# DY1203 도면마킹 관리 별도 분리안

## 1. 현재 문제점

- 홈 화면에 작업일지 작성·도면마킹 진입이 섞여 있어 현장 선택/왕복 동선이 길고 인지 부하가 큼.
- 도면마킹은 문서함(현장도면외 탭)과 데이터는 같지만, 작성/편집 흐름과 열람 UI가 분리돼 있어 연결 인지가 낮음.
- 모바일 작은 화면에서 작업일지 입력과 도면마킹을 한 세션에서 처리하려다 보니 입력 폼/도구가 복잡해지고 시간 소모가 큼.
- 작업일지 ↔ 도면마킹 참조가 일관되지 않아, 작성 후 마킹 추가/수정 시 재진입 동선이 불편.

## 2. 개선 방향 (원칙)

- 홈은 유지하되 “도면마킹 관리”를 별도 메뉴/페이지로 분리해 작성·편집·연동을 전담시킨다.
- 문서함 > 현장도면외 탭은 그대로 두고, “보기/보관” 역할만 유지한다(재브랜딩 불필요).
- 데이터 소스는 공통(현행 도면/마킹 테이블·스토리지 재사용)으로 두고, UI만 역할별로 분리한다.
- 작업일지와 도면마킹 참조를 간단한 링크/선택 필드로 묶어 “작성 → 마킹 선택/생성 → 제출” 흐름을 단순화한다.

## 3. 개선 시 변경되는 요소

- 네비게이션: 사이드바(또는 탑바)에 `도면마킹 관리` 메뉴 추가. 홈에는 짧은 CTA 버튼만 두고 상세 작업은 전용 페이지로 이동.
- 문서함 현장도면외 탭: 열람 위주 유지. 단, 필요 시 “마킹 관리로 이동” 버튼을 추가해 자연스러운 진입 동선을 제공.
- 전용 페이지 기능: 현장별 도면 목록/버전/마킹 상태 표시, 새 도면 업로드 후 마킹, 기존 마킹 이어하기, 작업일지와의 링크 설정/해제.
- 작업일지 작성/보기 화면: 마킹 참조 필드(선택/링크), 참조된 도면 바로 열기, 작성 후에도 마킹 추가/교체 가능.

## 4. 구체적 개선 구현 방안

1. 정보구조/라우팅
   - 모바일/현장관리자용 전용 페이지 신설(예: `/mobile/drawings` 또는 `/mobile/markups`).
   - 홈: “도면마킹 관리로 이동” 단일 CTA만 제공(현장 자동 필터를 위해 현재 선택/최근 사용 현장 정보를 넘김).
   - 문서함 탭: “마킹 관리로 이동” 보조 링크만 추가, 기존 뷰/다운로드 흐름은 그대로 유지.

2. 목록/상세 UX
   - 기본 필터: 현장 필수 선택(최근 선택/배정된 현장 자동 적용), 검색어·상태(미마킹/마킹완료) 필터 제공.
   - 카드/리스트 항목에 최신 마킹 여부, 작성자, 업데이트 일시, 참조된 작업일지 개수 표시.
   - 상세(뷰어)에서 “마킹 이어하기”, “다른 마킹 보기”, “작업일지에 연결” 버튼 제공.

3. 마킹 작성 흐름
   - “새 도면 업로드 후 마킹”과 “기존 도면에 추가 마킹”을 분리 버튼으로 제공.
   - 업로드 시 현장 필수, 파일 업로드 → 썸네일/버전 생성 → 바로 마킹 도구 진입.
   - 마킹 도구는 저장/임시저장/버전 기록, 되돌리기/다시하기, 간단한 레이어/주석 세트 유지.
   - 완료 시 “작업일지에 연결” 체크박스/선택 필드로 바로 연결 가능.

4. 작업일지 연동
   - 작업일지 작성/편집 화면에 `참조 도면마킹` 선택 필드 추가(현장 기준 필터). 선택 시 미리보기/바로가기 버튼 노출.
   - 작업일지 상세에서는 참조된 마킹을 열람·교체·추가할 수 있는 링크 제공(권한 내에서만).
   - 참조 관계는 단순히 작업일지 레코드에 도면/마킹 ID를 저장하는 방식으로 구현(기존 데이터 손상 없이).

5. 성능/오프라인 고려
   - 목록은 페이지네이션 + 썸네일 Lazy-load, 업로드는 진행률 표시 및 실패 복구 버튼 제공.
   - 마킹 저장은 네트워크 재시도/임시 저장(로컬) 옵션을 둬 현장 환경 불안정 시에도 작성 가능하게.

6. 권한/가드
   - 접근: site_manager/production_manager 기본 허용, partner/customer_manager는 파트너사/배정 현장 범위로 필터.
   - 데이터는 기존 도면/마킹 테이블과 동일 RLS를 그대로 사용해 중복 정책 도입 없이 UI만 분리.

7. 단계적 적용/완화책
   - 홈 섹션은 당분간 유지하되 “이제 도면마킹은 전용 페이지에서 관리하세요” 안내 배너 표시.
   - 기존 즐겨찾기/딥링크를 전용 페이지로 리다이렉트하거나 안내 모달 제공.

8. 테스트
   - 역할별(현장/생산/파트너)로 목록 필터, 업로드+마킹, 작업일지 링크/해제, 문서함에서 뷰→전용 페이지 이동 CTA 동작을 수동 체크.
   - 네트워크 불안정 시 업로드/저장 재시도, 이미지 용량 큰 경우 로딩 성능 확인.
