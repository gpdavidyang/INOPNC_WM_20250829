<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MainPage - Integrated</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css"
    />
    <link rel="stylesheet" href="./00main.css?v=2">
  </head>
  <body>
    <div
      id="app"
      class="container min-h-screen"
      style="
        background-color: var(--bg-body);
        color: var(--text-main);
        max-width: 600px;
        margin: 0 auto;
        padding: 0 16px;
      "
    >
      <!-- Quick Menu -->
      <section class="quick-menu-section" style="padding-top: 0px">
        <div class="qm-header">
          <div style="display: flex; align-items: center; gap: 6px">
            <img
              src="https://github.com/gpdavidyang/INOPNC_WM_20250829/raw/main/public/icons/Flash.png?raw=true"
              alt="빠른메뉴"
              class="qm-title-icon-img"
            />
            <span class="qm-title">빠른메뉴</span>
          </div>
        </div>
        <div class="qm-grid" id="quickMenuGrid">
          <!-- Quick menu items will be rendered here -->
        </div>
      </section>

      <!-- Site Info Card -->
      <div
        id="site-card"
        class="bg-bg-surface dark:bg-slate-800 rounded-2xl p-6 mb-4 shadow-sm border border-transparent dark:border-slate-700"
        style="background: var(--bg-surface); border: 1px solid var(--border)"
      >
        <div class="flex justify-between items-center mb-3">
          <div
            class="text-xl font-bold text-header-navy dark:text-white flex items-center gap-2"
            style="color: var(--header-navy)"
          >
            <i
              data-lucide="map-pin"
              style="width: 20px; height: 20px; color: var(--header-navy)"
            ></i>
            작업현장 <span style="color: var(--danger)">*</span>
          </div>
          <span
            class="bg-red-50 text-red-500 text-[13px] font-bold h-8 px-3.5 rounded-xl flex items-center"
          >
            * 필수 입력
          </span>
        </div>

        <div class="mb-3">
          <div class="relative">
            <input
              type="text"
              id="siteSearch"
              placeholder="현장 선택 또는 검색"
              class="site-search-optimized w-full h-[54px] bg-bg-input dark:bg-slate-900 border border-border dark:border-slate-600 rounded-xl px-4 text-[17px] font-medium outline-none transition-all placeholder:text-slate-400 dark:placeholder:text-slate-500"
              style="background: var(--bg-input); border: 1px solid var(--border)"
            />
            <button
              onclick="toggleSiteDropdown()"
              class="absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 dark:text-slate-500 hover:text-slate-600 dark:hover:text-slate-300 transition-colors"
            >
              <i data-lucide="chevron-down" style="width: 20px; height: 20px"></i>
            </button>

            <ul
              id="siteDropdown"
              class="site-dropdown-optimized absolute z-50 w-full mt-1.5 max-h-60 overflow-auto bg-[var(--bg-surface)] border border-border dark:border-slate-600 rounded-xl shadow-xl hidden"
              style="background: var(--bg-surface); border: 1px solid var(--border)"
            >
              <!-- Site options will be rendered here -->
            </ul>
          </div>
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div>
            <label class="block text-[15px] font-bold text-text-sub mb-2">
              소속 <span class="text-[14px] font-medium ml-1">ㅣ 자동연동</span>
            </label>
            <div class="relative">
              <input
                type="text"
                id="dept"
                readonly
                placeholder="자동연동"
                class="w-full h-[54px] bg-slate-100 dark:bg-slate-800 border border-border dark:border-slate-600 rounded-xl px-4 text-[17px] font-medium text-text-sub cursor-not-allowed"
                style="background: #f1f5f9; border: 1px solid var(--border); color: var(--text-sub)"
              />
              <div class="absolute top-2 right-2 flex items-center gap-1">
                <span
                  class="sub-badge contractor"
                  style="
                    font-size: 11px;
                    padding: 2px 6px;
                    height: 20px;
                    background: #eef2ff;
                    color: #6366f1;
                    border: 1px solid #c7d2fe;
                  "
                  >현대건설</span
                >
              </div>
            </div>
          </div>
          <div>
            <label class="block text-[15px] font-bold text-text-sub mb-2">작업일자</label>
            <div class="relative">
              <input
                type="date"
                id="workDate"
                class="w-full h-[54px] sm:h-[54px] bg-bg-input dark:bg-slate-900 border border-border dark:border-slate-600 rounded-xl px-3 sm:px-4 text-[15px] sm:text-[17px] font-medium outline-none focus:border-[#87CEEB] focus:ring-2 focus:ring-[#87CEEB]/20 transition-all cursor-pointer"
                style="
                  background: var(--bg-input);
                  border: 1px solid var(--border);
                  position: relative;
                  z-index: 1;
                  font-family: var(--font-main);
                "
              />
            </div>
          </div>
        </div>
      </div>

      <!-- Manpower Card -->
      <div
        id="manpower-card"
        class="bg-bg-surface dark:bg-slate-800 rounded-2xl p-6 mb-4 shadow-sm border border-transparent dark:border-slate-700"
        style="background: var(--bg-surface); border: 1px solid var(--border)"
      >
        <div class="flex justify-between items-center mb-3">
          <div
            class="text-xl font-bold text-header-navy dark:text-white flex items-center gap-2"
            style="color: var(--header-navy)"
          >
            <i data-lucide="users" style="width: 20px; height: 20px; color: var(--header-navy)"></i>
            투입 인원(공수) <span style="color: var(--danger)">*</span>
          </div>
          <button
            onclick="addManpower()"
            class="bg-primary-bg text-primary h-8 px-3.5 rounded-xl text-sm font-bold flex items-center gap-1 hover:bg-sky-100 transition-colors"
            style="background: var(--primary-bg); color: var(--primary)"
          >
            <span class="text-lg font-black">+</span> 추가
          </button>
        </div>

        <div class="flex flex-col gap-2.5" id="manpowerList">
          <!-- Manpower items will be rendered here -->
        </div>
      </div>

      <!-- Work Content Card -->
      <div
        class="bg-bg-surface dark:bg-slate-800 rounded-2xl p-6 mb-4 shadow-sm border border-transparent dark:border-slate-700"
        style="background: var(--bg-surface); border: 1px solid var(--border)"
      >
        <div class="flex justify-between items-center mb-3">
          <div
            class="text-xl font-bold text-header-navy dark:text-white flex items-center gap-2"
            style="color: var(--header-navy)"
          >
            <i
              data-lucide="hard-hat"
              style="width: 20px; height: 20px; color: var(--header-navy)"
            ></i>
            작업내용 <span style="color: var(--danger)">*</span>
          </div>
          <button
            onclick="addWorkSet()"
            class="bg-primary-bg text-primary h-8 px-3.5 rounded-xl text-sm font-bold flex items-center gap-1 hover:bg-sky-100 transition-colors"
            style="background: var(--primary-bg); color: var(--primary)"
          >
            <span class="text-lg font-black">+</span> 추가
          </button>
        </div>

        <div class="flex flex-col gap-4" id="workSets">
          <!-- Work sets will be rendered here -->
        </div>
      </div>

      <!-- Material Card -->
      <div
        class="bg-bg-surface dark:bg-slate-800 rounded-2xl p-6 mb-4 shadow-sm border border-transparent dark:border-slate-700"
        style="background: var(--bg-surface); border: 1px solid var(--border)"
      >
        <div class="flex justify-between items-center mb-3">
          <div
            class="text-xl font-bold text-header-navy dark:text-white flex items-center gap-2"
            style="color: var(--header-navy)"
          >
            <i
              data-lucide="package"
              style="width: 20px; height: 20px; color: var(--header-navy)"
            ></i>
            자재 사용 내역
            <span class="text-[14px] text-text-sub font-medium ml-2">ㅣ 자재 있을 시 입력</span>
          </div>
        </div>
        <div class="grid grid-cols-[1.8fr_1fr_auto] gap-2.5 mb-3 items-center">
          <select id="materialSelect" class="material-select">
            <option value="NPC-1000">NPC-1000</option>
            <option value="NPC-3000Q">NPC-3000Q</option>
            <option value="custom">직접입력</option>
          </select>
          <div
            class="flex items-center bg-bg-input dark:bg-slate-900 border border-border rounded-xl h-[48px] px-3"
            style="background: var(--bg-input); border: 1px solid var(--border)"
          >
            <input
              type="number"
              min="0"
              id="materialQty"
              placeholder="0"
              class="flex-1 bg-transparent text-right font-medium outline-none w-full"
            />
            <span class="text-text-sub text-[15px] font-medium ml-1">말</span>
          </div>
          <button
            onclick="addMaterial()"
            class="w-12 h-[48px] bg-primary-bg text-primary rounded-xl font-black text-lg flex items-center justify-center hover:bg-sky-100"
            style="background: var(--primary-bg); color: var(--primary)"
          >
            +
          </button>
        </div>

        <div id="customMaterialInput" class="flex gap-2 items-center mb-3 hidden">
          <input
            type="text"
            id="customMaterialValue"
            class="flex-1 min-w-0 h-[48px] bg-bg-input dark:bg-slate-900 border border-border rounded-xl px-3 sm:px-4 outline-none focus:border-[#87CEEB] focus:ring-2 focus:ring-[#87CEEB]/20 transition-all text-sm sm:text-base"
            placeholder="자재명 직접 입력"
            style="background: var(--bg-input); border: 1px solid var(--border)"
          />
          <button
            onclick="handleConfirmCustomMaterial()"
            class="bg-header-navy text-white px-3 sm:px-4 h-[48px] rounded-xl font-bold text-xs sm:text-sm whitespace-nowrap shrink-0"
            style="background: var(--header-navy)"
          >
            확인
          </button>
        </div>

        <!-- 영수증 업로드 -->
        <!-- 영수증 업로드 -->
        <div id="receiptUploadSection" class="mb-3 hidden">
          <div class="flex items-center gap-3">
            <input
              type="file"
              id="customReceiptInput"
              accept="image/*,.pdf"
              class="hidden"
              onchange="handleCustomReceiptUpload(event)"
            />
          </div>

          <div id="customReceiptPreview" class="mt-3 hidden">
            <div
              class="flex items-center justify-between bg-white dark:bg-slate-700 rounded-lg p-2 border"
              style="border-color: rgba(99, 102, 241, 0.35)"
            >
              <div class="flex items-center gap-2">
                <i data-lucide="receipt-text" style="width: 16px; height: 16px; color: #6366f1"></i>
                <span
                  id="customReceiptFileName"
                  class="text-sm text-text-main truncate max-w-[200px]"
                ></span>
              </div>
              <button onclick="removeCustomReceipt()" class="text-red-500 hover:text-red-700">
                <i data-lucide="x" style="width: 16px; height: 16px"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="flex flex-col gap-2" id="materialsList">
          <!-- Materials will be rendered here -->
        </div>
      </div>

      <!-- Photos & Drawings -->
      <div
        class="bg-bg-surface dark:bg-slate-800 rounded-2xl p-6 mb-4 shadow-sm border border-transparent dark:border-slate-700"
        style="background: var(--bg-surface); border: 1px solid var(--border)"
      >
        <div class="flex justify-between items-center mb-4">
          <div
            class="text-xl font-bold text-header-navy dark:text-white flex items-center gap-2"
            style="color: var(--header-navy)"
          >
            <i data-lucide="image" style="width: 20px; height: 20px; color: var(--header-navy)"></i>
            사진 및 도면
          </div>
        </div>

        <div
          id="mediaPreview"
          class="flex flex-nowrap gap-3 overflow-x-auto pb-3 pt-2 mb-3 px-1 w-full hidden"
          style="webkit-overflow-scrolling: touch"
        >
          <!-- Photos and drawings will be rendered here -->
        </div>

        <div class="grid grid-cols-2 gap-3">
          <div>
            <div class="text-[17px] font-bold text-text-sub mb-2">사진등록</div>
            <input
              type="file"
              multiple
              accept="image/*"
              class="hidden"
              id="photoInput"
              onchange="handleNativePhotoUpload(event)"
            />
            <input
              type="file"
              accept="image/*"
              class="hidden"
              id="replaceMediaInput"
              onchange="handleReplaceMedia(event)"
            />

            <button
              onclick="document.getElementById('photoInput').click()"
              class="w-full h-[50px] border border-dashed border-sky-400 bg-sky-50 text-sky-500 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-sky-100 transition-colors text-[15px] sm:text-[16px]"
            >
              <i data-lucide="camera" style="width: 20px; height: 20px"></i> 사진 등록
            </button>
          </div>
          <div>
            <div class="text-[17px] font-bold text-text-sub mb-2">도면마킹</div>
            <button
              onclick="openDrawingSheet()"
              class="w-full h-[50px] border border-dashed border-teal-400 bg-teal-50 text-teal-600 rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-teal-100 transition-colors text-[15px] sm:text-[16px]"
            >
              <i data-lucide="scan-line" style="width: 20px; height: 20px"></i> 도면마킹
            </button>
          </div>
        </div>
      </div>

      <!-- Floating Actions -->
      <div
        id="floatingActions"
        class="sticky bottom-[80px] bg-bg-surface dark:bg-slate-800 p-2.5 rounded-2xl border border-border shadow-xl mb-5 z-40 transition-all"
        style="background: var(--bg-surface); border: 1px solid var(--border)"
      >
        <div
          id="readyToSaveIndicator"
          class="save-ready-indicator absolute -top-5 left-1/2 -translate-x-1/2 text-white text-xs font-bold px-4 py-1 rounded-full shadow-lg hidden"
        >
          ✓ 저장 가능
        </div>
        <div class="flex gap-2.5">
          <button
            onclick="handleReset()"
            class="flex-1 h-[50px] bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300 font-bold rounded-xl border border-slate-300 dark:border-slate-600 text-[15px] sm:text-[16px]"
          >
            초기화
          </button>

          <!-- 임시 저장 (Temporary Save) -->
          <button
            onclick="handleTempSave()"
            class="flex-1 h-[50px] bg-sky-50 dark:bg-slate-800 text-sky-600 dark:text-sky-400 font-bold rounded-xl border border-sky-200 dark:border-sky-800 text-[15px] sm:text-[16px]"
          >
            임시 저장
          </button>

          <button
            id="saveButton"
            onclick="handleSave()"
            class="flex-1 h-[50px] text-white font-bold rounded-xl transition-all text-[15px] sm:text-[16px]"
            style="background: var(--header-navy); box-shadow: none"
          >
            일지저장
          </button>
        </div>
      </div>

      <!-- Drawing Bottom Sheet -->
      <div
        id="drawingSheet"
        class="fixed inset-0 bg-black/50 z-[100] hidden"
        onclick="closeDrawingSheet(event)"
      >
        <div
          class="fixed bottom-0 left-0 right-0 bg-[var(--bg-surface)] border-t border-[var(--border)] rounded-t-2xl p-6 z-[101] animate-[slideDown_0.3s_ease-out] max-w-[600px] mx-auto"
          onclick="event.stopPropagation()"
          style="background: var(--bg-surface); border: 1px solid var(--border)"
        >
          <div class="text-center font-bold text-lg mb-5 text-[var(--text-main)]">도면 선택</div>
          <label
            class="w-full h-[54px] bg-sky-50 text-sky-500 border border-sky-200 rounded-xl font-bold flex items-center justify-center gap-2 mb-2.5 cursor-pointer hover:bg-sky-100 transition-colors"
          >
            <i data-lucide="camera" style="width: 18px; height: 18px"></i> 도면 업로드
            <input
              type="file"
              multiple
              class="hidden"
              accept="image/*"
              onchange="handleDrawingUpload(event)"
              id="drawingInput"
            />
          </label>
          button
            onclick="handleLoadSiteDrawing()"
            class="w-full h-[54px] bg-[var(--bg-hover)] text-[var(--text-main)] border border-[var(--border)] rounded-xl font-bold flex items-center justify-center gap-2 mb-2.5 hover:bg-[var(--bg-input)] transition-colors"
            style="background: var(--bg-hover); border: 1px solid var(--border)"
          >
            <i data-lucide="map" style="width: 18px; height: 18px"></i> 현장 도면 불러오기
          </button>
          <button
            onclick="closeDrawingSheet()"
            class="w-full h-[54px] bg-header-navy text-white rounded-xl font-bold mt-2 hover:bg-slate-700 transition-colors"
            style="background: var(--header-navy)"
          >
            닫기
          </button>
        </div>
      </div>

      <!-- Site Drawing Viewer Overlay -->
      <div
        id="siteDrawingViewer"
        class="fixed inset-0 bg-slate-950 z-[60] flex flex-col animate-[fadeIn_0.2s] hidden"
      >
        <div
          class="h-[52px] bg-header-navy flex items-center justify-between px-3 text-white border-b border-white/10 shrink-0"
          style="background: var(--header-navy)"
        >
          <div class="flex items-center gap-2">
            <button onclick="closeSiteDrawingViewer()">
              <i data-lucide="x" class="w-6 h-6"></i>
            </button>
            <span class="font-bold text-lg">현장 도면 목록</span>
          </div>
        </div>
        <div class="flex-1 overflow-y-auto p-4 flex flex-col gap-4">
          <div class="max-w-[1200px] mx-auto w-full" id="siteDrawingPages">
            <!-- Site drawing pages will be rendered here -->
          </div>
        </div>
      </div>

      <!-- Drawing Modal -->
      <div id="drawingModal" class="fixed inset-0 bg-slate-950 z-50 flex flex-col hidden">
        <!-- Drawing modal content will be rendered here -->
      </div>

      <!-- Summary -->
      <div
        class="bg-bg-surface dark:bg-slate-800 rounded-2xl p-6 mb-8 shadow-sm border border-transparent dark:border-slate-700"
        style="background: var(--bg-surface); border: 1px solid var(--border)"
      >
        <div
          onclick="toggleSummary()"
          class="flex justify-between items-center pb-3 border-b border-border cursor-pointer mb-4"
          style="border-bottom: 1px solid var(--border)"
        >
          <div
            class="text-xl font-bold text-header-navy dark:text-white flex items-center gap-2"
            style="color: var(--header-navy)"
          >
            <i
              data-lucide="file-text"
              style="width: 20px; height: 20px; color: var(--header-navy)"
            ></i>
            작성 내용 요약
          </div>
          <i
            id="summaryIcon"
            data-lucide="chevron-down"
            class="text-text-sub"
            style="width: 20px; height: 20px; color: var(--text-sub)"
          ></i>
        </div>

        <div
          id="summaryContent"
          class="transition-all overflow-hidden"
          style="max-height: 0; opacity: 0"
        >
          <!-- Summary content will be rendered here -->
        </div>
      </div>

      <!-- Toast -->
      <div
        id="toast"
        class="fixed top-20 left-1/2 -translate-x-1/2 bg-slate-900/95 text-white px-4 py-2.5 rounded-full text-[13px] font-bold shadow-xl flex items-center gap-2 z-[9999] hidden"
      >
        <i data-lucide="check-circle-2" style="width: 16px; height: 16px; color: #10b981"></i>
        <span id="toastMessage"></span>
      </div>
    </div>

    <script src="./00main.js"></script>
  </body>
</html>
