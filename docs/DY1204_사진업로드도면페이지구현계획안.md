# DY1204 사진 업로드 · 도면 페이지 구현 계획안

## 1) 목적

- DY1203 사진·도면 관리 개선안에 따라 `/mobile/media` 전용 페이지를 신설하고, 사진/도면 업로드·마킹·작업일지 연동을 한 화면에서 처리한다.
- `docs/DY1204_사진&도면업로드_개선안.html` 레이아웃/스타일을 React+Tailwind로 이식해 모바일 우선 UI를 빠르게 확보한다.

## 2) 적용 범위

- 신규 라우트: `/mobile/media` (탭 기반), 필요 시 `/mobile/media/photos`, `/mobile/media/drawings` 서브 라우트 유지.
- 대상 탭: 사진 탭(보수 전/후 업로드), 도면 탭(업로드·마킹 이어하기·리스트·통계).
- 연계 화면: 홈/문서함/작업일지에서의 딥링크 및 “사진·도면 관리에서 열기”/“작업일지 연결” CTA.

## 3) 레이아웃/스타일 전환 가이드 (HTML → React/Tailwind)

- 컨테이너: 최대 480px, 배경 `#f4f6fb`, 카드 `#fff`, 그림자/보더는 tailwind shadow-sm/lg + `border`로 매핑.
- 상단바: 제목 + 보조 버튼(작성완료) 유지, 모바일 헤더 컴포넌트로 래핑.
- 검색/필터: 라운드 입력 + pill 필터 2개(현장, 기간) 공통 컨트롤. 검색/필터 상태는 전역 현장 컨텍스트에 바인딩.
- 탭: 라인 탭 스타일(활성 파란 언더라인). Tailwind `border-b`, `text-sky-500` 등으로 구현.
- 카드: 둥근 모서리(16px), 내부 패딩 16~18px. 버튼은 primary(남색) / outline / chip(라운드).
- 사진 탭: 2열 그리드(보수 전/후), 드롭존/카메라 버튼, 업로드 카운트, “전/후 업로드 스위치” 인라인 링크, 임시저장 안내 텍스트.
- 도면 탭: 업로드/이어하기 버튼 행, 리스트(제목/상태/작업일지 연결 수) + CTA(열기/이어하기/마킹 시작), 하단 통계 카드 3개.

## 4) 기능 설계 (DY1203 원칙 반영 + 작업일지 매핑 확장)

- 전역 현장 컨텍스트: 최근/배정 현장 자동 적용(localStorage + 서버 세션), 검색/필터/탭 공용 사용.
- 사진 관리:
  - 업로드(전/후), 태그/상태 배지, 멀티 선택 후 작업일지 연결/다운로드, 썸네일 lazy-load, 업로드 진행률·재시도·임시저장.
  - **작업일지 매핑**: 사진을 선택 후 `참조 작업일지` 필드로 연결/해제. 리스트/상세에서 “연결된 작업일지 수”와 링크된 일지 ID/제목 노출.
  - 필터: 현장, 기간, 작업일지 연결 여부(없음/있음), 태그/상태.
  - **최근 작업일지 패널**: 최근 작성/임시저장 작업일지 목록을 노출하고, 각 항목에 날짜, 현장명, 부재명, 작업공간, 업로드된 사진 수(보수 전/후), 상태 배지(임시저장/작성중/제출/승인 등)를 표시. 클릭 시 해당 작업일지로 이동하거나 사진 연결/확인 모달을 띄워 빠른 매핑을 지원.
- 도면 관리:
  - 도면 업로드, 버전/마킹 상태/작성자/업데이트일, 마킹 열기/이어하기, 작업일지 연결 수 표시, 썸네일 lazy-load.
  - **작업일지 매핑**: 마킹 도면을 선택 후 `작업일지 연결/해제`. 리스트에서 “연결된 작업일지 n건” 표시, 상세에서 작업일지 목록/CTA 제공.
  - 필터: 현장, 기간, 마킹 상태(미마킹/진행중/완료), 작업일지 연결 여부.
- 작업일지 연동: 사진(멀티)·도면마킹(싱글/멀티 옵션) 참조 ID 저장. 작업일지/문서함에서 `/mobile/media?siteId=&mediaId=`로 이동해 선택 유지. 작업일지 상세에는 연결된 사진/도면 목록과 “교체/추가” 버튼 유지.
- 문서함 연동: 사진함/현장도면외 상세/리스트에 “사진·도면 관리에서 열기” 링크 추가, 반대 방향으로 “문서함에서 보기/다운로드” 제공.

## 5) 상태/데이터 흐름

- 상태 관리: React 서버 컴포넌트 + 클라이언트 탭/필터 컴포넌트. 전역 컨텍스트 훅으로 현장/검색/기간/탭 상태 제공.
- 데이터: Supabase 테이블 재사용(사진/도면), 필터는 siteId/기간/상태/태그. 업로드 큐는 클라이언트 상태에 보관 후 제출 시 업로드.
- 업로드/마킹: 진행률 토스트, 실패 재시도 버튼. 오프라인/저속망 대비 임시 저장 메시지 유지.
- 권한/RLS: site_manager/production_manager 기본, partner/customer_manager는 배정 현장만 필터. UI에서 현장 필터 강제 적용.

## 6) 페이지 구조 (컴포넌트 초안)

- 상단바 `TopBar`: 제목/작성완료 버튼.
- `SearchFilterBar`: 검색 입력 + pill 필터(현장/기간).
- `Tabs`: 사진/도면.
- 사진 탭:
  - `PhotoUploadCard`: 전/후 그리드, 카운트, 드롭존 버튼, 전/후 전환 링크, 임시저장 안내.
  - `PhotoGrid`: 썸네일 + 상태 배지 + 멀티 선택 + 액션바(작업일지 연결/해제, 다운로드). 각 카드에 현장명, 연결된 작업일지 카운트/목록 진입 CTA.
  - `RecentWorklogsPanel`: 최근/임시저장 작업일지 리스트(날짜, 현장명, 부재명, 작업공간, 보수 전/후 사진 수, 상태 배지). 항목별 “사진 연결/보기” CTA 제공.
- 도면 탭:
  - `DrawingActions`: 새 도면 업로드, 마킹 이어하기.
  - `DrawingList`: 제목/상태/작업일지 수 + CTA. 도면별 연결 작업일지 카운트/상세 링크, 마킹 상태 배지.
  - `MediaStats`: 사진/도면/연결된 작업일지 카드.

## 7) 네비게이션/딥링크

- 홈/문서함/작업일지 CTA → `/mobile/media?siteId=&search=&mediaId=&tab=photo|drawing`.
- 초기 렌더 시 쿼리 파라미터를 전역 컨텍스트에 반영해 필터/탭/선택 상태를 복원. 작업일지 ID(`worklogId`)를 받으면 해당 일지와 매핑된 사진/도면을 기본 선택 상태로 표시.
- 기존 딥링크는 리다이렉트 또는 안내 모달로 전용 페이지 이동 유도.

## 8) 테스트 시나리오

- 역할별 노출: 배정 현장만 필터링, 권한 없는 현장 미노출.
- 업로드: 전/후 업로드 → 썸네일 생성 → 임시 저장 → 제출 시 서버 업로드, 실패 재시도.
- 도면: 업로드 → 마킹 열기/이어하기 → 상태/버전/작성자/업데이트일 표출 → 작업일지 연결/해제.
- 연동: 작업일지에서 연결/해제, 문서함↔전용 페이지 왕복 CTA. 사진/도면 리스트에서 작업일지 연결 여부 필터 동작 확인.
- 성능/UX: lazy-load, 페이지네이션, 저속망 업로드 재시도, 토스트/실패 복구 버튼.

## 9) 구현 순서 제안

1. `/app/mobile/media/page.tsx` 레이아웃(검색/필터/탭/카드) React+Tailwind로 변환.
2. 전역 현장 컨텍스트 훅 구현 및 검색/필터/탭 연결, 쿼리 파라미터 상태 복원(사이트/탭/검색/작업일지).
3. 사진 탭: 업로드 카드 + PhotoGrid(썸네일/상태/작업일지 카운트/필터) + 업로드 큐/토스트/임시저장.
4. 도면 탭: 리스트/CTA/통계 데이터 바인딩, 마킹 이어하기 라우트 연결, 작업일지 연결/해제 액션 추가.
5. 작업일지 매핑 UX: 사진·도면 리스트에서 작업일지 연결/해제, 작업일지 상세에서 매핑된 항목 노출/교체, 문서함↔전용 페이지 CTA 연동.
6. 역할/성능/오프라인 포함 E2E/통합 테스트 진행.
