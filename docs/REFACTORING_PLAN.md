# 📋 INOPNC WM 코드베이스 리팩토링 실행 계획서

> 작성일: 2025년 1월 13일  
> 작성자: Development Team  
> 버전: 1.0

## 📌 Executive Summary

현재 INOPNC WM 프로젝트는 **심각한 기술 부채**로 인해 개발 및 배포에 과도한 시간이 소요되고 있습니다.

- 배포 시간: **10시간 이상** (정상: 30분)
- 디버깅 시간: **월 80시간 이상**
- 타입 에러: **6,223개의 any 타입 사용**

**즉시 리팩토링을 시작하지 않으면 3개월 내 전면 재개발이 필요할 수 있습니다.**

---

## 🔍 1. 현황 분석

### 1.1 코드베이스 현황

| 지표                | 현재 상태 | 정상 범위  | 심각도       |
| ------------------- | --------- | ---------- | ------------ |
| **총 코드 라인**    | 167,658줄 | < 50,000줄 | 🔴 과도함    |
| **TypeScript 파일** | 1,339개   | < 500개    | 🔴 매우 많음 |
| **any 타입 사용**   | 6,223곳   | < 100곳    | 🔴 심각      |
| **중복 코드**       | ~40% 추정 | < 5%       | 🔴 매우 높음 |
| **컴포넌트 수**     | 400+      | < 150      | 🔴 과다      |

### 1.2 개발 프로세스 문제점

| 문제점              | 현재 상황 | 영향           |
| ------------------- | --------- | -------------- |
| **타입 체크 시점**  | 배포 시   | 10시간+ 디버깅 |
| **코드 리뷰**       | 없음      | 품질 저하      |
| **테스트 커버리지** | < 5%      | 버그 다발      |
| **CI/CD**           | 불완전    | 배포 실패 빈번 |

### 1.3 최근 3일 커밋 분석

- **총 커밋**: 30개
- **fix 커밋**: 30개 (100%)
- **평균 간격**: 3-4분
- **주요 내용**: TypeScript 타입 에러 수정

---

## 🎯 2. 목표 설정

### 2.1 단기 목표 (1개월)

- ✅ 배포 시간 30분 이내로 단축
- ✅ any 타입 사용 90% 감소
- ✅ 개발 중 타입 에러 즉시 발견
- ✅ 핵심 기능 테스트 커버리지 50%

### 2.2 중기 목표 (3개월)

- ✅ 코드 중복 5% 이하
- ✅ 컴포넌트 수 50% 감소
- ✅ 전체 테스트 커버리지 70%
- ✅ 자동화된 CI/CD 파이프라인

---

## 📅 3. 단계별 실행 계획

### Phase 1: 긴급 안정화 (Day 1-3)

**목표**: 즉시 배포 가능한 상태 만들기

#### 작업 항목

| #   | 작업                                       | 담당   | 소요시간 | 우선순위 |
| --- | ------------------------------------------ | ------ | -------- | -------- |
| 1.1 | Pre-commit Hook 설정 (Husky + lint-staged) | DevOps | 2시간    | 🔴 필수  |
| 1.2 | VS Code 설정 강화 (타입체크 실시간)        | 전체   | 1시간    | 🔴 필수  |
| 1.3 | 현재 빌드 에러 일괄 수정                   | 전체   | 1일      | 🔴 필수  |
| 1.4 | GitHub Actions 타입체크 추가               | DevOps | 3시간    | 🔴 필수  |
| 1.5 | 긴급 배포 프로세스 문서화                  | PM     | 2시간    | 🟡 중요  |

#### 설정 코드

```json
// package.json
{
  "scripts": {
    "type-check": "tsc --noEmit",
    "lint": "eslint . --ext .ts,.tsx",
    "pre-commit": "lint-staged"
  },
  "lint-staged": {
    "*.{ts,tsx}": ["tsc --noEmit", "eslint --fix", "prettier --write"]
  }
}
```

```json
// .vscode/settings.json
{
  "typescript.tsdk": "node_modules/typescript/lib",
  "typescript.enablePromptUseWorkspaceTsdk": true,
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true,
    "source.organizeImports": true
  }
}
```

### Phase 2: 타입 시스템 구축 (Week 1)

**목표**: 중앙화된 타입 관리 체계 구축

#### 작업 항목

| #   | 작업                     | 담당       | 소요시간 | 완료 기준     |
| --- | ------------------------ | ---------- | -------- | ------------- |
| 2.1 | 타입 정의 파일 구조 설계 | Senior Dev | 4시간    | 문서 승인     |
| 2.2 | API 응답 타입 통합       | Backend    | 2일      | 100% 타입화   |
| 2.3 | DB 스키마 타입 생성      | Backend    | 1일      | Prisma 동기화 |
| 2.4 | 컴포넌트 Props 정리      | Frontend   | 2일      | 중복 제거     |
| 2.5 | any 타입 1차 제거 (30%)  | 전체       | 1일      | 2,000개 제거  |

#### 폴더 구조

```
/types
├── api/                 # API 관련 타입
│   ├── auth.ts         # 인증 관련
│   ├── documents.ts    # 문서 관련
│   ├── workers.ts      # 작업자 관련
│   └── common.ts       # 공통 응답 타입
├── database/           # DB 스키마 타입
│   ├── generated.ts    # Prisma 자동생성
│   └── custom.ts       # 커스텀 타입
├── components/         # 컴포넌트 Props
│   ├── mobile.ts       # 모바일 UI
│   ├── desktop.ts      # 데스크톱 UI
│   └── shared.ts       # 공용 컴포넌트
├── utils/              # 유틸리티 타입
│   └── helpers.ts      # 헬퍼 타입
└── index.ts            # 전체 export
```

### Phase 3: API 레이어 통합 (Week 2)

**목표**: 데이터 페칭 로직 통합 및 표준화

#### 작업 항목

| #   | 작업                      | 담당       | 소요시간 | 기대효과      |
| --- | ------------------------- | ---------- | -------- | ------------- |
| 3.1 | 기본 API Hook 템플릿 생성 | Senior Dev | 1일      | 코드 재사용   |
| 3.2 | 도메인별 전문 Hook 개발   | Frontend   | 3일      | 50% 코드 감소 |
| 3.3 | 에러 처리 시스템 통합     | Backend    | 1일      | 일관된 에러   |
| 3.4 | React Query 캐싱 구현     | Frontend   | 2일      | 30% 성능 향상 |

#### Hook 구조

```typescript
/hooks
├── api/
│   ├── useApi.ts           # 기본 템플릿
│   ├── useAuth.ts          # 인증 관련
│   ├── useWorker.ts        # 작업자 데이터
│   ├── useDocuments.ts     # 문서 관리
│   └── useSite.ts          # 현장 정보
├── utils/
│   ├── useDebounce.ts
│   └── useLocalStorage.ts
└── index.ts
```

### Phase 4: 모바일 UI 정리 (Week 3)

**목표**: 새 모바일 UI 완성 및 구 버전 제거

#### 작업 항목

| #   | 작업               | 담당       | 소요시간 | 체크포인트  |
| --- | ------------------ | ---------- | -------- | ----------- |
| 4.1 | 중복 컴포넌트 매핑 | Frontend   | 1일      | 목록 작성   |
| 4.2 | 컴포넌트 통합      | Frontend   | 2일      | 50% 감소    |
| 4.3 | API 연동 완료      | Full Stack | 2일      | 100% 연동   |
| 4.4 | 구 컴포넌트 제거   | Frontend   | 1일      | 0% 구버전   |
| 4.5 | 성능 최적화        | Senior Dev | 1일      | 2초 내 로딩 |

---

## ⚠️ 4. 리스크 관리

### 4.1 리스크 매트릭스

| 리스크                  | 발생확률 | 영향도 | 위험도  | 대응 방안                      |
| ----------------------- | -------- | ------ | ------- | ------------------------------ |
| **배포 중 서비스 장애** | 중 (40%) | 높음   | 🔴 높음 | Feature Flag 사용, 단계별 배포 |
| **타입 수정 버그**      | 낮 (20%) | 중간   | 🟡 중간 | 철저한 테스트, 롤백 준비       |
| **개발 일정 지연**      | 높 (60%) | 낮음   | 🟡 중간 | 핵심 기능 우선, 버퍼 확보      |
| **팀원 저항**           | 중 (30%) | 중간   | 🟡 중간 | 교육 세션, 점진적 적용         |
| **성능 저하**           | 낮 (15%) | 높음   | 🟡 중간 | 성능 모니터링, A/B 테스트      |

### 4.2 롤백 계획

```bash
# 긴급 롤백 절차
1. git checkout [previous-stable-tag]
2. npm ci
3. npm run build
4. vercel rollback [deployment-id]
```

---

## 💰 5. ROI 분석

### 5.1 비용 분석

#### 투입 비용

| 항목               | 수량   | 단가        | 총 비용         |
| ------------------ | ------ | ----------- | --------------- |
| 개발자 (4명 × 3주) | 12 M/W | ₩5,000,000  | ₩60,000,000     |
| 도구 라이선스      | 1식    | ₩2,000,000  | ₩2,000,000      |
| 기회비용           | 3주    | ₩10,000,000 | ₩30,000,000     |
| **총 투입 비용**   |        |             | **₩92,000,000** |

#### 절감 효과 (연간)

| 항목           | 현재      | 개선 후   | 절감액/년        |
| -------------- | --------- | --------- | ---------------- |
| 디버깅 시간    | 80시간/월 | 10시간/월 | ₩168,000,000     |
| 배포 실패 처리 | 20시간/월 | 2시간/월  | ₩43,200,000      |
| 신규 기능 개발 | 15일/기능 | 5일/기능  | ₩240,000,000     |
| 버그 수정      | 40시간/월 | 10시간/월 | ₩72,000,000      |
| **총 절감액**  |           |           | **₩523,200,000** |

### 5.2 투자 회수 기간

- **투자금**: ₩92,000,000
- **월 절감액**: ₩43,600,000
- **회수 기간**: **2.1개월**
- **1년 ROI**: **468%**

---

## 📊 6. 성공 지표 (KPI)

### 6.1 주간 체크포인트

| 주차    | 마일스톤     | 성공 기준              | 측정 방법   |
| ------- | ------------ | ---------------------- | ----------- |
| **1주** | Phase 1 완료 | ✅ 빌드 30분 내        | CI/CD 로그  |
| **2주** | Phase 2 완료 | ✅ any 타입 50% 감소   | TSC 리포트  |
| **3주** | Phase 3 완료 | ✅ API 코드 40% 감소   | LOC 분석    |
| **4주** | Phase 4 완료 | ✅ 모바일 UI 100% 완성 | 기능 테스트 |

### 6.2 핵심 성과 지표

```typescript
interface RefactoringKPI {
  buildTime: number // 목표: < 30분
  anyTypeCount: number // 목표: < 500
  testCoverage: number // 목표: > 50%
  duplicateCode: number // 목표: < 5%
  deploymentSuccess: number // 목표: > 95%
}
```

---

## 🚀 7. 실행 권고사항

### 7.1 즉시 실행 사항 (Today)

1. ⚡ **Pre-commit Hook 설정** - 2시간 내 완료
2. ⚡ **팀 미팅** - 계획 공유 및 역할 분담
3. ⚡ **백업** - 현재 코드베이스 전체 백업

### 7.2 주의사항

- ⚠️ main 브랜치 직접 수정 금지
- ⚠️ 대규모 변경은 Feature Flag로 보호
- ⚠️ 매일 오전 스탠드업 미팅 필수
- ⚠️ 문제 발생 시 즉시 롤백

### 7.3 커뮤니케이션 계획

- **일일 스탠드업**: 오전 10시
- **주간 리뷰**: 금요일 오후 4시
- **긴급 채널**: Slack #refactoring-emergency
- **문서 공유**: Notion 또는 Confluence

---

## 📝 8. 부록

### 8.1 참고 자료

- [TypeScript 공식 문서](https://www.typescriptlang.org/docs/)
- [React 최적화 가이드](https://react.dev/learn/render-and-commit)
- [Clean Code JavaScript](https://github.com/ryanmcdermott/clean-code-javascript)

### 8.2 도구 및 라이브러리

```json
{
  "devDependencies": {
    "@typescript-eslint/eslint-plugin": "^6.0.0",
    "@typescript-eslint/parser": "^6.0.0",
    "eslint": "^8.45.0",
    "husky": "^8.0.3",
    "lint-staged": "^13.2.3",
    "prettier": "^3.0.0"
  }
}
```

### 8.3 연락처

- **프로젝트 리더**: project-lead@inopnc.com
- **기술 지원**: tech-support@inopnc.com
- **긴급 연락**: 010-XXXX-XXXX

---

## ✅ 9. 승인

| 역할      | 이름 | 서명 | 날짜 |
| --------- | ---- | ---- | ---- |
| CTO       |      |      |      |
| PM        |      |      |      |
| Tech Lead |      |      |      |
| QA Lead   |      |      |      |

---

> **"기술 부채는 복리로 증가합니다. 지금 시작하지 않으면, 6개월 후에는 전면 재개발이 필요할 것입니다."**

---

_이 문서는 정기적으로 업데이트됩니다. 최종 수정일: 2025-01-13_
