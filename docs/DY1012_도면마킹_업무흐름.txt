DY1012 · 모바일 도면 마킹 업무흐름 가이드

본 문서는 모바일 앱의 홈 화면에서 소속/현장 선택 후 도면 마킹(표시)까지의 주요 업무흐름을 정의합니다. 공도면이 있는 경우와 없는 경우로 분기되는 UI/기능 차이를 중심으로 작성되었습니다.

[1] 용어 정의
- 소속: 사용자가 속한 회사/파트너 조직 단위
- 현장: 공사 프로젝트 단위(현장 식별자 기반)
- 공도면: 현장에 등록되어 사용자에게 공개된 기준 도면(버전/구역/층 포함)
- 마킹: 도면 위에 핀/선/영역/텍스트 등으로 작업 정보를 표시하는 행위
- 작업 항목: 마킹으로 생성되는 관리 단위(공종/유형/담당/기한 등 메타데이터 포함)
- 상태: 작업 항목의 진행 상태(draft, submitted, in_review, approved, rejected)

[2] 전제 조건
- Supabase Auth 로그인 완료 및 권한 부여
- 모바일 홈 화면에서 소속과 현장 선택 가능
- 오프라인 임시저장/동기화 UI 제공

[3] 상위 플로우(개요)
모바일 홈
  └─ 소속 선택
      └─ 현장 선택
          └─ 공도면 존재 여부 확인
              ├─ [있음] 도면 목록/뷰어 → 마킹 → 임시저장/제출 → 검토/확정
              └─ [없음] 도면 없음 안내 → (도면 요청 / 사진 기반 마킹 / 도면 업로드 권한자 액션)

[4] 분기 A: 공도면이 있는 경우
A-1. 도면 접근
- 소속/현장 선택 완료 시 현장별 도면 섹션 노출
- 도면 목록 필터/정렬: 버전/층/구역/분류/최근 수정순
- 도면 썸네일 또는 열기 → 도면 뷰어 진입

A-2. 도면 뷰어 핵심 기능
- 확대/축소, 이동, 레이어 토글
- 마킹 도구: 핀(점), 폴리라인(선), 폴리곤(영역), 텍스트, (옵션)치수
- 속성 입력: 공종, 작업 유형, 우선순위, 담당자, 마감일, 설명, 첨부(사진/동영상/파일)
- 마킹은 도면 좌표/페이지에 고정되어 복원

A-3. 저장과 협업
- 임시저장: 로컬/오프라인 큐 → 온라인 시 자동 동기화
- 제출: 검토 요청(submitted)
- 검토/승인: 코멘트 및 상태 변경(approved/rejected)
- 히스토리: 상태/첨부 변경 이력

A-4. 예외/에러 처리
- 권한 부족: 읽기 전용 표시
- 파일 미지원: 이미지 렌더 폴백
- 대용량: 로딩/진행 상태 표시

[5] 분기 B: 공도면이 없는 경우
B-1. 안내 및 대체 흐름
- 도면 없음 상태 화면과 액션 제공
  1) 도면 업로드 요청 생성
  2) 현장 사진 기반 마킹
  3) (권한자) 도면 직접 업로드/등록

B-2. 사진 기반 마킹
- 촬영/갤러리 → 뷰어 유사 UI에서 마킹
- 도면 참조 없음 상태로 저장, 이후 도면 등록 시 매핑 가능(옵션)

B-3. 업로드 요청/처리
- 일반 사용자: 요청 생성 및 상태 추적
- 관리자/파트너: 파일 업로드, 버전/층/구역 메타데이터 입력, 공개 범위 설정 후 게시

[6] 화면 구성 요약
- 홈 화면: 소속/현장 선택기, 현장 단축 액션(도면/작업/보고)
- 도면 목록: 필터/정렬, 썸네일, 최근 업데이트, 오프라인 배지
- 도면 뷰어: 캔버스, 마킹 도구, 속성 패널, 첨부, 히스토리
- 도면 없음 화면: 요청 생성, 사진 기반 마킹, 권한자 업로드 진입

[7] 권한과 라우팅(요약)
- 역할 예: 작업자(Worker), 반장/현장소장(Supervisor), 관리자(Admin), 파트너(Partner)
- 가시성 예:
  - Worker: 마킹 생성/제출 가능, 업로드 불가
  - Supervisor/Admin: 검토/승인, 업로드 가능(정책에 따름)
  - Partner: 파트너 소속 현장 관리 기능 접근

[8] 데이터와 동기화(개념)
- 엔티티: Organization, Site, Drawing, Page, Markup, Attachment
- 상태: draft → submitted → in_review → approved/rejected
- 오프라인: queued → syncing → synced / failed

[9] 시나리오 예시
A. 도면이 있는 현장
1) 홈 → 소속 A / 현장 X
2) 도면 B1 v2 선택 → 뷰어
3) 폴리곤 마킹(전기/점검/담당/기한/사진 첨부)
4) 임시저장 후 온라인 복구 시 자동 동기화
5) 제출 → 승인

B. 도면이 없는 현장
1) 홈 → 소속 B / 현장 Y → 도면 없음 화면
2) 업로드 요청 또는 사진 기반 마킹
3) 작업 항목 생성/공유
4) 이후 도면 업로드 시 매핑(옵션)

[10] QA 체크리스트(권장)
- 소속/현장 변경 시 데이터/권한 캐시 갱신 여부
- 공도면 유/무에 따른 화면 분기 정확성
- 오프라인 임시저장 및 온라인 동기화 안정성
- 권한별 버튼 노출/비활성화 정확성
- 대용량 도면 뷰어 성능 기준 충족
- 제출/승인 이력 및 첨부 미리보기 정상 동작

[11] 향후 확장 포인트
- 공종별 마킹 템플릿, 자동 층/구역 감지, PDF/Excel 보고서, 도면 비교/이력

문서 버전: DY1012 / 최초 작성 2025-10-12
