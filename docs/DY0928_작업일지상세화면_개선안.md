# DY0928 작업일지 상세 화면 개선안

본 문서는 요구 시안(좌측, `dy_memo/new_image_html_v3.0/inopnc-page/public/raw/task.html`의 “작업일지 상세”)과 현재 구현(우측, `modules/mobile/components/worklogs/DiaryDetailViewer.tsx` 등)의 차이를 분석하고, 동일한 UI/UX/스타일/레이아웃으로 수렴시키기 위한 개선 항목과 구현 계획을 정리합니다.

## 요약

- 레이아웃: 시안은 상단 헤더 + 정보 테이블 + 첨부 탭 + 미리보기/컨트롤. 현재는 하단 슬라이드 인 패널(바텀시트) + 카드 목록.
- 정보 항목: 시안에는 주소/블럭·동·층 등이 표준 테이블 행으로 정렬. 현재는 일부 항목만 ‘정보 카드’ 형태.
- 첨부 UI: 시안은 “사진대지/진행도면/완료확인서/기타서류” 탭 전환 + 수량/줌 컨트롤. 현재는 섹션별 나열 + 컨트롤 없음.
- 스타일: 시안의 색/테두리/라운드(10px)·간격 체계가 일관. 현재는 일부 팔레트 차이, 라운드/보더/여백 불일치.

## 주요 차이점 상세

- 헤더/타이틀
  - 시안: “작업일지 상세” 제목 + 우측 ‘닫기’ 버튼( pill ).
  - 현재: 사이트명 + 날짜/공정 문구 + 우측 X 아이콘.
- 기본 정보 블록
  - 시안: 6행 표(현장명/주소/부재명/작업공정/작업유형/블럭·동·층) 형태, 우측 값 영역은 연한 surface 배경.
  - 현재: ‘현장/작업공정/작업유형/공수/작성자/위치/특이사항’ 카드 리스트. ‘주소’ 누락, 위치 표기가 free text.
- 첨부 문서 영역
  - 시안: 탭 4종(사진대지/진행도면/완료확인서/기타서류), 선택 탭의 리스트만 표시. 상단에 줌(- 100% +) 컨트롤.
  - 현재: 섹션을 모두 노출. 각 아이템 카드에 ‘열기/다운로드’ 버튼. 마킹 문서 별도 섹션 존재.
- 상호작용
  - 시안: 탭 전환, 첨부 썸네일 확대/축소, 상단 닫기 버튼, (옵션) 전체 다운로드.
  - 현재: 섹션 스크롤, 닫기(X) 및 풋터 버튼(닫기/마킹 열기/전체 다운로드)만 제공, 확대/축소 없음.
- 스타일/토큰
  - 시안 변수: --bg, --card, --line, --tag-blue(#31a3fa) 등 일관. 라운드 10px, 보더 #E6ECF4, 바 shadow 낮음.
  - 현재: 일부 페이지에서 #e5e7eb, #2f6bff/ #0068FE 혼재, 라운드 12~16px, 섀도 강도 상이.

## 개선 항목(기능/레이아웃/스타일)

1. 상세 패널 레이아웃을 시안 구조로 재배치

- 옵션 A(권장): 기존 바텀시트 유지하되 내부 레이아웃을 시안과 동일하게 구성(헤더/정보테이블/탭/컨트롤 순서).
- 옵션 B: 사이드/센터 모달 시트(고정 높이, 상단 헤더)로 전환.
- 파일: `modules/mobile/components/worklogs/DiaryDetailViewer.tsx:126`

2. 상단 헤더 영역 시안화

- 타이틀을 고정 텍스트 “작업일지 상세”로, 닫기 버튼을 pill 스타일(문자 ‘닫기’)로 제공.
- 보조 텍스트(사이트/날짜/공정)는 정보 테이블로 이동.
- 파일: `modules/mobile/components/worklogs/DiaryDetailViewer.tsx:134`

3. 정보 테이블(6행) 구현 및 데이터 매핑 보강

- 행: 현장명 / 주소 / 부재명 / 작업공정 / 작업유형 / 블럭·동·층
- 현재 누락 데이터
  - 주소: API 응답에 `sites.address` 존재 → 타입/매핑 추가 필요
    - 타입: `types/worklog.ts`의 `WorklogDetail`에 `siteAddress?: string` 추가
    - 매핑: `modules/mobile/data/worklog-api.ts:141` `mapReportToDetail()`에서 `siteAddress: report.sites?.address ?? ''`
  - 블럭·동·층: 현재 `location.{block,dong,unit}` 매핑 이미 존재, 표준 표기로 조합
- 스타일: 좌 라벨 고정폭/우 값 배경 surface-2(연한 회색) + 테두리 #E6ECF4 + 라운드 10px
- 파일: `modules/mobile/components/worklogs/DiaryDetailViewer.tsx:147`

4. 첨부 탭 컴포넌트 도입

- 신규 컴포넌트: `modules/mobile/components/worklogs/AttachmentTabs.tsx`
  - 탭: 사진대지(photos) / 진행도면(drawings) / 완료확인서(completionDocs) / 기타서류(others)
  - 수량: `worklog.attachmentCounts` 활용(이미 제공)
  - 상태: URL 해시 또는 내부 state로 제어
- 기존 섹션 나열 제거 후, 활성 탭의 리스트만 렌더링
- 파일 대체: `modules/mobile/components/worklogs/DiaryDetailViewer.tsx:188` 이하의 섹션 렌더 → 탭 기반 렌더로 교체

5. 첨부 썸네일/리스트 + 줌 컨트롤

- 컨트롤: `[-] 100% [+]` (단계 75/100/125/150%), 키보드/터치 대응
- 썸네일: 고정 비율(4:3), 라운드 10px, hover 보더/섀도 미세 강조
- 성능: lazy 로딩, 대용량 시 가상 스크롤 검토
- 파일: `modules/mobile/components/worklogs/AttachmentGallery.tsx` (신규), 스타일 `modules/mobile/styles/worklogs.css`

6. 마킹(진행도면) 통합 노출

- 시안의 ‘진행도면’ 탭에서 마킹 문서도 함께 노출되도록 통합(‘열기’ 버튼 유지)
- 구현: 기존 `linkedMarkups` 목록을 drawings 탭의 상단에 병합하여 표시
- 파일: `modules/mobile/components/worklogs/DiaryDetailViewer.tsx:188`

7. 풋터/액션 정리

- 시안 상단 ‘닫기’ 버튼이 있으므로 풋터는 선택(모바일 접근성 고려 시 유지 가능)
- ‘전체 다운로드’는 유지하되, 문구/아이콘 일관(#31a3fa 기반)
- 파일: `modules/mobile/components/worklogs/DiaryDetailViewer.tsx:220`

8. 컬러/라운드/보더/간격 토큰 통일

- 변수 제안(시안 기준)
  - `--line: #E6ECF4`, `--card: #FFFFFF`, `--tag-blue: #31a3fa`, 라운드 10px 통일
- 적용 대상
  - 상세 테이블/탭/썸네일/컨트롤: `modules/mobile/styles/worklogs.css`
  - 현재 12~16px 라운드 → 10px로 통일, 보더 `#E6ECF4`로 교체

## 구현 계획(스텝)

1. 타입/데이터 확장

- `types/worklog.ts`에 `WorklogDetail.siteAddress?: string` 추가
- `modules/mobile/data/worklog-api.ts:141` `mapReportToDetail()`에 `siteAddress` 매핑 추가

2. UI 구조 개편

- `DiaryDetailViewer`를 헤더/정보테이블/탭/갤러리/풋터의 섹션 컴포지션으로 리팩터링
  - 파일 시작점: `modules/mobile/components/worklogs/DiaryDetailViewer.tsx:126`

3. 첨부 탭/갤러리 컴포넌트화

- `AttachmentTabs.tsx`, `AttachmentGallery.tsx` 신설 → `DiaryDetailViewer`에서 사용
- 갤러리에서 줌 상태(%) 보존, 썸네일 클릭 시 미리보기 모달(선택)

4. 스타일 정합성 정리

- `modules/mobile/styles/worklogs.css`에 상세 전용 클래스를 추가
  - `.detail-header`, `.info-table`, `.detail-tabs`, `.zoom-toolbar`, `.thumb`, `.thumb--doc`
- 라운드 10px/보더 #E6ECF4/배경 surface 규칙을 통일 적용

5. 접근성/모바일 최적화

- 탭은 role=tablist/tab/tabpanel, 키보드 포커스 가능
- 닫기 버튼은 텍스트 버튼 ‘닫기’ 유지(스크린리더 친화)
- 스크롤 잠금/포커스 트랩 확인

6. (옵션) 전체 다운로드

- API가 없으면 클라이언트에서 JSZip으로 번들 다운로드 구현(용량 제한 고려)

## 수용 기준(AC)

- 상단에 “작업일지 상세” 고정 타이틀과 ‘닫기’ 버튼이 보인다.
- 정보 영역이 6행 표로 표시되고 ‘주소’가 포함된다.
- 첨부 영역은 탭 4개로 전환되며, 활성 탭만 표시된다.
- 줌 컨트롤로 썸네일 크기를 75/100/125/150%로 변경할 수 있다.
- 색상/라운드/보더/간격이 시안과 시각적으로 일치한다(10px 라운드, #E6ECF4 보더, #31a3fa 포커스/강조).

## 영향 범위/리스크

- DiaryDetailViewer 리팩터로 인한 클래스 변경 → 기존 스타일 의존부 점검 필요
- 데이터 매핑 추가(siteAddress)로 타입/Mock 업데이트 필요
- 이미지/문서 썸네일 로딩 성능: lazy 및 캐시 전략 반영

## 파일별 작업 목록(참조)

- 상세 뷰 로직: `modules/mobile/components/worklogs/DiaryDetailViewer.tsx:126`
- 스타일: `modules/mobile/styles/worklogs.css`
- 타입: `types/worklog.ts`
- 데이터 매핑: `modules/mobile/data/worklog-api.ts:141`
- (신규) 탭/갤러리: `modules/mobile/components/worklogs/AttachmentTabs.tsx`, `modules/mobile/components/worklogs/AttachmentGallery.tsx`

## 비고

- 시안의 텍스트/여백/테두리 수치가 이미 `task.html`에 정의되어 있으므로 동일 수치로 반영합니다.
- 필요 시 데스크톱/태블릿 레이아웃(2열)도 탭/정보 블록을 좌/우 분리하여 확장 가능합니다.
