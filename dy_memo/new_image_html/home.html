<!doctype html>
<html lang="ko" data-theme="light">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, maximum-scale=1">
<meta name="referrer" content="no-referrer">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<base href="./">
  <title>INOPNC - 작업일지</title>
  <!-- 통일된 아이콘 설정 (캐싱 방지) -->
  <link rel="icon" href="image/00_로고-세로조합.png?v=2" type="image/png" />
  <link rel="apple-touch-icon" href="image/00_로고-세로조합.png?v=2" />
  <link rel="manifest" href="manifest.json?v=2" />
  
  <script>
    window.APP_VERSION = 'v' + Date.now();
    
    // 모바일 뷰포트 대응 초기화
    function initMobileViewport() {
      // CSS 변수로 동적 뷰포트 높이 설정
      function setViewportHeight() {
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
      }
      
      // 초기 설정
      setViewportHeight();
      
      // 리사이즈 시 업데이트
      window.addEventListener('resize', setViewportHeight);
      
      // visualViewport API 지원 시 키보드 대응
      if (window.visualViewport) {
        function handleViewportChange() {
          const viewport = window.visualViewport;
          const height = viewport.height;
          const offsetTop = viewport.offsetTop;
          
          // 키보드가 나타났을 때
          if (height < window.innerHeight) {
            document.body.style.height = `${height}px`;
            document.body.style.paddingBottom = `${window.innerHeight - height}px`;
          } else {
            // 키보드가 사라졌을 때
            document.body.style.height = '';
            document.body.style.paddingBottom = '';
          }
          
          // 포커스된 입력 필드가 화면에 보이도록 조정
          const activeElement = document.activeElement;
          if (activeElement && (activeElement.tagName === 'INPUT' || activeElement.tagName === 'TEXTAREA')) {
            setTimeout(() => {
              activeElement.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'center',
                inline: 'nearest'
              });
            }, 100);
          }
        }
        
        window.visualViewport.addEventListener('resize', handleViewportChange);
        window.visualViewport.addEventListener('scroll', handleViewportChange);
      }
    }
    
    // DOM 로드 시 초기화
    document.addEventListener('DOMContentLoaded', initMobileViewport);
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700;800&display=swap" rel="stylesheet" />
  <style>
    .logo-text{ font-family:'Poppins', system-ui, sans-serif; font-weight:700; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale; text-rendering:optimizeLegibility; }
  </style>

  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700;800&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700;800&display=swap" rel="stylesheet">
  
  <!-- 폰트 로딩 확인 스크립트 -->
  <script>
    document.fonts.ready.then(function () {
      console.log('폰트 로딩 완료:', document.fonts.check('16px "Noto Sans KR"'));
    });
  </script>

  <!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>
  <script>tailwind.config = { darkMode: 'class' };</script>

<style>
    :root{
      --font:'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      --bg:#f5f7fb; --card:#ffffff; --text:#101828; --muted:#667085; --line:#e6eaf2;
      --header-h:56px; --nav-h:64px; --nav-bg:#ffffff; --nav-border:#e5e7eb; --nav-text:#6b7280; --nav-text-active:#2563eb;
      --brand:#1A254F; --num:#0068FE; /* 브랜드 색상 및 번호 컬러 */
      --label-fz:16px; --label-fw:800; --label-lh:1.2; --label-track:-0.2px;
      
      /* 모바일 뷰포트 대응 */
      --vh: 1vh;
      --dvh: 100dvh;
      --svh: 100svh;
    }
    [data-theme="dark"]{
      --bg:#0f172a; --surface:#11151B; --card:#0f172a; --overlay:#0f172aCC; --line:#3A4048; --line-soft:#2A2E35;
      --text:#E9EEF5; --text-muted:#A8B0BB; --icon:#B9C2CE;
      --accent:#2F6BFF; --accent-weak:#1E4EDC; --accent-ghost:#2F6BFF1A;
      --success:#22C55E; --warn:#F59E0B; --danger:#EF4444;
      --shadow:0 10px 26px rgba(0,0,0,.35); --radius:8px;
      --nav-bg:#11151B; --nav-border:#3A4048; --nav-text:#A8B0BB; --nav-text-active:#2F6BFF;
    }
    *{ box-sizing:border-box; }
    html { -webkit-text-size-adjust: 100%; }
    body{ 
      margin:0; 
      background:var(--bg); 
      color:var(--text); 
      font-family:var(--font); 
      font-size:15px; 
      line-height:1.6; 
      transition: font-size 0.3s ease; 
      overscroll-behavior: contain;
    }
    
    /* 모바일 입력 필드 최적화 */
    input, select, textarea { 
      font-size: 16px !important; 
      -webkit-appearance: none;
      appearance: none;
      border-radius: 0;
    }
    
    /* iOS 자동 줌 방지 */
    input[type="text"], 
    input[type="password"], 
    input[type="email"], 
    input[type="tel"], 
    input[type="url"], 
    input[type="search"], 
    textarea, 
    select { 
      font-size: 16px !important; 
    }
    
    /* ===== 글씨 크기 스위치 ===== */
    body.fs-100{font-size:15px; font-weight:200; font-family:'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif;}
    body.fs-150{
      font-size:27px; /* 15px * 1.8 = 27px */
      font-weight:200; 
      font-family:'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif;
    }
    
    /* 큰글씨 모드에서 컨테이너 너비 조정 */
    body.fs-150 .container{
      max-width: 100%;
      padding-left: 0.5rem;
      padding-right: 0.5rem;
      min-height: calc(100vh - var(--header-h) - var(--nav-h));
      padding-top: calc(var(--header-h) + 1rem);
      padding-bottom: calc(var(--nav-h) + 1rem);
    }
    
    /* 큰글씨 모드에서 카드 패딩 조정 */
    body.fs-150 .card{
      padding: 0.5rem;
      margin-bottom: 0.5rem;
    }
    
    /* 큰글씨 모드에서 그리드 간격 조정 */
    body.fs-150 .grid{
      gap: 0.375rem;
    }
    
    /* 큰글씨 모드에서 버튼 크기 조정 */
    body.fs-150 .chip{
      padding: 0.25rem 0.5rem;
      font-size: 1.125rem;
      margin: 0.125rem;
      word-break: keep-all;
      overflow-wrap: break-word;
      white-space: normal;
      line-height: 1.3;
    }
    
    /* 큰글씨 모드에서 입력 필드 조정 */
    body.fs-150 .ctl{
      padding: 0.375rem 0.5rem;
      font-size: 1.125rem;
      word-break: keep-all;
      overflow-wrap: break-word;
      line-height: 1.4;
    }
    
    /* 확대 모드에서 입력 필드 텍스트 처리 */
    body.fs-150 input,
    body.fs-150 textarea,
    body.fs-150 select {
      word-break: keep-all;
      overflow-wrap: break-word;
      white-space: normal;
    }
    
    /* 확대 모드에서 플렉스 컨테이너 텍스트 처리 */
    body.fs-150 .flex {
      min-width: 0;
      overflow-wrap: break-word;
    }
    
    body.fs-150 .flex > * {
      min-width: 0;
      word-break: keep-all;
      overflow-wrap: break-word;
    }
    
    /* 큰글씨 모드에서 고정 요소 위치 안정화 */
    body.fs-150 header.appbar{
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 100;
      height: var(--header-h); /* 높이 고정으로 로고 위치 유지 */
      background: var(--card);
      border-bottom: 1px solid var(--line);
      padding: 0 0.375rem;
    }
    
    /* 큰글씨 모드에서 브랜드 로고 수직 정렬 고정 */
    body.fs-150 .brand-logo{
      line-height: var(--header-h); /* 헤더 높이와 동일하게 설정 */
      vertical-align: middle;
      font-size: 20px !important; /* 폰트 크기 고정으로 쪼개짐 방지 */
      white-space: nowrap; /* 텍스트 줄바꿈 방지 */
      overflow: hidden; /* 넘치는 텍스트 숨김 */
      text-overflow: ellipsis; /* 넘치는 텍스트에 ... 표시 */
      max-width: 120px; /* 최대 너비 제한 */
    }
    
    body.fs-150 .search-page{
      position: fixed;
      inset: 0;
      z-index: 9999;
      background: var(--card);
      display: none;
      overflow: auto;
    }
    
    /* 큰글씨 모드에서 제목 크기 조정 */
    body.fs-150 .q{
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
      word-break: keep-all;
      overflow-wrap: break-word;
      line-height: 1.4;
    }
    
    /* 큰글씨 모드에서 섹션 제목 크기 조정 */
    body.fs-150 .section-title{
      font-size: 1.25rem;
      margin-bottom: 0.5rem;
      word-break: keep-all;
      overflow-wrap: break-word;
      line-height: 1.4;
    }
    
    /* 큰글씨 모드에서 빠른메뉴 문구 크기 조정 */
    body.fs-150 #quick-menu .quick-item span{
      font-size: 1.05rem;  /* 큰글씨 모드에서 20% 확대 (14px → 16.8px) */
      padding: 0.25rem;
      word-break: keep-all;
      overflow-wrap: break-word;
      line-height: 1.3;
    }
    
    /* 확대 모드에서 텍스트 오버플로우 처리 */
    body.fs-150 * {
      word-break: keep-all;
      overflow-wrap: break-word;
      hyphens: auto;
    }
    
    /* 확대 모드에서 컨테이너 너비 보장 */
    body.fs-150 .container,
    body.fs-150 .card,
    body.fs-150 .grid,
    body.fs-150 .flex {
      min-width: 0;
      overflow-wrap: break-word;
    }
    
    /* 큰글씨 모드에서 라벨 크기 조정 */
    body.fs-150 .text-sm{
      font-size: 16px;
    }
    
    /* 큰글씨 모드에서 요약 박스 조정 */
    body.fs-150 #summary{
      padding: 8px;
    }
    
  /* 작업 내용 기록 카드 스타일 */
  .work-card {
    border: 1px solid #E6ECF4;
    border-radius: 12px;
    background: #fff;
    transition: all 0.2s ease;
  }
  
  .work-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }
  
  .work-card.mt-4 {
    margin-top: 16px;
  }
  
  
  /* 다크모드 카드 스타일 */
  [data-theme="dark"] .work-card {
    background: #0f172a;
    border-color: var(--line);
  }
  
    
    body.fs-150 .qcenter{
      font-size: 18px;
    }

    /* ===== 상단 헤더 ===== */
    header.appbar{ position:fixed; top:0; left:0; right:0; z-index:100; height:var(--header-h); background:var(--card); border-bottom:1px solid var(--line); }
    .bar{ max-width:960px; margin:0 auto; height:100%; display:flex; align-items:center; justify-content:space-between; padding:0 12px; }
    .brand-logo{
      font-family: "Poppins", "Inter", "Pretendard", "Noto Sans KR", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      font-weight: 800;          /* 가중치 명시 */
      font-size: 20px;
      line-height: 1;
      letter-spacing: .2px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
      color: var(--text);
      text-decoration: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      transform: translateX(-12px); /* 좌측으로 12px 이동 */
      flex-shrink: 0; /* flex로 눌림 방지 */
    }
    .brand-logo img{ 
      height: 24px; 
      max-height: 28px;     /* 상한 */
      width: auto;          /* 비율 유지 */
      aspect-ratio: auto;   /* 실제 비율 유지 */
      object-fit: contain;  /* 비율 유지하며 컨테이너에 맞춤 */
      flex: 0 0 auto;       /* flex로 눌림 방지 */
      image-rendering: auto; /* 이미지 렌더링 최적화 */
      display: block;
    }
    @media(min-width: 768px){ 
      .brand-logo img{ height: 28px; } 
    }
    .brand-logo:hover{ transform: translateX(-12px) translateY(-2px); text-shadow: 0 4px 8px rgba(0,0,0,0.15); }
    .brand-logo:active{ transform: translateX(-12px) translateY(0); }
    .actions{ display:flex; align-items:center; gap:12px; }
    .icon-btn{ 
      background:transparent; 
      border:0; 
      padding:0; 
      border-radius:8px; 
      color:#374151; 
      cursor:pointer; 
      position: relative;
      width: 28px;
      height: 28px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      vertical-align: middle;
      line-height: 0;
      flex-shrink: 0;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); 
    }
    #btnTheme{ transform: translateX(9.5px); }
    .fswitch{ transform: translateX(9px); }
    #btnSearch{ transform: translateX(2px); }
    .icon-btn:hover{ color:#1A254F; background:rgba(26, 37, 79, 0.08); }
    [data-theme="dark"] .icon-btn{ color:#c9d1d9; }
    [data-theme="dark"] .icon-btn:hover{ color:#3182ce; background:rgba(49, 130, 206, 0.1); }
    .appbar .icon-btn:hover{ background:none !important; } /* 헤더 아이콘 호버 시 배경색 제거 */
    [data-theme="dark"] .appbar .icon-btn:hover{ background:none !important; } /* 다크 테마 헤더 아이콘 호버 시 배경색 제거 */
    
    /* 빠른메뉴 설정 버튼 호버 효과 제거 */
    #qm-section button#qmSettingsBtn.icon-btn:hover,
    button#qmSettingsBtn.icon-btn:hover{ 
      background:transparent !important; 
      color:inherit !important;
    }
    [data-theme="dark"] #qm-section button#qmSettingsBtn.icon-btn:hover,
    [data-theme="dark"] button#qmSettingsBtn.icon-btn:hover{ 
      background:transparent !important; 
      color:inherit !important;
    }
    .btn-plain{ background:none; border:none; padding:0 6px; font-weight:700; font-size:14px; line-height:1; cursor:pointer; color:var(--text); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .btn-plain:hover{ color:#1A254F; }
    .btn-plain:focus{ outline:none; }
    [data-theme="dark"] .btn-plain:hover{ color:#3182ce; }
    .notification-badge{ 
      position:absolute; 
      top: -2px; 
      right: -8px; 
      background:#ff0000; 
      color:#fff; 
      font-size:10px; 
      font-weight:700; 
      min-width:16px; 
      height:16px; 
      padding: 0;
      border-radius:50%; 
      display:flex; 
      align-items:center; 
      justify-content:center; 
      white-space: nowrap;
      font-variant-numeric: tabular-nums;
      line-height: 1;
      border:1px solid #fff; 
      box-shadow: 0 1px 3px rgba(0,0,0,0.3);
      transition: all 0.3s ease; 
      z-index: 2;
    }
    .notification-badge.is-hidden{ display:none !important; }
    [data-theme="dark"] .notification-badge{ border-color:#fff; }
    
    /* 알림 아이콘 스타일 */
    .bell-icon{ 
      width:26px; height:26px; color:#6b7280; 
      transition:color .2s ease; 
    }
    .bell-icon:hover{ color:#1A254F; }
    [data-theme="dark"] .bell-icon{ color:#9ca3af; }
    [data-theme="dark"] .bell-icon:hover{ color:#2F6BFF; }
    
    /* 확대 모드에서 알림 배지 조정 */
    body.fs-150 .notification-badge {
      position: absolute;
      top: -4px;
      right: -6px;
      background: #ff0000;
      color: #fff;
      font-size: 11px;
      font-weight: 700;
      min-width: 18px;
      height: 18px;
      padding: 0;
      border-radius: 50%;
      display: inline-flex; /* flex -> inline-flex */
      align-items: center;
      justify-content: center;
      white-space: nowrap; /* 추가 */
      font-variant-numeric: tabular-nums; /* 추가 */
      line-height: 1; /* 추가 */
      border: 2px solid #fff;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
      transform: scale(1);
      transform-origin: center;
    }
    
    [data-theme="dark"] body.fs-150 .notification-badge {
      border-color: #fff;
    }
    
    /* 알림 배지 펄스 효과 */
    @keyframes notificationPulse {
      0% { transform: scale(1); background-color: #ff0000; }
      50% { transform: scale(1.2); background-color: #cc0000; }
      100% { transform: scale(1); background-color: #ff0000; }
    }
    
    .notification-badge.pulse {
      animation: notificationPulse 0.6s ease-in-out;
    }
    
    /* 확대 모드에서 펄스 효과 조정 */
    @keyframes notificationPulseFs150 {
      0% { transform: scale(1); background-color: #ff0000; }
      50% { transform: scale(1.2); background-color: #cc0000; }
      100% { transform: scale(1); background-color: #ff0000; }
    }
    
    body.fs-150 .notification-badge.pulse {
      animation: notificationPulseFs150 0.6s ease-in-out;
    }
    
    /* 새로운 알림 추가 시 배지 강조 효과 */
    @keyframes newNotificationGlow {
      0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(255, 0, 0, 0); }
      100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
    }
    
    .notification-badge.glow {
      animation: newNotificationGlow 1s ease-out;
    }
    
    /* 확대 모드에서 글로우 효과 조정 */
    @keyframes newNotificationGlowFs150 {
      0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); }
      70% { box-shadow: 0 0 0 0.625rem rgba(255, 0, 0, 0); } /* 10px -> 0.625rem */
      100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); }
    }
    
    body.fs-150 .notification-badge.glow {
      animation: newNotificationGlowFs150 1s ease-out;
    }

    /* 공지사항 박스 새 글 추가 효과 */
    @keyframes noticeBoxHighlight {
      0% { 
        background-color: var(--card);
        transform: scale(1);
      }
      50% { 
        background-color: rgba(0, 104, 254, 0.05);
        transform: scale(1.02);
      }
      100% { 
        background-color: var(--card);
        transform: scale(1);
      }
    }
    
    .notice-card.highlight {
      animation: noticeBoxHighlight 1.5s ease-out;
    }
    .bell-img{ width:26px; height:26px; object-fit:contain; display:block; }
    
    /* 알림 아이콘 스타일 */
    .icon {
      height: 100%;
      width: 100%;
      object-fit: contain;
      flex-shrink: 0;
      display: block;
    }
    .notif {
      position: relative;
      width: 28px;
      height: 28px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      vertical-align: middle;
      line-height: 0;
      flex-shrink: 0;
      background: transparent;
      border: 0;
      padding: 0;
      border-radius: 8px;
      cursor: pointer;
    }
    .notif::before, .notif::after { content: none !important; }
    .notif, .notif * { list-style: none; }

    /* ===== 글씨 크기 스위치 ===== */
    .fswitch{ display:inline-flex; align-items:center; gap:3.6px; height:25px; padding:1.8px; border-radius:9999px; border:1px solid var(--line); background:var(--card); transform: translateX(5px); }
    .fswitch-btn{ min-width:39px; padding:0 7px; border:0; border-radius:9999px; background:transparent; font-family:'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif; font-weight:300; font-size:12px; line-height:22px; color:#475569; cursor:pointer; transition:all .15s ease; }
    .fswitch-btn.active{ background:var(--brand); color:#fff; box-shadow:0 0 0 1px rgba(0,0,0,.06) inset; }
    .fswitch-btn:focus{ outline:none; }
    [data-theme="dark"] .fswitch{ border-color:var(--line) !important; background:#0b1220; }
    [data-theme="dark"] .fswitch-btn{ color:#cbd5e1; }
    [data-theme="dark"] .fswitch-btn.active{ background:#0068FE; color:#fff; box-shadow:0 0 0 1px rgba(255,255,255,.08) inset; }

    /* ===== 검색 전체화면 페이지 ===== */
    .search-page{ position:fixed; inset:0; z-index:9999; background:var(--card); display:none; overflow:auto; }
    .sp-head{ position:sticky; top:0; background:var(--card); padding:16px 20px; border-bottom:1px solid var(--line); display:flex; align-items:center; gap:12px; }
    .sp-back{ background:transparent; border:0; padding:8px; border-radius:8px; cursor:pointer; color:#6b7280; font-size:18px; font-weight:600; }
    .sp-input-wrap{ flex:1; position:relative; }
    .sp-input{ width:100%; height:48px; border-radius:24px !important; background:#fafafa; border:1px solid #e5e5e5; padding:0 50px 0 20px; font:400 16px 'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif; color:#333; outline:none; }
    .sp-input:hover{ background:#fafafa; border:1px solid #e5e5e5; } /* 호버 효과 제거 */
    .sp-input:focus{ background:#fafafa; border:1px solid #e5e5e5; } /* 포커스 효과도 동일하게 유지 */
    .sp-input::placeholder{ color:#8a8a8a; font-weight:400; }
    .sp-icon{ position:absolute; right:16px; top:50%; transform:translateY(-50%); opacity:0.7; color:#8a8a8a; }
    .sp-body{ padding:18px 20px 80px; }
    .sp-section-title{ font:700 13px var(--font); color:#98a2b3; margin:8px 0 10px; }
    .sp-list{ display:block; }
    .sp-row{ display:flex; align-items:center; gap:14px; padding:10px 4px; border-bottom:1px solid #f0f2f6; }
    .sp-num{ width:20px; text-align:right; font:800 14px var(--font); color:var(--num); }
    .sp-item{ font:400 15px 'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif; color:#3b4658; }
    /* 다크 모드에서 검색 페이지 가독성 */
    [data-theme="dark"] .sp-input{ background:#2a2a2a; border-color:#404040; color:#e6e9f1; }
    [data-theme="dark"] .sp-input:hover{ background:#2a2a2a; border-color:#404040; } /* 다크 모드 호버 효과 제거 */
    [data-theme="dark"] .sp-input:focus{ background:#2a2a2a; border-color:#404040; } /* 다크 모드 포커스 효과도 동일하게 유지 */
    [data-theme="dark"] .sp-input::placeholder{ color:#999; }
    [data-theme="dark"] .sp-row{ border-bottom:1px solid var(--line-soft) !important; }
    [data-theme="dark"] .sp-item{ color:#e6e9f1; }
    [data-theme="dark"] .sp-back{ color:#ffffff; }
    [data-theme="dark"] .sp-icon{ color:#ffffff; opacity:0.8; }
    [data-theme="dark"] .sp-head svg{ stroke:#ffffff; }

    /* ===== 사진업로드 스타일 (칩 스타일 적용) ===== */
    .upload-chip-group{
      display:flex; gap:8px; flex-wrap:wrap; align-items:center;
      width: 100%;
    }

    .upload-chip{
      display:inline-flex; align-items:center; justify-content:center;
      height:48px; padding:0 12px;
      border:1px solid #E6ECF4; border-radius:12px;
      background:#fff; color:#1A254F;
      font:600 15px/1.1 'Noto Sans KR',system-ui,sans-serif;
      white-space:nowrap;
      cursor:pointer; user-select:none;
      transition:all .15s ease;
      box-shadow:0 1px 0 rgba(0,0,0,.02);
      flex: 1;
      min-width: 0;
    }
    
    /* 업로드 칩 호버 효과 (선택되지 않은 상태에서만) */
    .upload-chip:not([data-active="true"]):hover {
      background-color: #f8fafc !important;
      border-color: #cbd5e1 !important;
      transform: translateY(-1px) !important;
    }
    
    /* 업로드 칩 선택 상태 */
    .upload-chip[data-active="true"] {
      background-color: #EFF6FF !important;
      color: #1A56DB !important;
      border-color: #BBD7FF !important;
      transform: none !important;
      box-shadow: 0 2px 4px rgba(26, 86, 219, 0.2) !important;
    }
    
    /* 업로드 칩 클릭 효과 */
    .upload-chip:active {
      transform: scale(0.95) !important;
      transition: transform 0.1s ease !important;
    }
    
    /* 업로드 칩 클릭 시 리플 효과 */
    .upload-chip.clicked {
      animation: chipRipple 0.6s ease-out;
    }
    
    /* 다크모드 업로드 칩 클릭 효과 */
    [data-theme="dark"] .upload-chip.clicked {
      animation: chipRippleDark 0.6s ease-out;
    }
    
    /* 다크모드 토큰 */
[data-theme="dark"]{
  --bg:#0f172a;         /* 페이지 배경 */
  --card:#111827;       /* 카드/패널 */
  --text:#E6E9F1;       /* 본문 */
  --muted:#94A3B8;      /* 보조 */
  --line:#334155;       /* 경계선 */
  --focus:#2F6BFF;      /* 포커스 */
  --chip-active:#2F6BFF;
  --chip-active-line:#3B82F6;

  /* 업로드 박스 타입별 아주 옅은 틴트 */
  --tint-before: rgba(59,130,246,.06);  /* 전(파랑)  */
  --tint-after:  rgba(16,185,129,.06);  /* 후(초록)  */
  --tint-proof:  rgba(245,158,11,.06);  /* 영수증(앰버) */
  --tint-dwg:    rgba(99,102,241,.06);  /* 도면(인디고) */
}
    
    /* 다크모드 업로드 칩 - 부재명 선택박스와 동일한 효과 */
    [data-theme="dark"] .upload-chip{
      background: transparent;
      color: var(--text);
      border: 1px solid var(--line) !important;
    }
    [data-theme="dark"] .upload-chip:hover{ 
      background-color: rgba(255,255,255,.04) !important;
      border-color: var(--line) !important;
      transform: translateY(-1px) !important;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
    }
    [data-theme="dark"] .upload-chip[data-active="true"]{
      background-color: transparent !important;
      border-color: var(--chip-active-line) !important;
      color: var(--text) !important;
      transform: none !important;
      box-shadow: 0 0 0 4px color-mix(in srgb, var(--chip-active) 12%, transparent) inset !important;
    }
    [data-theme="dark"] .upload-chip:active {
      transform: scale(0.95) !important;
    }
    
    .btn:active{transform:translateY(1px)}
    
    /* 업로드 옵션 모달 (메인팝업 스타일) */
    .upload-modal{ 
      position:fixed; inset:0; background:rgba(0,0,0,.45); backdrop-filter:blur(4px);
      display:none; align-items:center; justify-content:center; z-index:1000;
    }
    .upload-modal.show{ display:flex; }
    .upload-modal.hidden{ display:none; }
    .upload-modal-content{ 
      width:min(480px, 92vw); background:var(--card); border-radius:24px;
      box-shadow:0 12px 40px rgba(0,0,0,.25); padding:20px 20px 12px; 
      animation:fadeIn .28s ease-out;
    }
    @keyframes fadeIn{ from{transform:scale(.95);opacity:.6} to{transform:scale(1);opacity:1} }
    @keyframes slideIn{ from{transform:translateY(-20px);opacity:0} to{transform:translateY(0);opacity:1} }
    @keyframes fadeOut{ from{transform:scale(1);opacity:1} to{transform:scale(.95);opacity:0} }
    
    .upload-modal-header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:6px; }
    .upload-modal-header h3{ font-weight:600; font-size:18px; color:#1A254F; text-align:center; margin:0; }
    .upload-modal-close{ 
      width:36px; height:36px; border:none; background:transparent; cursor:pointer;
      display:grid; place-items:center; border-radius:50%;
    }
    .upload-modal-close:hover{ background:rgba(0,0,0,.06); }
    .upload-modal-close svg{ width:22px; height:22px; color:#6b7280; }
    
    .upload-modal-body{ padding:8px 2px 2px; }
    .upload-options{ display:grid; grid-template-columns:repeat(2,1fr); gap:12px; }
    .upload-option-btn{ 
      display:flex; flex-direction:column; align-items:center; text-align:center;
      background:transparent; border:none; cursor:pointer; padding:0;
    }
    .upload-option-icon-box{
      width:72px; height:72px; border-radius:16px; background:var(--card); border:1px solid var(--line);
      display:grid; place-items:center; box-shadow:0 2px 10px rgba(2,6,23,.04); 
      transition:.2s; position:relative; overflow:hidden; margin-bottom:8px;
    }
    .upload-option-icon-box:hover{ border-color:#3b82f6; transform:translateY(-2px); box-shadow:0 4px 20px rgba(59,130,246,.15); }
    .upload-option-icon-box svg{ color:#6b7280; transition:.2s; }
    .upload-option-btn:hover .upload-option-icon-box svg{ color:#3b82f6; }
    .upload-option-title{ font-size:14px; font-weight:600; color:#1A254F; margin-bottom:2px; }
    .upload-option-desc{ font-size:12px; color:#6b7280; }
    
    /* 갤러리 선택 모달 */
    .gallery-modal{ position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:9999; display:flex; align-items:center; justify-content:center; }
    .gallery-modal-content{ background:#fff; border-radius:16px; width:720px; max-width:90vw; max-height:80vh; box-shadow:0 20px 25px -5px rgba(0,0,0,0.1); }
    .gallery-modal-header{ display:flex; align-items:center; justify-content:space-between; padding:20px 24px; border-bottom:1px solid #e5e7eb; }
    .gallery-modal-header h3{ margin:0; font-size:18px; font-weight:700; color:#111827; }
    .gallery-modal-close{ background:none; border:none; font-size:24px; color:#6b7280; cursor:pointer; padding:0; width:24px; height:24px; display:flex; align-items:center; justify-content:center; }
    .gallery-modal-body{ padding:24px; max-height:60vh; overflow-y:auto; }
    .gallery-grid{ display:grid; grid-template-columns:repeat(auto-fill, minmax(150px, 1fr)); gap:16px; margin-bottom:20px; }
    .gallery-item{ background:#f9fafb; border:1px solid #e5e7eb; border-radius:8px; padding:12px; text-align:center; }
    .gallery-thumb{ font-size:24px; margin-bottom:8px; }
    .gallery-name{ font-size:12px; color:#374151; margin-bottom:8px; word-break:break-all; }
    .gallery-select-btn{ background:#3b82f6; color:#fff; border:none; border-radius:6px; padding:4px 8px; font-size:12px; cursor:pointer; transition:all 0.2s ease; }
    .gallery-select-btn:hover{ background:#2563eb; }
    .gallery-select-btn.selected{ background:#10b981; }
    .gallery-actions{ display:flex; gap:12px; justify-content:flex-end; }
    .gallery-cancel-btn{ background:#6b7280; color:#fff; border:none; border-radius:8px; padding:8px 16px; font-size:14px; cursor:pointer; }
    .gallery-confirm-btn{ background:#3b82f6; color:#fff; border:none; border-radius:8px; padding:8px 16px; font-size:14px; cursor:pointer; }
    
    /* 다크모드 모달 */
    [data-theme="dark"] .upload-modal-content{ background:#1f2937; }
    [data-theme="dark"] .upload-modal-header{ border-bottom-color:#374151; }
    [data-theme="dark"] .upload-modal-header h3{ color:#f9fafb; }
    [data-theme="dark"] .upload-modal-close{ color:#9ca3af; }
    [data-theme="dark"] .upload-option-btn{ background:#374151; border-color:#4b5563; color:#f9fafb; }
    [data-theme="dark"] .upload-option-btn:hover{ border-color:var(--line) !important; background:#4b5563; }
    [data-theme="dark"] .upload-option-title{ color:#f9fafb; }
    [data-theme="dark"] .upload-option-desc{ color:#9ca3af; }
    
    [data-theme="dark"] .gallery-modal-content{ background:#1f2937; }
    [data-theme="dark"] .gallery-modal-header{ border-bottom-color:#374151; }
    [data-theme="dark"] .gallery-modal-header h3{ color:#f9fafb; }
    [data-theme="dark"] .gallery-modal-close{ color:#9ca3af; }
    [data-theme="dark"] .gallery-item{ background:#374151; border-color:#4b5563; }
    [data-theme="dark"] .gallery-name{ color:#d1d5db; }
    [data-theme="dark"] .list:hover{background-color:rgba(255,255,255,.06)}
    [data-theme="dark"] .list:active{background-color:rgba(255,255,255,.1)}

    /* 알림 팝업 스타일 */
    .notification-popup{ 
      position:fixed; inset:0; background:rgba(0,0,0,.45); backdrop-filter:blur(4px);
      display:none; align-items:center; justify-content:center; z-index:1001;
    }
    .notification-popup.show{ display:flex; }
    .notification-popup.hidden{ display:none; }
    .notification-popup-content{ 
      width:min(480px, 92vw); background:var(--card); border-radius:24px;
      box-shadow:0 12px 40px rgba(0,0,0,.25); padding:20px 20px 12px; 
      animation:fadeIn .28s ease-out; max-height:80vh; overflow-y:auto;
    }
    
    .notification-popup-header{ 
      display:flex; align-items:center; justify-content:space-between; 
      margin-bottom:16px; padding-bottom:12px; border-bottom:1px solid var(--line);
    }
    .notification-popup-header h3{ 
      font-weight:600; font-size:18px; color:#1A254F; margin:0; 
    }
    .notification-popup-close{ 
      width:36px; height:36px; border:none; background:transparent; cursor:pointer;
      display:grid; place-items:center; border-radius:50%; transition:background .2s ease;
    }
    .notification-popup-close:hover{ background:rgba(0,0,0,.06); }
    .notification-popup-close svg{ width:22px; height:22px; color:#6b7280; }
    
    .notification-popup-body{ padding:8px 2px 16px; }
    .notification-content p{ 
      margin:0 0 16px; color:var(--muted); font-size:14px; text-align:center;
    }
    .notification-list{ display:flex; flex-direction:column; gap:12px; margin-bottom:20px; }
    .notification-item{ 
      display:flex; align-items:flex-start; gap:12px; padding:12px; 
      background:#f8fafc; border-radius:12px; border:1px solid #e2e8f0;
    }
    .notification-icon{ 
      width:20px; height:20px; flex-shrink:0; margin-top:2px; 
      display:flex; align-items:center; justify-content:center;
    }
    .notification-icon svg{ 
      color:#3b82f6; 
    }
    .notification-text{ flex:1; }
    .notification-title{ 
      font-weight:600; font-size:14px; color:#1A254F; margin-bottom:4px; 
    }
    .notification-desc{ 
      font-size:13px; color:var(--muted); line-height:1.4; 
    }
    
    .notification-options{ 
      display:flex; justify-content:center; margin-bottom:20px; 
    }
    .notification-checkbox{ 
      display:flex; align-items:center; gap:8px; cursor:pointer; 
      font-size:14px; color:var(--text);
    }
    .notification-checkbox input[type="checkbox"]{ 
      display:none; 
    }
    .checkmark{ 
      width:18px; height:18px; border:2px solid #d1d5db; border-radius:4px;
      display:flex; align-items:center; justify-content:center; 
      transition:all .2s ease; position:relative;
    }
    .notification-checkbox input[type="checkbox"]:checked + .checkmark{ 
      background:#3b82f6; border-color:#3b82f6; 
    }
    .notification-checkbox input[type="checkbox"]:checked + .checkmark::after{ 
      content:'✓'; color:#fff; font-size:12px; font-weight:bold; 
    }
    
    .notification-popup-footer{ 
      display:flex; gap:12px; padding-top:12px; border-top:1px solid var(--line);
    }
    .notification-btn{ 
      flex:1; height:44px; border-radius:12px; border:none; font-size:14px; 
      font-weight:600; cursor:pointer; transition:all .2s ease;
    }
    .notification-btn-secondary{ 
      background:#fff; color:#99A4BE; border:1px solid #99A4BE;
    }
    .notification-btn-secondary:hover{ 
      background:#99A4BE; color:#fff; 
    }
    .notification-btn-primary{ 
      background:#1A254F; color:#fff; 
    }
    .notification-btn-primary:hover{ 
      filter:brightness(.95); 
    }
    
    /* 다크모드 알림 팝업 */
    [data-theme="dark"] .notification-popup-content{ background:#1f2937; }
    [data-theme="dark"] .notification-popup-header{ border-bottom-color:#374151; }
    [data-theme="dark"] .notification-popup-header h3{ color:#f9fafb; }
    [data-theme="dark"] .notification-popup-close{ color:#9ca3af; }
    [data-theme="dark"] .notification-popup-close:hover{ background:rgba(255,255,255,.06); }
    [data-theme="dark"] .notification-content p{ color:#9ca3af; }
    [data-theme="dark"] .notification-item{ 
      background:#374151; border-color:#4b5563; 
    }
    [data-theme="dark"] .notification-icon svg{ 
      color:#9ca3af; 
    }
    [data-theme="dark"] .notification-title{ color:#f9fafb; }
    [data-theme="dark"] .notification-desc{ color:#9ca3af; }
    [data-theme="dark"] .notification-checkbox{ color:#f9fafb; }
    [data-theme="dark"] .checkmark{ border-color:#6b7280; }
    [data-theme="dark"] .notification-popup-footer{ border-top-color:#374151; }
    [data-theme="dark"] .notification-btn-secondary{ 
      background:#2A323C; color:#E9EEF5; border:none; 
    }
    [data-theme="dark"] .notification-btn-secondary:hover{ 
      background:#2A323C; color:#E9EEF5; 
    }
    [data-theme="dark"] .notification-btn-primary{ 
      background:#2F6BFF; color:#ffffff; 
    }
    [data-theme="dark"] .notification-btn-primary:hover{ 
      background:#2F6BFF; color:#ffffff; 
    }
    
    .pill{padding:.3rem .6rem; border-radius:999px; font-size:.75rem; background:#EEF2FF; color:#3730A3; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
    .pill:hover{ background:#1A254F; color:#fff; }
    [data-theme="dark"] .pill{
      background:#0B1F3A;
      color:#BFDBFE;
      border:1px solid #1E3A8A;
    }
    [data-theme="dark"] .pill:hover{
      background:#3182ce;
      color:#fff;
      border-color:#3182ce;
    }
    .list{min-height:24px; padding:12px; border:1px solid var(--line); border-radius:12px; display:flex; flex-wrap:wrap; gap:12px; cursor:pointer; transition:background-color 0.2s ease}
    
    /* 보수전, 보수후, 영수증, 도면 업로드박스 높이를 저장하기 버튼과 동일하게 조정 */
    .list.pre,
    .list.post,
    .list.docs {
      min-height: 48px;
      border-style: dashed;
    }
    
    /* 각 업로드박스별 점선 테두리 색상 조정 */
    .list.pre {
      border-color: #BBD7FF; /* 보수전 배경색 #F4F8FF와 조화 */
    }
    .list.post {
      border-color: #80deea; /* 시안 계열 점선 테두리 */
    }
    .list.docs {
      border-color: #C7C7FF; /* 영수증/도면 배경색 #FAFAFF와 조화 */
    }
    .list:hover{background-color:rgba(47,107,255,0.05)}
    .list:active{background-color:rgba(47,107,255,0.1)}
    .list.pre { background:#F4F8FF; }
    .list.post{ background:#f0fdfd; }
    .list.docs{ background:#FAFAFF; }
    
    

    
    /* 다크모드 타입별 틴트 - 카운트 숫자와 동일한 배경컬러 */
    [data-theme="dark"] .list.pre { 
      background: #0B1F3A;
      border: 1px solid #1E3A8A;
    }
    [data-theme="dark"] .list.post { 
      background: #0B1F3A;
      border: 1px solid #1E3A8A;
    }
    [data-theme="dark"] .list.docs { 
      background: #0B1F3A;
      border: 1px solid #1E3A8A;
    }
    /* 썸네일 스타일 통합 */
    .thumb {
      width: 90px; 
      height: 90px; 
      border-radius: 12px; 
      overflow: hidden; 
      border: 1px solid #e5e7eb; 
      position: relative; 
      background: #fafafa;
      margin: 4px;
      flex-shrink: 0;
    }
    .thumb img { 
      width: 100%; 
      height: 100%; 
      object-fit: cover 
    }
    .thumb .swap, .thumb .del {
      position: absolute; 
      top: 6px; 
      font-size: 12px; 
      background: rgba(0,0,0,.55); 
      color: #fff; 
      border-radius: 8px; 
      padding: 2px 6px; 
      border: 0; 
      cursor: pointer
    }
    .thumb .swap { left: 6px }
    .thumb .del { right: 6px }
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}

    /* 본문 패딩(헤더/네비에 안가리도록) */
    main.container{ 
      max-width: 100%; 
      width: 100%;
      margin: 0 auto; 
      padding: calc(var(--header-h) + 10px) 16px calc(var(--nav-h) + 12px); 
      min-height: calc(100vh - var(--header-h) - var(--nav-h)); 
    }
    
    /* 확대 모드에서 메인 컨테이너 동적 조정 */
    body.fs-150 main.container {
      max-width: 100%;
      width: 100%;
      margin: 0 auto;
      padding: calc(var(--header-h) + 10px) 1rem calc(var(--nav-h) + 12px);
      min-height: calc(100vh - var(--header-h) - var(--nav-h) - 0.5rem - env(safe-area-inset-bottom));
      transform: scale(1);
      transform-origin: center;
    }

    /* ===== 글자 커지는 효과 ===== */
    .font-size-small { font-size:12px !important; line-height:1.5 !important; }
    .font-size-medium{ font-size:14px !important; line-height:1.6 !important; }
    .font-size-mobile{ font-size:16px !important; }
    .font-size-large { font-size:16px !important; line-height:1.7 !important; letter-spacing:.02em !important; }
    .font-size-xlarge{ font-size:18px !important; line-height:1.8 !important; }

    .font-size-mobile .container,
    .font-size-large  .container,
    .font-size-xlarge .container { max-width:100%; padding-left:20px; padding-right:20px; }

    .section{ padding: 6px 0; }
    .font-size-mobile .section,
    .font-size-large  .section,
    .font-size-xlarge .section { margin-bottom:20px; }

    /* ===== 하단 네비게이터 ===== */
    .bottom-nav-wrap{ position:fixed; left:0; right:0; bottom:0; z-index:50; }
    .bottom-nav{ background:var(--nav-bg); border-top:1px solid var(--nav-border); box-shadow:0 -6px 16px rgba(17,24,39,.06); height:var(--nav-h); padding-bottom:env(safe-area-inset-bottom); }
    .nav-list{ display:grid; grid-template-columns:repeat(5,1fr); max-width:720px; height:100%; margin:0 auto; padding:0; list-style:none; }
    .nav-item{ position:relative; display:flex; align-items:center; justify-content:center; }
    .nav-link{ display:flex; flex-direction:column; align-items:center; gap:6px; color:var(--nav-text); text-decoration:none; cursor:pointer; }
    
    /* 확대 모드에서 하단 네비게이터 동적 조정 */
    body.fs-150 .nav-label{ font-size: 0.875rem; }
    body.fs-150 .nav-svg{ width: 1.5rem; height: 1.5rem; }
    
    /* 네비게이터 통합 애니메이션 */
    .nav-link, .nav-svg, .nav-label {
      transition: all 0.2s ease-out;
      transform-origin: center;
    }
    
    .nav-link:hover {
      transform: translateY(-2px) scale(1.05);
    }
    
    .nav-link:active {
      transform: scale(0.95);
    }
    
    .nav-link:hover .nav-svg,
    .nav-link:hover .nav-label {
      transform: scale(1.05);
      color: #1A254F;
    }
    
    [data-theme="dark"] .nav-link:hover .nav-svg,
    [data-theme="dark"] .nav-link:hover .nav-label {
      color: #2F6BFF;
    }
    
    .nav-link.active{ color:var(--nav-text-active); }
    .nav-label{ font-size:11px; font-weight:600; line-height:1; }
    .nav-ico{ width:26px; height:26px; display:grid; place-items:center; }
    .nav-svg{ width:22px; height:22px; }

    /* 모든 네비게이터 메뉴 기본 상태 - 통일 */
    .nav-link .nav-svg{ color: #99A4BE; }
    .nav-link .nav-label{ color: #99A4BE; }

    /* ===== 공통 UI ===== */
    .card{ background:var(--card); border:1px solid #E6ECF4; border-radius:14px; padding:14px; box-shadow:0 2px 10px rgba(2,6,23,.04); }
    [data-theme="dark"] .card{ border-color:var(--line) !important; }
    /* 제목 스타일 통일 */
    .section-title, .card-title, .form-title, .q {
      font-family: "Noto Sans KR", system-ui, sans-serif;
      font-weight: 700;
      font-size: 17px;
      line-height: 1.4;
      color: #1A254F;
    }
    
    /* ===== 빠른메뉴 제목 스타일 ===== */
    .quick-title {
      display: flex;
      align-items: center;   /* 수직 가운데 정렬 */
      gap: 6px;              /* 아이콘과 텍스트 사이 간격 */
      font-family: "Noto Sans KR", system-ui, sans-serif;
      font-weight: 700;
      font-size: 17px;       /* 제목과 동일한 크기로 조정 */
      line-height: 1.4;
      color: #1A254F;
    }

    /* 번개 아이콘 크기 */
    .flash-icon {
      width: 18px;   /* 필요에 맞게 조절 */
      height: 18px;
      display: inline-block;
      vertical-align: middle;
    }
    .muted{ color:var(--muted); }
    .tag{ display:inline-flex; align-items:center; gap:6px; border-radius:9999px; padding:6px 10px; font-size:12px; font-weight:700; cursor:pointer; user-select:none; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
    .tag:hover{ color:#1A254F; }
    .tag--ghost{ background:transparent; border:1px solid var(--line); }
    .tag--ghost:hover{ background:rgba(26, 37, 79, 0.08); border-color:#1A254F; }
    .tag--blue{ background:#2563eb; color:#fff; border:1px solid #1d4ed8; }
    .tag--blue:hover{ background:#1d4ed8; }
    .tag--blue-outline{ background:transparent; color:#2563eb; border:1px solid #2563eb; }
    .tag--blue-outline:hover{ background:#2563eb; color:#fff; }
    [data-theme="dark"] .tag:hover{ color:#3182ce; }
    [data-theme="dark"] .tag--ghost:hover{ background:rgba(49, 130, 206, 0.1); border-color:#3182ce; }
    .cta-banner{ background:linear-gradient(180deg,#eff6ff,#ffffff); border:1px solid var(--line); border-radius:16px; padding:14px; display:flex; align-items:center; justify-content:space-between; }
    .card-head{ display:flex; align-items:center; justify-content:space-between; }
    .acc-btn{ width:32px; height:32px; border-radius:8px; border:1px solid var(--line); display:grid; place-items:center; background:var(--card); }
    .acc-icon{ width:18px; height:18px; transition:transform .2s ease; }
    .flip-y{ transform: rotate(180deg); }

      /* 알림 벨 애니메이션 */
  @keyframes bellRing{0%{transform:rotate(0deg) scale(1);}10%{transform:rotate(-8deg) scale(1.05);}20%{transform:rotate(8deg) scale(1.05);}30%{transform:rotate(-6deg) scale(1.03);}40%{transform:rotate(6deg) scale(1.03);}50%{transform:rotate(-4deg) scale(1.02);}60%{transform:rotate(4deg) scale(1.02);}70%{transform:rotate(-2deg) scale(1.01);}80%{transform:rotate(2deg) scale(1.01);}90%{transform:rotate(-1deg) scale(1.005);}100%{transform:rotate(0deg) scale(1);} }
  #notificationBtn.bell-ringing{ animation: bellRing 1.2s ease-in-out; }

  /* ===== 작업일지 스타일 ===== */
  /* ===== 버튼 이벤트 효과 (이미지 스타일 적용) ===== */
  
  /* 기본 버튼 호버 효과 */
  .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  /* 버튼 클릭 효과 */
  .btn:active {
      transform: translateY(0);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      transition: all 0.1s ease;
  }
  
  /* 버튼 포커스 효과 */
  .btn:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(26, 37, 79, 0.3);
  }
  
  /* 버튼 리플 효과 */
  .btn.clicked {
      animation: buttonRipple 0.6s ease-out;
  }
  
  /* 버튼 리플 애니메이션 */
  @keyframes buttonRipple {
      0% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(26, 37, 79, 0.4);
      }
      50% {
          transform: scale(1.02);
          box-shadow: 0 0 0 8px rgba(26, 37, 79, 0.1);
      }
      100% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(26, 37, 79, 0);
      }
  }
  
  /* 다크모드 버튼 리플 애니메이션 */
  @keyframes buttonRippleDark {
      0% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(47, 107, 255, 0.4);
      }
      50% {
          transform: scale(1.02);
          box-shadow: 0 0 0 8px rgba(47, 107, 255, 0.1);
      }
      100% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(47, 107, 255, 0);
      }
  }
  
  /* 다크모드 버튼 효과 */
  [data-theme="dark"] .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  }
  
  [data-theme="dark"] .btn:focus {
      box-shadow: 0 0 0 3px rgba(47, 107, 255, 0.3);
  }
  
  [data-theme="dark"] .btn.clicked {
      animation: buttonRippleDark 0.6s ease-out;
  }
  /* 기본 박스 스타일 */
  .chip {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: 48px;
      background-color: #ffffff;
      color: #000000;
      border: 1px solid #E6ECF4;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      user-select: none;
      position: relative;
      overflow: hidden;
      flex: 1;
      min-width: 0;
      word-break: keep-all;
      overflow-wrap: break-word;
      white-space: normal;
      line-height: 1.3;
  }

  /* 칩 버튼 클릭 효과 - 리플과 함께 */
  .chip:active {
      transform: scale(0.95) !important;
      transition: transform 0.1s ease !important;
  }
  
  /* 칩 버튼 클릭 시 리플 효과 */
  .chip.clicked {
      animation: chipRipple 0.6s ease-out;
  }

  .chip[data-role="site"]:focus,
  .chip[data-role="part"]:focus,
  .chip[data-role="proc"]:focus,
  .chip[data-role="area"]:focus {
      outline: none;
      border-color: #1890ff;
      box-shadow: 0 0 0 3px rgba(24, 144, 255, 0.3);
  }

  
  /* 리플 이펙트 스타일 */
  .ripple-ink {
      position: absolute;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.35);
      transform: scale(0);
      animation: ripple 0.45s ease-out;
      pointer-events: none;
  }
  
  @keyframes ripple {
      to {
          transform: scale(1);
          opacity: 0;
      }
  }
  
  /* 다크모드 칩 버튼 리플 애니메이션 */
  @keyframes chipRippleDark {
      0% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(47, 107, 255, 0.4);
      }
      50% {
          transform: scale(1.05);
          box-shadow: 0 0 0 10px rgba(47, 107, 255, 0.1);
      }
      100% {
          transform: scale(1);
          box-shadow: 0 0 0 0 rgba(47, 107, 255, 0);
      }
  }
  
  /* 다크모드 칩 클릭 효과 */
  [data-theme="dark"] .chip.clicked {
      animation: chipRippleDark 0.6s ease-out;
  }
  /* 선택됨 (Selected) 상태 - 통합 */
  .chip[data-active="true"] {
      background-color: #EFF6FF !important;
      color: #1A56DB !important;
      border-color: #BBD7FF !important;
      transform: none !important;
      box-shadow: 0 2px 4px rgba(26, 86, 219, 0.2) !important;
  }
  
  /* 칩 호버 효과 (선택되지 않은 상태에서만) */
  .chip:not([data-active="true"]):hover {
      background-color: #f8fafc !important;
      border-color: #cbd5e1 !important;
      transform: translateY(-1px) !important;
  }
  
  /* 다크모드 칩 선택 상태 */
  [data-theme="dark"] .chip[data-active="true"] {
      background-color: transparent !important;
      border-color: var(--chip-active-line) !important;
      color: var(--text) !important;
      transform: none !important;
      box-shadow: 0 0 0 4px color-mix(in srgb, var(--chip-active) 12%, transparent) inset !important;
  }
  
  /* 다크모드 칩 호버 효과 (선택되지 않은 상태에서만) */
  [data-theme="dark"] .chip:not([data-active="true"]):hover {
      background-color: rgba(255,255,255,.04) !important;
  }
  
  /* 비활성화된 칩 스타일 */
  .chip:disabled {
      opacity: 0.5 !important;
      cursor: not-allowed !important;
      background-color: #f8f9fa !important;
      border-color: #e9ecef !important;
      color: #6c757d !important;
  }
  
  /* 다크모드 비활성화된 칩 스타일 */
  [data-theme="dark"] .chip:disabled {
      background-color: rgba(255,255,255,.05) !important;
      border-color: var(--line) !important;
      color: var(--muted) !important;
  }

  /* 작업 액션 태그 스타일 (작성자 태그와 동일한 크기) */
  .work-action-tag {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: 28px; /* 작성자 태그와 동일한 높이 */
      background-color: #ffffff;
      color: #000000;
      border: 1px solid #E6ECF4;
      border-radius: 16px; /* 작성자 태그와 동일한 둥근 모서리 */
      font-size: 13px; /* 작성자 태그와 동일한 폰트 크기 */
      font-weight: 600; /* 작성자 태그와 동일한 폰트 굵기 */
      cursor: pointer;
      transition: all 0.3s ease;
      user-select: none;
      position: relative;
      overflow: hidden;
      padding: 6px 12px; /* 작성자 태그와 동일한 패딩 */
      min-width: 50px; /* 작성자 태그와 동일한 최소 너비 */
      text-shadow: none !important;
      box-shadow: none !important;
  }
  
  /* 추가 버튼 스타일 */
  .work-action-tag:first-child {
      background-color: rgba(41, 52, 208, 0.15); /* #2934D0 15% */
      color: #2934D0; /* #2934D0 */
      font-weight: 600; /* 작성자 태그와 동일한 폰트 굵기 */
      text-rendering: optimizeLegibility; /* 텍스트 렌더링 최적화 */
      -webkit-font-smoothing: antialiased; /* 웹킷 폰트 스무딩 */
      -moz-osx-font-smoothing: grayscale; /* 파이어폭스 폰트 스무딩 */
      border: none; /* 테두리 제거 */
      font-size: 13px; /* 작성자 태그와 동일한 폰트 크기 */
  }
  
  .work-action-tag:first-child:hover {
      background-color: rgba(41, 52, 208, 0.25); /* 호버 시 조금 더 진한 색상 */
  }
  
  /* 삭제 버튼 스타일 */
  .work-action-tag:last-child {
      background-color: #FFD5E8; /* 연한 분홍색 배경 */
      color: #FF2980; /* 밝은 분홍색 텍스트 */
      font-weight: 600; /* 작성자 태그와 동일한 폰트 굵기 */
      text-rendering: optimizeLegibility; /* 텍스트 렌더링 최적화 */
      -webkit-font-smoothing: antialiased; /* 웹킷 폰트 스무딩 */
      -moz-osx-font-smoothing: grayscale; /* 파이어폭스 폰트 스무딩 */
      border: none; /* 테두리 제거 */
      font-size: 13px; /* 작성자 태그와 동일한 폰트 크기 */
      display: flex; /* 플렉스 박스 사용 */
      align-items: center; /* 수직 중앙 정렬 */
      justify-content: center; /* 수평 중앙 정렬 */
      line-height: 1; /* 라인 높이 조정 */
  }
  
  .work-action-tag:last-child:hover {
      background-color: #FFB8D9; /* 호버 시 조금 더 진한 분홍색 */
  }

  /* 다크모드 작업 액션 태그 (작성자 태그와 동일한 기본 스타일) */
  [data-theme="dark"] .work-action-tag {
      border-color: var(--line);
      background: transparent;
      color: var(--text);
  }
  
  [data-theme="dark"] .work-action-tag:first-child {
      background-color: rgba(41, 52, 208, 0.3); /* 다크모드에 어울리는 #2934D0 30% - 더 밝게 */
      color: #5B6BFF; /* 더 밝은 파란색으로 변경 */
      font-weight: 600; /* 작성자 태그와 동일한 폰트 굵기 */
      text-rendering: optimizeLegibility; /* 텍스트 렌더링 최적화 */
      -webkit-font-smoothing: antialiased; /* 웹킷 폰트 스무딩 */
      -moz-osx-font-smoothing: grayscale; /* 파이어폭스 폰트 스무딩 */
      border: none; /* 테두리 제거 */
      font-size: 13px; /* 작성자 태그와 동일한 폰트 크기 */
  }
  
  [data-theme="dark"] .work-action-tag:last-child {
      background-color: rgba(255, 45, 128, 0.2); /* 덜 탁한 분홍색 배경 */
      color: #FF6B9D; /* 덜 탁한 밝은 분홍색 텍스트 */
      font-weight: 600; /* 작성자 태그와 동일한 폰트 굵기 */
      text-rendering: optimizeLegibility; /* 텍스트 렌더링 최적화 */
      -webkit-font-smoothing: antialiased; /* 웹킷 폰트 스무딩 */
      -moz-osx-font-smoothing: grayscale; /* 파이어폭스 폰트 스무딩 */
      border: none; /* 테두리 제거 */
      font-size: 13px; /* 작성자 태그와 동일한 폰트 크기 */
  }
  
  /* 작업 내용 태그 스타일 */
  .work-content-tag {
    display: inline-block;
    background: #EFF6FF;
    color: #1A56DB;
    padding: 4px 8px;
    margin: 2px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
    border: 1px solid #BBD7FF;
  }
  .ctl{ height:48px; border:1px solid #E6ECF4; border-radius:12px; padding:0 12px; font:600 15px/1.1 'Noto Sans KR',system-ui,sans-serif; }
  [data-theme="dark"] .ctl{ border-color:var(--line) !important; }
  .ctl#blockVal, .ctl#dongVal, .ctl#hoVal{ text-align:center }
  input[placeholder=""].ctl{ text-align:center }
  
  /* number input 스핀 버튼 제거 */
  input[type="number"].ctl {
    -moz-appearance: textfield;
    appearance: textfield;
  }
  
  input[type="number"].ctl::-webkit-outer-spin-button,
  input[type="number"].ctl::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  
  /* 공수입력 컨트롤 스테퍼 - 완전 재구현 */
  .qty-split3 {
    display: flex;
    align-items: center;
    height: 48px;
    border-radius: 14px;
    padding: 0;
    background: #fff;
    border: 1px solid var(--line);
    font-family: 'Noto Sans KR', system-ui, sans-serif;
    font-size: 16px;
    font-weight: 700;
    color: #1A254F;
    user-select: none;
    position: relative;
    overflow: hidden;
  }

  .qty-split3:focus-within {
    outline: 2px solid #2F6BFF;
    outline-offset: 2px;
  }

  .qty-split3.error {
    border-color: var(--danger);
  }

  .qbtn {
    width: 32px;
    height: 32px;
    border: none;
    background: transparent;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    font-weight: 700;
    color: #1A254F;
    border-radius: 0;
    transition: all 0.2s ease;
    margin: 8px;
  }

  .qbtn:hover:not(:disabled) {
    background: rgba(47, 107, 255, 0.1);
  }

  .qbtn:active:not(:disabled) {
    background: rgba(47, 107, 255, 0.2);
    transform: scale(0.95);
  }

  .qbtn:disabled {
    opacity: 0.3;
    cursor: default;
  }

  .qcenter {
    flex: 1;
    text-align: center;
    font-size: 16px;
    font-weight: 700;
    color: #1A254F;
    min-width: 40px;
    padding: 0 8px;
    border: none;
  }


  /* 다크모드 스타일 */
  [data-theme="dark"] .qty-split3 {
    background: #111827;
    border-color: var(--line) !important;
    color: #E6E9F1;
  }

  [data-theme="dark"] .qbtn {
    color: #E6E9F1;
  }

  [data-theme="dark"] .qbtn:hover:not(:disabled) {
    background: rgba(255,255,255,.04) !important;
    border-color: var(--line) !important;
  }

  [data-theme="dark"] .qbtn:active:not(:disabled) {
    background: rgba(47, 107, 255, 0.3);
  }

  [data-theme="dark"] .qcenter {
    color: #E6E9F1;
  }


  /* 구분선 제거 - 불필요한 내부 라인 제거 */
  .qcenter::before,
  .qcenter::after {
    display: none;
  }
  .hint{ color:#6b7280; font-size:.9rem }
   .dz{ border:2px dashed #C7D7F2; border-radius:14px; background:#F4F8FF }
   .dz.drag{ background:#EAF1FF; border-color:#84A9FF }
   
   /* 업로드 박스 스타일 개선 */
   .upload-box {
     min-height: 80px;
     height: auto;
     transition: all 0.3s ease;
     display: flex;
     align-items: center;
     justify-content: center;
     position: relative;
   }
   
   /* 업로드 박스에 썸네일이 있을 때 숨기기 */
   .list:has(.thumb) .upload-box {
     display: none;
   }
   
   /* 썸네일이 없을 때만 업로드 박스 표시 */
   .list:not(:has(.thumb)) .upload-box {
     display: flex;
   }
   
   /* 반응형 디자인 개선 */
   @media (max-width: 768px) {
     .thumb {
       width: 70px;
       height: 70px;
       margin: 2px;
     }
     
     .upload-box {
       min-height: 60px;
       font-size: 14px;
     }
     
     .thumb .swap,
     .thumb .del {
       font-size: 10px;
       padding: 1px 4px;
     }
   }
   
   @media (max-width: 480px) {
     .thumb {
       width: 60px;
       height: 60px;
       margin: 1px;
     }
     
     .upload-box {
       min-height: 50px;
       font-size: 12px;
     }
   }
   
   /* 접근성 개선 */
   .thumb button {
     cursor: pointer;
     border: none;
     outline: none;
     transition: all 0.2s ease;
   }
   
   .thumb button:hover {
     background: rgba(0,0,0,.7);
     transform: scale(1.1);
   }
   
   .thumb button:focus {
     outline: 2px solid #3b82f6;
     outline-offset: 2px;
   }
   
   /* 드래그 앤 드롭 시각적 피드백 개선 */
   .thumb[draggable="true"] {
     cursor: grab;
   }
   
   .thumb[draggable="true"]:active {
     cursor: grabbing;
   }
   
   .thumb.dragging {
     opacity: 0.5;
     transform: rotate(5deg);
   }
  .pill{ 
    padding: 6px 12px; 
    border-radius: 16px; 
    font-size: 13px; 
    font-weight: 600; 
    background: #fff; 
    color: #1A254F; 
    height: 28px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border: 1px solid #E6ECF4;
    transition: all 0.3s ease;
    box-shadow: 0 1px 0 rgba(0,0,0,.02);
    cursor: pointer;
  }
  .pill:hover{
    background: #1A254F;
    color: #fff;
    border-color: #1A254F;
  }
  
  /* 다크모드 pill 스타일 */
  [data-theme="dark"] .pill {
    background: #161B21;
    color: #E9EEF5;
    border-color: #2A323C;
  }
  [data-theme="dark"] .pill:hover{
    background: #3182ce;
    color: #fff;
    border-color: #3182ce;
  }
  .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }
  
  /* 다크모드 작업일지 스타일 */
  [data-theme="dark"] .q{ color:#E9EEF5; }
  [data-theme="dark"] .section-title{ color:#E9EEF5; }
  /* 다크모드에서 빠른메뉴 항목 폰트 색상 적용 */
[data-theme="dark"] #quick-menu .quick-item span{
  color: #3B82F6 !important;        /* 다크모드에서 파란색으로 변경 */
}

/* 다크모드에서 빠른메뉴 개별 색상 적용 - 최고 우선순위 */
body[data-theme="dark"] #quick-menu .quick-item:nth-child(2) span,  /* 작업일지 */
body[data-theme="dark"] #quick-menu .quick-item:nth-child(6) span { /* 재고관리 */
  color: #3B82F6 !important;        /* 다크모드에서 파란색으로 변경 */
}

[data-theme="dark"] #quick-menu .quick-item:nth-child(3) span,  /* 현장정보 */
[data-theme="dark"] #quick-menu .quick-item:nth-child(5) span { /* 본사요청 */
  color: #3B82F6 !important;        /* 다크모드에서 파란색으로 변경 */
}
  [data-theme="dark"] .btn{ border-color:var(--line); background:transparent; color:var(--text); }
  [data-theme="dark"] .btn[data-active="true"]{ background:transparent; border-color:var(--chip-active-line); color:var(--text); box-shadow:0 0 0 4px color-mix(in srgb, var(--chip-active) 12%, transparent) inset; }
  [data-theme="dark"] .chip{ border-color:var(--line); background:transparent; color:var(--text); }
  [data-theme="dark"] .ctl{ border-color:var(--line); background:transparent; color:var(--text); }
  [data-theme="dark"] .hint{ color:var(--muted); }
  
  /* 다크 모드 기본 설정 */
  [data-theme="dark"] body {
      background-color: var(--bg);
      color: var(--text);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,0.1);
  }

  /* 다크 모드에서 적용될 콘텐츠 영역 스타일 */
  [data-theme="dark"] .content {
      border-color: var(--line);
  }

  /* 다크 모드에서 적용될 버튼 스타일 */
  [data-theme="dark"] button {
      background-color: var(--surface);
      color: var(--text);
      border-color: var(--line);
  }
  
  /* 다크모드 날짜 선택 도구 색상 */
  [data-theme="dark"] input[type="date"] {
      color: #E9EEF5;
  }
  
  [data-theme="dark"] input[type="date"]::-webkit-calendar-picker-indicator {
      filter: invert(1);
  }
  
  /* 다크모드 작은 텍스트 라벨 색상 */
  [data-theme="dark"] .text-sm,
  [data-theme="dark"] .text-gray-600 {
      color: #E9EEF5 !important;
  }
  
  /* 다크모드 공수 박스 배경색 */
  [data-theme="dark"] .bg-gray-50 {
      background-color: #161B21 !important;
  }
  
  /* 다크모드 공수 입력 필드 중앙 영역 */
  [data-theme="dark"] .ctl {
      background-color: #161B21 !important;
  }
  
  /* 다크모드 기타 직접입력 박스 */
  [data-theme="dark"] .custom-input {
      background-color: #161B21 !important;
      color: #E9EEF5 !important;
      border: 1px solid #2A323C !important;
  }
  
  [data-theme="dark"] .custom-input:focus {
      border-color: #2F6BFF !important;
  }

  /* 다크모드 모든 밝은 테두리 통일 - 기본 요소들 */
  [data-theme="dark"] .card,
  [data-theme="dark"] .btn,
  [data-theme="dark"] .ctl,
  [data-theme="dark"] .chip,
  [data-theme="dark"] .select-shell,
  [data-theme="dark"] .work-card,
  [data-theme="dark"] .summary-card {
      border-color: var(--line) !important;
  }

  /* 다크모드 구분선 통일 */
  [data-theme="dark"] .border-t,
  [data-theme="dark"] .border-b,
  [data-theme="dark"] .border-l,
  [data-theme="dark"] .border-r,
  [data-theme="dark"] .border,
  [data-theme="dark"] hr,
  [data-theme="dark"] .divider {
      border-color: var(--line) !important;
  }

  /* 다크모드 box-shadow 테두리를 border로 강제 오버라이드 */
  [data-theme="dark"] body {
      box-shadow: none !important;
      border: 1px solid var(--line) !important;
  }

  /* 다크모드 Tailwind 유틸리티 클래스 오버라이드 */
  [data-theme="dark"] .border-white,
  [data-theme="dark"] .border-t-white,
  [data-theme="dark"] .border-b-white,
  [data-theme="dark"] .border-l-white,
  [data-theme="dark"] .border-r-white,
  [data-theme="dark"] .hover\:border-white:hover,
  [data-theme="dark"] .focus\:border-white:focus,
  [data-theme="dark"] .border-\[#E6ECF4\],
  [data-theme="dark"] .border-t-\[#E6ECF4\],
  [data-theme="dark"] .border-b-\[#E6ECF4\],
  [data-theme="dark"] .border-l-\[#E6ECF4\],
  [data-theme="dark"] .border-r-\[#E6ECF4\] {
      border-color: var(--line) !important;
  }

  /* 다크모드 요약 박스와 카드들 */
  [data-theme="dark"] .bg-soft,
  [data-theme="dark"] .summary-section,
  [data-theme="dark"] .work-summary-card {
      border-color: var(--line) !important;
  }

  /* 구분선 두께 통일 */
  .border-t.border-\[#E6ECF4\] {
      border-width: 0.5px !important;
  }

  /* 다크모드 구분선과 요약 박스 색상 및 두께 통일 */
  [data-theme="dark"] .border-t.border-\[#E6ECF4\] {
      border-color: var(--line-soft) !important;
      border-width: 0.25px !important;
  }

  [data-theme="dark"] .border.border-\[#E6ECF4\] {
      border-color: var(--line) !important;
      border-width: 1px !important;
  }

  /* 다크모드에서 Tailwind 테두리 클래스들 override */
  [data-theme="dark"] .border-white,
  [data-theme="dark"] .border-gray-100,
  [data-theme="dark"] .border-gray-200 {
      border-color: var(--line) !important;
  }
  
  [data-theme="dark"] .border-t-white,
  [data-theme="dark"] .border-t-gray-100,
  [data-theme="dark"] .border-t-gray-200 {
      border-color: var(--line-soft) !important;
  }
  
  [data-theme="dark"] .border-b-white,
  [data-theme="dark"] .border-b-gray-100,
  [data-theme="dark"] .border-b-gray-200 {
      border-color: var(--line-soft) !important;
  }
  
  [data-theme="dark"] .border-l-white,
  [data-theme="dark"] .border-l-gray-100,
  [data-theme="dark"] .border-l-gray-200,
  [data-theme="dark"] .border-r-white,
  [data-theme="dark"] .border-r-gray-100,
  [data-theme="dark"] .border-r-gray-200 {
      border-color: var(--line) !important;
  }

  /* 다크모드에서 hover 상태의 Tailwind 테두리 클래스들 override */
  [data-theme="dark"] .hover\:border-white:hover,
  [data-theme="dark"] .hover\:border-gray-100:hover,
  [data-theme="dark"] .hover\:border-gray-200:hover {
      border-color: var(--line) !important;
  }

  /* 다크모드에서 focus 상태의 Tailwind 테두리 클래스들 override */
  [data-theme="dark"] .focus\:border-white:focus,
  [data-theme="dark"] .focus\:border-gray-100:focus,
  [data-theme="dark"] .focus\:border-gray-200:focus {
      border-color: var(--line) !important;
  }
  
  /* 다크모드 칩 버튼 통합 스타일 */
  [data-theme="dark"] .chip:active {
      transform: scale(0.95) !important;
      transition: transform 0.1s ease !important;
  }

  [data-theme="dark"] .chip[data-role="site"]:focus,
  [data-theme="dark"] .chip[data-role="part"]:focus,
  [data-theme="dark"] .chip[data-role="proc"]:focus,
  [data-theme="dark"] .chip[data-role="area"]:focus {
      outline: none !important;
      border-color: #2F6BFF !important;
      box-shadow: 0 0 0 3px rgba(47, 107, 255, 0.3) !important;
  }

  [data-theme="dark"] .chip:hover {
    background-color: rgba(255,255,255,.04) !important;
    border-color: var(--line) !important;
    transform: translateY(-1px) !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
  }

  /* 현장선택 버튼 통합 스타일 */
  [data-role="site"][data-active="true"] {
      background-color: #EFF6FF !important;
      border-color: #BBD7FF !important;
      color: #1A56DB !important;
      transform: none !important;
  }
  
  [data-role="site"]:not([data-active="true"]):hover {
      background-color: #f8fafc !important;
      border-color: #cbd5e1 !important;
      transform: translateY(-1px) !important;
  }

  [data-role="site"]:focus {
      outline: none !important;
      border-color: #1890ff !important;
      box-shadow: 0 0 0 3px rgba(24, 144, 255, 0.3) !important;
  }

  /* 다크모드 현장선택 버튼 */
  [data-theme="dark"] [data-role="site"][data-active="true"] {
      background-color: #2F6BFF !important;
      border-color: #2F6BFF !important;
      color: #ffffff !important;
  }
  
  [data-theme="dark"] [data-role="site"]:not([data-active="true"]):hover {
      background-color: rgba(255,255,255,.04) !important;
      border-color: var(--line) !important;
      transform: translateY(-1px) !important;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
  }
  
  /* 다크모드 현장 선택 드롭박스 스타일 */
  [data-theme="dark"] #siteSelect {
      border-color: #2A323C;
      background-color: #161B21;
      color: #E9EEF5;
  }

  [data-theme="dark"] [data-role="site"]:active {
      background-color: #2F6BFF !important;
      color: #ffffff !important;
      transform: scale(0.95) !important;
      box-shadow: 0 2px 8px rgba(47, 107, 255, 0.4) !important;
  }

  [data-theme="dark"] [data-role="site"]:focus {
      outline: none !important;
      border-color: #2F6BFF !important;
      box-shadow: 0 0 0 3px rgba(47, 107, 255, 0.3) !important;
  }


  /* 도면마킹 버튼 색상 (처음부터 버튼과 동일) */
  #btnPhotoSiteAfter {
      background-color: #99A4BE !important;
      color: #ffffff !important;
      font-weight: 700 !important;
      font-size: 14px !important;
      border: none !important;
      transition: all 0.2s ease !important;
  }
  
  /* 다크모드 도면마킹 버튼 색상 */
  [data-theme="dark"] #btnPhotoSiteAfter {
      background-color: #2A323C !important;
      color: #E9EEF5 !important;
      font-weight: 700 !important;
      font-size: 14px !important;
  }
  
  /* 사진대지 생성 버튼 색상 (저장하기 버튼과 동일) */
  #btnPhotoSiteBefore {
      background-color: #1A254F !important;
      color: #ffffff !important;
      font-weight: 700 !important;
      font-size: 14px !important;
      border: none !important;
      transition: all 0.2s ease !important;
  }
  
  /* 다크모드 사진대지 생성 버튼 색상 */
  [data-theme="dark"] #btnPhotoSiteBefore {
      background-color: #2F6BFF !important;
      color: #ffffff !important;
      font-weight: 700 !important;
      font-size: 14px !important;
  }
  
  /* 사진대지 뷰어 스타일 (ps- 접두사) */
  .ps-hidden { display: none !important; }
  
  .ps-card {
    background: white;
    border-radius: 14px;
    box-shadow: 0 2px 10px rgba(2,6,23,.04);
    border: 1px solid #E6ECF4;
  }
  
  .ps-toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 0 14px 0;
    border-bottom: 1px solid #E6ECF4;
    gap: 6px;
    margin-bottom: 14px;
  }
  
  .ps-title {
    font: 600 18px/1 "Noto Sans KR";
    color: #1A254F;
    margin: 0;
  }
  
  .ps-controls {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  
  .ps-btn {
    height: 36px;
    padding: 0 8px;
    border: none;
    background: #fff;
    color: #1A254F;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    line-height: 34px;
    font-size: 14px;
    border: 1px solid #E6ECF4;
    transition: all 0.2s ease;
  }
  
  .ps-btn:hover {
    background: #f8fafc;
  }
  
  .ps-zoomgroup {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    background: #fff;
    border: 1px solid #E6ECF4;
    border-radius: 8px;
    padding: 4px 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    height: 40px;
    min-width: 120px;
    flex-shrink: 0;
    justify-content: center;
  }
  
  .ps-iconbtn {
    width: 32px;
    height: 32px;
    padding: 0;
    text-align: center;
    border: none !important;
    border-radius: 6px;
    font-size: 16px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s ease;
  }
  
  .ps-iconbtn:hover {
    background: #f1f5f9;
    transform: scale(1.05);
  }
  
  .ps-percent {
    padding: 0 8px;
    font-weight: 700;
    color: #1A254F;
    font-size: 14px;
    min-width: 50px;
    text-align: center;
    background: transparent;
    border: none;
    line-height: 1;
  }
  
  .ps-closebtn {
    background: #fff;
    color: #dc2626;
    border: 1px solid #fecaca;
    border-radius: 8px;
    width: 40px;
    height: 40px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .ps-closebtn:hover {
    background: #fef2f2;
    color: #b91c1c;
    transform: scale(1.05);
  }
  
  .ps-approve-btn {
    background: #28a745;
    color: white;
    border: none;
  }
  
  .ps-reset-btn {
    background: #dc3545;
    color: white;
    border: none;
  }
  
  .ps-save-btn {
    background: #007bff;
    color: white;
    border: none;
  }
  
  .ps-approve-btn:hover {
    background: #218838;
  }
  
  .ps-reset-btn:hover {
    background: #c82333;
  }
  
  .ps-save-btn:hover {
    background: #0056b3;
  }
  
  .ps-approve-btn.approved {
    background: #6c757d;
    cursor: not-allowed;
  }
  
  .ps-download-btn {
    background: #007bff;
    color: white;
    border: none;
  }
  
  .ps-download-btn:hover:not(:disabled) {
    background: #0056b3;
  }
  
  .ps-download-btn:disabled {
    background: #6c757d;
    cursor: not-allowed;
    opacity: 0.6;
  }
  
  .ps-container {
    width: 100%;
    max-width: 100%;
    overflow-x: auto;
    overflow-y: hidden;
    white-space: nowrap;
    padding: 0;
  }
  
  .ps-page {
    width: 100%;
    max-width: 100%;
    background: #ffffff;
    margin: 0 10px 0 0;
    transform: scale(1);
    transform-origin: center center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    padding: 14px;
    box-sizing: border-box;
    font-family: 'Noto Sans KR', system-ui, sans-serif;
    line-height: 1.4;
    display: inline-block;
    vertical-align: top;
    white-space: normal;
  }
  
  .ps-page:last-child {
    margin-right: 0;
  }
  
  .ps-construction-name {
    font-size: 18px;
    margin-bottom: 8px;
    font-weight: 600;
    color: #1A254F;
    font-family: 'Noto Sans KR';
  }
  
  .ps-photo-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
    width: 100%;
    margin-bottom: 0;
  }
  
  .ps-photo-table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
    margin: 0;
    font-size: 12px;
    border: 1px solid #000;
  }
  
  .ps-photo-table.border-left-none {
    border-left: 1px solid #000;
  }
  
  .ps-photo-table.border-top-none {
    border-top: 1px solid #000;
  }
  
    .ps-photo-cell {
      border: 1px solid #000;
      padding: 0;
      text-align: center;
      vertical-align: middle;
    }
  
  .ps-photo-cell.border-left-none {
    border-left: 1px solid #000;
  }
  
  .ps-photo-cell.border-top-none {
    border-top: 1px solid #000;
  }
  
  .ps-photo-container {
    position: relative;
  }
  
  .ps-photo-img {
    cursor: pointer;
    transition: opacity 0.2s ease;
  }
  
  .ps-photo-img:hover {
    opacity: 0.8;
  }
  
  .ps-photo-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.2s ease;
    font-size: 12px;
    font-weight: 600;
  }
  
  .ps-photo-container:hover .ps-photo-overlay {
    opacity: 1;
  }
  
  .ps-info-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 0;
    width: 100%;
    margin-top: 0;
  }
  
  .ps-info-table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
    margin: 0;
    font-size: 12px;
    border: 1px solid #000;
  }
  
  .ps-info-table.border-left-none {
    border-left: 1px solid #000;
  }
  
  .ps-info-table.border-top-none {
    border-top: 1px solid #000;
  }
  
  .ps-info-th {
    border: 1px solid #000;
    padding: 4px;
    text-align: center;
    vertical-align: middle;
    background: #f5f5f5;
    font-weight: 700;
  }
  
  .ps-info-th.border-left-none {
    border-left: 1px solid #000;
  }
  
  .ps-info-th.border-top-none {
    border-top: 1px solid #000;
  }
  
  .ps-info-td {
    border: 1px solid #000;
    padding: 4px;
    text-align: center;
    vertical-align: middle;
  }
  
  .ps-info-td.border-left-none {
    border-left: 1px solid #000;
  }
  
  .ps-info-td.border-top-none {
    border-top: 1px solid #000;
  }
  
  .ps-info-td.editable {
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  
  .ps-info-td.editable:hover {
    background-color: #f0f8ff;
  }
  
  .ps-info-td.editing {
    background-color: #fff;
    border: 2px solid #007bff;
  }
  
  .ps-info-input {
    width: 100%;
    height: 100%;
    border: none;
    background: transparent;
    text-align: center;
    font-size: 12px;
    padding: 0;
    outline: none;
  }
  
  /* 승인된 상태에서 편집 불가 스타일 */
  .ps-approved .ps-photo-img {
    cursor: not-allowed;
    opacity: 0.7;
  }
  
  .ps-approved .ps-photo-overlay {
    display: none;
  }
  
  .ps-approved .ps-info-td.editable {
    cursor: not-allowed;
    background-color: #f8f9fa;
  }
  
  .ps-approved .ps-info-td.editable:hover {
    background-color: #f8f9fa;
  }
  
   /* 인쇄 스타일 */
   @media print {
     @page {
       size: A4 portrait;
       margin: 16mm;
     }
     
     * {
       -webkit-print-color-adjust: exact !important;
       print-color-adjust: exact !important;
     }
    
    .ps-page {
      width: 100% !important;
      max-width: 100% !important;
      margin: 0 !important;
      padding: 0 !important;
      box-shadow: none !important;
      transform: none !important;
      page-break-after: always;
    }
    
    .ps-page:last-child {
      page-break-after: avoid;
    }
    
    .ps-photo-table,
    .ps-info-table {
      border-collapse: collapse !important;
    }
    
    .ps-photo-cell,
    .ps-info-th,
    .ps-info-td {
      border: 1px solid #000 !important;
    }
    
     .ps-photo-img {
       object-fit: cover !important;
       object-position: center !important;
     }
     
     .ps-photo-cell {
       height: 100mm !important;
       min-height: 100mm !important;
     }
     
     .ps-photo-container {
       position: absolute !important;
       inset: 0 !important;
       overflow: hidden !important;
     }
  }
  
  /* 다크모드 지원 */
  [data-theme="dark"] .ps-card {
    background: var(--card);
    border-color: var(--line);
  }
  
  [data-theme="dark"] .ps-toolbar {
    border-bottom-color: var(--line);
  }
  
  [data-theme="dark"] .ps-title {
    color: #1A254F;
  }
  
  [data-theme="dark"] .ps-btn {
    background: var(--card);
    color: #1A254F;
    border-color: var(--line);
  }
  
  [data-theme="dark"] .ps-btn:hover {
    background: #1E293B;
  }
  
  [data-theme="dark"] .ps-zoomgroup {
    background: var(--card);
    border-color: var(--line);
  }
  
  [data-theme="dark"] .ps-iconbtn:hover {
    background: #374151;
  }
  
  [data-theme="dark"] .ps-percent {
    background: transparent;
    color: #1A254F;
  }
  
  [data-theme="dark"] .ps-construction-name {
    color: #1A254F;
  }
  
  [data-theme="dark"] .ps-info-th {
    color: #1A254F;
  }
  
  [data-theme="dark"] .ps-info-td {
    color: #1A254F;
  }
  
  [data-theme="dark"] .ps-info-input {
    color: #1A254F;
  }
  
  /* 공지사항 내용 폰트만 화이트로 변경 (태그는 그대로) */
  [data-theme="dark"] .notice-text {
    color: #ffffff !important;
  }
  
  /* 공지사항 태그는 기존 색상 유지 */
  [data-theme="dark"] .tag-label {
    color: #3B82F6 !important;
  }
  
  [data-theme="dark"] .ps-closebtn {
    background: var(--card);
    color: #f87171;
    border-color: #7f1d1d;
  }
  
  [data-theme="dark"] .ps-closebtn:hover {
    background: #7f1d1d;
    color: #fca5a5;
  }
  
  /* PDF 다운로드 버튼 상태별 스타일 */
  .ps-pdf-btn-approved {
    background-color: #10b981 !important;
    color: #fff !important;
    border-color: #059669 !important;
  }
  
  .ps-pdf-btn-pending {
    background-color: #ef4444 !important;
    color: #fff !important;
    border-color: #dc2626 !important;
    opacity: 0.7;
  }
  
  .ps-pdf-btn-pending:hover {
    opacity: 0.8;
    cursor: not-allowed;
  }
  
  [data-theme="dark"] .ps-pdf-btn-approved {
    background-color: #059669 !important;
    border-color: #047857 !important;
  }
  
  [data-theme="dark"] .ps-pdf-btn-pending {
    background-color: #dc2626 !important;
    border-color: #b91c1c !important;
  }
  
  /* 사진대지 뷰어 버튼 스타일 */
  .ps-controls .chip {
    font-size: 14px !important;
    font-weight: 600 !important;
    text-shadow: none !important;
    box-shadow: none !important;
    border: 1px solid #E6ECF4 !important;
    background: #fff !important;
    color: #1A254F !important;
    padding: 8px 16px !important;
    border-radius: 8px !important;
    cursor: pointer !important;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    white-space: nowrap !important;
    height: 40px !important;
    line-height: 1.2 !important;
    min-width: 60px !important;
    display: inline-flex !important;
    align-items: center !important;
    justify-content: center !important;
    position: relative !important;
    overflow: hidden !important;
  }
  
  .ps-controls .chip:hover {
    background: #f8fafc !important;
    border-color: #d1d5db !important;
    transform: translateY(-2px) !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
  }
  
  .ps-controls .chip:active {
    transform: scale(0.95) !important;
  }
  
  .ps-controls .chip.clicked {
    animation: buttonRipple 0.6s ease-out !important;
  }
  
  /* 다크모드 사진대지 뷰어 버튼 */
  [data-theme="dark"] .ps-controls .chip {
    background: var(--card) !important;
    color: #E9EEF5 !important;
    border-color: var(--line) !important;
  }
  
  [data-theme="dark"] .ps-controls .chip:hover {
    background: #1E293B !important;
    border-color: #374151 !important;
    transform: translateY(-2px) !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
  }
  
  [data-theme="dark"] .ps-controls .chip.clicked {
    animation: buttonRippleDark 0.6s ease-out !important;
  }
  
  /* 모바일 반응형 조정 */
  @media (max-width: 768px) {
    .ps-controls {
      flex-wrap: nowrap !important;
      gap: 4px !important;
      overflow-x: auto;
      padding-bottom: 4px;
    }
    
    .ps-controls::-webkit-scrollbar {
      height: 4px;
    }
    
    .ps-controls::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 2px;
    }
    
    .ps-controls::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 2px;
    }
    
    .ps-zoomgroup {
      max-width: 100px;
      gap: 2px;
      padding: 2px 4px;
      flex-shrink: 0;
      height: 40px;
      min-width: 90px;
    }
    
    .ps-iconbtn {
      width: 28px;
      height: 28px;
      font-size: 14px;
    }
    
    .ps-percent {
      font-size: 12px;
      min-width: 40px;
      padding: 0 4px;
    }
    
    .chip {
      font-size: 14px !important;
      padding: 6px 8px;
      flex-shrink: 0;
      white-space: nowrap;
    }
  }
  
  @media (max-width: 480px) {
    .ps-controls {
      gap: 2px !important;
    }
    
    .ps-zoomgroup {
      max-width: 90px;
      height: 40px;
      min-width: 80px;
    }
    
    .ps-iconbtn {
      width: 26px;
      height: 26px;
      font-size: 12px;
    }
    
    .ps-percent {
      font-size: 11px;
      min-width: 35px;
    }
    
    .chip {
      font-size: 14px !important;
      padding: 4px 6px;
    }
  }
  
  /* ===== (1) 인접 표 사이 '겹치는 라인' 제거: 수직/수평 모두 1줄만 ===== */
  table{ border-collapse: collapse; border-spacing: 0; } /* 보강 */

  .grid{ display:grid; grid-template-columns:1fr 1fr; gap:0; }

  /* 좌우 나란한 두 표 사이: 왼쪽 표의 우측선만 제거 → 중복선 방지 */
  .grid > table:first-child{ border-right:0 !important; }
  .grid > table:first-child th,
  .grid > table:first-child td{ border-right:0 !important; }

  /* 바로 아래 그리드(다음 블록)와 맞닿는 상단선 제거 → 위/아래 중복선 방지 */
  .grid + .grid > table{ border-top:0 !important; }
  .grid + .grid > table th,
  .grid + .grid > table td{ border-top:0 !important; }

  /* 인쇄 시에도 라인 굵기·색 통일 */
  @media print{
    table, th, td{ border-color:#000 !important; border-style:solid !important; }
    *{ -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    
    /* 인쇄 시 색감/선 유지 */
    .ps-photo-img {
      object-fit: cover !important;
      object-position: center !important;
    }
  }

  /* ===== (2) 사진칸 고정 높이 + 이미지가 셀 크기를 '절대' 늘리지 않도록 ===== */
  /* 테이블 셀은 고정 높이만 갖고, 내용은 '절대배치'로 배치 → 행 높이 증가 차단 */
  .ps-photo-cell{ 
    position: relative; 
    height: 100mm !important; 
    min-height: 100mm !important; 
    max-height: 100mm !important;
  }

  /* 사진 컨테이너를 out-of-flow(absolute)로 만들어 테이블 행 높이에 영향 X */
  .ps-photo-container{
    position: absolute !important; 
    inset: 0 !important; 
    overflow: hidden !important; 
    background: #fff;
    display: flex; 
    align-items: center; 
    justify-content: center;
  }

  /* 이미지는 컨테이너 안에서만 맞추기. 셀 높이를 밀어 올리지 않음 */
  .ps-photo-img{
    width: 100% !important; 
    height: 100% !important; 
    object-fit: cover !important; 
    object-position: center !important;
    max-width: 100%;
    max-height: 100%;
  }

  /* 업로드 힌트/인풋은 기존 로직 유지 */
  
  /* 사진대지 미리보기 창 스타일 (워크로그와 동일) */
  .panel-h{
    display: flex; 
    align-items: center; 
    justify-content: space-between;
    padding: 0 0 14px 0; 
    border-bottom: 1px solid #E6ECF4; 
    gap: 6px;
    margin-bottom: 14px;
  }
  .title{ 
    font: 600 18px/1 "Noto Sans KR"; 
    color: #1A254F; 
    margin: 0; 
  }
  .toolbar{ 
    display: flex; 
    align-items: center; 
    gap: 6px; 
  }
  .zoomgroup{ 
    display: inline-flex; 
    align-items: center; 
    gap: 4px; 
  }
  .btn{
    height: 28px; 
    padding: 0 8px; 
    border: none; 
    background: #fff; 
    color: #1A254F;
    border-radius: 8px; 
    font-weight: 600; 
    cursor: pointer; 
    line-height: 26px;
    font-size: 14px;
  }
  .btn:hover{ 
    background: #f8fafc; 
  }
  .iconbtn{ 
    width: 28px; 
    height: 28px; 
    padding: 0; 
    border-radius: 8px; 
    display: inline-flex; 
    align-items: center; 
    justify-content: center; 
  }
  .percent{
    min-width: 56px; 
    height: 28px; 
    padding: 0 6px;
    display: inline-flex; 
    align-items: center; 
    justify-content: center;
    border: 1px solid #E6ECF4; 
    border-radius: 8px; 
    font-weight: 600; 
    color: #1A254F; 
    background: #fff;
    font-variant-numeric: tabular-nums; 
    letter-spacing: 0;
    font-size: 14px;
  }
  
  /* 다크모드 사진대지 미리보기 스타일 */
  [data-theme="dark"] .panel-h {
    border-bottom-color: var(--line);
  }
  [data-theme="dark"] .title {
    color: #E9EEF5;
  }
  
  /* 다크모드 툴바 버튼 색상 강제 적용 - 최고 우선순위 */
  html[data-theme="dark"] .toolbar .btn,
  html[data-theme="dark"] .zoomgroup .btn,
  [data-theme="dark"] .toolbar .btn,
  [data-theme="dark"] .zoomgroup .btn {
    background: var(--card) !important;
    color: #FFFFFF !important;
    border: none !important;
  }
  
  html[data-theme="dark"] .toolbar .btn:hover,
  html[data-theme="dark"] .zoomgroup .btn:hover,
  [data-theme="dark"] .toolbar .btn:hover,
  [data-theme="dark"] .zoomgroup .btn:hover {
    background: #1E293B !important;
    color: #FFFFFF !important;
  }
  
  /* 다크모드 툴바 버튼 내부 모든 요소 색상 강제 적용 */
  html[data-theme="dark"] .toolbar .btn *,
  html[data-theme="dark"] .zoomgroup .btn *,
  [data-theme="dark"] .toolbar .btn *,
  [data-theme="dark"] .zoomgroup .btn * {
    color: #FFFFFF !important;
    fill: #FFFFFF !important;
    stroke: #FFFFFF !important;
  }
  
  /* 다크모드 퍼센트 텍스트 색상 강제 적용 */
  html[data-theme="dark"] .toolbar .percent,
  html[data-theme="dark"] .zoomgroup .percent,
  [data-theme="dark"] .toolbar .percent,
  [data-theme="dark"] .zoomgroup .percent {
    background: var(--card) !important;
    color: #FFFFFF !important;
    border-color: var(--line) !important;
  }
  
  /* 다크모드 퍼센트 텍스트 내부 모든 요소 색상 강제 적용 */
  html[data-theme="dark"] .toolbar .percent *,
  html[data-theme="dark"] .zoomgroup .percent *,
  [data-theme="dark"] .toolbar .percent *,
  [data-theme="dark"] .zoomgroup .percent * {
    color: #FFFFFF !important;
    fill: #FFFFFF !important;
    stroke: #FFFFFF !important;
  }
  
  /* 다크모드 사진대지 미리보기 툴바 전체 강제 적용 - 최종 백업 */
  html[data-theme="dark"] .panel-h .toolbar,
  html[data-theme="dark"] .panel-h .zoomgroup,
  [data-theme="dark"] .panel-h .toolbar,
  [data-theme="dark"] .panel-h .zoomgroup {
    color: #FFFFFF !important;
  }
  
  html[data-theme="dark"] .panel-h .toolbar *,
  html[data-theme="dark"] .panel-h .zoomgroup *,
  [data-theme="dark"] .panel-h .toolbar *,
  [data-theme="dark"] .panel-h .zoomgroup * {
    color: #FFFFFF !important;
    fill: #FFFFFF !important;
    stroke: #FFFFFF !important;
  }
  [data-theme="dark"] #reset {
      background-color: #2A323C !important;
      color: #E9EEF5 !important;
      font-weight: 700 !important;
      font-size: 14px !important;
  }
  
  /* 저장하고 현장보기 버튼 색상 */
  #save {
      background-color: #1A254F !important;
      font-weight: 700 !important;
      font-size: 14px !important;
  }
  
  /* 다크모드 저장하고 현장보기 버튼 색상 */
  [data-theme="dark"] #save {
      background-color: #2F6BFF !important;
      font-weight: 700 !important;
      font-size: 14px !important;
  }
  
  /* 처음부터 버튼 색상 */
  #reset {
      background-color: #99A4BE !important;
      color: #ffffff !important;
      font-weight: 700 !important;
      font-size: 14px !important;
  }
  
  /* 현장선택 통합 스타일 */
  .chip[data-role="site"] {
      width: 100%;
      min-width: 0;
  }
  
  /* row-inline과 field 스타일 - 데스크톱에서 한 줄 배치 */
  .row-inline {
      display: flex;
      gap: 16px;
      align-items: stretch; /* 높이 동일하게 맞춤 */
  }
  
  .row-inline .field {
      flex: 1; /* 동일한 너비로 균등 분할 */
      min-width: 0; /* flex 아이템이 축소될 수 있도록 */
  }
  
  .input {
      width: 100%;
      height: 44px;
      padding: 10px 12px;
      border: 1px solid var(--line);
      border-radius: 12px;
      background: var(--card);
  }
  
  /* 모바일(480px 이하)에서도 현장선택은 한 행 유지 */
  @media (max-width: 480px) {
      .row-inline {
          flex-direction: row; /* 세로 배치 대신 가로 배치 유지 */
          gap: 8px; /* 모바일에서는 간격을 더 줄임 */
      }
      
      /* 모바일에서 현장선택 요소들의 크기 조정 */
      .row-inline .field {
          flex: 1;
          min-width: 0;
      }
      
      /* site1 버튼과 선택박스 높이 통일 */
      .row-inline .field .chip,
      .row-inline .field .select-shell .box {
          height: 48px; /* 모바일에서도 48px로 통일 */
          font-size: 14px; /* 폰트 크기 조정 */
          padding: 0 8px; /* 모바일에서 패딩 조정 */
          white-space: nowrap; /* 텍스트 줄바꿈 방지 */
          overflow: hidden;
          text-overflow: ellipsis; /* 긴 텍스트는 ... 처리 */
      }
  }
  
  /* 매우 작은 화면(360px 이하)에서 추가 최적화 */
  @media (max-width: 360px) {
      .row-inline {
          gap: 6px; /* 더 작은 간격 */
      }
      
      .row-inline .field .chip,
      .row-inline .field .select-shell .box {
          height: 48px; /* 더 작은 화면에서도 48px로 통일 */
          font-size: 13px; /* 더 작은 폰트 */
          padding: 0 6px; /* 더 작은 패딩 */
      }
  }
  
  /* 커스텀 셀렉트 스타일 (site1와 동일한 너비 보장) */
  .select-shell {
      position: relative;
      width: 100%;
      min-width: 0;
  }
  
  .select-shell .box {
      display: block;
      width: 100%;
      height: 48px;
      padding: 0 14px;
      border: 1px solid #E6ECF4;
      border-radius: 12px;
      background: #ffffff;
      font: 600 15px/1.1 'Noto Sans KR', system-ui, sans-serif;
      text-align: center;
      color: #000000;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
  }
  
  .select-shell .arrow {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 10px;
      height: 10px;
      pointer-events: none;
      background: linear-gradient(45deg, #9aa3b6 50%, transparent 50%) center,
                  linear-gradient(-45deg, #9aa3b6 50%, transparent 50%) center;
      background-size: 8px 8px, 8px 8px;
      background-repeat: no-repeat;
      clip-path: polygon(50% 70%, 0 20%, 100% 20%);
  }
  
  .select-shell select {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      cursor: pointer;
  }

  /* 다크모드 현장 선택박스 - 투명 배경 */
  [data-theme="dark"] .select-shell .box {
      background: transparent;
      border-color: var(--line);
      color: var(--text);
  }
  
  [data-theme="dark"] .select-shell .box:hover {
      background: rgba(255,255,255,.06) !important;
      border-color: var(--line) !important;
      color: var(--text);
  }
  
  [data-theme="dark"] .select-shell .arrow {
      color: var(--muted);
  }
  
  [data-theme="dark"] .select-shell .box:hover .arrow {
      color: var(--text);
  }



  .notice-icon {
      font-size: 18px;
      margin-right: 8px;
  }

  .notice-title {
      font-size: 18px;
      font-weight: 600;
      color: #1A254F;
  }

  .notice-content {
      position: relative;
      min-height: 24px;
      overflow: visible;
      padding: 0;
  }

  .notice-item {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      opacity: 0;
      transform: translateY(100%);
      transition: opacity 0.4s ease, transform 0.4s ease;
  }

  .notice-item.active {
      opacity: 1;
      transform: translateY(0);
  }

  .notice-item.prev {
      opacity: 0;
      transform: translateY(-100%);
  }

  .notice-text {
      font-size: 14px;
      font-weight: 600;
      color: #6B7280;
      line-height: 24px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
      overflow: visible;
      text-overflow: unset;
  }

  /* Tag Label 스타일 - 슬라브 버튼과 동일한 폰트 */
  .tag-label {
      font-family: 'Noto Sans KR', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      font-size: 14px;
      font-weight: 700;
      line-height: 1.2;
      color: #1A254F;
  }

  /* 다크모드에서 공지사항 태그 색상을 파란색으로 변경 */
  [data-theme="dark"] .tag-label {
      color: #3B82F6 !important;  /* 파란색 (#3B82F6) */
  }

  /* Icon Box 스타일 - 카드형 아이콘 컨테이너 */
  .icon-box {
      width: 64px;
      height: 64px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 16px;
      background: #fff;
      border: 1px solid var(--line);
      box-shadow: 0 4px 12px rgba(0,0,0,.06);
      transition: all 0.3s ease;
      cursor: pointer;
  }

  /* Icon Box 호버 효과 */
  .icon-box:hover {
      background: #f8fafc;
      border-color: #1A254F;
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(26, 37, 79, 0.15);
  }

  /* 다크모드 Icon Box 호버 효과 */
  [data-theme="dark"] .icon-box:hover {
      background: #374151;
      border-color: #3182ce;
      box-shadow: 0 8px 20px rgba(49, 130, 206, 0.25);
  }

  /* Icon 스타일 */
  .icon {
      width: 32px;
      height: 32px;
      object-fit: contain;
  }

  
  
  /* 선택박스 화살표 스타일 */
  select {
      appearance: none;
      -webkit-appearance: none;
      -moz-appearance: none;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
      background-position: calc(100% - 8px) center;
      background-repeat: no-repeat;
      background-size: 16px;
      padding-right: 32px;
      font:600 15px/1.1 'Noto Sans KR',system-ui,sans-serif;
  }

  /* 사용자 태그 박스 스타일 */
  .user-tag {
      background-color: rgba(0, 104, 254, 0.2); /* #0068FE 20% */
      color: #0068FE;
      padding: 12px 16px;
      border-radius: 12px;
      font-weight: 700;
      text-align: center;
      border: 1px solid rgba(0, 104, 254, 0.3);
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
  }
  
  /* 컨텐츠 스타일 */
  .content {
      position: relative; /* 상대 위치 지정 */
      padding-right: 60px; /* 오른쪽 여백 추가 */
  }

  /* 중요 태그 버튼 스타일 */
  .important-tag {
      background-color: rgba(0, 104, 254, 0.2); /* #0068FE 20% */
      color: #0068FE; /* #0068FE */
      padding: 6px 12px; /* 내부 여백 */
      border-radius: 16px; /* 둥근 모서리 */
      font-size: 13px; /* 글자 크기 */
      font-weight: 600; /* 굵은 글씨체 */
      position: absolute; /* 절대 위치 지정 */
      top: 3px; /* 위쪽 위치 조정 */
      right: 0; /* 오른쪽 위치 */
      height: 28px;
      min-width: 50px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
  }

  /* 다크모드 중요 태그 */
  [data-theme="dark"] .important-tag {
      background-color: rgba(47, 107, 255, 0.25); /* #2F6BFF 25% */
      color: #63B3ED; /* 밝은 파란색 */
  }
  
  /* 부재명 선택 스타일 */
  .absence-reason {
      display: flex;
      align-items: center;
      gap: 8px;
      width: 100%;
  }

  .reason-tag {
      background-color: #e6f7ff;
      color: #000;
      padding: 4px 8px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: bold;
      border: none;
      cursor: pointer;
  }

  .custom-input {
      background-color: #f5f5f5;
      color: #000;
      padding: .4rem .7rem;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 400;
      border: 1px solid #E6ECF4;
      outline: none;
      flex: 0 0 auto;
      height: 48px;
      min-width: 120px;
      max-width: 200px;
      width: 120px;
      transition: width 0.3s ease, max-width 0.3s ease;
  }
  
  .custom-input:focus {
      outline: none;
      border-color: #1A254F;
      width: 200px;
      max-width: 200px;
  }
  
  .custom-input.expanded {
      width: 200px;
      max-width: 200px;
  }
  
  /* 작업일자 입력 필드 폰트 크기 */
  #workDate {
      font-size: 14px !important;
  }
  
  /* 상단 헤더 */
  .header-section {
      margin-bottom: 8px; /* 원래 값보다 줄인 값 */
  }

  /* 현장 선택 카드 박스 */
  .site-selection-card {
      margin-top: 0; /* 위쪽 여백 제거 */
  }

  /* site1 버튼과 드롭다운 높이 맞춤 */
  .row-inline .field .chip {
      height: 48px; /* select-shell .box와 동일한 높이 */
  }
  
  /* 공통 섹션 */
  .section {
      margin-bottom: 8px; /* 원래 값보다 줄인 값 */
  }

  /* 하단 네비게이터 */
  .footer-nav {
      margin-top: 0; /* 위쪽 여백 제거 */
  }

  /* 라벨 강조 스타일 */
  .label-strong {
      font-family: var(--font);
      font-size: var(--label-fz);
      font-weight: var(--label-fw);
      line-height: var(--label-lh);
      letter-spacing: var(--label-track);
      color: inherit;
  }


</style>

<style>

/* zoom pill button */
.zoom-pill{display:inline-flex;align-items:center;gap:6px;height:28px;padding:0 10px;border-radius:9999px;border:1px solid var(--line);background:var(--card);font-weight:700;font-size:13px;line-height:1;color:var(--text)}
.zoom-pct{opacity:.85}
[data-theme="dark"] .zoom-pill{border-color:#2A323C}

/* ===================== UPLOAD POPUP STYLES ===================== */
.upload-scrim{
  position:fixed;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(4px);
  display:none;align-items:center;justify-content:center;z-index:1000;
}
.upload-scrim.show{display:flex}
.upload-popup{
  width:min(560px, 92vw);background:var(--card);border-radius:24px;
  box-shadow:0 12px 40px rgba(0,0,0,.25);padding:20px 20px 12px;animation:fadeIn .28s ease-out;
}
@keyframes fadeIn{from{transform:scale(.95);opacity:.6}to{transform:scale(1);opacity:1}}

.upload-popup-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
.upload-popup-title{font-weight:600;font-size:18px;color:#1A254F;text-align:center;font-family:'Noto Sans KR',system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif}
.upload-popup-sub{margin:2px 0 12px;color:var(--muted)}

  /* 업로드 태그 스타일 */
  .upload-tag {
    background: rgba(51, 230, 246, 0.2);
    color: #28C1CF;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 600;
    font-family: 'Noto Sans KR', system-ui, sans-serif;
    white-space: nowrap;
  }
  
  /* 다크모드 업로드 태그 - 토큰 기반 */
  [data-theme="dark"] .upload-tag {
    background: color-mix(in srgb, var(--chip-active) 20%, transparent);
    color: var(--chip-active);
  }

.upload-close-x{
  width:36px;height:36px;border:none;background:transparent;cursor:pointer;
  display:grid;place-items:center;border-radius:50%;
}
.upload-close-x:hover{background:rgba(0,0,0,.06)}
.upload-close-x svg{width:22px;height:22px;color:#6b7280}

.upload-options{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:8px 2px 2px}
.upload-option{display:flex;flex-direction:column;align-items:center;text-align:center;cursor:pointer;padding:16px;border-radius:16px;border:none;background:var(--card);transition:.2s}
.upload-option:hover{transform:translateY(-3px)}
.upload-icon-box{
  width:72px;height:72px;border-radius:16px;background:var(--card);border:1px solid var(--line);
  display:grid;place-items:center;box-shadow:0 8px 28px rgba(10,25,56,.08);transition:.2s;position:relative;overflow:hidden;margin-bottom:8px
}
.upload-label{margin-top:8px;font-weight:700;color:#283142}

/* 구분선 */
.upload-divider{
  width:95%;height:1px;background:#E5E7EB;margin:16px auto;border:none
}

.upload-popup-actions{display:flex;gap:10px;margin-top:14px;padding-bottom:6px}
.upload-popup-actions .btn{flex:1}


/* 선택된 파일 목록 */
.selected-files{margin-top:16px}
.file-item{display:flex;align-items:center;gap:12px;padding:8px;border:1px solid var(--line);border-radius:8px;margin-bottom:8px;background:var(--card)}
.file-icon{width:24px;height:24px;color:var(--muted)}
.file-info{flex:1}
.file-name{font-weight:600;color:var(--text);font-size:14px}
.file-size{font-size:12px;color:var(--muted)}
.file-remove{width:24px;height:24px;border:none;background:transparent;cursor:pointer;color:var(--muted);border-radius:4px}
.file-remove:hover{background:rgba(239,68,68,.1);color:#ef4444}

/* 숨겨진 파일 입력 */
.hidden-file-input{display:none}

/* 버튼 스타일 */
.btn{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    min-height:44px;
    padding:0 16px;
    border-radius:12px;
    border:1px solid transparent;
    font:700 15px/1 var(--font);
    cursor:pointer;
    transition:all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}
.btn--navy{background:#1A254F;color:#fff}
.btn--navy:hover{filter:brightness(.95)}
.btn--gray{background:#fff;color:#99A4BE;border-color:#99A4BE}
.btn--gray:hover{background:#99A4BE;color:#fff}

/* 라벨 강조 스타일 우선순위 */
.card .label-strong {
    font-weight: 800;
}



/* ===== 섹션 간격 일관성 정리 ===== */

/* 모든 section은 내부 패딩 제거 */
.section {
  padding-top: 0 !important;
  padding-bottom: 0 !important;
}

/* 카드 아래 마진만 사용해서 간격 16px로 확장 */
.card {
  margin-bottom: 16px !important; /* 카드 간 여백 확보 */
}

/* 빠른메뉴와 공지사항 섹션 간격 적용 - 강화된 버전 */
#home-quick {
  margin-bottom: 12px !important;
  padding-bottom: 0 !important;
}
#home-quick::after {
  content: "";
  display: block;
  height: 12px;
  width: 100%;
}
#home-notice {
  margin-top: 0 !important;
  margin-bottom: 12px !important;
  padding-top: 0 !important;
}

/* 빠른메뉴 그리드: 무조건 6칸 1행, 간격 최소화 */
#quick-menu.quick-grid{
  display: grid !important;
  grid-template-columns: repeat(6, minmax(0, 1fr)) !important;
  gap: 1px !important;  /* 간격을 더 줄여서 1행 유지 */
  margin: 0 !important; 
  margin-bottom: 0 !important; /* 하단 마진은 상위 섹션에서 처리 */
  padding: 0 !important;
  list-style: none !important;
  justify-items: center !important; 
  align-items: start !important;
}

/* 빠른메뉴 아이템 스타일 (quick-item 클래스에 맞게 수정) */
#quick-menu .quick-item{
  display: flex; flex-direction: column; align-items: center; gap: 1px; width: 100%;
  text-decoration: none; color: inherit;
  border-radius: 12px;
  transition: all 0.2s ease;
  padding: 4px;  /* 패딩을 줄여서 공간 확보 */
}

/* 빠른메뉴 아이콘 호버 효과 - 하단 네비게이터와 동일한 효과 */
#quick-menu .quick-item {
  transition: all .3s cubic-bezier(0.4, 0, 0.2, 1);
}

#quick-menu .quick-item:hover {
  background: transparent !important;
  transform: translateY(-4px) scale(1.02);
}

#quick-menu .quick-item:hover span {
  color: #1A254F !important;
}

#quick-menu .quick-item:hover img {
  transform: scale(1.1);
}

/* 빠른메뉴 아이콘 클릭 효과 */
#quick-menu .quick-item:active {
  background: transparent !important;
  transform: scale(0.95);
}

/* 다크모드 빠른메뉴 아이콘 호버 효과 */
[data-theme="dark"] #quick-menu .quick-item:hover {
  background: transparent !important;
}

[data-theme="dark"] #quick-menu .quick-item:hover span {
  color: #2F6BFF !important;
}

/* 다크모드 빠른메뉴 아이콘 클릭 효과 */
[data-theme="dark"] #quick-menu .quick-item:active {
  background: transparent !important;
}
/* 빠른메뉴 아이콘 크기 확대 (기존보다 10% 추가 확대) */
#quick-menu .quick-item img{
  width: 100% !important; 
  height: auto !important; 
  object-fit: contain !important; 
  display: block !important;
  /* 아이콘 크기 확대: 기존보다 15% 더 크게 */
  max-width: clamp(46px, 9.7vw, 78px) !important;
  transition: all .3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* ===== 빠른메뉴 팝업 컴포넌트 스코프 CSS (DPR 대응) ===== */
#quick-menu {
  display: grid;
  grid-template-columns: repeat(3, minmax(0, 1fr));
  gap: 16px;
}

#quick-menu .quick-item {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

#quick-menu .qm-icon {
  display: block;
  max-width: 100%;
  height: auto;
  object-fit: contain;
  aspect-ratio: 1/1;
  image-rendering: auto;
}

@media (max-width: 420px) {
  #quick-menu {
    gap: 12px;
  }
  #quick-menu .quick-item .label {
    font-size: 12px;
  }
}
/* ===== 빠른메뉴 팝업 컴포넌트 스코프 CSS 끝 ===== */
/* 빠른메뉴 항목 폰트 스타일 */
#quick-menu .quick-item span{
  font-size: 12px !important;        /* 폰트 크기 12px */
  font-weight: 600 !important;        /* 굵기 600 */
  color: #1A254F !important;        /* 통일된 색상 */
  white-space: nowrap; 
  text-align: center;
  line-height: 1.2;
  margin-top: 2px;
  transition: all .3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* 빠른메뉴 개별 색상 적용 - 최고 우선순위 */
body #quick-menu .quick-item:nth-child(2) span,  /* 작업일지 */
body #quick-menu .quick-item:nth-child(6) span { /* 재고관리 */
  color: #1A254F !important;        /* 통일된 색상 */
}

#quick-menu .quick-item:nth-child(3) span,  /* 현장정보 */
#quick-menu .quick-item:nth-child(5) span { /* 본사요청 */
  color: #1A254F !important;        /* 통일된 색상 */
}
/* 제목 ↔ 아이콘 간격 - 카드 섹션 간격과 동일하게 12px (새로운 스타일로 대체됨) */

/* 공지사항 박스 오른쪽 텍스트 붙는 현상 방지: 내부 여백 보강 */
.notice-card{ 
  padding-inline: 20px !important; 
  box-sizing: border-box; 
  margin-top: 0 !important; /* 상단 마진 제거 */
  margin-bottom: 0 !important; /* 하단 마진은 상위 섹션에서 처리 */
}
.notice-content{ padding-right: 16px !important; }
.notice-text{ 
  display: block; 
  padding-right: 16px; 
  white-space: nowrap; 
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
  line-height: 1.4;
}

/* 확대 모드에서 공지사항 카드 스타일 조정 */
body.fs-150 .notice-card {
  padding-inline: 1.25rem !important; /* 20px -> 1.25rem */
  margin-top: 0 !important;
  margin-bottom: 0 !important;
  position: relative;
  z-index: auto;
}

body.fs-150 .notice-content {
  padding-right: 1rem !important; /* 16px -> 1rem */
  min-height: 1.5rem; /* 24px -> 1.5rem */
}

body.fs-150 .notice-item {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  opacity: 0;
  transform: translateY(100%);
  transition: opacity 0.4s ease, transform 0.4s ease;
}

body.fs-150 .notice-item.active {
  opacity: 1;
  transform: translateY(0);
}

body.fs-150 .notice-item.prev {
  opacity: 0;
  transform: translateY(-100%);
}

body.fs-150 .notice-text {
  font-size: 14px; /* 일반 모드와 동일한 크기 유지 */
  font-weight: 500;
  color: #6B7280;
  line-height: 1.5rem; /* 24px -> 1.5rem */
  white-space: nowrap; /* nowrap으로 변경하여 ellipsis 적용 */
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: 100%;
  display: block; /* inline-block에서 block으로 변경 */
  padding-right: 1rem; /* 16px -> 1rem */
  word-break: keep-all;
  overflow-wrap: break-word;
}

body.fs-150 .tag-label {
  font-size: 14px; /* 일반 모드와 동일한 크기 유지 */
  font-weight: 700;
  line-height: 1.2;
  color: #1A254F;
}

/* 확대 모드에서 검색박스 일반 모드와 동일하게 유지 */
body.fs-150 .sp-input {
  height: 48px; /* 일반 모드와 동일한 높이 유지 */
  font-size: 16px; /* 일반 모드와 동일한 폰트 크기 유지 */
  padding: 0 50px 0 20px; /* 일반 모드와 동일한 패딩 유지 */
}

body.fs-150 .sp-input:hover {
  background: #fafafa; /* 확대 모드에서도 호버 효과 제거 */
  border: 1px solid #e5e5e5;
}

body.fs-150 .sp-input:focus {
  background: #fafafa; /* 확대 모드에서도 포커스 효과 동일하게 유지 */
  border: 1px solid #e5e5e5;
}

body.fs-150 .sp-input::placeholder {
  font-size: 16px; /* 일반 모드와 동일한 플레이스홀더 크기 유지 */
}

body.fs-150 .sp-icon {
  width: 20px; /* 일반 모드와 동일한 아이콘 크기 유지 */
  height: 20px;
  right: 16px; /* 일반 모드와 동일한 위치 유지 */
}

body.fs-150 .sp-back {
  font-size: 18px; /* 일반 모드와 동일한 뒤로가기 버튼 크기 유지 */
  padding: 8px; /* 일반 모드와 동일한 패딩 유지 */
}

body.fs-150 .sp-head {
  padding: 16px 20px; /* 일반 모드와 동일한 헤더 패딩 유지 */
  gap: 12px; /* 일반 모드와 동일한 간격 유지 */
}

/* 다크모드에서 확대 모드 공지사항 태그 색상 */
[data-theme="dark"] body.fs-150 .tag-label {
  color: #3B82F6 !important;
}

/* 확대 모드에서 다크 모드 검색박스 호버 효과 제거 */
[data-theme="dark"] body.fs-150 .sp-input:hover {
  background: #2a2a2a; /* 확대 모드 다크 모드에서도 호버 효과 제거 */
  border-color: #404040;
}

[data-theme="dark"] body.fs-150 .sp-input:focus {
  background: #2a2a2a; /* 확대 모드 다크 모드에서도 포커스 효과 동일하게 유지 */
  border-color: #404040;
}

/* 확대 모드에서 공지사항 섹션 간격 조정 */
body.fs-150 #notice-section {
  margin-top: 0 !important;
  margin-bottom: 0.75rem !important; /* 12px -> 0.75rem */
}

body.fs-150 #notice-section .notice-card {
  margin-top: 0.75rem !important; /* 12px -> 0.75rem */
  margin-bottom: 0 !important;
}

/* 확대 모드에서 빠른메뉴와 공지사항 간격 안정화 */
body.fs-150 #qm-section {
  margin: 0 0 0.75rem 0 !important; /* 12px -> 0.75rem */
}

body.fs-150 #qm-section .qm-head {
  margin: 0 0 0.5rem 0 !important; /* 8px -> 0.5rem */
}

/* 확대 모드에서 공지사항 카드 내부 레이아웃 안정화 */
body.fs-150 .notice-card .card {
  padding: 0.875rem !important; /* 14px -> 0.875rem */
  border-radius: 0.875rem !important; /* 14px -> 0.875rem */
}

/* (안전장치) 혹시 남아 있는 space-y 유틸/중복 규칙이 간섭하면 이 섹션에서만 무력화 */
#home-quick > * + *, #home-notice > * + * { margin-top: 0 !important; }

/* ===== 업로드 박스 아이콘 스타일 ===== */
.upload-box {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
  border-radius: 12px;
  background: transparent;
  width: 100%;
  height: 48px;
  cursor: pointer;
  transition: background .2s;
}

/* 호버 시 */
.upload-box:hover {
  background: transparent;
}

/* 업로드 아이콘 기본 스타일 */
.upload-box .upload-icon {
  width: 20.328px;
  height: 20.328px;
  opacity: 0.7;
  transition: opacity .2s, transform .2s;
}

/* 호버 시 아이콘 강조 */
.upload-box:hover .upload-icon {
  opacity: 1;
  transform: scale(1.1);
}

/* 업로드 박스 아이콘 색상 및 호버 효과 통합 */
.list.pre .upload-box .upload-icon { color: #8b5cf6; }
.list.post .upload-box .upload-icon { color: #00bcd4; }
.list.docs .upload-box .upload-icon { color: #3b82f6; }

.list.pre .upload-box:hover,
.list.post .upload-box:hover,
.list.docs .upload-box:hover {
  background: transparent;
}

/* ===== Quick Menu 제목: 폰트/여백 강제 적용 ===== */
:root{
  --quickmenu-gap: 6px;        /* 제목 아래 여백(섹션 간격도 여기에 맞춰 6px) */
  --quickmenu-title-size: 16px;  /* 제목 폰트 크기만 바꾸고 싶으면 여기 숫자만 변경 */
}

/* 제목 줄(아이콘+텍스트) 정렬 & 하단 여백 12px 고정 */
#home-quick .qm-head{
  display:flex !important;
  align-items:center !important;
  gap:6px !important;
  margin:0 0 var(--quickmenu-gap) 0 !important;
}

/* 제목 텍스트 본체 — 작업내용기록(.q)과 동일한 스타일 적용 (이미 .section-title에서 처리됨) */

/* 제목이 중복 렌더링될 때(겹쳐 보이는 현상) 뒤쪽 것 숨김 */
#home-quick .qm-head .section-title:not(:first-of-type),
#home-quick .qm-head .quick-title:not(:first-of-type){
  display:none !important;
}

/* 번개 아이콘(Flash.png) 정렬/크기 */
#home-quick .qm-head .flash-icon{
  width:18px; height:18px; display:inline-block; vertical-align:middle;
}

/* 섹션 간격 12px로 통일 (빠른메뉴 블록 자체의 바깥 여백) */
#home-quick{ margin: 0 0 var(--quickmenu-gap) 0 !important; }

/* 공지사항 섹션이 바로 아래 온다면 동일 간격으로 보이도록 */
/* .card.notice-card{ margin-top: var(--quickmenu-gap) !important; } */

/* 다크모드에서 작업내용기록(.q)과 동일한 색상 적용 (이미 .section-title에서 처리됨) */

/* ===== 빠른메뉴 ↔ 공지사항 간격 12px로 통일 ===== */
/* 빠른메뉴 섹션 하단 간격 */
#quick-menu {
  margin-bottom: 12px !important;
}

/* 공지사항 카드 상단 간격 */
.notice-card {
  margin-top: 12px !important;
}

/* 내부 요소들이 여백을 추가로 밀지 않도록 */
#quick-menu .card,
#quick-menu .quick-grid {
  margin: 0 !important;
  padding-bottom: 0; /* 필요 시 삭제 가능 */
}

/* 혹시 섹션 공통 규칙이 다시 덮으면 보호 */
section#quick-menu.section {
  margin-bottom: 12px !important;
}

/* === 빠른메뉴 ↔ 공지사항 간격을 정확히 12px로 고정 === */
/* 섹션에 id를 달아 사용: <section id="qm-section">, <section id="notice-section"> */

:root { --gap-12: 12px; }

/* 0) 부모가 Tailwind space-y-*를 쓰는 경우(예: #step1) 간섭 제거 */
#step1[class*="space-y-"] > :not([hidden]) ~ :not([hidden]) { margin-top: 0 !important; }

/* 1) 이 두 섹션만 padding 0 (전역 section padding은 보존) */
#qm-section,
#notice-section { padding-top: 0 !important; padding-bottom: 0 !important; }

/* 2) 빠른메뉴 섹션의 '바깥 여백'만 사용해 아래로 12px 확보 */
#qm-section { margin: 0 0 var(--gap-12) 0 !important; }

/* 3) 공지사항 섹션은 위쪽 padding/margin을 모두 0으로 두고,
      카드 자체에만 12px 위 여백을 준다 */
#notice-section { margin-top: 0 !important; }
#notice-section .notice-card { margin-top: var(--gap-12) !important; }

/* 4) 빠른메뉴 내부 잔여 여백(제목/그리드) 정리 – 추가 간격 방지 */
#qm-section .qm-head { margin: 0 0 8px 0 !important; }
#qm-section .quick-grid { margin: 0 !important; padding: 0 !important; }

/* 5) 다른 규칙이 덮는 경우 대비(특이성 보강) */
section#qm-section#quick-menu,
section#notice-section .notice-card { margin-top: initial; } /* no-op, 특이성 트릭 */

/* 작성 정보 입력 박스 겹침 문제 해결 */
.fix-input-row{
  display:grid !important;
  grid-template-columns:minmax(0,1fr) minmax(0,1fr);
  column-gap:12px !important;
  align-items:start;
}
.fix-input-row > *{min-width:0;}
.fix-input-row .ctl{width:100%; min-width:0; display:block;}

</style>

</head>
<body>
  <!-- ===== 상단 헤더 ===== -->
  <header class="appbar">
    <div class="bar">
      <div class="flex items-center gap-3">
        <button id="btnHamburger" class="icon-btn" aria-label="메뉴"><i data-lucide="menu" class="w-5 h-5"></i></button>
        <a href="home.html" class="brand-logo tracking-tight" id="homeLink" title="홈으로 이동">
          <img src="https://postfiles.pstatic.net/MjAyNTA5MTBfMjk3/MDAxNzU3NDc4ODkwMTc3.lBcKNGpQIyCk5kkAruIKUApO23ml-EJeX7da8626bQQg.oMA0TTp0F8nLP6ICPLrGelEJMVNg6cS5fdLUsXBb7pUg.PNG/00_%EB%A1%9C%EA%B3%A0-%EC%84%B8%EB%A1%9C%EC%A1%B0%ED%95%A9_n.png?type=w3840"
               srcset="https://postfiles.pstatic.net/MjAyNTA5MTBfMjk3/MDAxNzU3NDc4ODkwMTc3.lBcKNGpQIyCk5kkAruIKUApO23ml-EJeX7da8626bQQg.oMA0TTp0F8nLP6ICPLrGelEJMVNg6cS5fdLUsXBb7pUg.PNG/00_%EB%A1%9C%EA%B3%A0-%EC%84%B8%EB%A1%9C%EC%A1%B0%ED%95%A9_n.png?type=w3840 1x, https://postfiles.pstatic.net/MjAyNTA5MTBfMjk3/MDAxNzU3NDc4ODkwMTc3.lBcKNGpQIyCk5kkAruIKUApO23ml-EJeX7da8626bQQg.oMA0TTp0F8nLP6ICPLrGelEJMVNg6cS5fdLUsXBb7pUg.PNG/00_%EB%A1%9C%EA%B3%A0-%EC%84%B8%EB%A1%9C%EC%A1%B0%ED%95%A9_n.png?type=w3840 2x"
               sizes="(max-width: 480px) 120px, 160px"
               alt="INOPNC" 
               referrerpolicy="no-referrer" 
               loading="lazy" 
               decoding="async">
        </a>
      </div>
      <div class="actions">
        <!-- 1) 글씨 크기 스위치 -->
        <div class="fswitch" role="group" aria-label="글씨 크기">
          <button id="fsNormal" class="fswitch-btn active" type="button">일반</button>
          <button id="fsLarge" class="fswitch-btn" type="button">확대</button>
        </div>
        <!-- 2) 다크모드 -->
        <button id="btnTheme" class="icon-btn" aria-label="다크모드"><i data-lucide="moon" class="w-5 h-5" id="themeIcon"></i></button>
        <!-- 3) 검색 -->
        <button id="btnSearch" class="icon-btn" aria-label="검색"><i data-lucide="search" class="w-5 h-5"></i></button>
        <!-- 4) 알림 -->
        <button class="notif" aria-label="알림" id="notificationBtn">
          <img src="https://postfiles.pstatic.net/MjAyNTA5MDlfMTI4/MDAxNzU3MzczOTIzNjY1.cz65rYnLgXusuSn6OTKRtzcS3bVGqAdkQY-0GgOfW0Ug.A8e6_KKQ-P1GI4h_lx7pP4O-dqCinve_Un8_A7tVghkg.PNG/bell.png?type=w3840"
               alt="알림"
               class="icon"
               width="24"
               height="24"
               referrerpolicy="no-referrer"
               crossorigin="anonymous"
               loading="lazy"
               decoding="async"
               onerror="
                 if(!this.dataset.step){ 
                   this.dataset.step='proxy'; 
                   this.src='https://images.weserv.nl/?url=postfiles.pstatic.net%2FMjAyNTA5MDlfMTI4%2FMDAxNzU3MzczOTIzNjY1.cz65rYnLgXusuSn6OTKRtzcS3bVGqAdkQY-0GgOfW0Ug.A8e6_KKQ-P1GI4h_lx7pP4O-dqCinve_Un8_A7tVghkg.PNG%2Fbell.png%3Ftype%3Dw3840';
                 } else if(this.dataset.step==='proxy'){ 
                   this.dataset.step='fallback'; 
                   this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE4IDhBNiA2IDAgMCAwIDYgOEM2IDE1IDMgMTcgMyAxN0gyMUMyMSAxNyAxOCAxNSAxOCA4WiIgc3Ryb2tlPSIjNjc0NzUxIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8cGF0aCBkPSJNMTMgMjFWN0E1IDUgMCAwIDAgMTEgN1YyMSIgc3Ryb2tlPSIjNjc0NzUxIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8L3N2Zz4K';
                 } else { 
                   this.onerror=null; 
                 }
               "/>
          <span class="notification-badge" id="notificationBadge" aria-live="polite">3</span>
        </button>
      </div>
    </div>
  </header>

  <!-- 검색 전체화면 페이지 -->
  <div id="searchPage" class="search-page" role="dialog" aria-modal="true">
    <div class="sp-head">
      <button id="spBack" class="sp-back" aria-label="뒤로"><i data-lucide="chevron-left" class="w-6 h-6"></i></button>
      <div class="sp-input-wrap">
        <input id="spInput" class="sp-input" type="search" placeholder="현장명을 검색하세요." />
        <i data-lucide="search" class="sp-icon"></i>
      </div>
    </div>
    <div class="sp-body">
      <div class="sp-section-title">최근 검색어</div>
      <div class="sp-list" id="spList"><!-- JS 렌더 --></div>
    </div>
  </div>

  <!-- ===== 메인 컨테이너 ===== -->
  <main id="app" class="container">
    <!-- ============ STEP 1: 입력 ============ -->
    <section id="step1">




      <!-- 빠른메뉴 -->
      <section id="qm-section" class="section mb-3.5" id="home-quick">
        <div class="flex items-center gap-2 mb-3">
          <img src="https://postfiles.pstatic.net/MjAyNTA5MDlfMjYz/MDAxNzU3MzczOTIzNjUy.938EaPjiHzNGNoECgw9vItJhy_4pR6ZYVq3-8Z3tJecg.pSbWcXNy1U9El6kYe8OpwKmCEwkZiWJUiIM2R1qL2Swg.PNG/Flash.png?type=w966" alt="" class="w-4 h-4" referrerpolicy="no-referrer" loading="lazy" onerror="this.onerror=null; this.src='./public/assets/icons/Flash.png?v='+(window.APP_VERSION||'v');" />
          <h3 class="section-title">빠른메뉴</h3>
        </div>
        <ul id="quick-menu" class="quick-grid">
          <li><a href="worklog.html" class="quick-item" tabindex="0"><img class="qm-icon" src="https://postfiles.pstatic.net/MjAyNTA5MDlfMzMg/MDAxNzU3MzczOTIzOTg2.eKgzH2aeZVhrEtYCSg-Vjyuok2eudz505Ck18_zeqpsg.r-W69aHdwVPEBS58wMg5LyR7-mDy3WaW_Yyt9I-Ax8kg.PNG/%EC%B6%9C%EB%A0%A5%ED%98%84%ED%99%A9.png?type=w966" width="64" height="64" alt="출력현황" decoding="async" loading="lazy"><span>출력현황</span></a></li>
          <li><a href="home.html" class="quick-item"><img class="qm-icon" src="https://postfiles.pstatic.net/MjAyNTA5MDlfNDIg/MDAxNzU3MzczOTIzOTE5.uKHob9PU2yFuDqyYrTvUYHunByHEBj0A7pUASU7CEREg.3-0zMZk_TTNxnCDNBVAvSSxeGYcWdeot0GzIWhgD72Ug.PNG/%EC%9E%91%EC%97%85%EC%9D%BC%EC%A7%80.png?type=w966" width="64" height="64" alt="작업일지" decoding="async" loading="lazy"><span>작업일지</span></a></li>
          <li><a href="현장정보.html" class="quick-item"><img class="qm-icon" src="https://postfiles.pstatic.net/MjAyNTA5MDlfMTg4/MDAxNzU3MzczOTIzNjQ4.t3FLSpag_6badT7CAFsHXFj2wTbUWJh_3iHKxWR1DEwg.80vrXfmE4WGWg206E9n0XibJFSkfk1RkUr-lDpzyXh4g.PNG/%ED%98%84%EC%9E%A5%EC%A0%95%EB%B3%B4.png?type=w966" width="64" height="64" alt="현장정보" decoding="async" loading="lazy"><span>현장정보</span></a></li>
          <li><a href="home.html" class="quick-item"><img class="qm-icon" src="https://postfiles.pstatic.net/MjAyNTA5MDlfMjc2/MDAxNzU3MzczOTIzNjUx.O1t90awoAKjRWjXhHYAnUEen68ptahXE1NWbYNvjy8Yg.440PWbQoaCp1dpPCgCvnlKU8EASGSAXMHb0zGEKnLHkg.PNG/%EB%AC%B8%EC%84%9C%ED%95%A8.png?type=w966" width="64" height="64" alt="문서함" decoding="async" loading="lazy"><span>문서함</span></a></li>
          <li><a href="home.html" class="quick-item"><img class="qm-icon" src="https://postfiles.pstatic.net/MjAyNTA5MDlfNjEg/MDAxNzU3MzczOTIzODI4.vHsIasE2fPt-A9r28ui5Sw7oGf9JXhxetAh96TdAHgcg.iV39dkzonq61Z_hvu1O1-FLwCNFqM-OCqrNDwN3EuI8g.PNG/%EB%B3%B8%EC%82%AC%EC%9A%94%EC%B2%AD.png?type=w966" width="64" height="64" alt="본사요청" decoding="async" loading="lazy"><span>본사요청</span></a></li>
          <li><a href="home.html" class="quick-item"><img class="qm-icon" src="https://postfiles.pstatic.net/MjAyNTA5MDlfMTAg/MDAxNzU3MzczOTIzODc2.V3ORy11Kszltv6qJ6M3zt4qFtdNopNi1sYcrZALvFD0g.5ZpgJNYRXfyedL0hVpIfo1sxqgBPUAO9SmMjmKf7qZgg.PNG/%EC%9E%AC%EA%B3%A0%EA%B4%80%EB%A6%AC.png?type=w966" width="64" height="64" alt="재고관리" decoding="async" loading="lazy"><span>재고관리</span></a></li>
        </ul>
      </section>

      <!-- 공지사항 -->
      <section id="notice-section" class="section mb-3.5" id="home-notice">
        <div class="card notice-card">
          <div class="notice-content">
            <div class="notice-item active">
              <span class="notice-text">
                <strong class="tag-label">[공지사항]</strong>
                시스템 점검 안내: 1월 15일 오전 2시~4시
              </span>
            </div>
            <div class="notice-item">
              <span class="notice-text">
                <strong class="tag-label">[업데이트]</strong>
                새로운 기능이 추가되었습니다. 확인해보세요!
              </span>
            </div>
            <div class="notice-item">
              <span class="notice-text">
                <strong class="tag-label">[이벤트]</strong>
                신규 회원 대상 특별 혜택 이벤트 진행 중
              </span>
            </div>
          </div>
        </div>
      </section>

      <!-- 현장 선택 -->
      <div class="card p-5 site-selection-card mb-3.5">
        <div class="q mb-3 flex items-center justify-between"><span>현장선택<span style="color: #EA3829;">*</span></span><span class="text-sm text-gray-600" style="font-family: 'Noto Sans KR', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; font-weight: 600;"><span style="color: #0068FE;">필수입력값(*)작성 후 저장</span></span></div>
        <div class="row-inline">
          <div class="field">
            <button class="chip" data-role="site" data-value="site1">site1</button>
          </div>
          <div class="field">
            <label class="select-shell" aria-label="현장 선택">
              <div class="box" id="selectDisplay">선택</div>
              <span class="arrow" aria-hidden="true"></span>
              <select id="siteSelect">
                <option selected value="">선택</option>
                <option>Site A</option><option>Site B</option><option>Site C</option>
              </select>
            </label>
          </div>
        </div>
      </div>

      <!-- 일자/작성자 -->
      <div class="card p-5 mb-3.5" style="margin-top: 12px;">
        <div class="q mb-3 content">작성 정보 입력 <span style="color: #EA3829;">*</span>
          <div class="important-tag">작성자</div>
        </div>
        <div class="row-inline fix-input-row">
          <div class="field">
            <label class="flex flex-col gap-1">
              <span class="text-sm text-gray-600">작업일자</span>
              <input id="workDate" type="date" class="ctl"/>
            </label>
          </div>
          <div class="field">
            <label class="flex flex-col gap-1">
              <span class="text-sm text-gray-600">선택된 현장</span>
              <input id="siteOut" type="text" class="ctl bg-gray-50" placeholder="현장 미선택" readonly/>
            </label>
          </div>
        </div>
      </div>

      <!-- 작업 내용 기록 카드 컨테이너 -->
      <div id="workCardContainer" class="mb-3.5">
        <!-- 첫 번째 카드 (기본) -->
        <div class="card p-5 work-card" data-card-id="1">
          <!-- 작업 내용 기록 헤더 -->
          <div class="flex items-center justify-between mb-3">
            <div class="q">작업 내용 기록 <span style="color: #EA3829;">*</span></div>
            <div class="flex items-center gap-2">
              <button class="work-action-tag add-card-btn">추가</button>
              <button class="remove-card-btn work-action-tag" style="display: none;">삭제</button>
            </div>
          </div>
          
          <!-- 부재명 -->
          <div class="mb-4">
            <div class="text-sm text-gray-600 mb-2">부재명</div>
            <div class="absence-reason">
              <button class="chip" data-role="part" data-value="슬라브">슬라브</button>
              <button class="chip" data-role="part" data-value="거더">거더</button>
              <button class="chip" data-role="part" data-value="기둥">기둥</button>
              <input class="custom-input part-custom" placeholder="기타 직접입력"/>
            </div>
          </div>
          
          <!-- 작업공정 -->
          <div class="mb-4">
            <div class="text-sm text-gray-600 mb-2">작업공정</div>
            <div class="absence-reason">
              <button class="chip" data-role="proc" data-value="균열">균열</button>
              <button class="chip" data-role="proc" data-value="면">면</button>
              <button class="chip" data-role="proc" data-value="마감">마감</button>
              <input class="custom-input proc-custom" placeholder="기타 직접입력"/>
            </div>
          </div>

          <!-- 구분선 -->
          <div class="border-t border-[#E6ECF4] my-6" style="width: 98%; margin-left: auto; margin-right: auto;"></div>

          <!-- 작업구간 -->
          <div class="q mb-3">작업구간</div>
          <div class="mb-4">
            <div class="text-sm text-gray-600 mb-2">작업유형</div>
            <div class="absence-reason">
              <button class="chip" data-role="area" data-value="지하" data-code="UG">지하</button>
              <button class="chip" data-role="area" data-value="지붕" data-code="RF">지붕</button>
              <input class="custom-input area-custom" placeholder="기타 직접입력"/>
            </div>
          </div>

          <div class="mb-4">
            <div class="text-sm text-gray-600 mb-2">블럭 / 동 / 호수</div>
            <div class="flex items-center gap-2 w-full overflow-hidden">
              <input class="ctl flex-1 min-w-0 block-input" placeholder="블럭" oninput="this.value = this.value.toUpperCase()"/>
              <input class="ctl flex-1 min-w-0 dong-input" placeholder="동" type="number" min="0" oninput="this.value = this.value.replace(/[^0-9]/g, '')"/>
              <input class="ctl flex-1 min-w-0 ho-input" placeholder="호수" type="number" min="0" oninput="this.value = this.value.replace(/[^0-9]/g, '')"/>
            </div>
          </div>

          <!-- 공수(일) -->
          <div class="mb-4">
            <div class="q mb-2">공수(일) <span style="color: #EA3829;">*</span></div>
            <div class="qty-split3" data-values="0,0.5,1,1.5,2,2.5,3" role="group" aria-label="공수(일)">
              <button type="button" class="qbtn" data-minus aria-label="공수 감소">−</button>
              <div class="qcenter" aria-live="polite" aria-atomic="true">1</div>
              <button type="button" class="qbtn" data-plus aria-label="공수 증가">＋</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 하단 버튼들 -->
      <div class="mb-4">
        <div class="flex gap-2">
          <!-- 처음부터 버튼 -->
          <button id="reset" class="flex-1 h-[48px] rounded-xl bg-gray-200">처음부터</button>
          <!-- 저장하기 버튼 -->
          <button id="save" class="flex-1 h-[48px] rounded-xl bg-good text-white font-bold">저장하기</button>
        </div>
      </div>

      <!-- 사진업로드 -->
      <div class="card p-5">
        <div class="q mb-3 flex items-center justify-between">
          <span>사진·문서 업로드</span>
          <div class="upload-tag">↔ 버튼으로 전/후</div>
        </div>
        
        <!-- 업로드 버튼 (칩 스타일) -->
        <div class="upload-chip-group mb-5" role="group" aria-label="업로드 선택">
          <button id="btnBefore" class="upload-chip" data-mode="pre" type="button">보수 전</button>
          <button id="btnAfter" class="upload-chip" data-mode="post" type="button">보수 후</button>
          <button id="btnBulk" class="upload-chip" data-mode="bulk" data-active="true" type="button">일괄</button>
          <button id="btnReceipt" class="upload-chip" data-mode="receipt" type="button">영수증</button>
          <button id="btnDrawing" class="upload-chip" data-mode="drawing" type="button">도면</button>
        </div>

        <!-- 숨김 파일 입력 -->
        <input id="inBefore" type="file" class="sr-only" accept="image/*" multiple>
        <input id="inAfter" type="file" class="sr-only" accept="image/*" multiple>
        <input id="inReceipt" type="file" class="sr-only" accept="image/*,application/pdf,.dwg,.dxf" multiple>
        <input id="inDrawing" type="file" class="sr-only" accept="image/*,application/pdf,.dwg,.dxf" multiple>
        <input id="inBulk" type="file" class="sr-only" accept="image/*,application/pdf,.dwg,.dxf" multiple>

        <!-- 전/후 리스트 & 카운트 -->
        <div class="grid grid-cols-2 gap-4">
          <div>
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm font-medium">보수 전 <span id="cntPre" class="pill" aria-live="polite">0</span><span class="text-xs text-gray-500 ml-2">/30</span></div>
            </div>
            <div id="zonePre" class="list pre" aria-label="보수 전 썸네일 영역">
              <script>document.write(createUploadBox('inBefore', '보수 전 사진 업로드'));</script>
            </div>
          </div>
          <div>
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm font-medium">보수 후 <span id="cntPost" class="pill" aria-live="polite">0</span><span class="text-xs text-gray-500 ml-2">/30</span></div>
            </div>
            <div id="zonePost" class="list post" aria-label="보수 후 썸네일 영역">
              <script>document.write(createUploadBox('inAfter', '보수 후 사진 업로드'));</script>
            </div>
          </div>
        </div>

        <!-- 문서 리스트 & 카운트 -->
        <div class="grid grid-cols-2 gap-4 mt-4">
          <div>
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm font-medium">영수증 <span id="cntReceipt" class="pill" aria-live="polite">0</span><span class="text-xs text-gray-500 ml-2">/30</span></div>
            </div>
            <div id="zoneReceipt" class="list docs" aria-label="영수증 썸네일 영역">
              <script>document.write(createUploadBox('inReceipt', '영수증 업로드'));</script>
            </div>
          </div>
          <div>
            <div class="flex items-center justify-between mb-2">
              <div class="text-sm font-medium">도면 <span id="cntDrawing" class="pill" aria-live="polite">0</span><span class="text-xs text-gray-500 ml-2">/30</span></div>
            </div>
            <div id="zoneDrawing" class="list docs" aria-label="도면 썸네일 영역">
              <script>document.write(createUploadBox('inDrawing', '도면 업로드'));</script>
            </div>
          </div>
        </div>
      </div>

      <!-- 도면마킹·사진대지 생성 버튼들 -->
      <div class="mb-4">
        <div class="flex gap-2">
          <!-- 도면마킹 버튼 -->
          <button id="btnPhotoSiteAfter" class="flex-1 h-[48px] rounded-xl bg-gray-200 font-bold" data-mode="post" data-active="true" type="button">도면마킹</button>
          <!-- 사진대지 생성 버튼 -->
          <button id="btnPhotoSiteBefore" class="flex-1 h-[48px] rounded-xl bg-good text-white font-bold" data-mode="pre" type="button">사진대지 생성</button>
        </div>
        
        <!-- 사진대지 인라인 뷰어 -->
        <div id="ps-photoSheetViewer" class="ps-hidden mt-4">
          <div class="ps-card p-5">
            <!-- 사진대지 툴바 -->
            <div class="ps-toolbar">
              <div class="ps-controls" style="display: flex; align-items: center; gap: 8px; width: 100%; flex-wrap: nowrap; justify-content: space-between;">
                <button class="chip" id="ps-resetBtn" title="초기화">초기</button>
                <button class="chip" id="ps-saveBtn" title="저장">저장</button>
                <div class="ps-zoomgroup">
                  <button class="ps-btn ps-iconbtn" id="ps-zoomOutBtn" title="축소">−</button>
                  <div class="ps-percent" id="ps-zoomPct">100%</div>
                  <button class="ps-btn ps-iconbtn" id="ps-zoomInBtn" title="확대">＋</button>
                </div>
              </div>
            </div>
            
            <!-- 사진대지 컨테이너 -->
            <div id="ps-photoSheetContainer" class="ps-container">
              <!-- 동적으로 생성되는 페이지들이 여기에 추가됩니다 -->
            </div>
          </div>
        </div>
      </div>

      <!-- 요약 -->
      <div class="card p-5">
        <div class="q mb-3">작성 내용 요약</div>
        <div id="summary" class="bg-soft border border-[#E6ECF4] rounded-xl p-4 text-sm">
          <div><b>현장</b> : 미선택</div>
          <div><b>작업일자</b> : - &nbsp; <b>작성자</b> : -</div>
          <div><b>부재</b> : - &nbsp; <b>공정</b> : -</div>
          <div><b>작업유형</b> : -</div>
          <div><b>공수</b> : 1일</div>
          <div><b>사진·문서</b> : 보수 전 0장 / 보수 후 0장</div>
        </div>
      </div>
    </section>

    <!-- ============ STEP 2: 현장 보기(저장 후) ============ -->
    <section id="step2" class="hidden space-y-3.5">
      <div class="card p-5">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl bg-brand/10 flex items-center justify-center text-brand text-sm">📍</div>
          <div>
            <div id="vSite" class="text-sm font-extrabold text-navy">-</div>
          </div>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="card p-5">
          <div class="q mb-3">오늘의 현장 정보</div>
          <div id="vInfo" class="text-sm leading-7">
            -
          </div>
          <div class="mt-3 flex flex-wrap gap-2">
            <button class="btn" onclick="alert('현장 공도면으로 이동(예시)')">현장 공도면</button>
            <button class="btn" onclick="alert('PTW 문서로 이동(예시)')">PTW 문서</button>
            <button class="btn" onclick="alert('문서함으로 이동(예시)')">관련서/문서함</button>
          </div>
        </div>
        <div class="card p-5">
          <div class="q mb-3 label-strong">공지사항</div>
          <ul id="vNotice" class="text-sm list-disc pl-5 space-y-2">
            <li>안전모/안전화 상시 착용 점검 강화</li>
            <li>PTW 승인 절차 변경 안내</li>
          </ul>
        </div>
      </div>

      <div class="flex gap-2">
        <button class="btn" onclick="backToEdit()">수정하기</button>
        <button class="btn" onclick="alert('다음 단계로 이동(예시)')">다음</button>
      </div>
    </section>
  </main>

  <!-- ===== 하단 네비게이터 ===== -->
  <nav class="bottom-nav-wrap">
    <div class="bottom-nav">
      <ul class="nav-list">
        <li class="nav-item"><a class="nav-link" data-route="home"   href="home.html"><span class="nav-ico"><i data-lucide="home" class="nav-svg"></i></span><span class="nav-label">홈</span></a></li>
        <li class="nav-item"><a class="nav-link" data-route="output" href="worklog.html"><span class="nav-ico"><i data-lucide="calculator" class="nav-svg"></i></span><span class="nav-label">출력현황</span></a></li>
        <li class="nav-item"><a class="nav-link" data-route="worklog" href="#worklog"><span class="nav-ico"><i data-lucide="clipboard-list" class="nav-svg"></i></span><span class="nav-label">작업일지</span></a></li>
        <li class="nav-item"><a class="nav-link" data-route="sites"  href="#sites"><span class="nav-ico"><i data-lucide="map" class="nav-svg"></i></span><span class="nav-label">현장정보</span></a></li>
        <li class="nav-item"><a class="nav-link" data-route="docs"   href="#docs"><span class="nav-ico"><i data-lucide="folder" class="nav-svg"></i></span><span class="nav-label">문서함</span></a></li>
      </ul>
    </div>
  </nav>

  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
<script>
    // Lucide 아이콘 초기화 함수
    function initLucideIcons() {
      if (window.lucide && window.lucide.createIcons) {
        window.lucide.createIcons();
      }
    }

    // DOM이 로드된 후 아이콘 생성
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initLucideIcons);
    } else {
      initLucideIcons();
    }

    // 추가로 약간의 지연 후 다시 시도 (동적 컴포넌트를 위해)
    setTimeout(initLucideIcons, 100);

    // ========== 공지사항 슬라이드 ==========
    function initNoticeSlider() {
      const noticeItems = document.querySelectorAll('.notice-item');
      let currentIndex = 0;
      
      if (noticeItems.length <= 1) return; // 공지사항이 1개 이하면 슬라이드 불필요
      
      function showNextNotice() {
        // 현재 활성화된 항목을 이전으로 표시
        noticeItems[currentIndex].classList.remove('active');
        noticeItems[currentIndex].classList.add('prev');
        
        // 다음 인덱스 계산
        currentIndex = (currentIndex + 1) % noticeItems.length;
        
        // 다음 항목을 활성화
        noticeItems[currentIndex].classList.remove('prev');
        noticeItems[currentIndex].classList.add('active');
        
        // 이전 항목의 prev 클래스 제거 (애니메이션 완료 후)
        setTimeout(() => {
          noticeItems.forEach((item, index) => {
            if (index !== currentIndex) {
              item.classList.remove('prev');
            }
          });
        }, 400);
      }
      
      // 3초마다 다음 공지사항으로 슬라이드
      setInterval(showNextNotice, 3000);
    }

    // ========== 알림 카운터 기능 ==========
    function updateNotificationCounter() {
      const noticeItems = document.querySelectorAll('.notice-item');
      const notificationBadge = document.getElementById('notificationBadge');
      
      if (notificationBadge) {
        const count = noticeItems.length;
        notificationBadge.textContent = count;
        
        // 카운트가 0이면 배지 숨기기
        if (count === 0) {
          notificationBadge.style.display = 'none';
        } else {
          notificationBadge.style.display = 'flex';
        }
      }
    }

    // ========== 새로운 공지사항 추가 함수 ==========
    function addNewNotice(tag, content) {
      // 새로운 공지사항 데이터 추가
      const newNotice = {
        id: Date.now(),
        tag: tag,
        content: content,
        date: new Date().toISOString().split('T')[0],
        isNew: true
      };
      
      noticeData.notices.unshift(newNotice); // 맨 앞에 추가
      
      const noticeContent = document.querySelector('.notice-content');
      if (!noticeContent) return;

      // 새로운 공지사항 요소 생성
      const newNoticeItem = document.createElement('div');
      newNoticeItem.className = 'notice-item new-notice';
      newNoticeItem.innerHTML = `
        <span class="notice-text">
          <strong class="tag-label">[${tag}]</strong>
          ${content}
        </span>
      `;

      // 기존 공지사항들에 prev 클래스 추가
      const existingItems = noticeContent.querySelectorAll('.notice-item');
      existingItems.forEach(item => {
        item.classList.remove('active');
        item.classList.add('prev');
      });

      // 새 공지사항을 맨 앞에 추가하고 활성화
      noticeContent.insertBefore(newNoticeItem, noticeContent.firstChild);
      newNoticeItem.classList.add('active');

      // 공지사항 박스 하이라이트 효과
      const noticeCard = document.querySelector('.notice-card');
      if (noticeCard) {
        noticeCard.classList.remove('highlight');
        void noticeCard.offsetWidth;
        noticeCard.classList.add('highlight');
        
        // 효과 클래스 제거 (애니메이션 완료 후)
        setTimeout(() => {
          noticeCard.classList.remove('highlight');
        }, 1500);
      }

      // 알림 카운터 업데이트
      updateNotificationCounter();

      // 알림 배지 효과 실행
      const notificationBadge = document.getElementById('notificationBadge');
      if (notificationBadge) {
        // 펄스 효과
        notificationBadge.classList.remove('pulse');
        void notificationBadge.offsetWidth;
        notificationBadge.classList.add('pulse');
        
        // 글로우 효과 (펄스와 함께)
        notificationBadge.classList.remove('glow');
        void notificationBadge.offsetWidth;
        notificationBadge.classList.add('glow');
        
        // 효과 클래스 제거 (애니메이션 완료 후)
        setTimeout(() => {
          notificationBadge.classList.remove('pulse', 'glow');
        }, 1000);
      }

      // 알림 벨 애니메이션 실행
      const notificationBtn = document.getElementById('notificationBtn');
      if (notificationBtn) {
        notificationBtn.classList.remove('bell-ringing');
        void notificationBtn.offsetWidth;
        notificationBtn.classList.add('bell-ringing');
        
        // 벨 애니메이션 완료 후 클래스 제거
        setTimeout(() => {
          notificationBtn.classList.remove('bell-ringing');
        }, 1200);
      }

      // 3초 후 기존 항목들의 prev 클래스 제거
      setTimeout(() => {
        existingItems.forEach(item => {
          item.classList.remove('prev');
        });
        newNoticeItem.classList.remove('new-notice');
      }, 3000);
    }
    
    // DOM 로드 후 공지사항 슬라이드 및 알림 카운터 초기화
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => {
        initNoticeSlider();
        updateNotificationCounter();
      });
    } else {
      initNoticeSlider();
      updateNotificationCounter();
    }

    // ========== 테스트용 함수 (개발용) ==========
    // 새로운 공지사항 추가 테스트 - 콘솔에서 사용 가능
    window.addTestNotice = function() {
      const tags = ['긴급', '일반', '공지', '안내', '업데이트'];
      const contents = [
        '새로운 작업 지침이 업데이트되었습니다',
        '월간 보고서 제출 마감일 안내',
        '현장 안전 점검 일정 변경',
        '새로운 시스템 도입 안내',
        '휴무일 변경 공지',
        '장비 점검 일정 안내',
        '급여 지급 일정 안내',
        '현장 보안 강화 안내'
      ];
      
      const randomTag = tags[Math.floor(Math.random() * tags.length)];
      const randomContent = contents[Math.floor(Math.random() * contents.length)];
      
      addNewNotice(randomTag, randomContent);
    };

    // 공지사항 삭제 테스트 함수
    window.removeLastNotice = function() {
      const noticeItems = document.querySelectorAll('.notice-item');
      if (noticeItems.length > 0) {
        const lastItem = noticeItems[noticeItems.length - 1];
        lastItem.remove();
        updateNotificationCounter();
      }
    };
    setTimeout(initLucideIcons, 500);



    // Theme toggle
    const root = document.documentElement;
    const themeBtn = document.getElementById('btnTheme');
    const themeIcon = document.getElementById('themeIcon');
    const THEME_KEY = 'inopnc_theme';
    function setTheme(mode){
      root.setAttribute('data-theme', mode);
      try{ localStorage.setItem(THEME_KEY, mode); }catch(e){}
      themeIcon && themeIcon.setAttribute('data-lucide', mode === 'dark' ? 'sun' : 'moon');
      initLucideIcons();
    }
    setTheme(localStorage.getItem(THEME_KEY) || 'light');
    themeBtn && themeBtn.addEventListener('click', ()=>{
      setTheme(root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
    });

    // ===== 글씨 크기 스위치 =====
    document.addEventListener('DOMContentLoaded', () => {
      const FS_KEY = 'font-scale-mode';
      const fsNormal = document.getElementById('fsNormal');
      const fsLarge  = document.getElementById('fsLarge');

      function applyFontScale(mode){
        document.body.classList.remove('fs-100','fs-150');
        document.body.classList.add(mode);
        fsNormal?.classList.toggle('active', mode === 'fs-100');
        fsLarge?.classList.toggle('active',  mode === 'fs-150');
        try{ localStorage.setItem(FS_KEY, mode); }catch(e){}
      }
      applyFontScale(localStorage.getItem(FS_KEY) || 'fs-100');
      fsNormal?.addEventListener('click', ()=>applyFontScale('fs-100'));
      fsLarge?.addEventListener('click', ()=>applyFontScale('fs-150'));
    });

    // ===== 검색 페이지 (현장명) =====
    document.addEventListener('DOMContentLoaded', () => {
      const btnSearch = document.getElementById('btnSearch');
      const page = document.getElementById('searchPage');
      const back = document.getElementById('spBack');
      const input = document.getElementById('spInput');
      const list = document.getElementById('spList');

      // 최근 검색어 예시(현장명)
      const keywords = [
        "포항환호1BL","포항환호2BL","디에이치방배","위례자이더시티","과천지식정보타운","송도더샵프라임뷰","검단신도시AA10"
      ];

      function renderList(){
        list.innerHTML = "";
        keywords.forEach((k, idx)=>{
          const row = document.createElement('div');
          row.className = 'sp-row';
          row.innerHTML = `<span class="sp-num">${idx+1}</span><span class="sp-item">${k}</span>`;
          list.appendChild(row);
        });
      }
      renderList();

      function openPage(){ page.style.display = 'block'; setTimeout(()=> input.focus(), 30); }
      function closePage(){ page.style.display = 'none'; }

      btnSearch?.addEventListener('click', openPage);
      back?.addEventListener('click', closePage);
      document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape') closePage(); });
    });

    // 알림 배지 카운트 설정 함수
    function setNotificationCount(count) {
      const el = document.querySelector('.notification-badge');
      if (!el) return;
      
      if (!count || count <= 0) {
        el.classList.add('is-hidden');
        el.textContent = '';
        el.removeAttribute('aria-label');
        return;
      }
      
      const label = count > 99 ? '99+' : String(count);
      el.textContent = label;
      el.setAttribute('aria-label', `새 알림 ${label}`);
      el.classList.remove('is-hidden');
    }

    // 알림 아이콘 로드 보안 조치 - 외부 링크 우선, 실패 시 아이콘 대체
    document.addEventListener('DOMContentLoaded', () => {
      // 알림 배지 초기화
      setNotificationCount(3); // 현재 값으로 초기화
      
      // 알림 팝업 기능 초기화
      initNotificationPopup();
      
      // 알림 버튼 클릭 이벤트
      const notificationBtn = document.getElementById('notificationBtn');
      notificationBtn && notificationBtn.addEventListener('click', ()=>{
        notificationBtn.classList.remove('bell-ringing');
        void notificationBtn.offsetWidth;
        notificationBtn.classList.add('bell-ringing');
        
        // 알림 팝업 표시 (바로가기 버튼을 눌러야 페이지 이동)
        showNotificationPopup();
      });
    });

    // 알림 팝업 기능 초기화
    function initNotificationPopup() {
      const popup = document.getElementById('notification-popup');
      const closeBtn = document.getElementById('notification-popup-close');
      const skipBtn = document.getElementById('notification-skip-btn');
      const shortcutBtn = document.getElementById('notification-shortcut-btn');
      const dontShowCheckbox = document.getElementById('notification-dont-show-today');

      // 닫기 버튼 이벤트
      if (closeBtn) {
        closeBtn.addEventListener('click', () => {
          closeNotificationPopup();
        });
      }

      // 팝업 배경 클릭 시 닫기
      if (popup) {
        popup.addEventListener('click', (e) => {
          if (e.target === popup) {
            closeNotificationPopup();
          }
        });
      }

      // 건너뛰기 버튼 이벤트
      if (skipBtn) {
        skipBtn.addEventListener('click', () => {
          // 홈으로 이동 (현재 페이지 유지)
          closeNotificationPopup();
          console.log('건너뛰기: 홈으로 이동');
        });
      }

      // 바로가기 버튼 이벤트
      if (shortcutBtn) {
        shortcutBtn.addEventListener('click', () => {
          // 바로가기 기능 수행 (예: 작업일지 페이지로 이동)
          window.location.href = 'worklog.html';
        });
      }

      // 오늘은 그만보기 체크박스 이벤트
      if (dontShowCheckbox) {
        dontShowCheckbox.addEventListener('change', (e) => {
          if (e.target.checked) {
            // 오늘은 그만보기 체크 시 로컬스토리지에 저장
            const today = new Date().toDateString();
            localStorage.setItem('notification-dont-show-today', today);
            console.log('오늘은 그만보기 설정됨:', today);
          } else {
            // 체크 해제 시 로컬스토리지에서 제거
            localStorage.removeItem('notification-dont-show-today');
            console.log('오늘은 그만보기 해제됨');
          }
        });
      }
    }

    // 알림 팝업 표시
    function showNotificationPopup() {
      // 오늘은 그만보기 체크 여부 확인
      const today = new Date().toDateString();
      const dontShowToday = localStorage.getItem('notification-dont-show-today');
      
      if (dontShowToday === today) {
        console.log('오늘은 그만보기 설정으로 인해 팝업을 표시하지 않습니다.');
        return;
      }

      const popup = document.getElementById('notification-popup');
      if (popup) {
        popup.classList.remove('hidden');
        popup.classList.add('show');
        
        // 애니메이션 효과
        const content = popup.querySelector('.notification-popup-content');
        if (content) {
          content.style.animation = 'fadeIn 0.28s ease-out';
        }
      }
    }

    // 테스트용: 오늘은 그만보기 해제 함수
    function resetDontShowToday() {
      localStorage.removeItem('notification-dont-show-today');
      console.log('오늘은 그만보기 설정이 해제되었습니다.');
      
      // 체크박스 상태도 업데이트
      const checkbox = document.getElementById('notification-dont-show-today');
      if (checkbox) {
        checkbox.checked = false;
      }
    }

    // 전역 함수로 노출 (테스트용)
    window.resetDontShowToday = resetDontShowToday;

    // 알림 팝업 닫기
    function closeNotificationPopup() {
      const popup = document.getElementById('notification-popup');
      if (popup) {
        popup.classList.add('hidden');
        popup.classList.remove('show');
        
        // 애니메이션 효과
        const content = popup.querySelector('.notification-popup-content');
        if (content) {
          content.style.animation = 'fadeOut 0.28s ease-out';
        }
      }
    }

    // 출력현황 바로가기 키 (Ctrl+O)
    document.addEventListener('keydown', (e) => {
      if (e.ctrlKey && e.key === 'o') {
        e.preventDefault();
        window.location.href = 'worklog.html';
      }
    });

    // Service Worker 등록
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js?v=' + (window.APP_VERSION || 'v-dev'))
        .then(reg => {
          console.log('Service Worker 등록 성공:', reg);
          reg.update && reg.update();
        })
        .catch(err => console.log('Service Worker 등록 실패:', err));
    }

    // 사진대지 뷰어 기능 (ps- 접두사)
    document.addEventListener('DOMContentLoaded', () => {
      const psViewer = document.getElementById('ps-photoSheetViewer');
      const psContainer = document.getElementById('ps-photoSheetContainer');
      const psResetBtn = document.getElementById('ps-resetBtn');
      const psSaveBtn = document.getElementById('ps-saveBtn');
      const psZoomOutBtn = document.getElementById('ps-zoomOutBtn');
      const psZoomInBtn = document.getElementById('ps-zoomInBtn');
      const psZoomPct = document.getElementById('ps-zoomPct');
      
      let psCurrentZoom = 100;
      
      // 사진대지 생성 버튼 이벤트
      const btnMakePhotoSheet = document.getElementById('btnPhotoSiteBefore');
      if (btnMakePhotoSheet) {
        btnMakePhotoSheet.addEventListener('click', () => {
          generatePhotoSheet();
        });
      }
      
      // 초기화 버튼 이벤트
      if (psResetBtn) {
        psResetBtn.addEventListener('click', () => {
          if (confirm('사진대지를 초기화하시겠습니까? 모든 데이터가 삭제됩니다.')) {
            // 데이터 초기화
            photoSheetData = {
              projectName: '',
              date: '',
              photos: [],
              isApproved: false
            };
            
            // 컨테이너 초기화
            psContainer.innerHTML = '';
            psContainer.classList.remove('ps-approved');
            
            // 버튼 상태 초기화
            psSaveBtn.textContent = '저장';
            psSaveBtn.disabled = false;
            
            // 로컬 스토리지에서 삭제
            localStorage.removeItem('photoSheetData');
            
            alert('사진대지가 초기화되었습니다.');
          }
        });
      }
      
      // 저장 버튼 이벤트
      if (psSaveBtn) {
        psSaveBtn.addEventListener('click', () => {
          // 자동 저장 실행
          autoSavePhotoSheet();
          psSaveBtn.textContent = '저장완료';
          psSaveBtn.disabled = true;
          
          setTimeout(() => {
            psSaveBtn.textContent = '저장';
            psSaveBtn.disabled = false;
          }, 2000);
          
          alert('사진대지가 저장되었습니다.');
        });
      }
      
      // 줌 아웃 버튼 이벤트 (10% 단위)
      if (psZoomOutBtn) {
        psZoomOutBtn.addEventListener('click', () => {
          psCurrentZoom = Math.max(psCurrentZoom - 10, 50);
          updatePsZoomLevel();
        });
      }
      
      // 줌 인 버튼 이벤트 (10% 단위)
      if (psZoomInBtn) {
        psZoomInBtn.addEventListener('click', () => {
          psCurrentZoom = Math.min(psCurrentZoom + 10, 200);
          updatePsZoomLevel();
        });
      }
      
      // 줌 레벨 업데이트 함수
      function updatePsZoomLevel() {
        if (psZoomPct) {
          psZoomPct.textContent = `${psCurrentZoom}%`;
        }
        const pages = document.querySelectorAll('.ps-page');
        pages.forEach(page => {
          page.style.transform = `scale(${psCurrentZoom / 100})`;
          page.style.transformOrigin = 'top left';
        });
      }
      
      // 사진대지 생성 함수
      function generatePhotoSheet() {
        // 홈의 현장선택 데이터 가져오기
        const selectedSite = state.site || '';
        
        // 작업내용기록에서 부재명 데이터 가져오기
        const partData = Array.isArray(state.part) && state.part.length > 0 ? state.part.join(', ') : '';
        
        // 작업공정 데이터 가져오기 + "보수" 추가
        const procData = Array.isArray(state.proc) && state.proc.length > 0 ? state.proc.join(', ') + ' 보수' : '보수';
        
        console.log('매핑된 데이터:', { 
          siteVal: selectedSite, 
          partVal: partData, 
          procVal: procData 
        });
        console.log('현재 state.photos:', state.photos);
        
        // 업로드된 이미지 수집
        const images = collectImages();
        
        console.log('수집된 이미지 개수:', images.length);
        
        if (images.length === 0) {
          alert('업로드된 이미지가 없습니다. 먼저 사진을 업로드해주세요.');
          return;
        }
        
        // 사진대지 데이터 초기화
        photoSheetData = {
          images: images,
          tableData: {
            part: {},
            proc: {},
            content: {}
          },
          isApproved: false,
          lastSaved: null,
          siteData: selectedSite,
          partData: partData,
          procData: procData
        };
        
        // 사진대지 생성
        createPhotoSheetPages(selectedSite, partData, procData, images);
        
        // 뷰어 표시
        psViewer.classList.remove('ps-hidden');
        
        // 초기 자동 저장
        autoSavePhotoSheet();
      }
      
      // 이미지 수집 함수
      function collectImages() {
        const images = [];
        
        // state.photos에서 직접 이미지 수집
        console.log('이미지 수집 시작:', state.photos);
        
        // 보수 전 이미지
        if (state.photos.pre && state.photos.pre.length > 0) {
          state.photos.pre.forEach(photo => {
            if (photo.url) {
              images.push({
                src: photo.url,
                type: 'pre',
                contentLabel: '보수전'
              });
            }
          });
        }
        
        // 보수 후 이미지
        if (state.photos.post && state.photos.post.length > 0) {
          state.photos.post.forEach(photo => {
            if (photo.url) {
              images.push({
                src: photo.url,
                type: 'post',
                contentLabel: '보수후'
              });
            }
          });
        }
        
        // 영수증 이미지
        if (state.photos.receipt && state.photos.receipt.length > 0) {
          state.photos.receipt.forEach(photo => {
            if (photo.url) {
              images.push({
                src: photo.url,
                type: 'receipt',
                contentLabel: '영수증'
              });
            }
          });
        }
        
        // 도면 이미지
        if (state.photos.drawing && state.photos.drawing.length > 0) {
          state.photos.drawing.forEach(photo => {
            if (photo.url) {
              images.push({
                src: photo.url,
                type: 'drawing',
                contentLabel: '도면'
              });
            }
          });
        }
        
        console.log('수집된 이미지:', images);
        return images;
      }
      
      // 사진대지 페이지 생성 함수
      function createPhotoSheetPages(siteVal, partVal, procVal, images) {
        // 기존 페이지 제거
        psContainer.innerHTML = '';
        
        // 4장씩 페이지 생성
        const imagesPerPage = 4;
        const totalPages = Math.ceil(images.length / imagesPerPage);
        
        for (let pageIndex = 0; pageIndex < totalPages; pageIndex++) {
          const pageImages = images.slice(pageIndex * imagesPerPage, (pageIndex + 1) * imagesPerPage);
          const page = createPage(siteVal, partVal, procVal, pageImages, pageIndex);
          psContainer.appendChild(page);
        }
      }
      
      // 페이지 생성 함수
      function createPage(siteVal, partVal, procVal, images, pageIndex) {
        const page = document.createElement('div');
        page.className = 'ps-page';
        
        // 공사명
        const constructionName = document.createElement('div');
        constructionName.className = 'ps-construction-name';
        constructionName.textContent = `공사명: ${siteVal}`;
        page.appendChild(constructionName);
        
        // 상단 사진 그리드
        const topPhotoGrid = createPhotoGrid(images.slice(0, 2), partVal, procVal, false);
        page.appendChild(topPhotoGrid);
        
        // 상단 정보 표
        const topInfoGrid = createInfoGrid(images.slice(0, 2), partVal, procVal, false);
        page.appendChild(topInfoGrid);
        
        // 하단 사진 그리드
        const bottomPhotoGrid = createPhotoGrid(images.slice(2, 4), partVal, procVal, true);
        page.appendChild(bottomPhotoGrid);
        
        // 하단 정보 표
        const bottomInfoGrid = createInfoGrid(images.slice(2, 4), partVal, procVal, true);
        page.appendChild(bottomInfoGrid);
        
        return page;
      }
      
      // 사진 그리드 생성 함수
      function createPhotoGrid(images, partVal, procVal, isBottom) {
        const grid = document.createElement('div');
        grid.className = 'ps-photo-grid';
        
        for (let i = 0; i < 2; i++) {
          const table = document.createElement('table');
          table.className = 'ps-photo-table';
          if (i > 0) table.classList.add('border-left-none');
          if (isBottom) table.classList.add('border-top-none');
          
          const tr = document.createElement('tr');
          const td = document.createElement('td');
          td.className = 'ps-photo-cell';
          if (i > 0) td.classList.add('border-left-none');
          if (isBottom) td.classList.add('border-top-none');
          
          const container = document.createElement('div');
          container.className = 'ps-photo-container';
          
          if (images[i]) {
            const img = document.createElement('img');
            img.className = 'ps-photo-img';
            img.src = images[i].src;
            img.alt = `사진 ${i + 1}`;
            img.dataset.imageIndex = i;
            img.dataset.imageType = images[i].type;
            img.dataset.imageSrc = images[i].src;
            
            // 이미지 클릭 이벤트 추가
            img.addEventListener('click', () => {
              replaceImage(img, i, images[i].type);
            });
            
            // 오버레이 추가
            const overlay = document.createElement('div');
            overlay.className = 'ps-photo-overlay';
            overlay.textContent = '클릭하여 교체';
            
            container.appendChild(img);
            container.appendChild(overlay);
          }
          
          td.appendChild(container);
          tr.appendChild(td);
          table.appendChild(tr);
          grid.appendChild(table);
        }
        
        return grid;
      }
      
      // 정보 표 그리드 생성 함수
      function createInfoGrid(images, partVal, procVal, isBottom) {
        const grid = document.createElement('div');
        grid.className = 'ps-info-grid';
        
        for (let i = 0; i < 2; i++) {
          const table = document.createElement('table');
          table.className = 'ps-info-table';
          if (i > 0) table.classList.add('border-left-none');
          if (isBottom) table.classList.add('border-top-none');
          
          // 부재명 행
          const tr1 = document.createElement('tr');
          const th1 = document.createElement('th');
          th1.className = 'ps-info-th';
          if (i > 0) th1.classList.add('border-left-none');
          if (isBottom) th1.classList.add('border-top-none');
          th1.textContent = '부재명';
          const td1 = document.createElement('td');
          td1.className = 'ps-info-td editable';
          if (i > 0) td1.classList.add('border-left-none');
          if (isBottom) td1.classList.add('border-top-none');
          td1.textContent = partVal;
          td1.dataset.field = 'part';
          td1.dataset.index = i;
          td1.addEventListener('click', () => editCell(td1));
          tr1.appendChild(th1);
          tr1.appendChild(td1);
          
          // 공정 행
          const tr2 = document.createElement('tr');
          const th2 = document.createElement('th');
          th2.className = 'ps-info-th';
          if (i > 0) th2.classList.add('border-left-none');
          th2.textContent = '공 정';
          const td2 = document.createElement('td');
          td2.className = 'ps-info-td editable';
          if (i > 0) td2.classList.add('border-left-none');
          td2.textContent = procVal;
          td2.dataset.field = 'proc';
          td2.dataset.index = i;
          td2.addEventListener('click', () => editCell(td2));
          tr2.appendChild(th2);
          tr2.appendChild(td2);
          
          // 내용 행
          const tr3 = document.createElement('tr');
          const th3 = document.createElement('th');
          th3.className = 'ps-info-th';
          if (i > 0) th3.classList.add('border-left-none');
          th3.textContent = '내 용';
          const td3 = document.createElement('td');
          td3.className = 'ps-info-td editable';
          if (i > 0) td3.classList.add('border-left-none');
          
          // 내용 결정 - 업로드 위치에 따른 자동 반영
          if (images[i] && images[i].contentLabel) {
            td3.textContent = images[i].contentLabel;
          } else {
            td3.textContent = '-';
          }
          td3.dataset.field = 'content';
          td3.dataset.index = i;
          td3.addEventListener('click', () => editCell(td3));
          
          tr3.appendChild(th3);
          tr3.appendChild(td3);
          
          table.appendChild(tr1);
          table.appendChild(tr2);
          table.appendChild(tr3);
          grid.appendChild(table);
        }
        
        return grid;
      }
      
      // 이미지 교체 함수
      function replaceImage(imgElement, imageIndex, imageType) {
        // 승인된 경우 편집 불가
        if (photoSheetData.isApproved) {
          alert('승인된 사진대지는 수정할 수 없습니다.');
          return;
        }
        
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        
        input.addEventListener('change', (e) => {
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
              // 이미지 교체
              imgElement.src = e.target.result;
              imgElement.dataset.imageSrc = e.target.result;
              
              // 사진대지 데이터 업데이트
              updatePhotoSheetImage(imageIndex, imageType, e.target.result);
              
              // 자동 저장
              autoSavePhotoSheet();
              
              console.log(`이미지 ${imageIndex + 1} 교체 완료`);
            };
            reader.readAsDataURL(file);
          }
        });
        
        input.click();
      }
      
      // 사진대지 이미지 데이터 업데이트
      function updatePhotoSheetImage(index, type, newSrc) {
        if (!photoSheetData.images) {
          photoSheetData.images = [];
        }
        
        // 해당 인덱스의 이미지 업데이트
        if (photoSheetData.images[index]) {
          photoSheetData.images[index].src = newSrc;
          photoSheetData.images[index].type = type;
        }
      }
      
      // 자동 저장 함수
      function autoSavePhotoSheet() {
        photoSheetData.lastSaved = new Date().toISOString();
        
        // 로컬 스토리지에 저장
        try {
          localStorage.setItem('photoSheetData', JSON.stringify(photoSheetData));
          console.log('사진대지 데이터 자동 저장 완료');
        } catch (error) {
          console.error('자동 저장 실패:', error);
        }
      }
      
      // 셀 편집 함수
      function editCell(tdElement) {
        // 승인된 경우 편집 불가
        if (photoSheetData.isApproved) {
          alert('승인된 사진대지는 수정할 수 없습니다.');
          return;
        }
        
        // 이미 편집 중인 경우 무시
        if (tdElement.classList.contains('editing')) return;
        
        const originalText = tdElement.textContent;
        const field = tdElement.dataset.field;
        const index = tdElement.dataset.index;
        
        // 편집 모드 활성화
        tdElement.classList.add('editing');
        
        // 입력 필드 생성
        const input = document.createElement('input');
        input.className = 'ps-info-input';
        input.value = originalText;
        input.type = 'text';
        
        // 기존 텍스트 제거하고 입력 필드 추가
        tdElement.textContent = '';
        tdElement.appendChild(input);
        input.focus();
        input.select();
        
        // 저장 함수
        const saveEdit = () => {
          const newValue = input.value.trim();
          tdElement.textContent = newValue || '-';
          tdElement.classList.remove('editing');
          
          // 사진대지 데이터 업데이트
          updateTableData(field, index, newValue);
          
          // 자동 저장
          autoSavePhotoSheet();
          
          console.log(`${field} 필드 ${index}번 셀 수정: ${newValue}`);
        };
        
        // 취소 함수
        const cancelEdit = () => {
          tdElement.textContent = originalText;
          tdElement.classList.remove('editing');
        };
        
        // 이벤트 리스너
        input.addEventListener('blur', saveEdit);
        input.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            e.preventDefault();
            saveEdit();
          } else if (e.key === 'Escape') {
            e.preventDefault();
            cancelEdit();
          }
        });
        
        // 클릭 이벤트 중복 방지
        tdElement.removeEventListener('click', () => editCell(tdElement));
      }
      
      // 테이블 데이터 업데이트 함수
      function updateTableData(field, index, value) {
        if (!photoSheetData.tableData) {
          photoSheetData.tableData = {};
        }
        
        if (!photoSheetData.tableData[field]) {
          photoSheetData.tableData[field] = {};
        }
        
        photoSheetData.tableData[field][index] = value;
      }
      
      // 관리자 승인 상태 확인 함수
      function checkAdminApproval() {
        // 실제 구현에서는 서버에서 승인 상태를 확인해야 함
        // 현재는 localStorage에서 승인 상태를 확인하는 예시
        const approvalStatus = localStorage.getItem('adminApproval') || 'false';
        return approvalStatus === 'true';
      }
      
      // PDF 다운로드 버튼 상태 업데이트 함수
      function updatePdfButtonState() {
        if (psPdfBtn) {
          const isApproved = checkAdminApproval();
          if (isApproved) {
            psPdfBtn.disabled = false;
            psPdfBtn.style.opacity = '1';
            psPdfBtn.style.cursor = 'pointer';
            psPdfBtn.title = '사진대지뷰어 PDF 다운로드 (승인됨)';
            psPdfBtn.className = 'chip ps-pdf-btn-approved';
          } else {
            psPdfBtn.disabled = true;
            psPdfBtn.style.opacity = '0.7';
            psPdfBtn.style.cursor = 'not-allowed';
            psPdfBtn.title = '관리자 승인 후 PDF 다운로드 가능';
            psPdfBtn.className = 'chip ps-pdf-btn-pending';
          }
        }
      }
      
      // 페이지 로드 시 PDF 버튼 상태 업데이트
      updatePdfButtonState();
      
      // 승인 상태 변경 감지 (실제 구현에서는 서버 이벤트나 폴링 사용)
      setInterval(updatePdfButtonState, 5000); // 5초마다 상태 확인
      
      // 테스트용 전역 함수 (개발자 콘솔에서 사용)
      window.setAdminApproval = function(approved) {
        localStorage.setItem('adminApproval', approved.toString());
        updatePdfButtonState();
        console.log(`관리자 승인 상태가 ${approved ? '승인됨' : '대기중'}으로 변경되었습니다.`);
        console.log(`사진대지뷰어 PDF 다운로드 ${approved ? '가능' : '불가능'}합니다.`);
      };
      
      // 테스트용 전역 함수 (개발자 콘솔에서 사용)
      window.getAdminApproval = function() {
        const status = checkAdminApproval();
        console.log(`현재 관리자 승인 상태: ${status ? '승인됨' : '대기중'}`);
        return status;
      };
      
      // PDF 다운로드 함수
      function downloadPhotoSheetAsPDF() {
        try {
          // html2pdf 라이브러리 사용 (CDN에서 로드 필요)
          if (typeof html2pdf === 'undefined') {
            // html2pdf 라이브러리 동적 로드
            const script = document.createElement('script');
            script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js';
            script.onload = () => {
              generatePDF();
            };
            document.head.appendChild(script);
          } else {
            generatePDF();
          }
        } catch (error) {
          console.error('PDF 생성 실패:', error);
          alert('PDF 생성 중 오류가 발생했습니다. 다시 시도해주세요.');
        }
      }
      
      function generatePDF() {
        const element = psContainer;
        const opt = {
          margin: 10,
          filename: `사진대지_${photoSheetData.siteData}_${new Date().toISOString().split('T')[0]}.pdf`,
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: { 
            scale: 2,
            useCORS: true,
            allowTaint: true
          },
          jsPDF: { 
            unit: 'mm', 
            format: 'a4', 
            orientation: 'portrait' 
          }
        };
        
        // PDF 생성
        html2pdf().set(opt).from(element).save().then(() => {
          console.log('PDF 다운로드 완료');
          alert('PDF 다운로드가 완료되었습니다.');
        }).catch((error) => {
          console.error('PDF 생성 오류:', error);
          alert('PDF 생성 중 오류가 발생했습니다.');
        });
      }
    });

    // 하단 네비 active 동기화
    function syncNav(){
      const key = (location.hash||'#home').slice(1);
      document.querySelectorAll('.nav-link').forEach(a=>{
        a.classList.toggle('active', a.dataset.route === key);
      });
    }
    window.addEventListener('hashchange', syncNav);
    syncNav();

    // ===== 작업일지 기능 =====
/* ===== 공통 상태 ===== */
const $ = (s, el=document)=>el.querySelector(s);
const $$ = (s, el=document)=>[...el.querySelectorAll(s)];
const state = {
  site:'', date:'', writer:'',
      part:[], proc:[], // 배열로 변경하여 누적 선택 가능
  area:[], // 배열로 변경하여 누적 선택 가능
  block:{ type:'', val:''},
      dong:'', section:'', ho:'',
  men:0,
  photos:{ pre:[], post:[], receipt:[], drawing:[] }
};

// 사진대지 데이터 저장소
let photoSheetData = {
  images: [],
  tableData: {},
  isApproved: false,
  lastSaved: null
};

/* ===== 초기값: 날짜 ===== */
(function initDate(){
  const d=new Date(), y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), dd=String(d.getDate()).padStart(2,'0');
  $('#workDate').value = `${y}-${m}-${dd}`;
  state.date = $('#workDate').value;
})();

/* ===== 현장 선택 ===== */
// site1 박스와 현장 선택 박스 너비 동기화
function syncSiteBoxWidths() {
  const site1Button = document.querySelector('[data-value="site1"]');
  const siteSelectLabel = document.querySelector('label.btn');
  
  if (site1Button && siteSelectLabel) {
    // site1 버튼의 실제 렌더링 너비 측정
    const site1Width = site1Button.offsetWidth;
    
    // 현장 선택 라벨에 동일한 너비 적용
    siteSelectLabel.style.width = site1Width + 'px';
    
    console.log('site1 width:', site1Width + 'px');
    console.log('Site Select width applied:', site1Width + 'px');
  }
}

// 페이지 로드 후 및 리사이즈 시 너비 동기화
window.addEventListener('load', syncSiteBoxWidths);
window.addEventListener('resize', syncSiteBoxWidths);

// DOM이 완전히 로드된 후 실행
document.addEventListener('DOMContentLoaded', () => {
  // 약간의 지연을 두고 실행 (CSS 렌더링 완료 후)
  setTimeout(syncSiteBoxWidths, 100);
});

$$('[data-role="site"]').forEach(b=>{
  b.onclick=()=>{
        // 단일 선택 방식으로 변경
    $$('[data-role="site"]').forEach(x=>x.dataset.active='false');
    b.dataset.active='true';
        state.site=b.dataset.value; 
        $('#siteSelect').value=''; 
        $('#siteOut').value=state.site; 
        renderSummary();
      }
    });
    
    /* 현장선택 드롭다운 이벤트 */
    $('#siteSelect').onchange=(e)=>{ 
      $$('[data-role="site"]').forEach(x=>x.dataset.active='false');
      state.site=e.target.value||''; 
      $('#siteOut').value=state.site; 
      
      // 선택값을 표시 박스에 반영
      const selectDisplay = document.getElementById('selectDisplay');
      if (selectDisplay) {
        selectDisplay.textContent = e.target.options[e.target.selectedIndex].text;
      }
      
      renderSummary();
};

/* ===== 일자/작성자 ===== */
// 작업일자 입력 필드가 존재하는 경우에만 이벤트 바인딩
const workDateInput = $('#workDate');
if (workDateInput) {
  // 페이지 로드 시 오늘 날짜로 자동 설정
  const today = new Date();
  const todayString = today.toISOString().split('T')[0]; // YYYY-MM-DD 형식
  workDateInput.value = todayString;
  state.date = todayString; // 데이터에 즉시 반영
  
  // 날짜 변경 시 데이터 반영
  workDateInput.onchange = (e) => { 
    state.date = e.target.value; 
    renderSummary(); 
  };
  
  // 초기 렌더링
  renderSummary();
}
// 작성자 입력 필드가 존재하는 경우에만 이벤트 바인딩
const writerInput = $('#writer');
if (writerInput) {
  writerInput.oninput=(e)=>{ state.writer=e.target.value.trim(); renderSummary() };
}

    /* ===== 작업 내용 기록 ===== */
    let workContents = []; // 작업 내용 배열

    function addWorkContent(content) {
      if (!workContents.includes(content)) {
        workContents.push(content);
      }
    }

    function removeWorkContent(content) {
      workContents = workContents.filter(item => item !== content);
    }

/* ===== 부재/공정 칩 + 커스텀 ===== */
function bindChip(role, customId){
  $$(`[data-role="${role}"]`).forEach(c=>{
        c.onclick=()=>{ 
          // 누적 선택 방식으로 변경
          if(c.dataset.active === 'true') {
            c.dataset.active='false';
            const index = state[role==='part'?'part':'proc'].indexOf(c.dataset.value);
            if(index > -1) {
              state[role==='part'?'part':'proc'].splice(index, 1);
              // 작업 내용에서도 제거
              removeWorkContent(c.dataset.value);
            }
          } else {
            c.dataset.active='true';
            state[role==='part'?'part':'proc'].push(c.dataset.value);
            // 작업 내용에 추가
            addWorkContent(c.dataset.value);
          }
          if(customId) $(customId).value=''; 
          renderSummary();
    };
  });
      if(customId) $(customId).oninput=(e)=>{ 
        $$(`[data-role="${role}"]`).forEach(x=>x.dataset.active='false');
        state[role==='part'?'part':'proc']=[e.target.value]; 
        addWorkContent(e.target.value);
        renderSummary();
  };
}
// bindChip('part','#partCustom'); bindChip('proc','#procCustom'); // 새로운 카드 시스템에서 처리

/* ===== 기타 직접입력 텍스트상자 확장 기능 ===== */
function initCustomInputExpansion() {
  // 모든 custom-input 요소에 확장 기능 추가
  document.querySelectorAll('.custom-input').forEach(input => {
    // 클릭 시 확장
    input.addEventListener('click', function() {
      // 다른 모든 텍스트상자 축소
      document.querySelectorAll('.custom-input').forEach(other => {
        if (other !== this) {
          other.classList.remove('expanded');
          other.style.width = '120px';
        }
      });
      
      // 현재 텍스트상자 확장
      this.classList.add('expanded');
      this.style.width = '200px';
      this.focus();
    });
    
    // 포커스 시 확장
    input.addEventListener('focus', function() {
      // 다른 모든 텍스트상자 축소
      document.querySelectorAll('.custom-input').forEach(other => {
        if (other !== this) {
          other.classList.remove('expanded');
          other.style.width = '120px';
        }
      });
      
      // 현재 텍스트상자 확장
      this.classList.add('expanded');
      this.style.width = '200px';
    });
    
    // 포커스 아웃 시 축소 (값이 없을 때만)
    input.addEventListener('blur', function() {
      setTimeout(() => {
        if (this.value.trim() === '') {
          this.classList.remove('expanded');
          this.style.width = '120px';
        }
      }, 150); // 약간의 지연을 두어 다른 요소로의 이동을 고려
    });
  });
}

// 페이지 로드 시 초기화
document.addEventListener('DOMContentLoaded', function() {
  initCustomInputExpansion();
  initChipClickEffects();
  initButtonClickEffects();
});

/* ===== 버튼 클릭 효과 초기화 ===== */
function initButtonClickEffects() {
  // 모든 버튼에 클릭 효과 추가
  document.querySelectorAll('.btn').forEach(button => {
    button.addEventListener('click', function(e) {
      // 클릭된 버튼에 애니메이션 클래스 추가
      this.classList.add('clicked');
      
      // 애니메이션 완료 후 클래스 제거
      setTimeout(() => {
        this.classList.remove('clicked');
      }, 600);
      
      // 리플 효과 생성
      createButtonRippleEffect(e, this);
    });
  });
}

/* ===== 버튼 리플 효과 생성 함수 ===== */
function createButtonRippleEffect(event, element) {
  const ripple = document.createElement('span');
  const rect = element.getBoundingClientRect();
  const size = Math.max(rect.width, rect.height);
  const x = event.clientX - rect.left - size / 2;
  const y = event.clientY - rect.top - size / 2;
  
  ripple.style.width = ripple.style.height = size + 'px';
  ripple.style.left = x + 'px';
  ripple.style.top = y + 'px';
  ripple.classList.add('ripple-ink');
  
  element.appendChild(ripple);
  
  // 애니메이션 완료 후 리플 요소 제거
  setTimeout(() => {
    ripple.remove();
  }, 450);
}

/* ===== 칩 버튼 클릭 효과 초기화 ===== */
function initChipClickEffects() {
  // 모든 칩 버튼과 업로드 칩 버튼에 클릭 효과 추가
  document.querySelectorAll('.chip, .upload-chip').forEach(chip => {
    chip.addEventListener('click', function(e) {
      // 클릭된 칩에 애니메이션 클래스 추가
      this.classList.add('clicked');
      
      // 애니메이션 완료 후 클래스 제거
      setTimeout(() => {
        this.classList.remove('clicked');
      }, 600);
      
      // 리플 효과 생성
      createRippleEffect(e, this);
    });
  });
}

/* ===== 리플 효과 생성 함수 ===== */
function createRippleEffect(event, element) {
  const ripple = document.createElement('span');
  const rect = element.getBoundingClientRect();
  const size = Math.max(rect.width, rect.height);
  const x = event.clientX - rect.left - size / 2;
  const y = event.clientY - rect.top - size / 2;
  
  ripple.style.width = ripple.style.height = size + 'px';
  ripple.style.left = x + 'px';
  ripple.style.top = y + 'px';
  ripple.classList.add('ripple-ink');
  
  element.appendChild(ripple);
  
  // 애니메이션 완료 후 리플 요소 제거
  setTimeout(() => {
    ripple.remove();
  }, 450);
}

    /* ===== 사용자 정의 입력 ===== */
    function showCustomInput(type) {
      const promptText = type === 'part' ? '부재명을 입력하세요:' : '작업공정을 입력하세요:';
      const customValue = prompt(promptText);
      
      if (customValue && customValue.trim()) {
        const trimmedValue = customValue.trim();
        addWorkContent(trimmedValue);
        
        // 해당 타입의 커스텀 입력 필드에 값 설정
        if (type === 'part') {
          $('#partCustom').value = trimmedValue;
          $$('[data-role="part"]').forEach(x => x.dataset.active = 'false');
          state.part = [trimmedValue];
        } else if (type === 'proc') {
          $('#procCustom').value = trimmedValue;
          $$('[data-role="proc"]').forEach(x => x.dataset.active = 'false');
          state.proc = [trimmedValue];
        }
        
        renderSummary();
      }
    }

/* ===== 작업구간 표준화 입력 (누적 선택) - 새로운 카드 시스템에서 처리 ===== */
/*
$$('[data-role="area"]').forEach(ch=>{
  ch.onclick=()=>{ 
    // 누적 선택 방식으로 변경
    if(ch.dataset.active === 'true') {
      ch.dataset.active='false';
      // 배열에서 해당 항목 제거
      state.area = state.area.filter(item => item.label !== ch.dataset.value);
    } else {
      ch.dataset.active='true';
      // 배열에 새 항목 추가
      const newArea = { label:ch.dataset.value, code:ch.dataset.code };
      if (!state.area.some(item => item.label === ch.dataset.value)) {
        state.area.push(newArea);
      }
    }
    buildZone();
  };
});
*/
// 블럭/동/호수 입력 필드 안전 처리 - 새로운 카드 시스템에서 처리
/*
const blockValInput = $('#blockVal');
if (blockValInput) {
  blockValInput.oninput = ()=>{
    blockValInput.value = blockValInput.value.toUpperCase();
    state.block.val = blockValInput.value.trim(); 
    buildZone(); 
  };
}

const dongValInput = $('#dongVal');
if (dongValInput) {
  dongValInput.oninput = (e)=>{ state.dong = e.target.value.trim(); buildZone(); };
}

const hoValInput = $('#hoVal');
if (hoValInput) {
  hoValInput.oninput = (e)=>{ state.ho = e.target.value.trim(); buildZone(); };
}

const secValInput = $('#secVal');
if (secValInput) {
  secValInput.oninput = (e)=>{ state.section = e.target.value.trim(); buildZone(); };
}
*/
    // 공수(일) 컨트롤 초기화 (참고 코드 기반)
    function initQtyControl(qtySplit) {
      if (!qtySplit || qtySplit.dataset.initialized === 'true') return;

      // 허용값 파싱
      const parseValues = (el) => {
        const raw = (el.dataset.values || "0,0.5,1,1.5,2,2.5,3")
          .split(",").map(v => parseFloat(v.trim()))
          .filter(v => !Number.isNaN(v));
        const sorted = [...new Set(raw)].sort((a,b)=>a-b);
        return sorted.length ? sorted : [0];
      };

      const fmt = (n) => {
        const s = (Math.round(n*10)/10).toFixed(1);
        return s.endsWith(".0") ? s.slice(0,-2) : s; // 1.0 → 1
      };

      const minus = qtySplit.querySelector('[data-minus]');
      const plus  = qtySplit.querySelector('[data-plus]');
      const mid   = qtySplit.querySelector('.qcenter');
      if (!minus || !plus || !mid) return;

      const values = parseValues(qtySplit);

      const nearestIndex = (val) => {
        let idx = 0, best = Infinity;
        values.forEach((v,i) => {
          const d = Math.abs(v - val);
          if (d < best) { 
            best = d; 
            idx = i; 
          }
        });
        return idx;
      };

      // 중앙값 파싱 - 더 안전한 방식 (기본값 1로 설정)
      const currentText = mid.textContent || '1';
      const cur = parseFloat(currentText.replace(',', '.').trim()) || 1;
      let idx = nearestIndex(cur);

      const render = () => {
        mid.textContent = fmt(values[idx]);
        state.men = values[idx];
        minus.disabled = idx === 0;
        plus.disabled  = idx === values.length - 1;
        // renderSummary 함수가 정의되어 있을 때만 호출
        if (typeof renderSummary === 'function') {
          renderSummary();
        }
      };

      const handleMinusClick = () => { if (idx > 0) { idx--; render(); } };
      const handlePlusClick  = () => { if (idx < values.length - 1) { idx++; render(); } };
      const handleKeydown = (e) => {
        if (e.key === 'ArrowLeft' || e.key === '-') { e.preventDefault(); if (idx > 0) { idx--; render(); } }
        if (e.key === 'ArrowRight'|| e.key === '+') { e.preventDefault(); if (idx < values.length - 1) { idx++; render(); } }
      };

      minus.addEventListener('click', handleMinusClick);
      plus .addEventListener('click', handlePlusClick);
      qtySplit.addEventListener('keydown', handleKeydown);

      qtySplit.tabIndex = 0; // 키보드 포커스 가능
      
      // 초기 렌더링 강제 실행
      render();
      
      // 초기화 완료 표시
      qtySplit.dataset.initialized = 'true';
    }

    // 공수 컨트롤 초기화 및 이벤트 바인딩 (통합)
    function initManpowerControls() {
      document.querySelectorAll('.qty-split3').forEach(box => {
        initQtyControl(box);
      });
    }
    
    // 페이지 로드 시 초기화 (renderSummary 함수 정의 후 실행)
    // initManpowerControls(); // 아래에서 renderSummary 함수 정의 후 호출

/* 표준명/코드 생성 */
function buildZone(){
  // 층 표기 규칙 - 여러 작업유형 처리
  const areas = state.area.map(item => item.label).join(', ');
  const areaCodes = state.area.map(item => item.code).join('-');

  const block = state.block.val ? `${state.block.val.toUpperCase()}블럭` : '';
  const dong  = state.dong ? `${state.dong}동` : '';
  const ho    = state.ho ? `${state.ho}호` : '';
  const sect  = state.section ? `${state.section.toUpperCase()}구역` : '';
  const parts = [areas || '', block, dong, ho, sect].filter(Boolean);
  const pretty = parts.join(' · ') || '-';
  $('#zonePreview').textContent = pretty;

  // 코드: AREA-BLK-DONG-HO-SEC (빈값 생략)
  const blkCode = state.block.val ? `B${state.block.val.toUpperCase()}` : '';
  const dongCode= state.dong ? `D${state.dong}` : '';
  const hoCode  = state.ho ? `H${state.ho}` : '';
  const secCode = state.section ? state.section.toUpperCase() : '';
  const code = [areaCodes, blkCode, dongCode, hoCode, secCode].filter(Boolean).join('-') || '-';
  $('#zoneCode').textContent = code;

  renderSummary();
}
// 복사 버튼 안전 처리
const copyZoneBtn = $('#copyZone');
if (copyZoneBtn) {
  copyZoneBtn.onclick=()=>{
  const t = `표준명: ${$('#zonePreview').textContent}\n코드: ${$('#zoneCode').textContent}`;
  navigator.clipboard.writeText(t); alert('작업구간 표준명이 복사되었습니다.');
};
}

/* ===== 사진 업로드 ===== */
    // ===== 사진 업로드 =====
    // 상태
    const zonePre  = document.getElementById('zonePre');
    const zonePost = document.getElementById('zonePost');
    const zoneReceipt = document.getElementById('zoneReceipt');
    const zoneDrawing = document.getElementById('zoneDrawing');
    const cntPre   = document.getElementById('cntPre');
    const cntPost  = document.getElementById('cntPost');
    const cntReceipt = document.getElementById('cntReceipt');
    const cntDrawing = document.getElementById('cntDrawing');

    // 업로드 박스 생성 함수
    function createUploadBox(inputId, ariaLabel) {
      return `
        <div class="upload-box" onclick="document.getElementById('${inputId}').click()" 
             role="button" tabindex="0" aria-label="${ariaLabel}"
             onkeydown="if(event.key==='Enter'||event.key===' ')document.getElementById('${inputId}').click()">
          <svg class="upload-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="currentColor" stroke-width="2"/>
            <circle cx="8.5" cy="8.5" r="1.5" stroke="currentColor" stroke-width="2"/>
            <path d="M21 15L16 10L5 21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
      `;
    }

    // 카테고리 매핑 상수
    const CATEGORY_MAP = {
      'receipt': '영수증',
      'drawing': '도면',
      'pre': '보수 전',
      'post': '보수 후',
      'bulk': '일괄'
    };

    // 입력 요소 매핑 상수
    const INPUT_MAP = {
      'pre': 'inBefore',
      'post': 'inAfter',
      'bulk': 'inBulk'
    };


    // 활성 모드 설정 함수 (칩 스타일)
    function setActiveMode(mode) {
      // 모든 버튼에서 data-active 속성 제거
      document.querySelectorAll('.upload-chip').forEach(btn => {
        btn.removeAttribute('data-active');
      });
      // 선택된 버튼에 data-active 속성 추가
      document.querySelector(`[data-mode="${mode}"]`).setAttribute('data-active', 'true');
    }

    // 칩 그룹 클릭 이벤트 (바로 업로드)
    const uploadChipGroup = document.querySelector('.upload-chip-group');
    if (uploadChipGroup) {
      uploadChipGroup.addEventListener('click', (e) => {
        const chip = e.target.closest('.upload-chip');
        if (!chip) return;
        
        const mode = chip.getAttribute('data-mode');
        setActiveMode(mode);
        
        // 영수증과 도면은 직접 업로드 (팝업 없이)
        if (mode === 'receipt' || mode === 'drawing') {
          openDirectUpload(mode);
          return;
        }
        
        // 보수 전/후/일괄은 바로 파일 선택
        const inputId = INPUT_MAP[mode];
        if (inputId) {
          document.getElementById(inputId).click();
        }
      });
    }

    // 썸네일 영역 클릭 이벤트 (업로드 기능 실행)
    function addZoneClickEvents() {
      const zoneConfigs = [
        { zone: zonePre, mode: 'pre', action: () => document.getElementById('inBefore').click() },
        { zone: zonePost, mode: 'post', action: () => document.getElementById('inAfter').click() },
        { zone: zoneReceipt, mode: 'receipt', action: () => openDirectUpload('receipt') },
        { zone: zoneDrawing, mode: 'drawing', action: () => openDirectUpload('drawing') }
      ];

      zoneConfigs.forEach(config => {
        config.zone.addEventListener('click', (e) => {
          if (!e.target.closest('.thumb') && !e.target.closest('button')) {
            setActiveMode(config.mode);
            config.action();
          }
        });
      });
    }

    // 썸네일 영역 클릭 이벤트 등록
    addZoneClickEvents();


    // 모드별 제목 반환
    function getModeTitle(mode) {
      return CATEGORY_MAP[mode] || mode;
    }

    // 갤러리 선택기 표시

    // 파일 입력 핸들러 통합
    function setupFileInputHandlers() {
      const inputConfigs = [
        { id: 'inBefore', type: 'pre' },
        { id: 'inAfter', type: 'post' },
        { id: 'inReceipt', type: 'receipt' },
        { id: 'inDrawing', type: 'drawing' },
        { id: 'inBulk', type: 'bulk', isBulk: true }
      ];

      inputConfigs.forEach(config => {
        const input = document.getElementById(config.id);
        if (input) {
          input.addEventListener('change', (e) => {
            if (e.target.files && e.target.files.length > 0) {
              if (config.isBulk) {
                autoSplit([...e.target.files]);
              } else {
                addFiles([...e.target.files], config.type);
              }
              e.target.value = '';
              refreshCounts();
            }
          });
        }
      });
    }

    // 파일 입력 핸들러 설정
    setupFileInputHandlers();

    // 썸네일 요소 생성 - FileReader를 사용한 안전한 미리보기
    let phId=0;
    function thumbEl(obj, type){
      const el = document.createElement('div');
      el.className = 'thumb';
      el.dataset.id = obj.id;
      el.dataset.type = type;
      
      const isImage = obj.type && obj.type.startsWith('image/');
      const isDoc = type === 'receipt' || type === 'drawing';
      
      // 이미지 미리보기 생성
      if (isImage) {
        const img = document.createElement('img');
        img.alt = obj.name;
        img.style.width = '100%';
        img.style.height = '100%';
        img.style.objectFit = 'cover';
        
        // FileReader를 사용하여 안전한 이미지 로딩
        if (obj.file) {
          const reader = new FileReader();
          reader.onload = function(e) {
            img.src = e.target.result;
          };
          reader.onerror = function() {
            // 이미지 로딩 실패 시 대체 아이콘 표시
            img.style.display = 'none';
            el.innerHTML = `<div style="font-size:28px; display:flex; align-items:center; justify-content:center; height:100%; color:#999;">🖼️</div>`;
          };
          reader.readAsDataURL(obj.file);
        } else if (obj.url) {
          // 기존 URL 방식도 지원
          img.src = obj.url;
        }
        
        el.appendChild(img);
      } else {
        // 문서 파일의 경우 아이콘 표시
        el.innerHTML = `<div style="font-size:28px; display:flex; align-items:center; justify-content:center; height:100%;">📄</div><div style="position:absolute; left:6px; bottom:6px; background:rgba(0,0,0,.55); color:#fff; font-size:11px; padding:2px 6px; border-radius:6px;">${obj.name.split('.').pop().toUpperCase()}</div>`;
      }
      
      // 영수증/도면은 전환 버튼 없이 삭제만, 이미지는 전/후 전환
      if (isDoc) {
        el.innerHTML += `
          <button class="del" title="삭제" type="button">x</button>
        `;
      } else {
        el.innerHTML += `
          <button class="swap" title="전/후 전환" type="button">↔</button>
          <button class="del" title="삭제" type="button">x</button>
        `;
      }

      // 전환 기능 (이미지만)
      if (!isDoc && el.querySelector('.swap')) {
        el.querySelector('.swap').addEventListener('click', ()=>{
          // 이미지: 전/후 전환
          if(el.dataset.type === 'pre'){
            zonePost.appendChild(el);
            el.dataset.type = 'post';
            state.photos.pre = state.photos.pre.filter(p=>p.id!==obj.id);
            state.photos.post.push(obj);
          } else if(el.dataset.type === 'post'){
            zonePre.appendChild(el);
            el.dataset.type = 'pre';
            state.photos.post = state.photos.post.filter(p=>p.id!==obj.id);
            state.photos.pre.push(obj);
          }
          refreshCounts();
        });
      }

      // 삭제 기능
      el.querySelector('.del').addEventListener('click', ()=>{
        el.remove();
        if(el.dataset.type === 'pre'){
          state.photos.pre = state.photos.pre.filter(p=>p.id!==obj.id);
        } else if(el.dataset.type === 'post'){
          state.photos.post = state.photos.post.filter(p=>p.id!==obj.id);
        } else if(el.dataset.type === 'receipt'){
          state.photos.receipt = state.photos.receipt.filter(p=>p.id!==obj.id);
        } else if(el.dataset.type === 'drawing'){
          state.photos.drawing = state.photos.drawing.filter(p=>p.id!==obj.id);
        }
        URL.revokeObjectURL(obj.url);
        refreshCounts();
      });

      // 드래그 앤 드롭 기능 개선
      el.draggable = true;
      el.addEventListener('dragstart', (e) => {
        e.dataTransfer.setData('text/plain', el.dataset.id);
        el.classList.add('dragging');
      });

      el.addEventListener('dragend', (e) => {
        el.classList.remove('dragging');
      });

      return el;
    }

    // 추가 업로드 (최대 30장 제한)
    function addFiles(files, to){
      const currentCount = getCurrentCount(to);
      const maxFiles = 30;
      const remainingSlots = maxFiles - currentCount;
      
      if (remainingSlots <= 0) {
        alert(`${getCategoryName(to)}은(는) 최대 30장까지 업로드 가능합니다.`);
        return;
      }
      
      const filesToAdd = files.slice(0, remainingSlots);
      
      if (files.length > remainingSlots) {
        alert(`${getCategoryName(to)}에 ${remainingSlots}장만 추가됩니다. (최대 30장 제한)`);
      }
      
      filesToAdd.forEach(f=>{
        const obj = { 
          id:`ph_${++phId}`, 
          name:f.name, 
          url:URL.createObjectURL(f), 
          type:f.type,
          file:f  // FileReader를 위한 원본 파일 객체 추가
        };
        if(to==='pre'){
          state.photos.pre.push(obj);
          zonePre.appendChild(thumbEl(obj,'pre'));
        }else if(to==='post'){
          state.photos.post.push(obj);
          zonePost.appendChild(thumbEl(obj,'post'));
        }else if(to==='receipt'){
          state.photos.receipt.push(obj);
          zoneReceipt.appendChild(thumbEl(obj,'receipt'));
        }else if(to==='drawing'){
          state.photos.drawing.push(obj);
          zoneDrawing.appendChild(thumbEl(obj,'drawing'));
        }
      });
      
      // 카운트 업데이트 실행
      refreshCounts();
    }
    
    // 현재 카테고리의 파일 개수 반환
    function getCurrentCount(category) {
      switch(category) {
        case 'pre': return state.photos.pre.length;
        case 'post': return state.photos.post.length;
        case 'receipt': return state.photos.receipt.length;
        case 'drawing': return state.photos.drawing.length;
        default: return 0;
      }
    }
    
    // 카테고리 이름 반환
    function getCategoryName(category) {
      return CATEGORY_MAP[category] || '파일';
    }

    // 일괄 업로드 자동분류
    function autoSplit(files){
      const pre=[], post=[], receipt=[], drawing=[];
      const isPre  = n => /(전|before|pre)/i.test(n);
      const isPost = n => /(후|after|post)/i.test(n);
      const isReceipt = n => /(영수|receipt|invoice|tax)/i.test(n);
      const isDrawing = n => /(도면|drawing|plan|cad|dwg|blueprint)/i.test(n);
      
      files.forEach(f=>{
        if(isReceipt(f.name)) receipt.push(f);
        else if(isDrawing(f.name)) drawing.push(f);
        else if(isPre(f.name)) pre.push(f);
        else if(isPost(f.name)) post.push(f);
      });
      
      const rest = files.filter(f=>!pre.includes(f) && !post.includes(f) && !receipt.includes(f) && !drawing.includes(f));
      const half = Math.ceil(rest.length/2);
      pre.push(...rest.slice(0, half));
      post.push(...rest.slice(half));
      
      // 각 카테고리별로 최대 30장 제한 적용
      const categories = [
        { files: pre, type: 'pre', name: '보수 전' },
        { files: post, type: 'post', name: '보수 후' },
        { files: receipt, type: 'receipt', name: '영수증' },
        { files: drawing, type: 'drawing', name: '도면' }
      ];
      
      categories.forEach(category => {
        const currentCount = getCurrentCount(category.type);
        const maxFiles = 30;
        const remainingSlots = maxFiles - currentCount;
        
        if (remainingSlots > 0) {
          const filesToAdd = category.files.slice(0, remainingSlots);
          
          if (category.files.length > remainingSlots) {
            alert(`${category.name}에 ${remainingSlots}장만 추가됩니다. (최대 30장 제한)`);
          }
          
          addFiles(filesToAdd, category.type);
        } else {
          alert(`${category.name}은(는) 최대 30장까지 업로드 가능합니다.`);
        }
      });
    }

    // 리스트 안에서의 드롭 정렬
    [zonePre, zonePost, zoneReceipt, zoneDrawing].forEach(zone=>{
      zone.addEventListener('dragover', e=>{ e.preventDefault(); });
      zone.addEventListener('drop', e=>{
        e.preventDefault();
        const id = e.dataTransfer.getData('text/plain');
        const el = [...zone.querySelectorAll('.thumb')].find(t=>t.dataset.id===id);
        if(!el){
          const fromOther = document.querySelector(`.thumb[data-id="${id}"]`);
          if(fromOther){
            const obj = findPhoto(id);
            if(zone===zonePre && fromOther.dataset.type!=='pre'){
              movePhoto(obj, fromOther.dataset.type, 'pre');
              fromOther.dataset.type='pre';
            }else if(zone===zonePost && fromOther.dataset.type!=='post'){
              movePhoto(obj, fromOther.dataset.type, 'post');
              fromOther.dataset.type='post';
            }else if(zone===zoneReceipt && fromOther.dataset.type!=='receipt'){
              movePhoto(obj, fromOther.dataset.type, 'receipt');
              fromOther.dataset.type='receipt';
            }else if(zone===zoneDrawing && fromOther.dataset.type!=='drawing'){
              movePhoto(obj, fromOther.dataset.type, 'drawing');
              fromOther.dataset.type='drawing';
            }
            zone.appendChild(fromOther);
            refreshCounts();
          }
        }
      });
    });

    function movePhoto(obj, fromType, toType){
      // 이전 위치에서 제거
      if(fromType === 'pre') state.photos.pre = state.photos.pre.filter(p=>p.id!==obj.id);
      else if(fromType === 'post') state.photos.post = state.photos.post.filter(p=>p.id!==obj.id);
      else if(fromType === 'receipt') state.photos.receipt = state.photos.receipt.filter(p=>p.id!==obj.id);
      else if(fromType === 'drawing') state.photos.drawing = state.photos.drawing.filter(p=>p.id!==obj.id);
      
      // 새 위치에 추가
      if(toType === 'pre') state.photos.pre.push(obj);
      else if(toType === 'post') state.photos.post.push(obj);
      else if(toType === 'receipt') state.photos.receipt.push(obj);
      else if(toType === 'drawing') state.photos.drawing.push(obj);
    }

    function findPhoto(id){
      return state.photos.pre.find(p=>p.id===id) || 
             state.photos.post.find(p=>p.id===id) ||
             state.photos.receipt.find(p=>p.id===id) ||
             state.photos.drawing.find(p=>p.id===id);
    }

    function refreshCounts(){
      // 카운트 요소들을 다시 찾아서 업데이트 (동적으로 생성된 경우 대비)
      const cntPreEl = document.getElementById('cntPre');
      const cntPostEl = document.getElementById('cntPost');
      const cntReceiptEl = document.getElementById('cntReceipt');
      const cntDrawingEl = document.getElementById('cntDrawing');
      
      // 디버깅을 위한 콘솔 로그
      console.log('카운트 업데이트:', {
        pre: state.photos.pre.length,
        post: state.photos.post.length,
        receipt: state.photos.receipt.length,
        drawing: state.photos.drawing.length
      });
      
      // 각 카운트 요소 업데이트
      if (cntPreEl) {
        cntPreEl.textContent = String(state.photos.pre.length);
        console.log('cntPre 업데이트:', cntPreEl.textContent);
      } else {
        console.warn('cntPre 요소를 찾을 수 없습니다');
      }
      
      if (cntPostEl) {
        cntPostEl.textContent = String(state.photos.post.length);
        console.log('cntPost 업데이트:', cntPostEl.textContent);
      } else {
        console.warn('cntPost 요소를 찾을 수 없습니다');
      }
      
      if (cntReceiptEl) {
        cntReceiptEl.textContent = String(state.photos.receipt.length);
        console.log('cntReceipt 업데이트:', cntReceiptEl.textContent);
      } else {
        console.warn('cntReceipt 요소를 찾을 수 없습니다');
      }
      
      if (cntDrawingEl) {
        cntDrawingEl.textContent = String(state.photos.drawing.length);
        console.log('cntDrawing 업데이트:', cntDrawingEl.textContent);
      } else {
        console.warn('cntDrawing 요소를 찾을 수 없습니다');
      }
      
      // aria-live 속성으로 스크린 리더에도 알림
      [cntPreEl, cntPostEl, cntReceiptEl, cntDrawingEl].forEach(el => {
        if (el) {
          el.setAttribute('aria-live', 'polite');
        }
      });
    }

/* ===== 저장 완료 모달 ===== */
function showSaveSuccessModal() {
  // 기존 모달이 있다면 제거
  const existingModal = document.getElementById('saveSuccessModal');
  if (existingModal) {
    existingModal.remove();
  }

  // 모달 HTML 생성
  const modalHTML = `
    <div id="saveSuccessModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50" style="animation: fadeIn 0.3s ease-out;">
      <div class="bg-white dark:bg-gray-800 rounded-lg p-6 max-w-sm mx-4 shadow-xl" style="animation: slideIn 0.3s ease-out;">
        <div class="text-center">
          <div class="mb-4">
            <div class="w-16 h-16 mx-auto mb-3 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center">
              <svg class="w-8 h-8 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
            </div>
          </div>
          <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-2">저장 완료</h3>
          <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">데이터가 성공적으로 저장되었습니다.</p>
          <button onclick="closeSaveSuccessModal()" class="w-full text-white rounded-lg font-medium transition-colors" style="background-color: #1A254F; min-height: 44px; padding: 0 16px;" onmouseover="this.style.backgroundColor='#0f1a3a'" onmouseout="this.style.backgroundColor='#1A254F'">
            확인
          </button>
        </div>
      </div>
    </div>
  `;

  // 모달을 body에 추가
  document.body.insertAdjacentHTML('beforeend', modalHTML);

  // ESC 키로 모달 닫기
  const handleEscKey = (e) => {
    if (e.key === 'Escape') {
      closeSaveSuccessModal();
      document.removeEventListener('keydown', handleEscKey);
    }
  };
  document.addEventListener('keydown', handleEscKey);

  // 3초 후 자동으로 닫기
  setTimeout(() => {
    closeSaveSuccessModal();
    document.removeEventListener('keydown', handleEscKey);
  }, 3000);
}

function closeSaveSuccessModal() {
  const modal = document.getElementById('saveSuccessModal');
  if (modal) {
    modal.style.animation = 'fadeOut 0.3s ease-out';
    setTimeout(() => {
      modal.remove();
    }, 300);
  }
}

/* ===== 요약 ===== */
function renderSummary(){
  const pretty = $('#zonePreview') ? $('#zonePreview').textContent : '-';
  const zoneCode = $('#zoneCode') ? $('#zoneCode').textContent : '-';
  const preCount = state.photos.pre.length;
  const postCount = state.photos.post.length;
  const receiptCount = state.photos.receipt.length;
  const drawingCount = state.photos.drawing.length;
  
  $('#summary').innerHTML = `
    <div class="space-y-3">
      <!-- 첫 번째 행: 현장, 작업일자 -->
      <div class="flex justify-between">
        <div class="flex flex-col flex-1 mr-4">
          <div class="text-xs text-gray-500 mb-1">현장</div>
          <div class="text-sm font-medium">${state.site || '미선택'}</div>
        </div>
        <div class="flex flex-col flex-1">
          <div class="text-xs text-gray-500 mb-1">작업일자</div>
          <div class="text-sm font-medium">${state.date || '-'}</div>
        </div>
      </div>
      
      <!-- 두 번째 행: 작성자, 부재명 -->
      <div class="flex justify-between">
        <div class="flex flex-col flex-1 mr-4">
          <div class="text-xs text-gray-500 mb-1">작성자</div>
          <div class="text-sm font-medium">${state.writer || '-'}</div>
        </div>
        <div class="flex flex-col flex-1">
          <div class="text-xs text-gray-500 mb-1">부재명</div>
          <div class="text-sm font-medium">${Array.isArray(state.part) && state.part.length > 0 ? state.part.join(', ') : '-'}</div>
        </div>
      </div>
      
      <!-- 세 번째 행: 작업공정, 작업유형 -->
      <div class="flex justify-between">
        <div class="flex flex-col flex-1 mr-4">
          <div class="text-xs text-gray-500 mb-1">작업공정</div>
          <div class="text-sm font-medium">${Array.isArray(state.proc) && state.proc.length > 0 ? state.proc.join(', ') : '-'}</div>
        </div>
        <div class="flex flex-col flex-1">
          <div class="text-xs text-gray-500 mb-1">작업유형</div>
          <div class="text-sm font-medium">${Array.isArray(state.area) && state.area.length > 0 ? state.area.map(item => item.label || item.value).join(', ') : '-'}</div>
        </div>
      </div>
      
      <!-- 네 번째 행: 블럭/동/호수, 공수 -->
      <div class="flex justify-between">
        <div class="flex flex-col flex-1 mr-4">
          <div class="text-xs text-gray-500 mb-1">블럭 / 동 / 호수</div>
          <div class="text-sm font-medium">${state.block && state.block.val ? state.block.val : '-'} / ${state.dong || '-'} / ${state.ho || '-'}</div>
        </div>
        <div class="flex flex-col flex-1">
          <div class="text-xs text-gray-500 mb-1">공수</div>
          <div class="text-sm font-medium">${state.men || 1}일</div>
        </div>
      </div>
      
      <!-- 다섯 번째 행: 사진·문서 -->
      <div class="flex justify-between">
        <div class="flex flex-col flex-1 mr-4">
          <div class="text-xs text-gray-500 mb-1">사진·문서</div>
          <div class="text-sm font-medium">보수 전 ${preCount}장 / 보수 후 ${postCount}장</div>
        </div>
        <div class="flex flex-col flex-1">
          <div class="text-xs text-gray-500 mb-1">문서 내용</div>
          <div class="text-sm font-medium">영수증 ${receiptCount}장 / 도면 ${drawingCount}장</div>
        </div>
      </div>
    </div>
  `;
}

/* ===== 초기화 기능 ===== */
// 처음부터 버튼 안전 처리
const resetBtn = $('#reset');
if (resetBtn) {
  resetBtn.onclick = () => {
    // 모든 상태 초기화
    state.site = '';
    state.date = '';
    state.writer = '';
    state.part = [];
    state.proc = [];
    state.area = [];
    state.men = 1;
    
    // 사진 상태 초기화
    state.photos.pre = [];
    state.photos.post = [];
    state.photos.receipt = [];
    state.photos.drawing = [];
    
    // 썸네일 영역 초기화
    $('#zonePre').innerHTML = '';
    $('#zonePost').innerHTML = '';
    $('#zoneReceipt').innerHTML = '';
    $('#zoneDrawing').innerHTML = '';
    
    // 드롭 이벤트 추가
    function addDropEvents() {
      const zones = ['zonePre', 'zonePost', 'zoneReceipt', 'zoneDrawing'];
      zones.forEach(zoneId => {
        const zone = document.getElementById(zoneId);
        if (zone) {
          zone.addEventListener('dragover', (e) => {
            e.preventDefault();
            zone.style.backgroundColor = '#f0f9ff';
          });
          
          zone.addEventListener('dragleave', (e) => {
            zone.style.backgroundColor = '';
          });
          
          zone.addEventListener('drop', (e) => {
            e.preventDefault();
            zone.style.backgroundColor = '';
            
            const draggedId = e.dataTransfer.getData('text/plain');
            const draggedEl = document.querySelector(`[data-id="${draggedId}"]`);
            
            if (draggedEl && draggedEl !== e.target) {
              // 같은 영역 내에서 순서 변경
              if (draggedEl.dataset.type === zoneId.replace('zone', '').toLowerCase()) {
                const rect = zone.getBoundingClientRect();
                const y = e.clientY - rect.top;
                const children = Array.from(zone.children);
                const insertIndex = children.findIndex(child => {
                  const childRect = child.getBoundingClientRect();
                  return childRect.top + childRect.height / 2 > e.clientY;
                });
                
                if (insertIndex === -1) {
                  zone.appendChild(draggedEl);
                } else {
                  zone.insertBefore(draggedEl, children[insertIndex]);
                }
              }
            }
          });
        }
      });
    }
    
    addDropEvents();
    
    // 카운트 업데이트 - 초기화 시 강제 실행
    refreshCounts();
    
    // 추가 안전장치: DOM이 완전히 로드된 후 카운트 재확인
    setTimeout(() => {
      refreshCounts();
    }, 200);
    
    // 테스트용: 카운트 강제 업데이트 버튼 (개발 중에만 사용) - 비활성화
    // if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
    //   const testBtn = document.createElement('button');
    //   testBtn.textContent = '카운트 강제 업데이트';
    //   testBtn.style.cssText = 'position:fixed; top:10px; right:10px; z-index:9999; background:red; color:white; padding:5px; border:none; border-radius:3px;';
    //   testBtn.onclick = () => {
    //     console.log('강제 카운트 업데이트 실행');
    //     refreshCounts();
    //     setTimeout(() => refreshCounts(), 100);
    //     setTimeout(() => refreshCounts(), 200);
    //   };
    //   document.body.appendChild(testBtn);
    // }
    document.querySelectorAll('[data-role="site"], [data-role="part"], [data-role="proc"], [data-role="area"]').forEach(btn => {
      btn.dataset.active = 'false';
    });
    
    // 입력 필드 초기화
    const workDate = $('#workDate');
    if (workDate) workDate.value = '';
    
    const siteOut = $('#siteOut');
    if (siteOut) siteOut.value = '';
    
    const blockVal = $('#blockVal');
    if (blockVal) blockVal.value = '';
    
    const dongVal = $('#dongVal');
    if (dongVal) dongVal.value = '';
    
    const hoVal = $('#hoVal');
    if (hoVal) hoVal.value = '';
    
    const secVal = $('#secVal');
    if (secVal) secVal.value = '';
    
    // 공수 컨트롤 초기화
    const qtySplit = document.querySelector('.qty-split3');
    if (qtySplit) {
      const mid = qtySplit.querySelector('.qcenter');
      if (mid) mid.textContent = '1';
    }
    
    // 썸네일 영역 초기화
    const zonePre = document.getElementById('zonePre');
    const zonePost = document.getElementById('zonePost');
    if (zonePre) zonePre.innerHTML = '';
    if (zonePost) zonePost.innerHTML = '';
    
    // 카운트 초기화 - 강제 실행
    refreshCounts();
    
    // 추가 안전장치: DOM 업데이트 후 카운트 재확인
    setTimeout(() => {
      refreshCounts();
    }, 100);
    
    // 요약 업데이트
    renderSummary();
    
    alert('모든 입력이 초기화되었습니다.');
  };
}

/* ===== 저장 → 현장 보기 ===== */
// 저장 버튼 안전 처리
const saveBtn = $('#save');
if (saveBtn) {
  saveBtn.onclick=()=>{
  // 간단한 필수 검증
  const need = [];
  if(!state.site) need.push('현장선택');
  if(!state.date) need.push('작성 정보');
  if(!state.part || (Array.isArray(state.part) && state.part.length === 0)) need.push('작업 내용 기록');
  if(!state.men || state.men < 1) {
    // 공수가 설정되지 않았거나 1 미만인 경우 기본값 1로 설정
    state.men = 1;
  }
  if(need.length){ alert('필수 입력: ' + need.join(', ')); return; }

  // 전송 페이로드(예시)
  const payload = {
    site: state.site, 
    date: state.date, 
    writer: state.writer,
    part: Array.isArray(state.part) ? state.part.join(', ') : state.part, 
    process: Array.isArray(state.proc) ? state.proc.join(', ') : state.proc,
    zone_pretty: $('#zonePreview') ? $('#zonePreview').textContent : '-',
    zone_code: $('#zoneCode') ? $('#zoneCode').textContent : '-',
    men: state.men,
    photos:{
      before: state.photos.pre.map(p=>({name:p.name})),
      after : state.photos.post.map(p=>({name:p.name})),
      docs: {
        receipt: state.photos.receipt.map(p=>({name:p.name})),
        drawing: state.photos.drawing.map(p=>({name:p.name}))
      }
    }
  };
  
  // localStorage에 workLogData 저장
  try {
    const existingData = JSON.parse(localStorage.getItem('workLogData') || '[]');
    const newWorkLog = {
      date: state.date,
      site: state.site,
      men: state.men,
      writer: state.writer,
      part: Array.isArray(state.part) ? state.part.join(', ') : state.part,
      process: Array.isArray(state.proc) ? state.proc.join(', ') : state.proc,
      zone_pretty: $('#zonePreview') ? $('#zonePreview').textContent : '-',
      zone_code: $('#zoneCode') ? $('#zoneCode').textContent : '-',
      area: Array.isArray(state.area) && state.area.length > 0 ? state.area.map(item => item.label || item.value).join(', ') : '-',
      photos: {
        before: state.photos.pre.length,
        after: state.photos.post.length,
        receipt: state.photos.receipt.length,
        drawing: state.photos.drawing.length
      },
      timestamp: new Date().toISOString()
    };
    
    // 같은 날짜의 기존 데이터가 있으면 업데이트, 없으면 추가
    const existingIndex = existingData.findIndex(item => item.date === state.date);
    if (existingIndex >= 0) {
      existingData[existingIndex] = newWorkLog;
    } else {
      existingData.push(newWorkLog);
    }
    
    localStorage.setItem('workLogData', JSON.stringify(existingData));
    console.log('[캘린더 데이터 저장 완료]', newWorkLog);
  } catch (error) {
    console.error('localStorage 저장 오류:', error);
  }

  // 작성내용요약 업데이트 (저장된 내용 반영)
  renderSummary();

  // 저장 완료 알림만 표시
  showSaveSuccessModal();
};
}

function backToEdit(){ 
  const step2 = $('#step2');
  const step1 = $('#step1');
  if (step2) step2.classList.add('hidden');
  if (step1) step1.classList.remove('hidden');
}

/* 초기 요약 렌더 */
renderSummary();

/* 공수 컨트롤 초기화 (renderSummary 함수 정의 후) */
initManpowerControls();

/* 기존 카드 이벤트 바인딩 제거 - 새로운 카드 관리 시스템 사용 */

    
    /* 작업 내용 기록 카드 관리 */
    let cardCounter = 1;
    let workCards = {}; // 모든 카드의 데이터를 저장
    
    // 첫 번째 카드 데이터 초기화
    workCards[1] = {
      id: 1,
      parts: [],
      procs: [],
      areas: [],
      block: '',
      dong: '',
      ho: '',
      manpower: 0
    };
    
    // 카드 추가 기능
    function addWorkCard() {
      cardCounter++;
      const container = document.getElementById('workCardContainer');
      const newCard = document.createElement('div');
      newCard.className = 'card p-5 work-card mt-4';
      newCard.setAttribute('data-card-id', cardCounter);
      
      newCard.innerHTML = `
        <!-- 작업 내용 기록 헤더 -->
        <div class="flex items-center justify-between mb-3">
          <div class="q">작업 내용 기록 <span style="color: #EA3829;">*</span></div>
          <div class="flex items-center gap-2">
            <button class="work-action-tag add-card-btn">추가</button>
            <button class="work-action-tag remove-card-btn">삭제</button>
          </div>
        </div>
        
        <!-- 부재명 -->
        <div class="mb-4">
          <div class="text-sm text-gray-600 mb-2">부재명</div>
          <div class="absence-reason">
            <button class="chip" data-role="part" data-value="슬라브">슬라브</button>
            <button class="chip" data-role="part" data-value="거더">거더</button>
            <button class="chip" data-role="part" data-value="기둥">기둥</button>
            <input class="custom-input part-custom" placeholder="기타 직접입력"/>
          </div>
        </div>
        
        <!-- 작업공정 -->
        <div class="mb-4">
          <div class="text-sm text-gray-600 mb-2">작업공정</div>
          <div class="absence-reason">
            <button class="chip" data-role="proc" data-value="균열">균열</button>
            <button class="chip" data-role="proc" data-value="면">면</button>
            <button class="chip" data-role="proc" data-value="마감">마감</button>
            <input class="custom-input proc-custom" placeholder="기타 직접입력"/>
          </div>
        </div>

        <!-- 구분선 -->
        <div class="border-t border-[#E6ECF4] my-6" style="width: 98%; margin-left: auto; margin-right: auto;"></div>

        <!-- 작업구간 -->
        <div class="q mb-3">작업구간</div>
        <div class="mb-4">
          <div class="text-sm text-gray-600 mb-2">작업유형</div>
          <div class="absence-reason">
            <button class="chip" data-role="area" data-value="지하" data-code="UG">지하</button>
            <button class="chip" data-role="area" data-value="지붕" data-code="RF">지붕</button>
            <input class="custom-input area-custom" placeholder="기타 직접입력"/>
          </div>
        </div>

        <div class="mb-4">
          <div class="text-sm text-gray-600 mb-2">블럭 / 동 / 호수</div>
          <div class="flex items-center gap-2 w-full overflow-hidden">
            <input class="ctl flex-1 min-w-0 block-input" placeholder="블럭" oninput="this.value = this.value.toUpperCase()"/>
            <input class="ctl flex-1 min-w-0 dong-input" placeholder="동" type="number" min="0" oninput="this.value = this.value.replace(/[^0-9]/g, '')"/>
            <input class="ctl flex-1 min-w-0 ho-input" placeholder="호수" type="number" min="0" oninput="this.value = this.value.replace(/[^0-9]/g, '')"/>
          </div>
        </div>

        <!-- 공수(일) -->
        <div class="mb-4">
          <div class="q mb-2">공수(일) <span style="color: #EA3829;">*</span></div>
          <div class="qty-split3" data-values="0,0.5,1,1.5,2,2.5,3" role="group" aria-label="공수(일)">
            <button type="button" class="qbtn" data-minus aria-label="공수 감소">−</button>
            <div class="qcenter" aria-live="polite" aria-atomic="true">1</div>
            <button type="button" class="qbtn" data-plus aria-label="공수 증가">＋</button>
          </div>
        </div>
      `;
      
      container.appendChild(newCard);
      
      // 새 카드 데이터 초기화
      workCards[cardCounter] = {
        id: cardCounter,
        parts: [],
        procs: [],
        areas: [],
        block: '',
        dong: '',
        ho: '',
        manpower: 0
      };
      
      // 새 카드의 이벤트 바인딩
      bindCardEvents(newCard);
      
      // 공수 컨트롤 초기화 (기본값 1로 설정)
      const qtySplit = newCard.querySelector('.qty-split3');
      if (qtySplit) {
        const mid = qtySplit.querySelector('.qcenter');
        if (mid) mid.textContent = '1';
        initQtyControl(qtySplit);
      }
      
      // 삭제 버튼 표시 업데이트
      updateDeleteButtons();
      
      // 요약 업데이트
      updateWorkSummary();
    }
    
    // 카드 삭제 기능
    function removeWorkCard(cardId) {
      const card = document.querySelector(`[data-card-id="${cardId}"]`);
      if (card && cardCounter > 1) { // 최소 1개 카드는 유지
        card.remove();
        delete workCards[cardId];
        
        // 삭제 버튼 표시 업데이트
        updateDeleteButtons();
        
        // 요약 업데이트
        updateWorkSummary();
      }
    }
    
    // 카드 이벤트 바인딩
    function bindCardEvents(card) {
      const cardId = parseInt(card.getAttribute('data-card-id'));
      
      // 칩 클릭 이벤트
      card.querySelectorAll('.chip').forEach(ch => {
        const role = ch.dataset.role;
        ch.onclick = () => {
          if(ch.dataset.active === 'true') {
            ch.dataset.active = 'false';
            if (role === 'part') {
              const index = workCards[cardId].parts.indexOf(ch.dataset.value);
              if(index > -1) workCards[cardId].parts.splice(index, 1);
            } else if (role === 'proc') {
              const index = workCards[cardId].procs.indexOf(ch.dataset.value);
              if(index > -1) workCards[cardId].procs.splice(index, 1);
            } else if (role === 'area') {
              const index = workCards[cardId].areas.findIndex(item => item.value === ch.dataset.value);
              if(index > -1) workCards[cardId].areas.splice(index, 1);
            }
          } else {
            ch.dataset.active = 'true';
            if (role === 'part') {
              if (!workCards[cardId].parts.includes(ch.dataset.value)) {
                workCards[cardId].parts.push(ch.dataset.value);
              }
            } else if (role === 'proc') {
              if (!workCards[cardId].procs.includes(ch.dataset.value)) {
                workCards[cardId].procs.push(ch.dataset.value);
              }
            } else if (role === 'area') {
              if (!workCards[cardId].areas.find(item => item.value === ch.dataset.value)) {
                workCards[cardId].areas.push({value: ch.dataset.value, code: ch.dataset.code});
              }
            }
          }
          updateWorkSummary();
        };
      });
      
      // 입력 필드 이벤트
      const blockInput = card.querySelector('.block-input');
      const dongInput = card.querySelector('.dong-input');
      const hoInput = card.querySelector('.ho-input');
      
      if (blockInput) {
        blockInput.oninput = (e) => {
          e.target.value = e.target.value.toUpperCase();
          workCards[cardId].block = e.target.value;
          updateWorkSummary();
        };
      }
      if (dongInput) {
        dongInput.oninput = (e) => {
          workCards[cardId].dong = e.target.value;
          updateWorkSummary();
        };
      }
      if (hoInput) {
        hoInput.oninput = (e) => {
          workCards[cardId].ho = e.target.value;
          updateWorkSummary();
        };
      }
      
      // 공수 변경 이벤트
      const qtySplit = card.querySelector('.qty-split3');
      if (qtySplit) {
        const qcenter = qtySplit.querySelector('.qcenter');
        const observer = new MutationObserver(() => {
          workCards[cardId].manpower = parseFloat(qcenter.textContent) || 0;
          updateWorkSummary();
        });
        observer.observe(qcenter, { childList: true, characterData: true });
      }
    }
    
    // 삭제 버튼 표시 업데이트
    function updateDeleteButtons() {
      const cards = document.querySelectorAll('.work-card');
      cards.forEach((card, index) => {
        const removeBtn = card.querySelector('.remove-card-btn');
        if (removeBtn) {
          removeBtn.style.display = cards.length > 1 ? 'block' : 'none';
        }
      });
    }
    
    // 작업 요약 업데이트
    function updateWorkSummary() {
      // 모든 카드의 데이터를 합산
      let totalParts = [];
      let totalProcs = [];
      let totalAreas = [];
      let totalManpower = 0;
      
      Object.values(workCards).forEach(card => {
        if (card) {
          totalParts = totalParts.concat(card.parts);
          totalProcs = totalProcs.concat(card.procs);
          totalAreas = totalAreas.concat(card.areas);
          totalManpower += card.manpower;
        }
      });
      
      // 중복 제거
      totalParts = [...new Set(totalParts)];
      totalProcs = [...new Set(totalProcs)];
      totalAreas = [...new Set(totalAreas.map(item => item.value))];
      
      // state 업데이트
      state.part = totalParts;
      state.proc = totalProcs;
      state.area = totalAreas.map(value => ({value, code: ''}));
      state.men = totalManpower;
      
      // buildZone 함수 호출 (표준명/코드 생성)
      if (typeof buildZone === 'function') {
        buildZone();
      }
      
      // 요약 렌더링
      renderSummary();
    }
    
    // 첫 번째 카드 이벤트 바인딩
    function bindFirstCard() {
      const firstCard = document.querySelector('.work-card[data-card-id="1"]');
      if (firstCard) {
        // 첫 번째 카드의 칩 이벤트 바인딩
        firstCard.querySelectorAll('.chip').forEach(ch => {
          const role = ch.dataset.role;
          ch.onclick = () => {
            if(ch.dataset.active === 'true') {
              ch.dataset.active = 'false';
              if (role === 'part') {
                const index = workCards[1].parts.indexOf(ch.dataset.value);
                if(index > -1) workCards[1].parts.splice(index, 1);
              } else if (role === 'proc') {
                const index = workCards[1].procs.indexOf(ch.dataset.value);
                if(index > -1) workCards[1].procs.splice(index, 1);
              } else if (role === 'area') {
                const index = workCards[1].areas.findIndex(item => item.value === ch.dataset.value);
                if(index > -1) workCards[1].areas.splice(index, 1);
              }
            } else {
              ch.dataset.active = 'true';
              if (role === 'part') {
                if (!workCards[1].parts.includes(ch.dataset.value)) {
                  workCards[1].parts.push(ch.dataset.value);
                }
              } else if (role === 'proc') {
                if (!workCards[1].procs.includes(ch.dataset.value)) {
                  workCards[1].procs.push(ch.dataset.value);
                }
              } else if (role === 'area') {
                if (!workCards[1].areas.find(item => item.value === ch.dataset.value)) {
                  workCards[1].areas.push({value: ch.dataset.value, code: ch.dataset.code});
                }
              }
            }
            updateWorkSummary();
          };
        });
        
        // 첫 번째 카드의 입력 필드 이벤트
        const blockInput = firstCard.querySelector('.block-input');
        const dongInput = firstCard.querySelector('.dong-input');
        const hoInput = firstCard.querySelector('.ho-input');
        
        if (blockInput) {
          blockInput.oninput = (e) => {
            e.target.value = e.target.value.toUpperCase();
            workCards[1].block = e.target.value;
            updateWorkSummary();
          };
        }
        if (dongInput) {
          dongInput.oninput = (e) => {
            workCards[1].dong = e.target.value;
            updateWorkSummary();
          };
        }
        if (hoInput) {
          hoInput.oninput = (e) => {
            workCards[1].ho = e.target.value;
            updateWorkSummary();
          };
        }
        
        // 첫 번째 카드의 공수 변경 이벤트 (기본값 1로 설정)
        const qtySplit = firstCard.querySelector('.qty-split3');
        if (qtySplit) {
          const qcenter = qtySplit.querySelector('.qcenter');
          if (qcenter) qcenter.textContent = '1';
          const observer = new MutationObserver(() => {
            workCards[1].manpower = parseFloat(qcenter.textContent) || 1;
            updateWorkSummary();
          });
          observer.observe(qcenter, { childList: true, characterData: true });
        }
      }
    }
    
    // 추가/삭제 버튼 이벤트 바인딩
    function bindActionButtons() {
      // 추가 버튼 이벤트
      document.addEventListener('click', (e) => {
        if (e.target.classList.contains('add-card-btn') || e.target.id === 'addWorkCard') {
          addWorkCard();
        }
        
        if (e.target.classList.contains('remove-card-btn')) {
          const card = e.target.closest('.work-card');
          if (card) {
            const cardId = parseInt(card.getAttribute('data-card-id'));
            removeWorkCard(cardId);
          }
        }
      });
    }
    
    // 초기화 함수
    function initializeWorkCards() {
      bindFirstCard();
      bindActionButtons();
      updateDeleteButtons();
    }
    
    // 전역 함수로 노출
    window.addWorkCard = addWorkCard;
    window.removeWorkCard = removeWorkCard;
    
    // 페이지 로드 시 초기화
    initializeWorkCards();

    document.addEventListener('click', (e) => {
      const b = e.target.closest('.chip');
      if (!b) return;
      
      const d = Math.max(b.clientWidth, b.clientHeight);
      const r = document.createElement('span');
      const rect = b.getBoundingClientRect();
      r.className = 'ripple-ink';
      r.style.width = r.style.height = d + 'px';
      r.style.left = (e.clientX - rect.left - d / 2) + 'px';
      r.style.top = (e.clientY - rect.top - d / 2) + 'px';
      b.appendChild(r);
      setTimeout(() => r.remove(), 450);
    });
</script>

  <!-- ===== 업로드 팝업 ===== -->
  <div id="upload-scrim" class="upload-scrim" role="dialog" aria-modal="true" aria-labelledby="upload-title">
    <div class="upload-popup">
      <div class="upload-popup-head">
        <div>
          <div id="upload-title" class="upload-popup-title">파일 업로드</div>
          <div id="upload-subtitle" class="upload-popup-sub">사진을 선택하여 업로드하세요</div>
        </div>
        <button class="upload-close-x" aria-label="닫기" id="upload-close" title="닫기">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M18 6L6 18M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <!-- 구분선 -->
      <div class="upload-divider"></div>

      <div class="upload-options">
        <div class="upload-option" id="camera-option">
          <div class="upload-icon-box">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
              <circle cx="12" cy="13" r="4"/>
            </svg>
          </div>
          <div class="upload-label">카메라</div>
        </div>
        <div class="upload-option" id="gallery-option">
          <div class="upload-icon-box">
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <circle cx="8.5" cy="8.5" r="1.5"/>
              <polyline points="21,15 16,10 5,21"/>
            </svg>
          </div>
          <div class="upload-label">갤러리</div>
        </div>
      </div>


      <!-- 선택된 파일 목록 -->
      <div class="selected-files" id="selected-files"></div>

      <!-- 숨겨진 파일 입력 -->
      <input type="file" id="file-input" class="hidden-file-input" multiple accept="image/*,.pdf" />

      <div class="upload-popup-actions" id="upload-popup-actions">
        <button class="btn btn--gray" id="upload-camera-btn">카메라</button>
        <button class="btn btn--gray" id="upload-gallery-btn">갤러리</button>
        <button class="btn btn--gray" id="upload-file-btn">파일</button>
        <button class="btn btn--gray" id="upload-cancel">취소</button>
      </div>
    </div>
  </div>

  <script>
    // ========== UPLOAD POPUP ========== 
    const UPLOAD_SCRIM = document.getElementById('upload-scrim');
    const UPLOAD_CLOSE = document.getElementById('upload-close');
    const UPLOAD_CANCEL = document.getElementById('upload-cancel');
    const UPLOAD_CONFIRM = document.getElementById('upload-confirm');
    const UPLOAD_CAMERA_BTN = document.getElementById('upload-camera-btn');
    const UPLOAD_GALLERY_BTN = document.getElementById('upload-gallery-btn');
    const UPLOAD_FILE_BTN = document.getElementById('upload-file-btn');
    const CAMERA_OPTION = document.getElementById('camera-option');
    const GALLERY_OPTION = document.getElementById('gallery-option');
    const FILE_INPUT = document.getElementById('file-input');
    const SELECTED_FILES = document.getElementById('selected-files');
    const UPLOAD_TITLE = document.getElementById('upload-title');
    const UPLOAD_SUBTITLE = document.getElementById('upload-subtitle');

    let currentCategory = '';
    let selectedFiles = [];

    // 영수증/도면 직접 업로드 (팝업 없이)
    function openDirectUpload(type) {
      // 숨겨진 파일 입력 요소 생성 또는 기존 것 사용
      let fileInput = document.getElementById(`direct-upload-${type}`);
      if (!fileInput) {
        fileInput = document.createElement('input');
        fileInput.type = 'file';
        fileInput.id = `direct-upload-${type}`;
        fileInput.style.display = 'none';
        fileInput.multiple = true;
        document.body.appendChild(fileInput);
      }
      
      // 파일 타입에 따른 accept 설정
      if (type === 'receipt') {
        fileInput.accept = 'image/*,.pdf,.dwg,.dxf';
        fileInput.removeAttribute('capture');
      } else if (type === 'drawing') {
        fileInput.accept = 'image/*,.pdf,.dwg,.dxf';
        fileInput.removeAttribute('capture');
      }
      
      // 파일 선택 이벤트 처리
      fileInput.onchange = (e) => {
        const files = e.target.files;
        if (files.length === 0) return;
        
        Array.from(files).forEach(file => {
          // 파일 유효성 검사
          if (type === 'receipt') {
            const allowedTypes = ['image/', 'application/pdf', 'application/dwg', 'application/dxf'];
            if (!allowedTypes.some(allowedType => file.type.startsWith(allowedType))) {
              alert('영수증은 이미지, PDF, DWG, DXF 파일만 업로드 가능합니다.');
              return;
            }
          } else if (type === 'drawing') {
            const allowedTypes = ['image/', 'application/pdf', 'application/dwg', 'application/dxf'];
            if (!allowedTypes.some(allowedType => file.type.startsWith(allowedType))) {
              alert('도면은 이미지, PDF, DWG, DXF 파일만 업로드 가능합니다.');
              return;
            }
          }
          
          // 파일 크기 검사 (10MB 제한)
          if (file.size > 10 * 1024 * 1024) {
            alert('파일 크기는 10MB를 초과할 수 없습니다.');
            return;
          }
          
          // 파일 업로드 처리
          const reader = new FileReader();
          reader.onload = (e) => {
            const photoObj = {
              id: Date.now() + Math.random(),
              url: e.target.result,
              name: file.name,
              size: file.size,
              type: file.type
            };
            
            // 해당 카테고리에 추가
            addPhotoToZone(photoObj, type);
          };
          reader.readAsDataURL(file);
        });
        
        // 파일 입력 초기화
        e.target.value = '';
      };
      
      // 파일 선택 다이얼로그 열기
      fileInput.click();
    }
    
    // 사진을 해당 영역에 추가하는 함수
    function addPhotoToZone(photoObj, zoneType) {
      // 상태에 추가
      if (zoneType === 'receipt') {
        state.photos.receipt.push(photoObj);
        zoneReceipt.appendChild(thumbEl(photoObj, 'receipt'));
      } else if (zoneType === 'drawing') {
        state.photos.drawing.push(photoObj);
        zoneDrawing.appendChild(thumbEl(photoObj, 'drawing'));
      }
      
      // 카운트 업데이트
      refreshCounts();
    }

    function openUploadPopup(category) {
      currentCategory = category;
      UPLOAD_TITLE.textContent = `${category} 업로드`;
      UPLOAD_SUBTITLE.textContent = '';
      
      const UPLOAD_POPUP_ACTIONS = document.getElementById('upload-popup-actions');
      
      // 영수증과 도면은 파일 업로드 영역과 버튼 표시
      if (category === '영수증' || category === '도면') {
        UPLOAD_POPUP_ACTIONS.style.display = 'flex';
      } else {
        // 다른 카테고리는 숨기기
        UPLOAD_POPUP_ACTIONS.style.display = 'none';
      }
      
      UPLOAD_SCRIM.classList.add('show');
      document.body.style.overflow = 'hidden';
    }

    function closeUploadPopup() {
      UPLOAD_SCRIM.classList.remove('show');
      document.body.style.overflow = '';
      selectedFiles = [];
      SELECTED_FILES.innerHTML = '';
      FILE_INPUT.value = '';
    }

    // 카메라 옵션 클릭
    CAMERA_OPTION.addEventListener('click', () => {
      // 모바일에서는 카메라 앱 실행
      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        FILE_INPUT.setAttribute('capture', 'camera');
        FILE_INPUT.click();
      } else {
        alert('카메라 기능을 사용할 수 없습니다.');
      }
    });

    // 갤러리 옵션 클릭
    GALLERY_OPTION.addEventListener('click', () => {
      FILE_INPUT.removeAttribute('capture');
      FILE_INPUT.click();
    });

    // 파일 선택 처리
    FILE_INPUT.addEventListener('change', (e) => {
      const files = Array.from(e.target.files);
      handleFileSelection(files);
    });

    function handleFileSelection(files) {
      const mode = Object.keys(CATEGORY_MAP).find(key => CATEGORY_MAP[key] === currentCategory);
      if (!mode) return;
      
      // 현재 카테고리의 파일 개수 확인
      const currentCount = getCurrentCount(mode);
      const remainingSlots = 30 - currentCount;
      
      if (remainingSlots <= 0) {
        alert(`${getCategoryName(mode)}은(는) 최대 30개까지만 업로드 가능합니다.`);
        return;
      }
      
      // 업로드 가능한 파일 수만큼만 처리
      const filesToAdd = files.slice(0, remainingSlots);
      
      filesToAdd.forEach(file => {
        if (file.type.startsWith('image/') || file.type === 'application/pdf') {
          selectedFiles.push(file);
        }
      });
      
      if (files.length > remainingSlots) {
        alert(`${getCategoryName(mode)}은(는) 최대 30개까지만 업로드 가능합니다. ${remainingSlots}개만 선택되었습니다.`);
      }
      
      renderSelectedFiles();
    }

    function renderSelectedFiles() {
      SELECTED_FILES.innerHTML = '';
      selectedFiles.forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'file-item';
        fileItem.innerHTML = `
          <svg class="file-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
            <polyline points="14,2 14,8 20,8"/>
          </svg>
          <div class="file-info">
            <div class="file-name">${file.name}</div>
            <div class="file-size">${formatFileSize(file.size)}</div>
          </div>
          <button class="file-remove" onclick="removeFile(${index})">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        `;
        SELECTED_FILES.appendChild(fileItem);
      });
    }

    function removeFile(index) {
      selectedFiles.splice(index, 1);
      renderSelectedFiles();
    }

    function formatFileSize(bytes) {
      if (bytes === 0) return '0 Bytes';
      const k = 1024;
      const sizes = ['Bytes', 'KB', 'MB', 'GB'];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // 닫기/취소
    [UPLOAD_CLOSE, UPLOAD_CANCEL].forEach(btn => btn.addEventListener('click', closeUploadPopup));

    // 카메라 버튼
    UPLOAD_CAMERA_BTN.addEventListener('click', () => {
      if (CAMERA_OPTION) {
        CAMERA_OPTION.click();
      }
    });

    // 갤러리 버튼
    UPLOAD_GALLERY_BTN.addEventListener('click', () => {
      if (GALLERY_OPTION) {
        GALLERY_OPTION.click();
      }
    });

    // 파일 버튼
    UPLOAD_FILE_BTN.addEventListener('click', () => {
      if (FILE_INPUT) {
        FILE_INPUT.click();
      }
    });

    // 업로드 확인
    UPLOAD_CONFIRM.addEventListener('click', () => {
      if (selectedFiles.length === 0) {
        alert('업로드할 파일을 선택해주세요.');
        return;
      }
      
      // 실제 업로드 로직 - 메인 시스템에 파일 추가
      const mode = Object.keys(CATEGORY_MAP).find(key => CATEGORY_MAP[key] === currentCategory);
      if (mode) {
        console.log('업로드 팝업에서 파일 추가:', mode, selectedFiles.length);
        
        // 직접 addFiles 함수 호출
        addFiles(selectedFiles, mode);
        
        // 카운트 즉시 업데이트 강제 실행 (여러 번 호출)
        refreshCounts();
        setTimeout(() => refreshCounts(), 50);
        setTimeout(() => refreshCounts(), 100);
        setTimeout(() => refreshCounts(), 200);
        
        alert(`${currentCategory} 파일 ${selectedFiles.length}개가 업로드되었습니다.`);
      }
      
      closeUploadPopup();
    });

    // 외부 클릭 닫기
    UPLOAD_SCRIM.addEventListener('click', (e) => {
      if (e.target === UPLOAD_SCRIM) closeUploadPopup();
    });

    // 전역 함수로 업로드 팝업 열기 함수 노출
    window.openUploadPopup = openUploadPopup;
    








  </script>

  <!-- 업로드 모달 -->
  <div id="upload-modal" class="upload-modal hidden">
    <div class="upload-modal-content">
      <div class="upload-modal-header">
        <h3 id="upload-modal-title">파일 업로드</h3>
        <button class="upload-modal-close" id="upload-modal-close">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="upload-modal-body">
        <div class="upload-options">
          <button class="upload-option-btn" id="upload-camera-option">
            <div class="upload-option-icon-box">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path>
                <circle cx="12" cy="13" r="4"></circle>
              </svg>
            </div>
            <div class="upload-option-title">카메라</div>
            <div class="upload-option-desc">사진 촬영</div>
          </button>
          <button class="upload-option-btn" id="upload-gallery-option">
            <div class="upload-option-icon-box">
              <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                <circle cx="9" cy="9" r="2"></circle>
                <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"></path>
              </svg>
            </div>
            <div class="upload-option-title">갤러리</div>
            <div class="upload-option-desc">기존 파일</div>
          </button>
        </div>
      </div>
      <!-- 숨겨진 파일 입력 -->
      <input type="file" id="upload-file-input" class="hidden" multiple accept="image/*,.pdf" />
    </div>
  </div>


  <!-- 알림 팝업 -->
  <div id="notification-popup" class="notification-popup hidden">
    <div class="notification-popup-content">
      <div class="notification-popup-header">
        <h3>알림</h3>
        <button class="notification-popup-close" id="notification-popup-close">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
      </div>
      <div class="notification-popup-body">
        <div class="notification-content">
          <div class="notification-list">
            <div class="notification-item">
              <div class="notification-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
              </div>
              <div class="notification-text">
                <div class="notification-title">시스템 점검 안내</div>
                <div class="notification-desc">오늘 오후 2시부터 3시까지 시스템 점검이 예정되어 있습니다.</div>
              </div>
            </div>
            <div class="notification-item">
              <div class="notification-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                  <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                </svg>
              </div>
              <div class="notification-text">
                <div class="notification-title">작업일지 제출 요청</div>
                <div class="notification-desc">이번 주 작업일지 제출이 필요합니다.</div>
              </div>
            </div>
            <div class="notification-item">
              <div class="notification-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="none">
                  <path d="M13,14H11V10H13M13,18H11V16H13M1,21H23L12,2L1,21Z"/>
                </svg>
              </div>
              <div class="notification-text">
                <div class="notification-title">안전 수칙 준수</div>
                <div class="notification-desc">현장에서 안전 수칙을 준수해 주시기 바랍니다.</div>
              </div>
            </div>
          </div>
        </div>
        <div class="notification-options">
          <label class="notification-checkbox">
            <input type="checkbox" id="notification-dont-show-today">
            <span class="checkmark"></span>
            <span class="checkbox-text">오늘은 그만보기</span>
          </label>
        </div>
      </div>
      <div class="notification-popup-footer">
        <button class="notification-btn notification-btn-secondary" id="notification-skip-btn">건너뛰기</button>
        <button class="notification-btn notification-btn-primary" id="notification-shortcut-btn">바로가기</button>
      </div>
    </div>
  </div>

  <!-- ========== 햄버거 드로어 ========== -->
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@500;600;700;800&display=swap');
    .drawer-scrim{position:fixed; inset:0; background:rgba(0,0,0,.35); display:none; z-index:1400;}
    .drawer-scrim.show{display:block}
    [data-theme="dark"] .drawer-scrim{background:rgba(0,0,0,.6);}
    .drawer{position:fixed; top:0; left:-320px; width:320px; max-width:86vw; height:100%; background:#fff; box-shadow:4px 0 24px rgba(0,0,0,.18); z-index:1500; display:flex; flex-direction:column; transition:left .28s ease-out; font-family:'Noto Sans KR', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif; overflow:visible; contain:layout paint; isolation:isolate; padding:calc(12px + env(safe-area-inset-top, 0px)) 12px calc(16px + env(safe-area-inset-bottom, 0px));}
    [data-theme="dark"] .drawer{background:#0F172A; box-shadow:4px 0 24px rgba(0,0,0,.4);}
    .drawer.show{left:0}
    .drawer-head{display:none}
    .drawer-body{padding:0; flex:1; overflow:visible;}
    .drawer-scale{transform-origin:top center; will-change:transform; padding:20px 16px;}
    .greet-wrap{display:flex; flex-direction:column; gap:6px; margin-bottom:18px}
    .greet-hello{font-family:'Noto Sans KR', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif; font-size:21px; font-weight:600; line-height:1.2; color:#1A254F}
    [data-theme="dark"] .greet-hello{color:#E9EEF5}
    .greet-email{font:500 13px/1.3 'Noto Sans KR', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif; color:#9CA3AF}
    [data-theme="dark"] .greet-email{color:#94A3B8}
    .coupon-sec{margin:10px 0 16px}
    .coupon-title{font:700 12px/1 'Noto Sans KR', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif; color:#6B7280; margin-bottom:8px}
    [data-theme="dark"] .coupon-title{color:#94A3B8}
    .coupon-row{display:flex; align-items:center; justify-content:space-between; padding:12px 0; border-bottom:1px solid #E5E7EB; color:#111827; font-family:'Noto Sans KR', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif}
    [data-theme="dark"] .coupon-row{border-color:#1E293B; color:#E5E7EB}
    .chev{color:#9CA3AF}
    [data-theme="dark"] .chev{color:#64748B}
    .menu-list{margin:8px 0 0; padding:0; list-style:none; border-top:1px solid #E5E7EB}
    [data-theme="dark"] .menu-list{border-color:#1E293B}
    .menu-item{display:block; padding:12px 0; border-bottom:1px solid #E5E7EB; color:var(--text); text-decoration:none;}
    [data-theme="dark"] .menu-item{border-color:#1E293B; color:#E9EEF5}
    .menu-item:hover{background:transparent}
    [data-theme="dark"] .menu-item:hover{color:#F1F5F9}
    .menu-label{font-family:'Noto Sans KR', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif; font-size:15px; font-weight:600; line-height:1.2; color:#1A254F; transform: translateX(30px);}
    [data-theme="dark"] .menu-label{color:#E9EEF5}
    .menu-item-with-btn{display:flex; align-items:center; justify-content:space-between; padding:12px 0; border-bottom:1px solid #E5E7EB;}
    .menu-item-with-btn .menu-item{padding:0; border-bottom:none;}
    [data-theme="dark"] .menu-item-with-btn{border-color:#1E293B}
    .close-btn{background-color:#ffffff; color:#000000; border:1px solid #e0e0e0; border-radius:6px; padding:8px 16px; font-family:'Noto Sans KR', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif; font-size:14px; font-weight:500; cursor:pointer; transition:all 0.3s ease; box-shadow:0 1px 3px rgba(0,0,0,0.1);}
    [data-theme="dark"] .close-btn{background-color:#1E293B; color:#E9EEF5; border-color:#374151;}
    [data-theme="dark"] .close-btn:hover{background-color:#374151; border-color:#4B5563;}
    .close-btn:hover{background-color:#f5f5f5; border-color:#d0d0d0;}
    .account-manage-btn{background-color:#ffffff; color:#000000; border:1px solid #e0e0e0; border-radius:6px; padding:8px 16px; font-family:'Noto Sans KR', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif; font-size:14px; font-weight:500; cursor:pointer; transition:all 0.3s ease; box-shadow:0 1px 3px rgba(0,0,0,0.1);}
    .account-manage-btn:hover{background-color:#f5f5f5; border-color:#d0d0d0;}
    [data-theme="dark"] .account-manage-btn{background-color:#1E293B; color:#E9EEF5; border-color:#374151;}
    [data-theme="dark"] .account-manage-btn:hover{background-color:#374151; border-color:#4B5563;}
    .account-info{padding:12px 0; border-bottom:1px solid #E5E7EB;}
    [data-theme="dark"] .account-info{border-color:#1E293B}
    .account-info-item{display:flex; justify-content:space-between; align-items:center; padding:6px 0; font-family:'Noto Sans KR', system-ui, sans-serif; font-size:15px; font-weight:600;}
    .account-label{color:#6B7280;}
    [data-theme="dark"] .account-label{color:#94A3B8}
    .account-value{color:#1A254F; font-weight:600;}
    [data-theme="dark"] .account-value{color:#E9EEF5}
    .change-password-btn{color:#0068FE !important; cursor:pointer; transition:color 0.3s ease;}
    .change-password-btn:hover{color:#0056CC !important;}
    [data-theme="dark"] .change-password-btn{color:#63B3ED !important;}
    [data-theme="dark"] .change-password-btn:hover{color:#90CDF4 !important;}
    
    /* 비밀번호 변경 폼 스타일 (홈 디자인 CSS 반영) */
    .password-change-form{
      padding:16px; 
      border-bottom:none; 
      opacity:1; 
      transform:translateY(0); 
      transition:opacity 0.3s ease, transform 0.3s ease;
      min-height: calc(var(--vh, 1vh) * 100);
      min-height: 100dvh;
      min-height: 100svh;
    }
    [data-theme="dark"] .password-change-form{border-color:#1E293B}
    .password-form-container{
      padding:0;
      position: relative;
      z-index: 1;
    }
    .form-group{margin-bottom:12px;}
    .form-label{display:block; margin-bottom:8px; font-family:'Noto Sans KR', system-ui, sans-serif; font-size:15px; font-weight:600; color:#6B7280;}
    [data-theme="dark"] .form-label{color:#D1D5DB;}
    .form-input{
      width:100%; 
      height:48px; 
      padding:0 16px; 
      border:1px solid #D1D5DB; 
      border-radius:12px; 
      font-family:'Noto Sans KR', system-ui, sans-serif; 
      font-size:16px !important; 
      background:#FFFFFF; 
      color:#111827; 
      transition:border-color 0.3s ease; 
      box-sizing:border-box;
    }
    .form-group{position:relative;}
    .password-toggle{position:absolute; right:12px; top:50%; transform:translateY(-50%); background:none; border:none; cursor:pointer; padding:4px; color:#6B7280; font-size:14px; font-weight:600; transition:color 0.3s ease; font-family:'Noto Sans KR', system-ui, sans-serif;}
    .password-toggle:hover{color:#374151;}
    [data-theme="dark"] .password-toggle{color:#9CA3AF;}
    [data-theme="dark"] .password-toggle:hover{color:#D1D5DB;}
    .form-input:focus{outline:none; border-color:#0068FE;}
    [data-theme="dark"] .form-input{border-color:#4B5563; background:#1F2937; color:#F9FAFB;}
    [data-theme="dark"] .form-input:focus{border-color:#63B3ED;}
    .form-actions{display:flex; gap:12px; margin-top:16px; width:100%;}
    .cancel-btn{flex:1; height:48px; border:1px solid #D1D5DB; border-radius:12px; background:#FFFFFF; color:#374151; font-family:'Noto Sans KR', system-ui, sans-serif; font-size:15px; font-weight:600; cursor:pointer; transition:all 0.3s ease; min-width:0;}
    .cancel-btn:hover{background:#F9FAFB; border-color:#9CA3AF;}
    [data-theme="dark"] .cancel-btn{border-color:#4B5563; background:#1F2937; color:#D1D5DB;}
    [data-theme="dark"] .cancel-btn:hover{background:#374151; border-color:#6B7280;}
    .save-btn{flex:1; height:48px; border:none; border-radius:12px; background:#0068FE; color:#FFFFFF; font-family:'Noto Sans KR', system-ui, sans-serif; font-size:15px; font-weight:600; cursor:pointer; transition:all 0.3s ease; min-width:0;}
    .save-btn:hover{background:#0056CC;}
    [data-theme="dark"] .save-btn{background:#63B3ED;}
    [data-theme="dark"] .save-btn:hover{background:#90CDF4;}
    .drawer-foot{margin-top:auto; padding:16px; border-top:1px solid var(--nav-border); padding-bottom:max(16px, env(safe-area-inset-bottom, 0px));}
    .logout-btn{width:100%; height:48px; border-radius:12px; border:1px solid #1A254F; background:#1A254F; font-family:'Noto Sans KR', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif; font-size:14px; font-weight:700; line-height:1.2; color:#FFFFFF;}
    .logout-btn:hover{background:#162043; border-color:#162043; color:#FFFFFF}
    [data-theme="dark"] .logout-btn{background:#1A254F; border-color:#1A254F; color:#FFFFFF}
    [data-theme="dark"] .logout-btn:hover{background:#162043; border-color:#162043; color:#FFFFFF}
    .drawer-name{font:inherit}
    .drawer-email{font:inherit}
    .drawer-role{font:600 14px/1.1 'Noto Sans KR', system-ui, -apple-system, Segoe UI, Roboto, sans-serif; color:#000000}
    [data-theme="dark"] .drawer-role{ color: var(--text); }
    .profile-sec{display:flex; flex-direction:column; margin:10px 0 16px; gap:8px;}
    .profile-header{display:flex; align-items:center; justify-content:space-between; width:100%;}
    .profile-left{display:flex; align-items:center; gap:12px}
    .profile-text{display:flex; flex-direction:column; gap:2px}
    .avatar{width:48px; height:48px; border-radius:12px; object-fit:cover; border:1px solid #E5E7EB; background:#f3f4f6}
    .profile-name{font:600 18px/1.2 'Noto Sans KR', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif; color:#1A254F}
    [data-theme="dark"] .profile-name{color:#E9EEF5}
    .profile-email{font:400 13px 'Noto Sans KR', system-ui, -apple-system, 'Segoe UI', Roboto, sans-serif; color:#64748B; text-align:left;}
    [data-theme="dark"] .profile-email{color:#94A3B8}
    #avatarUpload{display:none}
    [data-theme="dark"] .avatar{border-color:#1E293B; background:#0b1220}
  </style>

  <div id="drawerScrim" class="drawer-scrim" aria-hidden="true"></div>
  <aside id="drawer" class="drawer" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="drawer-body">
      <div class="drawer-scale">
      <a href="#" id="drawerClose" class="account-manage" aria-label="닫기"></a>
      
      <div class="profile-sec">
        <div class="profile-header">
          <div class="profile-name" id="profileUserName">이현수 <span class="important-tag" style="position: relative; top: 0; right: 0; margin-left: 8px;">현장관리자</span></div>
          <button class="close-btn" id="drawerCloseBtn">닫기</button>
        </div>
        <div class="profile-email" id="profileUserEmail">manager@inopnc.com</div>
      </div>
      <input type="file" id="avatarUpload" accept="image/*" aria-hidden="true" />
      <ul class="menu-list">
        <li><a class="menu-item" href="home.html"><span class="menu-label">홈</span></a></li>
        <li><a class="menu-item" href="worklog.html"><span class="menu-label">출력현황</span></a></li>
        <li><a class="menu-item" href="home.html"><span class="menu-label">작업일지</span></a></li>
        <li><a class="menu-item" href="현장정보.html"><span class="menu-label">현장정보</span></a></li>
        <li><a class="menu-item" href="home.html"><span class="menu-label">문서함</span></a></li>
        <li class="menu-item-with-btn">
          <a class="menu-item" href="home.html"><span class="menu-label">내정보</span></a>
          <button class="account-manage-btn" id="accountManageBtn">계정관리</button>
        </li>
        <li class="account-info" id="accountInfo" style="display: none;">
          <div class="account-info-item">
            <span class="account-label">연락처</span>
            <span class="account-value">010-1234-5678</span>
          </div>
          <div class="account-info-item">
            <span class="account-label">가입일</span>
            <span class="account-value">2024.01.15</span>
          </div>
          <div class="account-info-item">
            <span class="account-label">비밀번호 변경</span>
            <span class="account-value change-password-btn" id="changePasswordBtn">변경하기</span>
          </div>
        </li>
        <li class="password-change-form" id="passwordChangeForm" style="display: none;">
          <div class="password-form-container">
            <div class="form-group">
              <input type="password" class="form-input" id="currentPassword" placeholder="현재 비밀번호를 입력" inputmode="text">
            </div>
            <div class="form-group">
              <input type="password" class="form-input" id="newPassword" placeholder="새 비밀번호 입력(최소 6자)" inputmode="text">
            </div>
            <div class="form-group">
              <input type="password" class="form-input" id="confirmPassword" placeholder="새 비밀번호를 다시 입력" inputmode="text">
            </div>
            <div class="form-actions">
              <button class="cancel-btn" id="cancelPasswordChange">취소</button>
              <button class="save-btn" id="savePasswordChange">저장</button>
            </div>
          </div>
        </li>
      </ul>
      </div>
    </div>
    <div class="drawer-foot">
      <button class="logout-btn" type="button" id="drawerLogout">로그아웃</button>
    </div>
  </aside>

  <script>
    (function(){
      const btn = document.getElementById('btnHamburger');
      const scrim = document.getElementById('drawerScrim');
      const drawer = document.getElementById('drawer');
      const drawerScale = document.querySelector('.drawer-scale');
      const closeBtn = document.getElementById('drawerClose');
      
      function lockScroll(lock){ document.body.classList.toggle('modal-open', !!lock); }
      
      function fitDrawer(){
        if(!drawer || !drawerScale) return;
        // 가용 높이(패널 패딩/안전영역 감안)
        const style = getComputedStyle(drawer);
        const padTop = parseFloat(style.paddingTop);
        const padBottom = parseFloat(style.paddingBottom);
        const avail = window.innerHeight - padTop - padBottom;

        // 실제 콘텐츠 전체 높이
        const contentH = drawerScale.scrollHeight;

        // 축소 비율 계산 (최소 0.85 유지)
        const s = Math.max(0.85, Math.min(1, avail / contentH));
        drawerScale.style.transform = `scale(${s})`;
      }
      
      function open(){ 
        scrim.classList.add('show'); 
        drawer.classList.add('show'); 
        drawer.setAttribute('aria-hidden','false'); 
        lockScroll(true);
        // 열릴 때 자동 축소 적용
        setTimeout(fitDrawer, 50);
      }
      function close(){ scrim.classList.remove('show'); drawer.classList.remove('show'); drawer.setAttribute('aria-hidden','true'); lockScroll(false); }
      btn?.addEventListener('click', open);
      closeBtn?.addEventListener('click', close);
      scrim?.addEventListener('click', close);
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && drawer.classList.contains('show')) close(); });
      
      // 뷰포트 변동에 대응
      window.addEventListener('resize', fitDrawer);
      window.visualViewport?.addEventListener('resize', fitDrawer);
      window.visualViewport?.addEventListener('scroll', fitDrawer);
      
      // 비밀번호 토글 함수
      window.togglePassword = function(inputId, button) {
        const input = document.getElementById(inputId);
        if (input.type === 'password') {
          input.type = 'text';
          button.textContent = '숨기기';
        } else {
          input.type = 'password';
          button.textContent = '보기';
        }
      };
      
      // 닫기 버튼 이벤트 리스너 추가
      const drawerCloseBtn = document.getElementById('drawerCloseBtn');
      drawerCloseBtn?.addEventListener('click', close);
      
      // 계정관리 버튼 이벤트 리스너 추가
      const accountManageBtn = document.getElementById('accountManageBtn');
      const accountInfo = document.getElementById('accountInfo');
      accountManageBtn?.addEventListener('click', () => {
        if (accountInfo) {
          const isVisible = accountInfo.style.display !== 'none';
          accountInfo.style.display = isVisible ? 'none' : 'block';
        }
      });
      
      // 비밀번호 변경 기능
      const changePasswordBtn = document.getElementById('changePasswordBtn');
      const passwordChangeForm = document.getElementById('passwordChangeForm');
      const cancelPasswordChange = document.getElementById('cancelPasswordChange');
      const savePasswordChange = document.getElementById('savePasswordChange');
      
      changePasswordBtn?.addEventListener('click', () => {
        if (passwordChangeForm) {
          const isHidden = passwordChangeForm.style.display === 'none' || passwordChangeForm.style.display === '';
          
          if (isHidden) {
            // 폼 표시
            passwordChangeForm.style.display = 'block';
            passwordChangeForm.style.opacity = '0';
            passwordChangeForm.style.transform = 'translateY(-10px)';
            passwordChangeForm.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
            
            // 애니메이션 시작
            setTimeout(() => {
              passwordChangeForm.style.opacity = '1';
              passwordChangeForm.style.transform = 'translateY(0)';
            }, 10);
            
          } else {
            // 폼 숨기기
            passwordChangeForm.style.opacity = '0';
            passwordChangeForm.style.transform = 'translateY(-10px)';
            
            setTimeout(() => {
              passwordChangeForm.style.display = 'none';
            }, 300);
          }
        }
      });
      
      cancelPasswordChange?.addEventListener('click', () => {
        if (passwordChangeForm) {
          // 애니메이션과 함께 폼 숨기기
          passwordChangeForm.style.opacity = '0';
          passwordChangeForm.style.transform = 'translateY(-10px)';
          
          setTimeout(() => {
            passwordChangeForm.style.display = 'none';
            // 폼 초기화
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
          }, 300);
        }
      });
      
      savePasswordChange?.addEventListener('click', () => {
        const currentPassword = document.getElementById('currentPassword').value;
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        
        if (!currentPassword || !newPassword || !confirmPassword) {
          alert('모든 필드를 입력해주세요.');
          return;
        }
        
        if (newPassword !== confirmPassword) {
          alert('새 비밀번호가 일치하지 않습니다.');
          return;
        }
        
        if (newPassword.length < 6) {
          alert('비밀번호는 6자 이상이어야 합니다.');
          return;
        }
        
        // 비밀번호 변경 로직 (실제 구현 시 서버 API 호출)
        alert('비밀번호가 성공적으로 변경되었습니다.');
        
        // 애니메이션과 함께 폼 숨기기
        passwordChangeForm.style.opacity = '0';
        passwordChangeForm.style.transform = 'translateY(-10px)';
        
        setTimeout(() => {
          passwordChangeForm.style.display = 'none';
          // 폼 초기화
          document.getElementById('currentPassword').value = '';
          document.getElementById('newPassword').value = '';
          document.getElementById('confirmPassword').value = '';
        }, 300);
      });

      const avatarInput = document.getElementById('avatarUpload');
      const avatarImg = document.getElementById('drawerAvatar');
      avatarInput?.addEventListener('change', (event)=>{
        const file = event.target?.files && event.target.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = (e)=>{
          if(avatarImg && e.target && typeof e.target.result === 'string'){
            avatarImg.src = e.target.result;
          }
        };
        reader.readAsDataURL(file);
      });

      const logoutBtn = document.querySelector('.logout-btn');
      logoutBtn?.addEventListener('click', ()=>{
        try{ localStorage.clear(); }catch(e){}
        try{ sessionStorage.clear(); }catch(e){}
        window.location.replace('./');
      });
    })();
  </script>

  <!-- 홈 진입시 뜨는 바텀시트 팝업 (메인 팝업 통합) -->
  <style>
    :root{ --scrim: rgba(0,0,0,.45); --popup-w: clamp(320px, 92vw, 640px); }
    .home-scrim{position:fixed; inset:0; background:var(--scrim); backdrop-filter:blur(2px); display:none; z-index:999;}
    .home-scrim.show{display:block;}
    .home-sheet{position:fixed; left:50%; bottom:-100%; transform:translateX(-50%); width:var(--popup-w); background:var(--card); border-radius:24px 24px 0 0; box-shadow:0 12px 40px rgba(0,0,0,.18); z-index:1000; transition:bottom .28s ease-out; overflow:hidden;}
    .home-sheet.show{bottom:0;}
    .home-grid{display:grid; grid-template-columns:repeat(3,1fr); gap:14px; padding:18px 16px 8px;}
    .home-item{display:flex; flex-direction:column; align-items:center; text-decoration:none; color:var(--text); gap:8px; cursor:pointer; transition:all .2s ease;}
    .home-item.selected .home-ico{border-color:#2563eb; background:#eff6ff;}
    .home-item.selected .home-label{color:#2563eb; font-weight:800;}
    .home-ico{width:61px; height:61px; border-radius:14px; overflow:hidden; border:1px solid var(--line); background:transparent; display:grid; place-items:center; transition:all .2s ease;}
    .home-ico img{width:100%; height:100%; object-fit:cover; border-radius:14px;}
    .home-label{font:700 14px/1.2 var(--font); text-align:center;}
    .home-actions{display:flex; gap:10px; padding:10px 16px 8px;}
    .home-btn{display:inline-flex; align-items:center; justify-content:center; gap:8px; min-height:44px; padding:0 16px; border-radius:12px; border:1px solid transparent; font:700 15px/1 var(--font); cursor:pointer; transition: all .3s cubic-bezier(.4,0,.2,1); position:relative; overflow:hidden;}
    .home-btn--navy{background:#1A254F; color:#fff;}
    .home-btn--navy:hover{filter:brightness(.95);}
    .home-btn--gray{background:#fff; color:#99A4BE; border-color:#99A4BE;}
    .home-btn--gray:hover{background:#99A4BE; color:#fff;}
    .home-btn:hover{transform:translateY(-2px); box-shadow:0 4px 12px rgba(0,0,0,.15);} 
    .home-btn:active{transform:translateY(0); box-shadow:0 2px 6px rgba(0,0,0,.2); transition:all .1s ease;}
    .home-btn:focus{outline:none; box-shadow:0 0 0 3px rgba(26,37,79,.3);} 
    .home-btn.clicked{animation:homeButtonRipple .6s ease-out;}
    @keyframes homeButtonRipple{0%{transform:scale(1); box-shadow:0 0 0 0 rgba(26,37,79,.4);}50%{transform:scale(1.02); box-shadow:0 0 0 8px rgba(26,37,79,.1);}100%{transform:scale(1); box-shadow:0 0 0 0 rgba(26,37,79,0);} }
    .home-ripple{position:absolute; border-radius:50%; background:rgba(255,255,255,.35); transform:scale(0); animation:homeRipple .45s ease-out; pointer-events:none;}
    @keyframes homeRipple{to{transform:scale(1); opacity:0;}}
    .home-btn-skip, .home-btn-go{flex:1 1 0;}
    .home-option{display:flex; align-items:center; justify-content:space-between; padding:8px 16px 16px; color:#6b7280; font:600 13px var(--font);} 
    .home-left{display:flex; align-items:center; gap:10px;}
    .home-cbx{appearance:none; width:20px; height:20px; border:2px solid #cbd5e1; border-radius:6px; display:grid; place-items:center; cursor:pointer; background:#fff;}
    .home-cbx:checked{border-color:#2563eb; background:#2563eb; background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M5 10.5l3 3 7-7" fill="none" stroke="%23fff" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"/></svg>'); background-repeat:no-repeat; background-position:center; background-size:14px;}
    .home-close{background:none; border:none; font:600 13px var(--font); color:#2563eb; cursor:pointer;}
    body.modal-open{overflow:hidden;}
  </style>

  <div id="homeScrim" class="home-scrim" aria-hidden="true"></div>
  <aside id="homeSheet" class="home-sheet" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="home-grid">
      <div class="home-item" data-target="worklog.html" aria-label="출력현황">
        <span class="home-ico"><img src="image/출력현황.png" alt="출력현황" referrerpolicy="no-referrer"></span>
        <span class="home-label">출력현황</span>
      </div>
      <div class="home-item" data-target="home.html" aria-label="작업일지">
        <span class="home-ico"><img src="image/작업일지.png" alt="작업일지" referrerpolicy="no-referrer"></span>
        <span class="home-label">작업일지</span>
      </div>
      <div class="home-item" data-target="현장정보.html" aria-label="현장정보">
        <span class="home-ico"><img src="image/현장정보.png" alt="현장정보" referrerpolicy="no-referrer"></span>
        <span class="home-label">현장정보</span>
      </div>
      <div class="home-item" data-target="home.html" aria-label="문서함">
        <span class="home-ico"><img src="image/문서함.png" alt="문서함" referrerpolicy="no-referrer"></span>
        <span class="home-label">문서함</span>
      </div>
      <div class="home-item" data-target="home.html" aria-label="본사요청">
        <span class="home-ico"><img src="image/본사요청.png" alt="본사요청" referrerpolicy="no-referrer"></span>
        <span class="home-label">본사요청</span>
      </div>
      <div class="home-item" data-target="home.html" aria-label="재고관리">
        <span class="home-ico"><img src="image/재고관리.png" alt="재고관리" referrerpolicy="no-referrer"></span>
        <span class="home-label">재고관리</span>
      </div>
    </div>
    <div class="home-actions">
      <button id="homeBtnSkip" class="home-btn home-btn--gray home-btn-skip" type="button">건너뛰기</button>
      <button id="homeBtnGo" class="home-btn home-btn--navy home-btn-go" type="button">바로 가기</button>
    </div>
    <div class="home-option">
      <div class="home-left">
        <input type="checkbox" id="homeDontAgain" class="home-cbx" aria-label="오늘은 그만 보기"/>
        <label for="homeDontAgain">오늘은 그만 보기</label>
      </div>
      <button id="homeBtnClose" class="home-close" type="button">닫기</button>
    </div>
  </aside>

  <script>
    (function(){
      const scrim = document.getElementById('homeScrim');
      const sheet = document.getElementById('homeSheet');
      const btnClose = document.getElementById('homeBtnClose');
      const btnSkip = document.getElementById('homeBtnSkip');
      const btnGo = document.getElementById('homeBtnGo');
      const dont = document.getElementById('homeDontAgain');
      const KEY = 'inopnc_popup_date';
      const today = new Date().toISOString().slice(0,10);
      let selectedTarget = null;

      function lockScroll(lock){ document.body.classList.toggle('modal-open', !!lock); }
      function open(){ scrim.classList.add('show'); sheet.classList.add('show'); sheet.setAttribute('aria-hidden','false'); lockScroll(true); }
      function close(persist){ scrim.classList.remove('show'); sheet.classList.remove('show'); sheet.setAttribute('aria-hidden','true'); lockScroll(false); if(persist){ try{ localStorage.setItem(KEY, today); }catch(e){} } }

      function selectIcon(item){ document.querySelectorAll('.home-item').forEach(el=>el.classList.remove('selected')); item.classList.add('selected'); selectedTarget = item.dataset.target; }
      function addButtonFX(btn){ btn.addEventListener('click', function(e){ this.classList.add('clicked'); setTimeout(()=> this.classList.remove('clicked'), 600); const r=document.createElement('span'); const rect=this.getBoundingClientRect(); const size=Math.max(rect.width, rect.height); r.style.width=r.style.height=size+'px'; r.style.left=(e.clientX-rect.left-size/2)+'px'; r.style.top=(e.clientY-rect.top-size/2)+'px'; r.className='home-ripple'; this.appendChild(r); setTimeout(()=> r.remove(), 450); }); }

      document.querySelectorAll('.home-item').forEach(item=>{ item.addEventListener('click', ()=> selectIcon(item)); });
      [btnClose, scrim].forEach(el=> el.addEventListener('click', ()=> close(dont.checked)));
      btnSkip.addEventListener('click', ()=> close(dont.checked));
      btnGo.addEventListener('click', ()=>{ const target = selectedTarget || 'worklog.html'; window.location.href = target; });
      [btnSkip, btnGo].forEach(addButtonFX);

      document.addEventListener('DOMContentLoaded', function(){ try{ if(localStorage.getItem(KEY)!==today){ open(); } }catch(e){ open(); } });
    })();
  </script>

</body>
</html>

