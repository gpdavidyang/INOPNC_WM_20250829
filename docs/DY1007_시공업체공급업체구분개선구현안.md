# DY1007 · 시공업체(=소속사/파트너사) × 공급업체 구분 및 점진 전환(옵션 A: 별칭 View) 계획

작성일: 2025-10-07
담당: 시스템관리(Administrator) / 인증·계정 도메인

## 1) 목적

- 시공업체(=소속사=파트너사)를 `organizations`로 일원화하고, 공급업체는 `partner_companies`에서 운영하되, 명확한 이름으로 점진 전환(혼선 제거).
- 즉시 테이블명을 바꾸지 않고 “별칭 View”를 먼저 도입해 무중단·저리스크로 코드/문서/테스트를 이행(옵션 A).

## 2) 권장 원칙

- Canonical 엔터티
  - 시공업체(소속사/파트너사): `organizations`
  - 공급업체: `partner_companies`(현행) → 코드/문서 상 표기는 “공급업체”로 통일
- 가입요청/승인/권한은 모두 `organizations` 기준(소속사)에 맞춰 통일

## 3) 옵션 A: 별칭 View 기반 점진 전환(권장)

1. DB에 별칭 View 추가(읽기/쓰기 호환)
   - `CREATE VIEW supplier_companies AS SELECT * FROM partner_companies;`
   - 단순 1:1 컬럼 매핑이면 Postgres 업데이트 가능한 뷰가 되어 INSERT/UPDATE/DELETE도 동작
   - RLS는 원 테이블에 적용되어 그대로 유효
2. 코드 점진 전환
   - 신규/수정 코드부터 `supabase.from('supplier_companies')` 사용 시작
   - 타입/테스트도 ‘supplier_companies’로 대체(필요 시 어댑터 레이어)
3. 충분히 이행 후(선택) 최종 스위치(옵션 B) 검토
   - 모든 경로 이행이 끝나면 실제 rename 고려(아래 참고). 외부 의존이 있으면 호환 뷰 유지 기간 설정

## 4) 옵션 B: 최종 Rename(선택)

1. 실제 변경
   - `ALTER TABLE partner_companies RENAME TO supplier_companies;`
2. 호환 뷰 제공(기존 경로 유지)
   - `CREATE VIEW partner_companies AS SELECT * FROM supplier_companies;`
3. 외부/내부 호출의 전환 완료 후 호환 뷰 제거(옵션)

## 5) 리스크/완화

- 즉시 rename은 코드/타입/테스트/문서/REST 경로까지 광범위 영향 → 별칭 View로 완화
- RLS/정책/함수/뷰 의존성: rename 시 안전하나 이름 하드코딩된 뷰/함수는 수정 필요 → 점검 체크리스트로 관리

## 6) 실행 계획(권장)

- Phase A(0.5~1d)
  - DB: `supplier_companies` View 생성
  - 코드: 신규 모듈/화면부터 `supplier_companies` 사용하도록 전환(어댑터 작성 가능)
- Phase B(1~2d)
  - 점진 이행: 기존 쿼리/테스트/문서 교체
  - 외부 연동 경로도 문서로 공지(읽기 위주라면 영향 적음)
- Phase C(선택)
  - rename + 호환 뷰 제공 → 외부 의존도 낮고 내부 전환이 끝난 뒤 수행

## 7) 비고

- 사용자-facing 용어는 즉시 “공급업체”로 통일 가능(UI/문서 교체). DB는 뷰로 가려 리스크 최소화.
- 장기적으로 company_type 제약/검증 강화 및 협력 시공사(subcontractor) 정책 분리 권장.
