# DY0928 급여 계산 정책/UX 개선 설계

## 목표

- 일용직/프리랜서의 기본 원천징수(3.3%)를 정확히 반영하고, 상용직은 4대보험을 적용.
- 개인별 세율(본사/시스템관리자가 입력)을 최우선으로 사용하여 계산 일관성 확보.
- 모바일(명세서/급여현황)과 관리자 도구의 계산 결과가 1:1로 일치.

## 데이터 원천과 우선순위

1. `worker_salary_settings` (개인별 설정, is_active=true, effective_date<=기준일)
   - `employment_type`: 'freelancer' | 'daily_worker' | 'regular_employee'
   - `daily_rate`: 일급(원)
   - `custom_tax_rates` (JSON, %):
     - `income_tax`, `local_tax`, `national_pension`, `health_insurance`, `employment_insurance`
2. `salary_info` (레거시) – 상기 1) 부재 시 폴백
3. `employment_tax_rates` (고용형태별 기본 세율)

## 계산 정책(요약)

- 공통: 1공수=8시간, 기본시급=일급/8, 연장시급=기본시급×1.5
- 프리랜서/일용직:
  - 기본: 소득세 3% + 지방소득세 0.3% (=3.3%)만 공제, 4대보험 미적용
  - 개인별 `custom_tax_rates`가 있으면 해당 %로 덮어씀
- 상용직(4대보험):
  - `employment_tax_rates` 값으로 계산 (미존재 시 기본치 4.5/3.43/0.9 + 소득세 8% 가드)
  - 개인별 `custom_tax_rates`가 있으면 해당 %로 덮어씀

## 월 집계 로직 보강

- labor_hours가 비어 있고 work_hours만 있는 레코드를 자동 해석(labor=work_hours/8)
- status가 출근 계열(present/late/in-progress/working/checked_in/checked-out/checkedout/done) 이거나 check_in/out이 있으면 1공수(8h) 보정

## API/서비스 변경

- `lib/services/salary-calculation.service.ts`
  - getSalaryInfo: `worker_salary_settings` 우선 조회 → `salary_info` 폴백, `custom_tax_rates` 반환
  - calculateTaxDeductions(gross, type, customRates?) :
    - customRates 우선 → 프리/일용=3.3%, 상용=employment_tax_rates
- `app/api/salary/monthly`
  - 스냅샷 우선 → 서비스롤 월 계산 폴백
  - employment_type/daily_rate는 worker_salary_settings 우선
  - `debug=1`로 집계 검증용 합계 제공

## 모바일 UX

- 명세서: 간결(성명/현장/고용형태 + 근무일/공수/일당 + 지급/공제/실지급). 4대보험 항목은 금액>0일 때만 노출
- ‘세율 출처’ 배지: 개인설정/형태기본을 툴팁으로 제공(스냅샷 배지 옆)

## QA 체크리스트

- 개인설정이 있는/없는 케이스 비교(프리/일용/상용)
- labor_hours=0, work_hours>0, status만 있는 경우 보정 동작
- 관리자 도구의 금액과 모바일 명세서 금액 일치

## 롤아웃

- Phase 1: 서비스/라우트 반영(완료)
- Phase 2: 모바일 배지/툴팁 추가(선택)
