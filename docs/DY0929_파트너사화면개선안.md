# 파트너사 모바일 화면 - 구현 현황과 보완 항목 (DY0929)

본 문서는 파트너사 관리자 전용 모바일 홈 화면(`/mobile/partner`)을 최근 제시된 레퍼런스 HTML(`dy_memo/new_image_html_v3.0/inopnc-page/public/raw/p-main.html`)과 대조하여, 현재 구현 범위와 미비점 및 보완 계획을 정리한 문서입니다.

## 1) 기준 파일

- 디자인 기준: `dy_memo/new_image_html_v3.0/inopnc-page/public/raw/p-main.html`
  - 핵심 요소: 주간 캘린더 리본(요일/날짜), "오늘의 현장" 헤더/전체보기, 현장 상태 배지, 상세 정보 섹션(담당자/주소/작업 정보/업로드 등), 톤앤매너(폰트/컬러/여백)
- 실제 구현 소스(주요 경로):
  - 파트너 홈: `modules/mobile/components/partner/PartnerHomePage.tsx:1`
  - 파트너 셸/하단탭: `modules/mobile/components/layout/PartnerMobileLayout.tsx:1`, `modules/mobile/components/layout/PartnerBottomNav.tsx:1`
  - 작업일지(파트너 뷰): `modules/mobile/pages/partner/PartnerWorklogPage.tsx:1` (+ 상세/썸네일/라이트박스)
  - 현장정보(파트너 뷰): `modules/mobile/pages/partner/PartnerSitesPage.tsx:1`
  - 인증/진입: `app/mobile/partner/layout.tsx:1`, `lib/auth/ultra-simple.ts:11`, `app/dashboard/page.tsx:9`
  - 파트너 전용 API: `app/api/partner/labor/summary/route.ts:1`, `app/api/partner/labor/by-site/route.ts:1`, `app/api/partner/daily-reports/route.ts:1`, `app/api/partner/daily-reports/[id]/route.ts:1`

## 2) 현재 구현된 항목 (완료)

- 라우팅/역할 기반 진입
  - `customer_manager`/`partner` 로그인 시 `/mobile/partner`로 진입하도록 UI 트랙 일원화
  - 미들웨어 및 가드 기반 보호(캐시 무효화/역할 체크)

- 파트너 홈 v1 (요약 KPI + 빠른 이동)
  - 기간 탭(일/주/월)과 KPI 카드: 담당 현장 수/활성, 총 공수/연장, 일평균/근무일
  - 추가 KPI: 승인 대기(기간 반영), 금일 제출(당일 집계)
  - 빠른 이동 링크: 작업일지(필터), 출력정보, 현장정보, 문서함

- 작업일지(읽기 전용)
  - 필터: 기간(일/주/월), 현장, 상태(승인/임시/제출/완료) + “승인 대기(제출/완료 집계)” 지원
  - 상세 인라인 뷰: 위치/작업내용/작업자/자재/첨부(썸네일/라이트박스/다음/이전 탐색)
  - 파트너 제한: 데이터는 파트너 매핑 현장으로 자동 제한되는 API 사용

- 현장정보(읽기 전용)
  - 파트너 현장 목록: 상태/최근 작업일/작업일수 + 총 공수/일평균 칩
  - 퀵 링크: 작업일지 보기(해당 현장으로 필터), 승인 대기 바로보기, 문서함 진입

- 출력정보(Attendance)
  - 파트너 역할일 때 전체 현장 조회를 스킵하고 파트너 매핑 현장만 노출/필터

## 3) 레퍼런스(p-main.html) 대비 미흡/미구현 항목

- 홈 상단 주간 캘린더 리본(요일/날짜/선택 상태)
  - 요소: `.calendar-header`, `.week-days`, `.week-dates`, `.date-item(.today/.active)`
  - 현재: 기간 탭(KPI 기준)만 있고 주간 캘린더형 UI 및 날짜별 현장/공수 인디케이터 미구현

- “오늘의 현장” 헤더/전체보기 및 일자 단위 현장 Summary 섹션
  - 디자인의 날짜 선택에 따른 현장 목록 스냅샷(예: 작업일/공수/진척)을 홈에서 바로 제공해야 함
  - 현재: 홈에 KPI/링크는 있으나 날짜별 현장 스냅샷/전체보기 흐름 미구현

- 현장 상태 배지/정보 카드 스타일
  - 요소: `.site-status`, hover/active 효과, 색상 규칙
  - 현재: 파트너 현장 목록에 기본 칩은 있으나, 디자인의 정교한 배지 톤/효과를 반영하지 않음

- 상세 정보 구조(연락처/주소/작업 정보/업로드 블록)
  - 요소: `.contact-section`, `.address-section`, `.work-info-section`, `.upload-section` 등 세부 그리드/구분선/버튼(T맵/복사) 포함
  - 현재: 파트너 목록/상세는 요약 수준이며, 홈에서의 심층 상세 패널/행동 버튼은 미구현

- 검색/전체보기/내보내기 유틸리티
  - `view-all-link`, 상단 검색 입력(`.search-input-new`) 등 홈에서 바로 조작하는 검색/정렬/전체보기 패턴 미구현

- 톤앤매너/다크모드 일치
  - CSS 변수/폰트/여백/상호작용 효과(hover/active)까지 디자인과 1:1 매칭되지 않음
  - 현재는 Tailwind + 간단한 인라인 스타일/컴포넌트 조합으로 근사치만 제공

## 4) 데이터 매핑 제안(주요 컴포넌트별)

- 주간 캘린더 리본(홈)
  - 데이터: `daily_reports` 또는 `work_records`에서 기간 내 날짜별 공수/작업 유무 집계
  - 상호작용: 날짜 클릭 시 홈 하단 “오늘의 현장” 섹션을 해당 날짜 기준으로 필터

- 오늘의 현장 섹션(홈)
  - 데이터: `/api/partner/labor/by-site?period=daily` 변형(특정 work_date 파라미터 추가)
  - 카드: 현장명/상태/최근일/당일 공수/첨부 수, 작업일지로 이동 버튼

- 현장 상태 배지
  - 데이터: `partner_site_mappings`의 is_active + `sites.status`/공기(end_date)로 상태 도출(active/in_progress/completed 등)

- 연락처/주소
  - 데이터: `site_assignments` + `profiles`(site_manager) 매칭, `sites.address` 또는 주소 테이블 사용
  - 기능: T맵/주소복사 버튼 제공(외부 링크/클립보드)

## 5) 보완 계획(우선순위)

1. 홈 주간 캘린더 리본 구현(디자인 일치)
   - 컴포넌트: `PartnerHomeCalendar`(신규) → 상단 삽입
   - 기능: 주/좌우이동/오늘 강조/선택 반영, 날짜별 site count/공수 마커

2. 오늘의 현장 목록(선택 날짜 기반) + 전체보기 링크
   - 컴포넌트: `PartnerHomeDailySites`(신규)
   - 데이터: by-site API에 `date` 파라미터 추가 또는 전용 `/api/partner/labor/by-date` 구현

3. 디자인 톤 매칭 CSS 토큰 레이어 추가
   - `modules/mobile/styles/partner.css`에서 p-main의 변수/여백/호버/다크모드 규칙 정리
   - 기존 Tailwind 클래스 위에 최소한의 레이어만 적용

4. 현장 상태 배지/카드 확장
   - 현재 칩 → 색상/효과/아이콘 추가, 상태별 정렬/필터 제공

5. 상세 정보 패널 최소 버전(홈에서 펼침)
   - 연락처/주소/작업 정보 요약 + 행동 버튼(T맵/복사)
   - 추후 업로드/문서 바로가기 연동(문서함 개편 시점과 맞춤)

6. 접근성/성능 정리
   - 키보드 포커스/라이트박스 탐색 개선, 이미지 LQIP/지연 로딩, API 캐시 no-store 유지

## 6) 구현 범위 대조표(요약)

- 홈 KPI/기간 탭/빠른 이동: 구현됨
- 승인 대기/금일 제출 KPI: 구현됨(기간/당일)
- 주간 캘린더 리본: 미구현 → 1차 보완 대상
- 오늘의 현장(일자별 현장 스냅샷): 미구현 → 1차 보완 대상
- 상태 배지/디자인 효과: 근사 구현(칩) → 2차 강화 대상
- 상세 정보 패널(연락처/주소/작업/업로드): 미구현 → 2~3차 보완 대상
- 다크모드/톤앤매너(세부): 부분 적용 → 2차 보완 대상

## 7) 일정(제안)

- D+1: 홈 캘린더 리본 + 오늘의 현장 섹션 기본 데이터 연결
- D+2: 상태 배지/카드 효과/정렬 + 상세 패널 v1(연락처/주소)
- D+3: 스타일 토큰/다크모드 정합 + QA/접근성 개선

---

메뉴 구조는 현장관리자와 동일 트랙을 유지하되, 파트너 전용 홈에서 일자 기반의 즉시 현장 파악/진입을 강화하는 방향으로 정리했습니다. 위 우선순위에 따라 단계적으로 반영하고, 완료 시 이 문서를 갱신하겠습니다.
