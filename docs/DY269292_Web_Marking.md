# [DY269292] 본사 도면마킹 관리 시스템 개편 및 리팩토링 보고서

## 1. 개요

본사 관리자용 "도면마킹 관리" 페이지를 현장 중심의 인터페이스로 전면 개편했습니다. 기존의 단순 문서 나열 방식에서 벗어나, 모바일 현장 관리자의 핵심 워크플로우(작업일지 기반 도면 관리)를 웹 환경에 최적화하여 구현했습니다.

- **작업 일시**: 2026-02-02
- **주요 목적**: 본사 관리자의 도면 검토 효율성 증대 및 현장-본사 간 데이터 정렬

## 2. 주요 변경 사항

### 2.1 워크플로우 전환: 문서 중심 → 작업일지(Worklog) 중심

기존에는 생성된 마킹 문서들을 단순히 리스트 형태로 보여주었으나, 리팩토링 후에는 **작업일지를 먼저 선택**하고 해당 작업 범위에 속한 도면들을 관리하는 방식으로 변경되었습니다.

- **이점**: 특정 공정(부재, 작업유형)과 연결된 도면을 즉시 파악 가능하여 데이터의 맥락(Context) 유지 가능.

### 2.2 UI/UX 혁신: 2분할 대시보드 및 통합 3탭 시스템

사용자가 화면 전환 없이 모든 작업을 수행할 수 있도록 고성능 대시보드 구조를 채택했습니다.

- **좌측 패널 (일지 목록)**:
  - 현장, 문서 상태, 키워드 검색 필터 적용.
  - 일지별 실시간 연동 도면 개수 표시.
  - 무한 스크롤 및 페이지네이션 지원.
- **우측 패널 (도면 관리 영역)**:
  - **[업로드 된 도면] 탭**: 연동된 도면의 프리미엄 그리드 뷰, 확대 보기(Lightbox), 연결 해제(Unlink).
  - **[새 도면 업로드] 탭**: PDF/이미지 기반 기초 도면 업로드 및 일지 자동 연동.
  - **[도면 마킹 도구] 탭**: `SharedMarkupEditor` 통합을 통해 원본 도면 선택 후 즉시 마킹 및 저장.

### 2.3 기술적 스택 및 최적화

- **프론트엔드**: React, Next.js, TailwindCSS 기반의 프리미엄 테마 적용.
- **컴포넌트 구조**:
  - `AdminDrawingManagementContent.tsx`: 메인 클라이언트 상태 관리 및 레이아웃.
  - `DrawingListTab`, `DrawingUploadTab`, `DrawingMarkupTab`: 기능별 모듈화.
- **상태 관리**: URL SearchParams를 이용한 필터 상태 유지(뒤로 가기, 새로고침 대응).
- **디자인 시스템**: Lucide 아이콘, 고대비 타이포그래피, 모던한 그림자 효과 및 미세 애니메이션 적용.

## 3. 구현 상세 (Technical Details)

### 3.1 API 통합

- **도면 조회**: `/api/docs/drawings?worklog_id={id}` 를 통해 통합 문서 시스템(UDS)과 공유 문서함 데이터를 동시에 크로스 체크.
- **마킹 저장**: `/api/docs/drawings/markups/save` 를 호출하여 마킹 데이터를 저장하고, 동시에 UDS 상에 '진행도면'으로 자동 등록하여 시각적 확인 가능케 함.
- **연결 해제**: 문서 자체를 삭제하지 않고 작업일지와의 관계만 끊는 `unlink` 로직 구현으로 데이터 유실 방지.

### 3.2 데이터 동기화

- 모바일에서 업로드한 도면이 본사 웹에 즉시 반영되도록 실시간 데이터 페칭 로직 적용.
- 도면 개수(all-counts) API를 사용하여 목록에서 직관적으로 데이터 유무 확인 가능.

## 4. 기대 효과

1. **관리 효율성**: 본사 관리자가 현장의 작업 내용을 도면과 대조하며 검토하는 시간을 50% 이상 단축.
2. **협업 강화**: 현장 직원이 올린 도면에 본사 직원이 직접 마킹하여 수정 사항을 전달하는 양방향 소통 구조 확립.
3. **데이터 표준화**: 현장(모바일)과 본사(웹)가 동일한 문서 카테고리(`plan`, `progress`, `markup`)를 공유함으로써 데이터 파편화 방지.

## 5. 향후 계획

- 도면 내 텍스트 검색(OCR) 기능 추가 검토.
- 마킹 데이터의 리비전(버전 관리) 시스템 고도화.
