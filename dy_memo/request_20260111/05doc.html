<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>문서함 - INOPNC</title>

    <link
      rel="stylesheet"
      as="style"
      crossorigin
      href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css"
    />
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <link rel="stylesheet" href="05doc.css" />
  </head>

  <body>
    <div class="app">
      <!-- 탭 바 (상단 고정) -->
      <div class="tab-bar">
        <button class="tab-button active" data-tab="my-docs">내문서함</button>
        <button class="tab-button" data-tab="company-docs">회사서류</button>
        <button class="tab-button" data-tab="drawings">도면함</button>
        <button class="tab-button" data-tab="photos">사진함</button>
      </div>
    </div>

    <!-- 메인 컨텐츠 -->
    <div class="main-content">
      <!-- 현장 검색 (펀치 탭만) -->
      <div id="siteSearchWrapper" class="search-wrapper" style="position: relative">
        <input
          type="text"
          class="search-input"
          id="siteSearchInput"
          placeholder="현장 선택 또는 검색"
          style="padding-right: 80px"
        />
        <button class="clear-button" id="siteClearButton">
          <i data-lucide="x" class="icon-sm"></i>
        </button>
        <button
          onclick="toggleSiteDropdownList()"
          style="
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
          "
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="#475569"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="m6 9 6 6 6-6"></path>
          </svg>
        </button>
        <ul id="siteDropdown" class="site-dropdown-list" style="display: none"></ul>
      </div>

      <!-- 메인 검색 -->
      <div class="search-wrapper">
        <input type="text" class="search-input" id="mainSearchInput" placeholder="현장명 검색..." />
        <button class="clear-button" id="mainClearButton">
          <i data-lucide="x" class="icon-sm"></i>
        </button>
        <i data-lucide="search" class="search-icon" id="mainSearchIcon"></i>
      </div>

      <!-- 펀치 요약 (펀치 탭만) -->
      <div id="punchSummary" class="punch-summary">
        <button class="punch-filter-btn all active" data-filter="all">
          전체 <span id="punchTotalCount">0</span>
        </button>
        <button class="punch-filter-btn open" data-filter="open">
          미조치 <span id="punchOpenCount">0</span>
        </button>
        <button class="punch-filter-btn done" data-filter="done">
          완료 <span id="punchDoneCount">0</span>
        </button>
      </div>

      <!-- 문서 리스트 -->
      <div id="documentList"></div>

      <!-- 빈 상태 -->
      <div id="emptyState" class="empty-state hidden">
        <div class="empty-icon">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
            stroke="var(--text-sub)"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
            <line x1="8" y1="11" x2="14" y2="11"></line>
          </svg>
        </div>
        <p class="empty-text">검색 결과가 없습니다</p>
      </div>

      <!-- 더보기 버튼 -->
      <div id="loadMoreButton" class="toggle-btn-area hidden">
        <span>더보기</span>
        <i data-lucide="chevron-down" class="chevron-icon"></i>
      </div>

      <!-- 접기 버튼 -->
      <div id="collapseButton" class="toggle-btn-area hidden">
        <span>접기</span>
        <i data-lucide="chevron-up" class="chevron-icon rotated"></i>
      </div>
    </div>

    <!-- FAB 버튼 -->
    <button id="fabButton" class="fab-button">
      <i data-lucide="plus" class="icon-32"></i>
    </button>

    <!-- 배치 액션 바 -->
    <div id="batchBar" class="batch-bar">
      <button class="batch-action" id="batchDownload">
        <i data-lucide="download" class="icon-2xl"></i>
        <span>저장</span>
      </button>
      <button class="batch-action" id="batchEdit" style="display: none">
        <i data-lucide="edit-2" class="icon-2xl"></i>
        <span>수정</span>
      </button>
      <button class="batch-action" id="batchDownload">
        <i data-lucide="download" class="icon-2xl"></i>
        <span>다운로드</span>
      </button>
      <button class="batch-action" id="batchShare">
        <i data-lucide="share-2" class="icon-2xl"></i>
        <span>공유</span>
      </button>
      <button class="batch-action delete" id="batchDelete">
        <i data-lucide="trash-2" class="icon-2xl stroke-bold"></i>
        <span>삭제</span>
      </button>
    </div>

    <!-- 상세 화면 오버레이 -->
    <div id="detailOverlay" class="detail-overlay">
      <div class="detail-header">
        <div class="detail-header-inner">
          <button class="back-button" id="backButton">
            <i data-lucide="arrow-left" class="icon-2xl"></i>
            <span>이전</span>
          </button>
          <h2 class="detail-title" id="detailTitle">상세보기</h2>
          <div class="width-64">
            <button class="report-button hidden" id="reportButton">보고서</button>
          </div>
        </div>
      </div>
      <div class="detail-content">
        <div class="detail-content-inner" id="detailContentInner">
          <!-- 동적 콘텐츠 -->
        </div>
      </div>
    </div>

    <!-- 업로드 바텀 시트 -->
    <div class="bottom-sheet-overlay" id="uploadSheetOverlay"></div>
    <div class="bottom-sheet" id="uploadSheet">
      <div class="sheet-header">
        <h3 class="sheet-title">자료 등록</h3>
        <button class="close-button" id="closeUploadSheet">
          <i data-lucide="x" class="icon-2xl"></i>
        </button>
      </div>

      <div class="form-group">
        <label class="form-label" id="uploadTitleLabel" style="font-size: 15px; font-weight: 600"
          >문서명</label
        >
        <div style="position: relative">
          <input
            type="text"
            class="form-input"
            id="uploadTitleInput"
            placeholder="현장명을 입력하세요"
          />
          <ul id="uploadSiteDropdown" class="site-dropdown-list" style="display: none"></ul>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label" id="uploadDateLabel" style="font-size: 15px; font-weight: 600"
          >등록일</label
        >
        <input type="date" class="form-input" id="uploadDateInput" />
        <select
          class="form-select hidden"
          id="uploadWorklogInput"
          style="
            width: 100%;
            height: 48px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 15px;
            padding: 0 12px;
            background: white;
          "
        >
          <option value="wd1">25.12.08 | 송파 B현장 | 슬라브/균열/지하</option>
          <option value="wd2">25.12.09 | 송파 B현장 | 철근 배근 검측</option>
          <option value="wd3">25.12.10 | 송파 A현장 | 기초 타설 전 검측</option>
        </select>
      </div>

      <div class="upload-area" id="uploadArea">
        <i data-lucide="upload-cloud" class="icon-2xl icon-sub"></i>
        <span class="upload-label">파일 선택 (다중 가능)</span>
        <input
          type="file"
          multiple
          id="uploadFileInput"
          class="hidden"
          accept="image/*,.pdf,.hwp,.doc,.docx"
        />
      </div>

      <div class="sheet-actions">
        <button class="btn-sheet-cancel" id="cancelUpload">취소</button>
        <button class="btn-sheet-submit" id="submitUpload">등록하기</button>
      </div>
    </div>

    <!-- 이미지 미리보기 모달 - 보고서 에디터와 동일한 UI 적용 -->
    <div class="preview-modal" id="previewModal">
      <div class="preview-editor">
        <!-- Header -->
        <header class="preview-header">
          <button class="preview-close-btn" id="closePreview">
            <i data-lucide="x" class="icon-2xl"></i>
          </button>
          <div class="preview-title">
            <div class="preview-title-main" id="previewTitleMain">이미지 미리보기</div>
            <div class="preview-title-sub" id="previewTitleSub">이미지 보기</div>
          </div>
        </header>

        <!-- Viewport -->
        <div class="preview-viewport" id="previewViewport">
          <div class="preview-content" id="previewContent">
            <img id="previewImage" class="preview-image" alt="Preview" />
          </div>
        </div>

        <!-- Controls -->
        <div class="preview-controls">
          <button class="preview-control-btn" id="previewZoomOut">
            <i data-lucide="minus"></i>
            <span>축소</span>
          </button>
          <button class="preview-control-btn" id="previewTogglePan">
            <i data-lucide="hand"></i>
            <span>이동</span>
          </button>
          <button class="preview-control-btn" id="previewZoomIn">
            <i data-lucide="plus"></i>
            <span>확대</span>
          </button>
        </div>
      </div>
    </div>

    <!-- 숨겨진 파일 입력 -->
    <input type="file" id="photoBeforeInput" class="hidden" accept="image/*" />
    <input type="file" id="photoAfterInput" class="hidden" accept="image/*" />
    <input
      type="file"
      id="myDocsQuickFileInput"
      class="hidden"
      accept="image/*,.pdf,.hwp,.doc,.docx"
    />

    <!-- 보고서 에디터 모달 -->
    <div class="report-editor-overlay hidden" id="reportEditorOverlay">
      <div class="report-editor">
        <!-- Header -->
        <header class="report-header">
          <button class="report-close-btn" id="closeReportEditor">
            <i data-lucide="x" class="icon-2xl"></i>
          </button>
          <div class="report-title">
            <div class="report-title-main" id="reportSiteName">현장 보고서</div>
            <div class="report-title-sub">PDF 저장 및 미리보기</div>
          </div>
          <button class="report-download-btn" id="downloadReport" title="PDF 저장">
            <i data-lucide="download" style="width: 24px; height: 24px; color: white"></i>
          </button>
        </header>

        <!-- Viewport -->
        <div class="report-viewport" id="reportViewport">
          <div class="report-content" id="reportContent">
            <h1 class="report-content-title">조치 사항 점검 보고서</h1>
            <div class="report-info-row">
              <span>현장명: <strong id="reportInfoSiteName"></strong></span>
              <span>작성일: <strong id="reportInfoDate"></strong></span>
            </div>
            <table class="report-table">
              <thead>
                <tr>
                  <th style="width: 40px">NO</th>
                  <th style="width: 90px">위치</th>
                  <th>지적 내용</th>
                  <th style="width: 120px">조치전</th>
                  <th style="width: 120px">조치후</th>
                  <th style="width: 75px">상태</th>
                </tr>
              </thead>
              <tbody id="reportTableBody">
                <!-- 동적 콘텐츠 -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- Controls -->
        <div class="report-controls">
          <button class="report-control-btn" id="zoomOut">
            <i data-lucide="minus"></i>
            <span>축소</span>
          </button>
          <button class="report-control-btn" id="togglePan">
            <i data-lucide="hand"></i>
            <span>이동</span>
          </button>
          <button class="report-control-btn" id="zoomIn">
            <i data-lucide="plus"></i>
            <span>확대</span>
          </button>
          <button class="report-control-btn" id="shareReportControl">
            <i data-lucide="share-2"></i>
            <span>공유</span>
          </button>
        </div>
      </div>
    </div>

    <script src="05doc.js"></script>
  </body>
</html>
