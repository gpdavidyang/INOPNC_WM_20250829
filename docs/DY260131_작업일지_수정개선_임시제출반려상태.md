# DY260131 – 작업일지 수정 경로 개선 (임시/제출/반려)

## 1. 요구사항 요약

- 작업일지 상태 값은 `draft(임시)`, `submitted(제출)`, `approved(승인)`, `rejected(반려)` 총 4가지.
- **임시/제출/반려** 상태에서는 작성자(모바일)와 본사 관리자(데스크톱) 모두 동일한 편집 화면으로 접근해 수정할 수 있어야 한다.
- 현재 임시 상태는 “계속 작성” 버튼이 있으나 제출/반려 상태에는 편집 진입 경로가 없어 UX가 막혀 있음.
- 승인 상태만 편집을 제한하고, 나머지 상태는 저장 및 재제출이 가능해야 한다.

## 2. 화면별 개선 포인트

### 2.1 모바일 (작업자/현장관리자)

- 작업일지 상세 및 알림 모달(`WorkLogDetailModal`, `WorkLogModal`, `DailyReportDetail` 등)을 확인하여 상태별 CTA 조건을 업데이트.
  - `status ∈ {draft, submitted, rejected}` → “수정하기” 버튼 노출, edit 모드의 `WorkLogModal`로 이동.
  - 반려 상태의 경우 반려 사유 설명 바로 옆에 “수정 후 재제출” 버튼을 두어 재작성을 유도.
- 저장 시 `status`를 그대로 유지할지(예: 제출 상태에서 일부 수정 후 다시 제출) 혹은 임시로 되돌려 재제출하도록 안내할지 정책 정의 후 구현.

### 2.2 본사 관리자 (데스크톱)

- `DailyReportDetailClient` 상단 또는 header action에 “작업일지 수정” 버튼을 상태 조건 기반으로 노출.
  - 기존 `/dashboard/admin/daily-reports/[id]/edit` 페이지 재사용.
  - `status ∈ {draft, submitted, rejected}`일 때만 버튼 활성화, `approved`는 비활성 or 숨김.
- 목록(`DailyReportsTable`)에서도 동일 조건으로 row action 버튼을 노출해도 됨(추가 옵션).

## 3. 서버/API 체크

- `/api/admin/daily-reports/[id] (PATCH)` 및 모바일 `/api/mobile/daily-reports/[id]`에서 `status`별 수정 허용 범위 확인.
  - 현재 임시 상태만 허용하는 로직이 있는지, 제출/반려 상태에서도 `PATCH`가 가능하도록 policy 보완.
  - 수정 시 자동으로 `status`를 `draft`로 내리는지 여부 확인 후 명시적인 필드 업데이트 로직 정리.

## 4. 구현 순서

1. **상태/권한 조건 정리**: UI에서 어떤 역할이 언제 수정 버튼을 볼 수 있는지 표로 정리.
2. **모바일 CTA 추가**: 작업일지 상세/알림 모달에 상태별 “수정하기” 버튼을 추가하고 edit 모드 `WorkLogModal`로 연결.
3. **관리자 CTA 추가**: `DailyReportDetailClient`에 수정 버튼 노출 조건을 추가하고 `/edit` 페이지로 링크.
4. **API 권한 확인**: 제출/반려 상태에서도 `PATCH`가 허용되도록 서버 로직 확인/보완.
5. **QA**: 상태별 시나리오(임시→수정, 제출→수정, 반려→수정, 승인→비허용)를 모바일/데스크톱 각각에서 테스트.

## 5. 후속 고려사항

- 제출 상태 수정 시 자동으로 `draft`로 전환할지, “재제출” 버튼을 별도로 둘지에 대한 정책 확정.
- 반려 사유를 저장/표시하는 위치 정리(수정화면 상단 안내 등).
- 관리자와 모바일 간 동기화(예: 관리자가 수정 후 저장하면 상태가 어떻게 변하는지)에 대한 명시적인 UX 메시지 필요 시 추가.
