# DY1008: 필수서류 관리 통합 구현 계획안

작성일: 2025-10-08  
담당: 시스템관리자 화면 개편

## 1) 목적

- 관리자 메뉴의 “필수서류 설정”과 “필수서류 제출현황”을 “필수서류 관리” 단일 화면으로 통합하여, 설정·현황을 한 곳에서 관리한다.
- 중복된 네비/페이지/데이터 흐름을 정리해 유지보수 혼선을 줄이고, 확장성(오버뷰·통계·내보내기)을 강화한다.

## 2) 범위

- 관리자 대시보드 내 필수서류 관련 메뉴/페이지/컴포넌트/간단한 API 조정
- 라벨/브레드크럼, 리디렉션, 요약 카드(통계) 추가
- 데이터 모델 변경은 없음(필요 시 후속 단계 제안)

## 3) 현황 요약(레거시)

- 제출현황(페이지)
  - 경로: `app/dashboard/admin/documents/required/page.tsx`
  - 테이블: `components/admin/RequiredDocumentsTable.tsx`
  - API: `app/api/admin/documents/required/route.ts`
- 설정(유형/매핑)
  - 목록: `app/dashboard/admin/document-requirements/page.tsx`
  - 상세: `app/dashboard/admin/document-requirements/[id]/page.tsx`
  - 테이블: `components/admin/DocumentRequirementsTable.tsx`
  - API: `app/api/admin/required-document-types/*`

## 4) 목표/원칙

- 단일 메뉴: “필수서류 관리” 1개만 좌측 네비에 노출
- 단일 화면: 제출현황/설정 2개 탭으로 구성(초기 탭=제출현황)
- 기존 상세 페이지는 링크로 그대로 진입(역할/현장 매핑 편집 포함)
- 리디렉션으로 외부/내부 기존 링크 연속성 보장

## 5) 정보 구조(IA)

- 메뉴: ‘필수서류 관리’ (경로: `/dashboard/admin/documents/required`)
- 탭 구성
  - 탭1: 제출현황(기본) — 검색/필터/승인/반려/내보내기
  - 탭2: 설정(유형) — 유형 CRUD, 활성/비활성, 상세로 이동(역할/현장 매핑 관리)
- 브레드크럼: 대시보드 > 문서 관리 > 필수서류 관리

## 6) UI/UX 구성

- 상단 요약 카드(선택): 총 제출 수, 승인/대기/반려, 미제출(경고) 수
- 제출현황 탭
  - 필터: 검색어, 유형, 역할, 현장, 상태, 기간
  - 목록: 제출일/문서명/유형/제출자/상태/액션(보기·승인·반려)
  - 내보내기: CSV/엑셀
- 설정 탭
  - 유형 테이블: 코드/이름/허용 확장자/최대 크기/활성/정렬/생성일
  - 액션: 유형 추가·수정, 활성/비활성
  - 상세 페이지 링크: 유형 클릭 시 `app/dashboard/admin/document-requirements/[id]/page.tsx`

## 7) 라우팅/네비게이션

- 네비 통합(필수)
  - 파일: `components/admin/AdminDashboardLayout.tsx`
  - 변경: ‘필수서류 설정’·‘필수서류 제출현황’ 메뉴 제거 → ‘필수서류 관리’ 1개 유지(`href: /dashboard/admin/documents/required`)
- 리디렉션(권장)
  - `/dashboard/admin/document-requirements` → `/dashboard/admin/documents/required?tab=settings`
  - 방법 예시: `app/dashboard/admin/document-requirements/page.tsx`를 서버컴포넌트 리디렉션로 대체

## 8) 페이지 통합 방식(구현)

- 기준 페이지: `app/dashboard/admin/documents/required/page.tsx`
- 탭 추가(SSR 초기 데이터 로드 유지)
  - 탭1(제출현황): 기존 `RequiredDocumentsTable` 배치, 기존 API 그대로 사용
  - 탭2(설정): `DocumentRequirementsTable` 배치, 기존 타입 목록 쿼리 그대로 사용
- 상세는 기존 경로 유지(설정 탭에서 링크 이동)

## 9) API 계획

- 1단계(빠른 통합)
  - 제출현황: `GET /api/admin/documents/required` 유지
  - 설정(유형): `GET /api/admin/required-document-types` 유지
- 2단계(확장/일원화, 선택)
  - 오버뷰 API: `GET /api/admin/required-docs/overview` (요약 카드용)
  - 제출 목록 v2: `GET /api/admin/required-docs/submissions` (필터/페이지 최적화)
  - 유형/매핑 v2: `GET/POST /api/admin/required-docs/types` 등

## 10) 데이터/권한

- 테이블: `required_document_types`, `required_documents_by_role`, `site_required_documents`(+ 제출 데이터 소스)
- 권한: admin/system_admin 전체 접근, 제한 계정 접근 불가(현 정책 유지) 또는 읽기 전용(선택 정책)
- RLS 점검: 관리자 경로의 서버 호출에서 권한 오류 없도록 정책/서비스 클라이언트 고려

## 11) 점진 적용 순서

1. 네비 통합: 좌측 메뉴 정리(중복 메뉴 제거)
2. 페이지 통합: `/documents/required`에 탭 추가(현황/설정)
3. 리디렉션: `/document-requirements` → `.../required?tab=settings`
4. 요약 카드: 현황 API에 통계 합산 또는 오버뷰 API 도입
5. QA: 필터/페이지네이션/탭 URL 동기화(`?tab=...`) 확인
6. (선택) API v2 단계적 도입 및 성능 개선

## 12) 성능/UX 가이드

- 서버컴포넌트에서 초기 데이터 로드(SSR) + 탭 전환 시 필요한 데이터만 클라이언트 페치
- 목록 요청 인덱스/페이지네이션 적용(유형/상태/날짜)
- 내보내기는 서버 측 스트리밍/파일 생성 API 권장

## 13) 이관/호환

- 기존 링크/북마크는 리디렉션으로 연속성 보장
- 문구 일관화: ‘필수 문서 관리’/‘필수서류 관리’ 표기 통일(브레드크럼/타이틀)

## 14) 수용 기준(AC)

- 좌측 네비에 ‘필수서류 관리’ 단일 메뉴만 노출된다.
- 한 화면에서 ‘제출현황’과 ‘설정’ 탭 전환이 가능하다.
- 기존 상세 페이지로 정상 이동된다.
- 기존 경로 접근 시 통합 화면으로 리디렉션된다.
- 기존 기능(검색/필터/승인/반려/유형 관리)이 그대로 동작한다.

## 15) 리스크 및 대응

- 리디렉션 누락 시 북마크 깨짐 → 리디렉션 우선 적용/테스트
- 권한/RLS로 인한 서버 호출 실패 → 관리자 페이지는 서버-사이드에서 안전하게 호출, 필요 시 서비스 롤 사용
- API 응답량 증가로 TTFB 상승 → 탭 분리 로딩/요약 API 도입

## 16) 작업 체크리스트

- [ ] 좌측 네비 통합 (`components/admin/AdminDashboardLayout.tsx`)
- [ ] 제출현황/설정 탭 추가 (`documents/required/page.tsx`)
- [ ] 설정 탭에 유형 테이블 배치 (`DocumentRequirementsTable`)
- [ ] 리디렉션 추가 (`/dashboard/admin/document-requirements` → `/dashboard/admin/documents/required?tab=settings`)
- [ ] 브레드크럼/타이틀 통일
- [ ] 요약 카드(옵션) 및 API 도입 여부 결정
- [ ] 회귀 테스트(검색/필터/승인/반려/유형 편집)

## 17) 일정(가늠)

- 0.5일: 네비 통합 + 탭 구조 구성
- 0.5일: 리디렉션 + 브레드크럼/라벨 정리
- 0.5~1일: 요약 카드/오버뷰(선택) + QA

---

문의/결정 필요 사항

- 제한 계정(customer_manager)에게 제출현황 가시화 범위(불가/읽기 전용) 정책 확정
- 오버뷰 API 도입 시 통계 범위(기간/역할/현장) 정의
