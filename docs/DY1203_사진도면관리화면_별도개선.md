# DY1203 사진·도면 관리 화면 별도 개선안

## 1. 현재 문제점

- 홈에서 작업일지/사진/도면 진입이 뒤섞여 현장 선택을 반복해야 하고 동선이 길다.
- 도면마킹, 사진 업로드가 작업일지 작성 흐름과 한 세션에 섞여 있어 모바일에서 인지·시간 부담이 크다.
- 문서함 > 사진함 / 현장도면외와 실제 촬영·마킹 작업 UI가 분리되어 있어 연결 인지가 낮고, 딥링크도 일관되지 않다.
- 사진/도면을 작업일지에 연결·추가하는 흐름이 화면별로 달라 재진입과 후속 수정이 번거롭다.

## 2. 개선 방향 (원칙)

- 홈은 유지하되 “사진·도면 관리” 전용 페이지(두 개의 탭: 사진관리, 도면관리)로 작성·편집·연동을 집중시킨다.
- 문서함(사진함/현장도면외)은 그대로 보관/열람 역할만 유지하고, 전용 페이지와 데이터 소스를 공유한다.
- 최근/현재 선택된 현장을 전역 컨텍스트로 저장해 작업일지·사진·도면 화면에서 기본값으로 추천한다(현장 선택 최소화).
- 작업일지 연동은 단순 참조 필드(사진/도면 ID)로 일원화하고, 어디서든 교체/추가가 가능하게 한다.

## 3. 화면 변경 요소

- 내비게이션: 사이드바(또는 탑바)에 `사진·도면 관리` 메뉴 신설. 홈에는 단일 CTA만 배치.
- 탭: `사진관리`, `도면관리` 두 탭을 하나의 페이지에서 제공(공용 현장 필터/검색 바 공유).
- 문서함: 사진함/현장도면외 탭은 유지. 단, 각 상세/리스트에 “사진·도면 관리에서 열기” 보조 링크 추가.
- 작업일지 화면: 참조된 사진/도면 표시, 추가/교체 버튼, 전용 페이지로 이동하는 딥링크 추가.

## 4. 구체적 구현 방안

1. 정보구조/라우팅
   - 새로운 페이지 예: `/mobile/media` (탭으로 사진/도면 전환). 필요 시 `/mobile/media/photos`, `/mobile/media/drawings` 라우트별 탭 유지.
   - 홈/문서함/작업일지에서 전용 페이지로 이동할 때 현장 ID, 검색어를 쿼리로 전달해 초기 상태를 맞춘다.

2. 현장 컨텍스트 공유
   - 최근 선택 현장을 localStorage + 서버 세션에 저장, 전역 훅/컨텍스트에서 읽어 기본값으로 사용.
   - 탭 전환, 작업일지 작성, 사진/도면 업로드 모두 같은 컨텍스트를 재사용. 변경 시 전역 컨텍스트 갱신.

3. 사진관리 탭
   - 기능: 촬영/업로드, 태그/카테고리, 작업일지 링크, 현장 필터, 검색(파일명/태그/작성자), 정렬(최신/태그/상태).
   - UI: 썸네일 리스트 + 상태 배지(업로드 중/완료/링크 여부), 멀티선택 후 작업일지 연결/다운로드.
   - 문서함 사진함 데이터와 동일 테이블/스토리지 사용, 상태/태그/링크 필드만 추가 노출.

4. 도면관리 탭
   - 기능: 도면 업로드, 버전 관리, 마킹 작성/이어하기, 작업일지 링크, 현장 필터, 상태(미마킹/마킹완료) 필터.
   - UI: 리스트(도면명/버전/최신 마킹자/업데이트일) + “마킹 열기/이어하기” 버튼, 썸네일 Lazy-load.
   - 문서함 현장도면외 데이터 재사용, 마킹 메타(버전, 작성자, 링크된 작업일지 수) 표시.

5. 작업일지 연동
   - 작업일지 작성/편집에 `참조 사진`(멀티)과 `참조 도면마킹`(싱글/멀티 옵션 결정) 선택 필드 제공, 현장 필터 자동 적용.
   - 전용 페이지에서 사진/도면을 선택해 작업일지에 바로 연결하거나, 작업일지 상세에서 “사진·도면 관리에서 선택”으로 이동.
   - 참조는 ID 저장으로 단순화(기존 데이터 손상 없음), 권한 내에서만 교체/추가 가능.

6. 문서함 연동
   - 사진함/현장도면외 리스트/상세에 “사진·도면 관리에서 열기” 링크 추가(쿼리에 리소스 ID 포함).
   - 반대로 전용 페이지 항목에서 “문서함에서 보기/다운로드” 링크 제공해 기존 다운로드 흐름 유지.

7. 성능/오프라인/UX
   - 썸네일 Lazy-load + 페이지네이션, 대용량 업로드 진행률/재시도, 임시저장(로컬) 옵션.
   - 업로드/마킹/링크 작업 시 토스트와 실패 복구 버튼 제공. 네트워크 불안정 대비 자동 재시도.

8. 권한/가드
   - 접근: site_manager/production_manager 기본 허용, partner/customer_manager는 배정/파트너 현장으로 필터.
   - 데이터 RLS는 기존 사진/도면 테이블 정책 재사용, UI에서 현장 필터를 강제해 노출 차단.

9. 전환/마이그레이션
   - 홈/기존 섹션에 배너로 “사진·도면 관리에서 처리하세요” 안내, 일정 기간 유지.
   - 기존 딥링크는 전용 페이지로 리다이렉트하거나 안내 모달 제공.

10. 테스트

- 역할별 필터(배정 현장만 노출), 업로드→썸네일 생성, 마킹 작성/저장, 작업일지 링크/해제, 문서함↔전용 페이지 이동 CTA 동작.
- 오프라인/저속망에서 업로드 재시도, 대용량 이미지 로딩 성능 확인.

## 5. 사진·도면 관리 화면 설계안 (개략)

- 상단 바: 현장 선택 드롭다운(최근/배정 현장 자동 추천), 검색 입력, 필터(상태/태그/업데이트 순) 공통 제공.
- 탭 영역: `사진관리` / `도면관리` 두 탭으로 전환.
- 사진관리 탭: 썸네일 그리드 + 상태 배지, 멀티선택 체크박스, 우측/하단 액션바에 “작업일지 연결/다운로드/삭제(권한 시)” 버튼. 업로드 버튼은 플로팅.
- 도면관리 탭: 리스트/카드 토글, 버전/마킹 상태/작성자/업데이트일 표시, “마킹 열기/이어하기”, “작업일지 연결” 버튼. 새 도면 업로드는 플로팅 버튼.
- 상세 뷰(공통): 미리보기 영역, 메타데이터(작성자/태그/현장/업데이트일), 작업일지 링크 목록, 액션(다운로드, 링크 추가/해제, 마킹 열기/편집, 태그 편집).
- 홈/작업일지와의 연결: 상단에 현재 현장 컨텍스트 배지 노출, “작업일지 작성으로 이동” 및 “사진/도면 선택 유지” 안내.
