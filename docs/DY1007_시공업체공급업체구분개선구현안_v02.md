# DY1007 v02 · UI 용어 단일화(시공업체) + ‘미지정’ 플로우 + 계정 생성

작성일: 2025-10-07
담당: 시스템관리(Administrator)

## 1) 현재 컨텍스트 요약

- 용어/개념 정리(UX 정책)
  - UI/UX 전면에서 “공급업체/파트너사” 용어를 사용하지 않고 “시공업체(소속사)”로 단일 표기합니다.
  - Canonical 엔터티는 `organizations`(시공업체) 기준으로 노출하며, 공급 관련 데이터는 백엔드/운영에서만 유지합니다.
- 가입요청/승인 흐름 개선(Phase 1~3 반영)
  - 가입요청 상세 페이지 추가: `/dashboard/admin/signup-requests/[id]`
  - 목록 작업 컬럼: 상세/승인/거절 버튼, 상태 한글 표기
  - 승인 시 환영 메일 발송 + created_user_id 반환, 사용자 상세로 이동
  - 사이드바 “가입 요청 관리” 대기건수 뱃지
  - 로그인 실패 분기: pending이면 “승인 대기” 메시지, 배너(reason=reset_success|approved) 처리
  - 아이디 찾기/상태조회/재안내 API + 레이트리밋 적용
- 가입요청 ‘미지정’ 소속 정책
  - 가입요청 제출 시 소속사 ‘미지정’ 허용, 승인 단계에서 필수 지정(관리자 상세 화면에서 강제 검증)

## 2) 옵션 A(무중단) · 공급 데이터 유지 전략(백엔드 한정)

- DB: `supplier_companies` 뷰를 제공(운영/리포트 용도). UI는 사용하지 않습니다.
- 코드: 외부/운영 시나리오에서만 `supplier_companies` 뷰를 참조하도록 하고, 일반 화면은 모두 `organizations`(시공업체) 기준으로 동작합니다.
- 필요 시 최종 정리(옵션 B): 내부 의존도 제거 뒤 스키마 통합 검토

## 3) 반영된 변경(핵심)

- 가입요청 상세 페이지
  - `app/dashboard/admin/signup-requests/[id]/page.tsx`
  - `components/admin/signup-requests/SignupRequestDetailClient.tsx`
  - `app/api/admin/signup-requests/[id]/route.ts` (PATCH)
  - `app/api/admin/signup-requests/[id]/approve/route.ts` (POST)
  - `app/api/admin/signup-requests/[id]/reject/route.ts` (POST)
- 목록/상태/버튼/뱃지
  - `components/admin/SignupRequestsTable.tsx` (상세/승인/거절/상태 한글화)
  - `app/api/admin/signup-requests/pending-count/route.ts`
  - `components/admin/AdminDashboardLayout.tsx` (대기건수 뱃지)
- 로그인/인증 보강
  - `app/auth/login/page.tsx` (배너·pending 처리)
  - `app/api/auth/find-id/route.ts`, `app/api/auth/signup-request/status/route.ts`, `app/api/auth/signup-request/resend/route.ts` (+ 레이트리밋)
- 승인/메일/추적성
  - `app/auth/actions.ts` (approveSignupRequest: 환영메일 + created_user_id + created_user_id 설정 시도)
  - `app/actions/admin/users.ts` (사용자 상세에 signup_request 추적)

## 4) 이번 릴리스에서 마무리한 항목

- 가입요청 화면 ‘미지정’ 옵션/안내 추가, 승인 상세에서 강제 검증(소속사/현장 필수)
- 전 화면 용어 단일화 및 메뉴 정리(시공업체 관리 중심, 공급업체 UI 비노출)
- 모바일/레거시/문서 영역의 잔여 표기 대다수 정리(지속 스윕 대상 목록 유지)

## 5) 계정(ID) 표준화 및 생성

- 권장 ID(본사 관리자): `company_admin@inopnc.com`
  - 기존 `partner@inopnc.com`은 의미 혼선 유발 → 사용 중지 권장
- 개발 환경에서 생성 API(이미 추가)
  - POST `/api/admin/create-company-user`
  - Body 예시:
    ```json
    {
      "email": "company_admin@inopnc.com",
      "password": "password123",
      "organization_name": "INOPNC Construction (테스트)"
    }
    ```
  - 주의: production 차단. SUPABASE env 설정 필요.

## 6) 실행 순서 제안(운영)

1. 메뉴/라벨 단일화(완료) 및 UI 전수 검수(지속)
2. 가입요청 ‘미지정’ 정책 운영 공지(완료)
3. supplier_companies 뷰 생성(운영 DB, UI 비노출)
4. 백오피스/리포트에서만 공급 데이터 사용 유지

## 7) 운영 체크리스트

- Supabase env: NEXT_PUBLIC_SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY
- DB 권한/RLS: View는 원 테이블 정책을 사용(추가 정책 불필요), INSTEAD OF 트리거가 필요한 경우만 별도 정의
- 공지/문서: 용어 단일화(소속사=시공업체) 고지, 공급업체 용어는 사용자 화면에 미노출

(본 문서는 현재 세션 컨텍스트와 다음 작업 항목을 요약해 다른 세션에서 바로 이어서 착수할 수 있도록 정리한 버전입니다.)
