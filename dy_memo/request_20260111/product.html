<!doctype html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>INOPNC 주문생산관리 (CSS 정렬 + 화면표시 Fix)</title>

  <!-- Pretendard (가독성) -->
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />

  <!-- Tailwind Play CDN + Custom Theme Tokens (원 코드의 클래스명 유지) -->
  <script>
    // IMPORTANT: Tailwind CDN 설정은 tailwind.config로 지정해야 커스텀 컬러가 정상 적용됩니다.
    tailwind.config = {
      safelist: ['bg-primary', 'bg-primary-bg', 'text-primary', 'border-primary', 'bg-header-navy', 'text-header-navy', 'bg-bg-body', 'bg-bg-surface', 'text-text-main', 'text-text-sub', 'border-border', 'bg-pastel-red-bg', 'text-pastel-red-text', 'border-pastel-red-border', 'bg-pastel-blue-bg', 'text-pastel-blue-text', 'border-pastel-blue-border', 'bg-pastel-mint-bg', 'text-pastel-mint-text', 'border-pastel-mint-border', 'bg-slate-100', 'text-slate-600', 'border-slate-200', 'bg-amber-50', 'text-amber-700', 'border-amber-200', 'bg-[#eff6ff]', 'text-[#1e3a8a]', 'border-[#1e3a8a]', 'bg-[#f0f9ff]', 'text-[#0284c7]', 'border-[#0284c7]', 'bg-[#fafafa]/50', 'bg-header-navy/90', 'ring-primary/15', 'ring-primary/30', 'shadow-[0_-4px_20px_rgba(0,0,0,0.04)]', 'shadow-[0_4px_12px_rgba(49,163,250,0.4)]', 'animate-[fadeIn_0.3s_ease-out]', 'animate-[slideDown_0.3s_ease-out]', 'scale-[1.02]'],
      theme: {
        extend: {
          colors: {
            primary: '#31A3FA',
            'primary-bg': '#EAF5FF',

            'header-navy': '#1A254F',

            'bg-body': '#F5F7FB',
            'bg-surface': '#FFFFFF',

            'text-main': '#0F172A',
            'text-sub': '#64748B',

            border: '#E2E8F0',

            'pastel-red-bg': '#FFE8EE',
            'pastel-red-text': '#D92D4A',
            'pastel-red-border': '#FFD1DC',

            'pastel-blue-bg': '#EAF3FF',
            'pastel-blue-text': '#2563EB',
            'pastel-blue-border': '#C7D2FE',

            'pastel-mint-bg': '#E7FBF1',
            'pastel-mint-text': '#0F766E',
            'pastel-mint-border': '#B7F0D4',
          },
          boxShadow: {
            soft: '0 8px 24px rgba(15, 23, 42, 0.06)',
          }
        }
      }
    };
  </script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- @css 디자인시스템(Scoped) -->
  <style>

    /* =========================================================
      INOPNC 이식4 - 100% 이식 (Modified for 4050 Target)
      - ID/함수 네임스페이스: i3_ / INOPNC_I3
      - 가독성 강화: 폰트 17px, 줄간격 1.6
      - 하단 네비게이션 상단 여백 추가
    ========================================================= */

    /* (권장) 이 파일 단독 사용 시 최소 기본값 */
    html, body { margin:0; padding:0; }
    body { background:#0000; }

    /* =================================================================
      [1. 디자인 시스템] (Scoped)
    ================================================================= */
    #inopnc-i3-root{
      /* ✅ 폰트 정의 확인됨: Pretendard 우선 적용 */
      --font-main: "Pretendard Variable", Pretendard, -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;

      /* [Light Mode] */
      --primary: #31a3fa;
      --primary-bg: #eaf6ff;
      --header-navy: #1a254f;
      --text-main: #111111;
      --text-sub: #475569;
      --text-placeholder: #94a3b8;

      --bg-body: #f2f4f6;
      --bg-surface: #ffffff;
      --bg-input: #ffffff;
      
      /* 기본 검색창 배경색 (헤더) */
      --bg-search-input: #f1f5f9; 
      
      --border: #e2e8f0;

      --danger: #ef4444;
      --del-btn-bg: #fff1f2;
      --btn-logout-bg: #1a254f;
      --btn-clear-bg: #cbd5e1;
      --btn-clear-text: #ffffff;
      --upload-photo-bg: #f8fafc;
      --upload-photo-text: #475569;

      /* [Tone & Manner] 민트 컬러 (확인서 버튼용) */
      --btn-cert-bg: #ecfdf5;
      --btn-cert-text: #059669;
      --btn-cert-border: #6ee7b7;

      /* 레이아웃 규격 */
      --header-height: 60px;
      --nav-height: 75px; /* 네비게이션 패딩 추가로 높이 변수 미세 조정 */
      --h-common: 48px;
      
      /* 그림자 효과 */
      --shadow-soft: 0 4px 20px rgba(0,0,0,0.08); 
      --shadow-input: 0 4px 12px rgba(0,0,0,0.08);

      font-family: var(--font-main);
      font-size: 17px; 
      color: var(--text-main);
      background-color: var(--bg-body);
      line-height: 1.6;

      /* 헤더/하단바 공간 확보 */
      min-height: 100vh;
      padding-top: var(--header-height);
      padding-bottom: calc(var(--nav-height) + 20px);

      -webkit-text-size-adjust: 100%;
      overflow-x: hidden;
      touch-action: manipulation;
      transition: background-color 0.3s, color 0.3s;
      position: relative;
      width:100%;
    }

    /* [Dark Mode] (Scoped) */
    #inopnc-i3-root.dark-mode {
      --primary: #31a3fa;
      --primary-bg: #1e293b;
      --header-navy: #f1f5f9;
      --text-main: #f1f5f9;
      --text-sub: #94a3b8;
      --text-placeholder: #64748b;
      --bg-body: #0f172a;
      --bg-surface: #1e293b;
      --bg-input: #0f172a;
      --bg-search-input: #1e293b;
      --border: #334155;
      --btn-logout-bg: #3b82f6;
      --danger: #ef4444;
      --del-btn-bg: #450a0a;
      --upload-photo-bg: #1e293b;
      --upload-photo-text: #94a3b8;

      --btn-cert-bg: rgba(5, 150, 105, 0.2);
      --btn-cert-text: #34d399;
      --btn-cert-border: rgba(52, 211, 153, 0.3);

      --shadow-soft: none;
      --shadow-input: none;
    }

    /* 기본 리셋 */
    #inopnc-i3-root *, 
    #inopnc-i3-root *::before, 
    #inopnc-i3-root *::after { box-sizing: border-box; }
    #inopnc-i3-root a { text-decoration: none; color: inherit; }
    #inopnc-i3-root button,
    #inopnc-i3-root select,
    #inopnc-i3-root input,
    #inopnc-i3-root textarea {
      font-family: var(--font-main);
      outline: none;
      -webkit-tap-highlight-color: transparent;
      box-sizing: border-box;
    }

    /* =================================================================
      [2. 공통 UI 컴포넌트] (Scoped)
    ================================================================= */
    /* Header */
    #inopnc-i3-root .app-header {
      position: fixed; top: 0; left: 0; right: 0;
      height: var(--header-height);
      background-color: var(--bg-surface);
      border-bottom: 1px solid var(--border);
      z-index: 1000;
      display: flex; align-items: center; justify-content: center;
      transition: background-color 0.3s;
    }
    #inopnc-i3-root .header-inner {
      width: 100%; max-width: 600px; padding: 0 20px;
      display: flex; justify-content: space-between; align-items: center;
    }
    #inopnc-i3-root .brand-logo {
      font-size: 24px; font-weight: 800;
      color: var(--header-navy);
      letter-spacing: -0.5px; cursor: pointer;
    }
    #inopnc-i3-root .header-actions { display: flex; align-items: center; gap: 12px; }
    #inopnc-i3-root .header-btn {
      background: transparent; border: none; padding: 4px;
      display: flex; flex-direction: column; align-items: center; gap: 3px;
      cursor: pointer; color: var(--header-navy);
      position: relative;
      transition: opacity 0.2s;
      overflow: visible; 
    }
    #inopnc-i3-root .header-btn:active { opacity: 0.6; }
    #inopnc-i3-root .header-label {
      font-size: 12px;
      font-weight: 600; letter-spacing: -0.3px;
      color: var(--header-navy);
    }

    /* Notification badge */
    #inopnc-i3-root .notification-wrapper {
      position: relative; display: flex;
      align-items: center; justify-content: center;
      overflow: visible;
    }
    #inopnc-i3-root .notification-badge {
      position: absolute; top: -4px; right: -4px;
      background-color: #ef4444; color: white;
      border-radius: 50%;
      width: 18px; height: 18px;
      font-size: 10px; font-weight: 800;
      display: flex; align-items: center; justify-content: center;
      border: 2px solid var(--bg-surface);
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: 0.3s;
      transform: scale(1);
      line-height: 1;
    }
    #inopnc-i3-root .notification-badge.hidden { opacity: 0; transform: scale(0); pointer-events:none; }

    /* Bottom Nav (상단 여백 수정됨) */
    #inopnc-i3-root .bottom-nav-wrap {
      position: fixed; bottom: 0; left: 0; right: 0;
      z-index: 100;
      background: var(--bg-surface);
      border-top: 1px solid var(--border);
      /* ✅ 상단 여백 추가: 12px */
      padding-top: 12px; 
      padding-bottom: env(safe-area-inset-bottom);
    }
    #inopnc-i3-root .bottom-nav {
      display: flex; justify-content: space-around;
      height: 60px; align-items: center;
    }
    #inopnc-i3-root .nav-link {
      display: flex; flex-direction: column; align-items: center;
      color: #94a3b8; gap: 4px;
      transition: 0.2s; flex: 1; justify-content: center; height: 100%;
    }
    #inopnc-i3-root .nav-link.active { color: var(--header-navy); transform: scale(1.05); font-weight: 700; }
    #inopnc-i3-root.dark-mode .nav-link.active { color: #fff; }

    
    /* [추가] 하단 네비 라벨 가독성(4050) */
    #inopnc-i3-root .nav-label { font-size: 12px; font-weight: 700; letter-spacing: -0.2px; }
/* =================================================================
      [3. 오버레이 & 패널] (Scoped)
    ================================================================= */
    #inopnc-i3-root .overlay-backdrop {
      position: fixed; inset: 0;
      background-color: rgba(0,0,0,0.4);
      z-index: 1500;
      opacity: 0; pointer-events: none;
      transition: opacity 0.3s;
    }
    #inopnc-i3-root .overlay-backdrop.active { opacity: 1; pointer-events: auto; }

    /* =========================================================
      [추가] 새 현장 등록 모달 (폰트 규칙은 @site.html 메인과 동일 톤)
    ========================================================= */
    #inopnc-i3-root .i3-modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.4);
      z-index: 2600;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s;
    }
    #inopnc-i3-root .i3-modal-backdrop.active { opacity: 1; pointer-events: auto; }

    #inopnc-i3-root .i3-modal-panel {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.96);
      width: 90%;
      max-width: 420px;
      background: var(--bg-surface);
      border-radius: 16px;
      z-index: 2700;
      padding: 22px;
      box-shadow: var(--shadow-soft);
      opacity: 0;
      pointer-events: none;
      transition: 0.25s;
    }
    #inopnc-i3-root .i3-modal-panel.active {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
      pointer-events: auto;
    }
    #inopnc-i3-root .i3-modal-title {
      font-size: 18px;
      font-weight: 800;
      color: var(--header-navy);
      margin-bottom: 10px;
      letter-spacing: -0.2px;
    }
    #inopnc-i3-root .i3-modal-desc {
      font-size: 17px;
      font-weight: 500;
      color: var(--text-sub);
      line-height: 1.5;
      margin-bottom: 16px;
    }
    #inopnc-i3-root .i3-modal-label {
      display: block;
      font-size: 17px;
      font-weight: 700;
      color: var(--text-sub);
      margin-bottom: 8px;
    }
    #inopnc-i3-root .i3-modal-input {
      width: 100%;
      height: 54px;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 0 16px;
      font-size: 17px;
      font-weight: 500;
      color: var(--text-main);
      background: var(--bg-input);
    }
    #inopnc-i3-root .i3-modal-actions {
      display: flex;
      gap: 10px;
      margin-top: 18px;
    }
    #inopnc-i3-root .i3-btn-modal {
      flex: 1;
      height: 54px;
      border-radius: 12px;
      font-size: 17px;
      font-weight: 700;
      cursor: pointer;
      border: none;
    }
    /* 버튼 컬러는 그대로 유지 */
    #inopnc-i3-root .i3-btn-cancel { background: #f1f5f9; color: var(--text-sub); border: 1px solid var(--border); }
    #inopnc-i3-root .i3-btn-confirm { background: var(--header-navy); color: #fff; }

    /* 메인 영역 우측 상단 '추가' 버튼(최소 추가) */
    #inopnc-i3-root .i3-add-site-row { display:flex; justify-content:flex-end; margin: -8px 0 14px; }
    #inopnc-i3-root .i3-add-site-btn {
      height: 40px;
      padding: 0 14px;
      background: var(--bg-surface);
      border: 1px solid var(--primary);
      color: var(--primary);
      border-radius: 100px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 1px 3px rgba(49, 163, 250, 0.18);
    }

    #inopnc-i3-root .drawer-panel,
    #inopnc-i3-root .menu-panel {
      position: fixed; top: 0; bottom: 0;
      width: 85%; max-width: 320px;
      background-color: var(--bg-surface);
      z-index: 2500;
      transition: transform 0.3s;
      display: flex; flex-direction: column;
    }
    #inopnc-i3-root .menu-panel { left: 0; transform: translateX(-100%); }
    #inopnc-i3-root .drawer-panel { right: 0; transform: translateX(100%); }
    #inopnc-i3-root .menu-panel.active,
    #inopnc-i3-root .drawer-panel.active { transform: translateX(0); }

    #inopnc-i3-root .account-overlay,
    #inopnc-i3-root .search-overlay {
      position: fixed; inset: 0;
      background-color: var(--bg-body);
      z-index: 2000;
      display: flex; flex-direction: column;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.33, 1, 0.68, 1);
    }
    #inopnc-i3-root .account-overlay.active,
    #inopnc-i3-root .search-overlay.active { transform: translateY(0); }

    /* 작업완료확인서 모달 (모바일 최적화) */
    #inopnc-i3-root .cert-modal-overlay {
      position: fixed; 
      top: 0; left: 0; right: 0; bottom: 0;
      background-color: #000;
      z-index: 3000;
      display: flex; 
      flex-direction: column;
      transform: translateY(100%);
      transition: transform 0.3s cubic-bezier(0.33, 1, 0.68, 1);
      overflow: hidden;
      /* 모바일 safe area 대응 - 상하 균등하게 조정 */
      padding-top: env(safe-area-inset-top);
      padding-bottom: 0;
    }
    #inopnc-i3-root .cert-modal-overlay.active { 
      transform: translateY(0); 
    }
    
    #inopnc-i3-root .cert-modal-header {
      height: 60px;
      min-height: 60px;
      background-color: #000;
      border-bottom: 1px solid #333;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      flex-shrink: 0;
      z-index: 10;
      /* 모바일 safe area 대응 - 상단만 적용 */
      padding-top: max(env(safe-area-inset-top), 0px);
      margin-top: 0;
    }
    #inopnc-i3-root .cert-modal-title {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
      flex: 1;
      text-align: center;
    }
    #inopnc-i3-root .cert-modal-header-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    #inopnc-i3-root .cert-modal-btn {
      background: none;
      border: none;
      color: #fff;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    #inopnc-i3-root .cert-modal-btn:active {
      background: rgba(255, 255, 255, 0.15);
    }
    #inopnc-i3-root .cert-modal-close {
      background: none;
      border: none;
      color: #fff;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    #inopnc-i3-root .cert-modal-close:active {
      background: rgba(255, 255, 255, 0.15);
    }
    
    #inopnc-i3-root .cert-modal-body {
      flex: 1;
      position: relative;
      overflow: hidden;
      background: #1e1e1e;
      /* 모바일 스크롤 최적화 */
      -webkit-overflow-scrolling: touch;
      overscroll-behavior: contain;
      /* 하단 여백 제거 - 상하 균등하게 */
      margin-bottom: 0;
      padding-bottom: 0;
      /* 모바일 100% 최적화 */
      display: flex;
      flex-direction: column;
    }
    #inopnc-i3-root .cert-modal-iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: block;
      background: #1e1e1e;
      /* 모바일 터치 최적화 */
      touch-action: pan-x pan-y pinch-zoom;
      /* 하단 여백 제거 */
      margin: 0;
      padding: 0;
      /* iframe 내부 콘텐츠가 모달에 맞게 표시되도록 */
      overflow: hidden;
      /* 모바일 100% 최적화 */
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
    }
    
    /* 모바일 최적화 */
    @media (max-width: 768px) {
      #inopnc-i3-root .cert-modal-overlay {
        /* 모바일에서는 전체 화면 */
        transform: translateY(100%);
        padding-bottom: 0;
      }
      #inopnc-i3-root .cert-modal-overlay.active {
        transform: translateY(0);
      }
      
      /* 모바일에서 헤더 높이 조정 */
      #inopnc-i3-root .cert-modal-header {
        height: calc(60px + env(safe-area-inset-top));
        min-height: calc(60px + env(safe-area-inset-top));
        margin-bottom: 0;
      }
      
      /* 모달 바디 하단 여백 제거 */
      #inopnc-i3-root .cert-modal-body {
        margin-bottom: 0;
        padding-bottom: env(safe-area-inset-bottom);
      }
    }
    
    /* 매우 작은 화면 대응 */
    @media (max-width: 360px) {
      #inopnc-i3-root .cert-modal-title {
        font-size: 16px;
      }
    }

    /* --- [스마트 검색 스타일] --- */
    #inopnc-i3-root .search-header-global {
      display: flex; align-items: center; gap: 10px;
      height: 70px; 
      padding: 0 16px;
      background-color: var(--bg-surface);
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }
    #inopnc-i3-root .input-wrapper { flex: 1; position: relative; display: flex; align-items: center; }

    /* ✅ [수정] 헤더 검색창 (Global Search) */
    #inopnc-i3-root .unified-search-input {
      width: 100%; 
      height: 50px;
      border-radius: 50px;
      
      /* 1. 배경색: 기본은 기존색 유지 */
      background: var(--bg-search-input);
      
      /* 2. 테두리: Select 박스와 동일하게 적용 */
      border: 1px solid var(--border);
      
      padding: 0 76px 0 20px;
      font-size: 17px; color: var(--text-main); font-weight: 500;
      transition: all 0.2s;
      
      /* 3. 그림자 제거 */
      box-shadow: none;
    }

    #inopnc-i3-root.dark-mode .unified-search-input {
      border: 1px solid var(--border);
      box-shadow: none;
    }
    
    #inopnc-i3-root .unified-search-input:hover {
        border-color: #cbd5e1;
    }
    
    /* ✅ Focus(이벤트) 시 배경색 흰색 + 파란 테두리 */
    #inopnc-i3-root .unified-search-input:focus {
      background-color: #ffffff; /* 이벤트 시 흰색 */
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(49, 163, 250, 0.15);
      outline: none;
    }
    #inopnc-i3-root.dark-mode .unified-search-input:focus {
        background-color: var(--bg-surface); /* 다크모드에서는 surface 색상 */
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(49, 163, 250, 0.15);
    }

    #inopnc-i3-root .btn-search-icon-group {
      position: absolute; right: 8px; top: 50%;
      transform: translateY(-50%);
      display: flex; align-items: center; gap: 4px;
      overflow: visible;
    }
    #inopnc-i3-root .btn-search-clear {
      background: var(--btn-clear-bg); color: var(--btn-clear-text);
      border-radius: 50%;
      width: 24px; height: 24px;
      display: flex; align-items: center; justify-content: center;
      border: none; cursor: pointer;
      opacity: 0; pointer-events: none; transform: scale(0.5);
      transition: 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    #inopnc-i3-root .btn-search-clear.show { opacity: 1; pointer-events: auto; transform: scale(1); }

    #inopnc-i3-root .btn-mic {
      background: none; border: none; color: var(--primary);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; padding: 6px; border-radius: 50%;
      transition: 0.2s;
      overflow: visible;
    }
    #inopnc-i3-root .btn-mic:active { background-color: rgba(0,0,0,0.05); }
    #inopnc-i3-root .mic-listening { animation: i3_pulse_mic 1.5s infinite; color: #ef4444; }
    @keyframes i3_pulse_mic {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.7; }
      100% { transform: scale(1); opacity: 1; }
    }

    #inopnc-i3-root .btn-search-submit {
      background: none; border: none; color: var(--primary);
      font-weight: 700; font-size: 17px;
      width: auto; padding-left: 12px; cursor: pointer; white-space: nowrap;
    }
    #inopnc-i3-root .search-content {
      flex: 1; padding: 16px; overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }
    #inopnc-i3-root .section-title {
      font-size: 16px; font-weight: 700; color: var(--text-sub);
      margin-bottom: 12px; display: block;
    }

    /* [검색 결과 카드 & 액션 버튼] */
    #inopnc-i3-root .site-result-card {
      background: var(--bg-surface);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 14px;
      box-shadow: var(--shadow-soft);
      border: none;
      transition: 0.2s;
      cursor: pointer;
    }
    #inopnc-i3-root .site-result-card:active { transform: scale(0.98); }
    #inopnc-i3-root.dark-mode .site-result-card { border: 1px solid var(--border); box-shadow: none; }
    
    #inopnc-i3-root .site-card-header {
      display: flex; justify-content: space-between; align-items: flex-start;
      margin-bottom: 16px;
    }
    #inopnc-i3-root .site-name-lg {
      font-size: 20px;
      font-weight: 800; color: var(--text-main);
      line-height: 1.3; margin-bottom: 2px;
    }
    #inopnc-i3-root .site-addr { font-size: 15px; color: var(--text-sub); font-weight: 500; }
    #inopnc-i3-root .site-badge {
      background: var(--primary-bg); color: var(--primary);
      font-size: 13px; font-weight: 700;
      padding: 4px 10px; border-radius: 6px;
      white-space: nowrap;
    }

    /* [더 보기 버튼 스타일] */
    #inopnc-i3-root .btn-more-sites {
      width: 100%; height: 50px;
      background: var(--bg-surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text-sub);
      font-size: 15px; font-weight: 600;
      display: flex; align-items: center; justify-content: center; gap: 6px;
      cursor: pointer;
      margin-top: 4px;
      margin-bottom: 28px;
      transition: 0.2s;
    }
    #inopnc-i3-root .btn-more-sites:active { background: var(--bg-body); transform: scale(0.98); }
    #inopnc-i3-root.dark-mode .btn-more-sites { background: var(--bg-input); color: var(--text-main); }

    #inopnc-i3-root .quick-action-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    #inopnc-i3-root .btn-quick-action {
      background: var(--bg-search-input);
      border: 1px solid var(--border);
      border-radius: 12px;
      height: 50px;
      display: flex; align-items: center; justify-content: center;
      gap: 6px;
      font-size: 15px; font-weight: 600;
      color: var(--text-sub);
      cursor: pointer;
      transition: 0.1s;
      overflow: visible;
    }
    #inopnc-i3-root .btn-quick-action:active { background: var(--border); transform: scale(0.98); }
    #inopnc-i3-root .btn-quick-action.highlight { color: var(--primary); border-color: rgba(49, 163, 250, 0.3); background: #f0f9ff; }
    #inopnc-i3-root.dark-mode .btn-quick-action.highlight { background: rgba(49, 163, 250, 0.1); }

    /* [민트 컬러 적용 클래스] */
    #inopnc-i3-root .btn-quick-action.action-cert {
      color: var(--btn-cert-text);
      background-color: var(--btn-cert-bg);
      border-color: var(--btn-cert-border);
    }
    #inopnc-i3-root .btn-quick-action.action-cert:active { opacity: 0.8; }

    /* 태그 */
    #inopnc-i3-root .tag-container { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 20px; }
    #inopnc-i3-root .search-tag {
      background: var(--bg-surface);
      border: 1px solid var(--border);
      padding: 8px 14px;
      border-radius: 20px;
      font-size: 14px;
      color: var(--text-sub);
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
      line-height: 1.1;
    }
    #inopnc-i3-root .search-tag:active { background-color: var(--bg-body); }
    #inopnc-i3-root .empty-result { text-align: center; padding: 40px 0; color: var(--text-placeholder); }

    /* --- [본문 콘텐츠 & 하이라이트 효과] --- */
    #inopnc-i3-root .app-wrapper { width: 100%; max-width: 600px; margin: 0 auto; padding: 20px; }
    
    #inopnc-i3-root .dummy-content-box {
      margin-bottom: 24px;
      background: var(--bg-surface);
      border-radius: 16px;
      padding: 24px;
      box-shadow: var(--shadow-soft);
      border: none;
      transition: transform 0.3s;
    }
    #inopnc-i3-root.dark-mode .dummy-content-box { border: 1px solid var(--border); box-shadow: none; }
    
    #inopnc-i3-root .dummy-title { font-size: 19px; font-weight: 700; color: var(--text-main); margin-bottom: 10px; }
    #inopnc-i3-root .dummy-desc { font-size: 16px; color: var(--text-sub); line-height: 1.6; }

    @keyframes i3_highlight_flash {
      0% { background-color: rgba(49, 163, 250, 0.3); box-shadow: 0 0 0 4px rgba(49, 163, 250, 0.2); transform: scale(1.02); }
      50% { background-color: rgba(49, 163, 250, 0.1); transform: scale(1.02); }
      100% { background-color: transparent; box-shadow: none; transform: scale(1); }
    }
    #inopnc-i3-root .highlight-target { animation: i3_highlight_flash 2.0s ease-out; border-radius: 16px; }

    /* 패널 내부 기타 */
    #inopnc-i3-root .noti-header,
    #inopnc-i3-root .account-header {
      height: var(--header-height);
      padding: 0 16px;
      display: flex; align-items: center; justify-content: space-between;
      background-color: var(--bg-surface);
      border-bottom: 1px solid var(--border);
      flex-shrink: 0;
    }
    #inopnc-i3-root .noti-title,
    #inopnc-i3-root .account-title { font-size: 19px; font-weight: 700; color: var(--text-main); }
    #inopnc-i3-root .noti-list { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex: 1; }
    #inopnc-i3-root .noti-item { padding: 20px; border-bottom: 1px solid var(--border); display: flex; gap: 14px; align-items: flex-start; }
    #inopnc-i3-root .noti-item.unread { background-color: var(--primary-bg); }
    #inopnc-i3-root .noti-icon-box { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    #inopnc-i3-root .noti-icon-box.type-alert { background-color: var(--del-btn-bg); color: var(--danger); }
    #inopnc-i3-root .noti-icon-box.type-success { background-color: var(--upload-photo-bg); color: var(--upload-photo-text); }
    #inopnc-i3-root .noti-icon-box.type-info { background-color: var(--primary-bg); color: var(--primary); }
    #inopnc-i3-root .noti-content { flex: 1; display: flex; flex-direction: column; gap: 4px; }
    #inopnc-i3-root .noti-item-title { font-size: 16px; font-weight: 700; color: var(--text-main); }
    #inopnc-i3-root .noti-item-desc { font-size: 15px; color: var(--text-sub); line-height: 1.5; }
    #inopnc-i3-root .noti-time { font-size: 13px; color: var(--text-placeholder); margin-top: 4px; }
    #inopnc-i3-root .btn-read-all { border: 1px solid var(--border); background: none; font-size: 14px; color: var(--text-sub); padding: 6px 12px; border-radius: 8px; cursor: pointer; }
    #inopnc-i3-root .menu-nav-list { list-style: none; padding: 24px; margin: 0; flex: 1; overflow-y: auto; }
    #inopnc-i3-root .menu-nav-list li { margin-bottom: 24px; }
    #inopnc-i3-root .menu-link { font-size: 20px; font-weight: 700; color: var(--text-main); cursor: pointer; }
    #inopnc-i3-root .btn-acct-mgmt { font-size: 15px; font-weight: 600; color: var(--primary); background-color: var(--bg-surface); border: 1px solid var(--primary); padding: 8px 14px; border-radius: 8px; cursor: pointer; }
    #inopnc-i3-root .btn-logout { width: 100%; height: 56px; background: var(--btn-logout-bg); color: #fff; border: none; border-radius: 12px; font-size: 17px; font-weight: 700; cursor: pointer; }

    /* [프로필 이미지 스타일 - 다크모드 최적화] */
    #inopnc-i3-root .profile-edit-wrap { display: flex; flex-direction: column; align-items: center; margin-bottom: 32px; }
    #inopnc-i3-root .profile-img-box {
      width: 100px; height: 100px; border-radius: 50%;
      background-color: #e2e8f0;
      position: relative;
      display: flex; align-items: center; justify-content: center;
      font-size: 36px; font-weight: 700; color: #94a3b8;
      border: 4px solid var(--bg-surface);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      background-size: cover; background-position: center;
      overflow: visible;
    }
    #inopnc-i3-root .btn-edit-photo {
      position: absolute; bottom: 0; right: 0;
      width: 34px; height: 34px; border-radius: 50%;
      background-color: var(--header-navy); color: #fff;
      border: 3px solid var(--bg-surface);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; z-index: 10;
      box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    }
    #inopnc-i3-root.dark-mode .btn-edit-photo { background-color: var(--primary); }

    #inopnc-i3-root .acct-section { margin-bottom: 32px; }
    #inopnc-i3-root .acct-sec-title { font-size: 15px; font-weight: 700; color: var(--text-sub); margin-bottom: 12px; display: block; }
    #inopnc-i3-root .setting-row { display: flex; justify-content: space-between; align-items: center; padding: 16px 0; border-bottom: 1px solid var(--border); }
    #inopnc-i3-root .switch { position: relative; display: inline-block; width: 48px; height: 26px; }
    #inopnc-i3-root .switch input { opacity: 0; width: 0; height: 0; }
    #inopnc-i3-root .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #cbd5e1; transition: .4s; border-radius: 34px; }
    #inopnc-i3-root .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
    #inopnc-i3-root input:checked + .slider { background-color: var(--primary); }
    #inopnc-i3-root input:checked + .slider:before { transform: translateX(22px); }
    #inopnc-i3-root .form-group { margin-bottom: 16px; }
    #inopnc-i3-root .form-label { display: block; font-size: 16px; color: var(--text-sub); margin-bottom: 6px; font-weight: 600; }
    #inopnc-i3-root .form-input {
      width: 100%; height: var(--h-common);
      padding: 0 14px;
      border: 1px solid var(--border);
      border-radius: 12px;
      font-size: 17px; color: var(--text-main);
      background: var(--bg-input);
      font-weight: 500;
      transition: all 0.2s;
    }
    #inopnc-i3-root .btn-acct-save { font-size: 16px; font-weight: 600; color: var(--primary); background: none; border: none; cursor: pointer; }
    #inopnc-i3-root .btn-text-danger { color: var(--danger); font-size: 15px; font-weight: 600; background: none; border: none; padding: 0; cursor: pointer; margin-top: 8px; text-decoration: underline; }

    /* =================================================================
       [추가] Select Box (현장 선택 필터)
    ================================================================= */
    #inopnc-i3-root .form-select-group {
      margin-bottom: 24px;
    }
    #inopnc-i3-root .form-select {
        appearance: none; -webkit-appearance: none; /* 기본 화살표 제거 */
        width: 100%; height: 50px; 
        background-color: var(--bg-input); 
        border: 1px solid var(--border); border-radius: 12px; 
        padding: 0 40px 0 16px; /* 화살표 공간 확보 */
        font-family: var(--font-main); font-size: 16px; font-weight: 500; color: var(--text-main);
        
        /* 핵심: 커스텀 SVG 화살표 */
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%23333333' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        background-repeat: no-repeat; background-position: right 14px center; background-size: 18px;
        cursor: pointer; transition: all 0.2s;
    }
    #inopnc-i3-root .form-select:hover { border-color: #cbd5e1; }
    #inopnc-i3-root .form-select:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(49, 163, 250, 0.15); outline: none; }

    /* 다크모드 화살표 색상 변경 */
    #inopnc-i3-root.dark-mode .form-select {
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='%2394a3b8' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    }

    /* =================================================================
       [추가] Search Input (현장명 검색창)
    ================================================================= */
    #inopnc-i3-root .local-search-wrapper { position: relative; margin-bottom: 24px; display: flex; align-items: center; }
    
    /* ✅ [수정] 본문 검색창: 그림자 없음, 흰색 배경 */
    #inopnc-i3-root .search-input-local { 
        width: 100%; height: 50px; border-radius: 16px; 
        
        /* 요청사항: 흰색 배경 */
        background: #ffffff; 
        
        /* 요청사항: 그림자 제거 */
        box-shadow: none; 
        
        /* 가시성을 위해 연한 테두리 추가 (Select 박스와 통일) */
        border: 1px solid var(--border);
        
        padding: 0 44px 0 22px; font-size: 17px; color: var(--text-main); font-weight: 500; transition: all 0.2s; 
        font-family: var(--font-main);
    }
    
    /* 다크모드에서는 surface 색상 사용 */
    #inopnc-i3-root.dark-mode .search-input-local { background: var(--bg-surface); border: 1px solid var(--border); box-shadow: none; }
    
    #inopnc-i3-root .search-input-local:focus { box-shadow: 0 0 0 2px var(--primary); outline:none; }
    #inopnc-i3-root .local-search-icon { position: absolute; right: 18px; top: 50%; transform: translateY(-50%); color: var(--text-placeholder); pointer-events: none; width: 20px; transition: opacity 0.2s; }
    
    /* ✅ 텍스트 입력 시 삭제 버튼 스타일 (JS로 토글됨) */
    #inopnc-i3-root .btn-local-clear {
        position: absolute; right: 14px; top: 50%; transform: translateY(-50%);
        background: var(--btn-clear-bg); color: var(--btn-clear-text);
        border-radius: 50%; width: 22px; height: 22px;
        display: flex; align-items: center; justify-content: center;
        border: none; cursor: pointer; opacity: 0; pointer-events: none; transition: 0.2s; z-index: 2;
    }
    #inopnc-i3-root .btn-local-clear.show { opacity: 1; pointer-events: auto; }

    /* [추가] 초소형 화면 대응 (아이콘/라벨 겹침 방지) */
    @media (max-width: 360px) {
      #inopnc-i3-root .header-actions { gap: 10px; }
      #inopnc-i3-root .header-label { font-size: 11px; }
    }

  
  </style>

  <!-- page base styles (최소) -->
  <style>
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: "Pretendard Variable", Pretendard, -apple-system, system-ui, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
      background: #F5F7FB;
    }
    .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }

    /* @css 토큰을 현재 화면의 의미색에 연결(깨짐 방지) */
    #inopnc-i3-root .bg-header-navy { background-color: var(--header-navy) !important; }
    #inopnc-i3-root .text-header-navy { color: var(--header-navy) !important; }
    #inopnc-i3-root .bg-bg-body { background-color: var(--bg-body) !important; }
    #inopnc-i3-root .bg-bg-surface { background-color: var(--bg-surface) !important; }
    #inopnc-i3-root .text-text-main { color: var(--text-main) !important; }
    #inopnc-i3-root .text-text-sub { color: var(--text-sub) !important; }
    #inopnc-i3-root .bg-primary { background-color: var(--primary) !important; }
    #inopnc-i3-root .text-primary { color: var(--primary) !important; }
    #inopnc-i3-root .bg-primary-bg { background-color: var(--primary-bg) !important; }
    #inopnc-i3-root .border-border { border-color: var(--border) !important; }
    #inopnc-i3-root .border-primary { border-color: var(--primary) !important; }
  </style>
</head>

<body>
  <noscript>
    <div style="padding:16px; font-weight:700; color:#111;">
      이 화면은 JavaScript가 필요합니다. 브라우저 설정에서 JavaScript를 켜주세요.
    </div>
  </noscript>

  <div id="inopnc-i3-root">
    <div id="root"></div>
  </div>

  <div id="bootError" style="display:none; position:fixed; inset:0; background:#0b1220; color:#fff; z-index:99999; padding:16px; font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;">
    <div style="font-size:14px; font-weight:800; margin-bottom:10px;">화면 로딩 오류</div>
    <pre id="bootErrorMsg" style="white-space:pre-wrap; line-height:1.35; font-size:12px; opacity:0.9;"></pre>
  </div>

  <!-- UMD Dependencies (모듈 import 차단 환경에서도 화면이 뜨도록) -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/htm@3.1.1/dist/htm.umd.js" crossorigin></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js" crossorigin></script>

  <script>
    (function () {
      const bootError = (err) => {
        try {
          const box = document.getElementById("bootError");
          const msg = document.getElementById("bootErrorMsg");
          if (box && msg) {
            box.style.display = "block";
            msg.textContent = (err && (err.stack || err.message)) ? (err.stack || err.message) : String(err);
          }
        } catch (e) {
          alert("로딩 오류: " + (err && err.message ? err.message : err));
        }
      };

      window.addEventListener("error", (e) => bootError(e.error || e.message));
      window.addEventListener("unhandledrejection", (e) => bootError(e.reason));

      try {
        const React = window.React;
        const ReactDOM = window.ReactDOM;
        const htm = window.htm;

        if (!React || !ReactDOM || !htm) {
          throw new Error("필수 라이브러리 로딩 실패(React/ReactDOM/htm). 네트워크 또는 차단 정책을 확인하세요.");
        }

        const { useState, useMemo, useEffect } = React;
        const html = htm.bind(React.createElement);

        // -----------------------------
        // Mock Data (정상 동작용 / 구조는 그대로)
        // -----------------------------
        const REQUEST_DATA = [
          { id: "r1", type: "request", site: "강남 A현장", date: "2025. 11. 24", partner: "대한건설(주)", material: "NPC-1000", qty: 25, priority: "urgent", memo: "TEST 자재요청 (긴급처리 요망)" },
          { id: "r2", type: "request", site: "서초 B현장", date: "2025. 11. 22", partner: "대한건설(주)", material: "NPC-3000Q", qty: 30, priority: "low" },
          { id: "r3", type: "request", site: "송파 C현장", date: "2025. 10. 29", partner: "미지정", material: "NPC-1000", qty: 103, priority: "high", memo: "Seeded for 2025-10" },
          { id: "r4", type: "request", site: "인천공항 T3 확장", date: "2025. 10. 22", partner: "거래처 미지정", material: "NPC-1000", qty: 51, priority: "normal" },
          { id: "r5", type: "request", site: "방배 D현장", date: "2025. 10. 18", partner: "삼일씨엔에스", material: "NPC-3000Q", qty: 51, priority: "high", memo: "현장 진입로 협소" },
          { id: "r6", type: "request", site: "수원 영통구 A지구", date: "2025. 10. 14", partner: "소명건설", material: "NPC-3000Q", qty: 54, priority: "urgent" },
          { id: "r7", type: "request", site: "강남 A현장", date: "2025. 11. 12", partner: "대한건설(주)", material: "NPC-1000", qty: 50, priority: "normal", memo: "[일반] 추가 요청" },
        ];

        const PRODUCTION_DATA = [
          { id: "p1", type: "production", date: "2025. 11. 24", site: "제1공장", partner: "서울전기공사", productionQty: 120, material: "NPC-1000 외 1건", additionalMaterial: "NPC-3000Q (20개)" },
          { id: "p2", type: "production", date: "2025. 11. 24", site: "삼표 라인", partner: "서울전기공사", productionQty: 20, material: "NPC-1000" },
          { id: "p3", type: "production", date: "2025. 11. 21", site: "제2공장", partner: "서울전기공사", productionQty: 50, material: "NPC-3000Q" },
          { id: "p4", type: "production", date: "2025. 11. 13", site: "삼표 라인", partner: "서울전기공사", productionQty: 345, material: "NPC-3000Q" },
          { id: "p5", type: "production", date: "2025. 11. 13", site: "제1공장", partner: "서울전기공사", productionQty: 500, material: "NPC-3000Q", additionalMaterial: "메모 테스트" },
          { id: "p6", type: "production", date: "2025. 11. 13", site: "삼표 라인", partner: "서울전기공사", productionQty: 225, material: "NPC-1000" },
        ];

        const SHIPPING_DATA = [
          { id: "s1", type: "shipping", date: "2025. 11. 20", site: "강남 A현장", partner: "대한건설(주)", status: "done", material: "NPC-1000 외 1건", totalQty: 60, amount: 2280000, tags: ["월말청구", "화물", "착불"] },
          { id: "s2", type: "shipping", date: "2025. 11. 13", site: "삼성전기 수원", partner: "대한건설(주)", status: "waiting", material: "NPC-3000Q", totalQty: 234, amount: 8500000, tags: ["용차", "선불"] },
          { id: "s3", type: "shipping", date: "2025. 11. 10", site: "서초 B현장", partner: "대한건설(주)", status: "done", material: "NPC-1000", totalQty: 100, amount: 3500000, tags: ["월말청구"] },
          { id: "s4", type: "shipping", date: "2025. 11. 05", site: "송파 C현장", partner: "대한건설(주)", status: "waiting", material: "NPC-2000", totalQty: 45, amount: 1200000, tags: ["택배"] },
          { id: "s5", type: "shipping", date: "2025. 10. 30", site: "인천공항 T3 확장", partner: "대한건설(주)", status: "done", material: "NPC-3000Q", totalQty: 120, amount: 4800000, tags: ["용차"] },
          { id: "s6", type: "shipping", date: "2025. 10. 25", site: "강남 A현장", partner: "대한건설(주)", status: "waiting", material: "NPC-1000", totalQty: 10, amount: 380000, tags: ["화물"] },
        ];

        // Icon placeholder → lucide.createIcons()로 SVG 치환
        const Icon = ({ name, size = 20, stroke = 1.5, className = "" }) =>
          html`<i data-lucide=${name} width=${String(size)} height=${String(size)} stroke-width=${String(stroke)} className=${className}></i>`;

        const SummaryCard = ({ value, label, type }) => {
          const getStyle = () => {
            switch (type) {
              case "navy": return "bg-[#eff6ff] text-[#1e3a8a] border-[#1e3a8a]";
              case "sky": return "bg-[#f0f9ff] text-[#0284c7] border-[#0284c7]";
              case "red": return "bg-pastel-red-bg text-pastel-red-text border-pastel-red-border";
              default: return "bg-bg-surface";
            }
          };

          return html`
            <div className=${`sum-card px-1 py-4 rounded-2xl text-center flex flex-col gap-1.5 shadow-soft border ${getStyle()}`}>
              <span className="text-2xl font-extrabold leading-[1.1] tracking-[-0.5px]">${value}</span>
              <span className="text-sm font-bold opacity-90">${label}</span>
            </div>
          `;
        };

        const InfoCard = ({ item, isExpanded, onToggle, isHighlighted, onEdit, onDelete }) => {
          const renderRequestContent = (data) => {
            const priorityColors = {
              low: { bg: "bg-slate-100", text: "text-slate-600", border: "border-slate-200", label: "낮음" },
              normal: { bg: "bg-pastel-blue-bg", text: "text-pastel-blue-text", border: "border-pastel-blue-border", label: "보통" },
              high: { bg: "bg-amber-50", text: "text-amber-700", border: "border-amber-200", label: "높음" },
              urgent: { bg: "bg-pastel-red-bg", text: "text-pastel-red-text", border: "border-pastel-red-border", label: "긴급" },
            };
            const pStyle = priorityColors[data.priority] || priorityColors.normal;

            return html`
              <${React.Fragment}>
                <div className="flex justify-between items-start mb-2">
                  <div>
                    <div className="text-[19px] font-extrabold text-header-navy flex items-center gap-2">
                      ${data.site}
                    </div>
                    <div className="text-[13px] text-text-sub mt-0.5 font-medium flex items-center gap-1.5">
                      <${Icon} name="calendar" size=${12} />
                      ${data.date}
                      <span className="w-0.5 h-2.5 bg-gray-300 mx-0.5 inline-block"></span>
                      <span className="truncate max-w-[120px]">${data.partner || "거래처 미지정"}</span>
                    </div>
                  </div>
                  <span className=${`text-[11px] font-bold px-2.5 py-1 rounded-lg border ${pStyle.bg} ${pStyle.text} ${pStyle.border}`}>
                    ${pStyle.label}
                  </span>
                </div>

                <div className="flex justify-between items-center py-2 border-t border-dashed border-border mt-3">
                  <span className="text-[15px] font-bold text-text-sub">주문수량</span>
                  <span className="text-[18px] font-extrabold text-primary">${data.qty.toLocaleString()}</span>
                </div>

                <div className="flex justify-between items-center py-1">
                  <span className="text-[15px] font-medium text-text-sub">자재명</span>
                  <span className="text-[15px] font-bold text-text-main">${data.material}</span>
                </div>

                ${data.memo ? html`
                  <div className="mt-3 bg-bg-body px-3 py-2.5 rounded-xl flex gap-2 items-start">
                    <${Icon} name="message-square" size=${14} className="mt-0.5 text-text-sub shrink-0" />
                    <span className="text-[13px] text-text-sub font-medium leading-snug">${data.memo}</span>
                  </div>
                ` : null}
              <//>
            `;
          };

          const renderProductionContent = (data) => html`
            <${React.Fragment}>
              <div className="flex justify-between items-start mb-2">
                <div>
                  <div className="text-[19px] font-extrabold text-header-navy">${data.date}</div>
                  <div className="text-[13px] text-text-sub mt-0.5 font-medium flex items-center gap-1.5">
                    <${Icon} name="building-2" size=${12} /> ${data.partner}
                  </div>
                </div>
                <div className="text-right">
                  <div className="text-[11px] text-text-sub font-bold mb-0.5">생산수량</div>
                  <div className="text-[22px] font-black text-primary leading-none">${data.productionQty.toLocaleString()}</div>
                </div>
              </div>

              <div className="border-t border-dashed border-border mt-3 pt-3 flex justify-between items-center">
                <span className="text-[15px] font-bold text-text-sub">주자재</span>
                <span className="text-[15px] font-bold text-text-main">${data.material}</span>
              </div>

              ${data.additionalMaterial ? html`
                <div className="mt-3 bg-bg-body px-3 py-2.5 rounded-xl text-[13px] text-text-sub font-medium">
                  <span className="font-bold text-text-main mr-1">추가정보:</span> ${data.additionalMaterial}
                </div>
              ` : null}
            <//>
          `;

          const renderShippingContent = (data) => html`
            <${React.Fragment}>
              <div className="flex justify-between items-start mb-1">
                <div>
                  <div className="text-[19px] font-extrabold text-header-navy flex items-center gap-2">
                    ${data.partner}
                  </div>
                  <div className="text-[13px] text-text-sub mt-1 font-medium flex items-center gap-1.5">
                    ${data.site} <span className="text-gray-300">|</span> ${data.date}
                  </div>
                </div>

                ${data.status === "done"
                  ? html`<span className="text-[11px] px-2.5 py-1 rounded-lg bg-pastel-mint-bg text-pastel-mint-text font-bold border border-pastel-mint-border">완료</span>`
                  : html`<span className="text-[11px] px-2.5 py-1 rounded-lg bg-pastel-red-bg text-pastel-red-text font-bold border border-pastel-red-border">대기</span>`
                }
              </div>

              <div className="flex justify-between items-center mt-4 mb-2">
                <span className="text-[15px] font-medium text-text-sub">출고 자재</span>
                <span className="text-[15px] font-bold text-text-main">${data.material}</span>
              </div>

              <div className="bg-primary-bg rounded-xl p-3 mb-3 border border-blue-100">
                <div className="flex justify-between items-center mb-1">
                  <span className="text-[14px] font-bold text-text-sub">총 수량</span>
                  <span className="text-[18px] font-black text-primary">${data.totalQty.toLocaleString()}</span>
                </div>
                <div className="flex justify-between items-center">
                  <span className="text-[14px] font-bold text-text-sub">금액</span>
                  <span className="text-[15px] font-bold text-text-main">${data.amount.toLocaleString()}원</span>
                </div>
              </div>

              <div className="flex gap-1.5 flex-wrap">
                ${data.tags.map((tag, idx) => html`
                  <span key=${idx} className="text-[11px] px-2 py-1 rounded-md bg-white border border-border text-text-sub font-bold shadow-sm">
                    ${tag}
                  </span>
                `)}
              </div>
            <//>
          `;

          const renderContent = () => {
            switch (item.type) {
              case "request": return renderRequestContent(item);
              case "production": return renderProductionContent(item);
              case "shipping": return renderShippingContent(item);
              default: return null;
            }
          };

          const highlightStyles = isHighlighted
            ? "bg-blue-50 border-primary ring-2 ring-primary/30 scale-[1.02] z-10"
            : "bg-bg-surface border-border";

          return html`
            <div className=${`rounded-[20px] shadow-soft mb-4 relative overflow-hidden border transition-all duration-500 ${highlightStyles} ${isExpanded ? "ring-1 ring-primary border-primary" : ""}`}>
              <div className="p-5 cursor-pointer" onClick=${onToggle}>
                ${renderContent()}
              </div>

              ${isExpanded ? html`
                <div className="px-5 pb-5 animate-[fadeIn_0.3s_ease-out]">
                  <div className="grid grid-cols-2 gap-3 mt-5 pt-4 border-t border-border">
                    <button onClick=${onEdit} className="h-11 rounded-xl border border-border bg-white text-text-sub font-bold text-[14px] hover:bg-gray-50 active:scale-[0.98] transition-all">
                      수정하기
                    </button>
                    <button onClick=${onDelete} className="h-11 rounded-xl border border-pastel-red-border bg-pastel-red-bg text-pastel-red-text font-bold text-[14px] hover:brightness-95 active:scale-[0.98] transition-all">
                      삭제하기
                    </button>
                  </div>
                </div>
              ` : null}

              <div className="h-10 flex items-center justify-center cursor-pointer gap-1 text-text-sub text-[13px] font-bold bg-[#fafafa]/50 border-t border-border hover:bg-gray-100 transition-colors" onClick=${onToggle}>
                <span>${isExpanded ? "접기" : "상세보기"}</span>
                <span className=${`transition-transform duration-300 ${isExpanded ? "rotate-180" : ""}`}>
                  <${Icon} name="chevron-down" size=${16} />
                </span>
              </div>
            </div>
          `;
        };

        const BottomNav = ({ activeTab, onTabChange }) => {
          const navItems = [
            { id: "request", label: "주문요청", icon: "clipboard-list" },
            { id: "production", label: "생산정보", icon: "paint-bucket" },
            { id: "shipping", label: "출고배송", icon: "truck" },
          ];

          return html`
            <div className="fixed bottom-0 left-0 right-0 h-[80px] bg-white border-t border-border flex justify-around items-center px-2 pb-3 z-50 shadow-[0_-4px_20px_rgba(0,0,0,0.04)] safe-bottom">
              ${navItems.map((item) => {
                const isActive = activeTab === item.id;
                return html`
                  <button
                    key=${item.id}
                    onClick=${() => onTabChange(item.id)}
                    className=${`flex flex-col items-center gap-1.5 p-2 min-w-[64px] transition-all duration-200 ${isActive ? "text-header-navy scale-105" : "text-gray-400 hover:text-gray-600"}`}
                  >
                    <${Icon} name=${item.icon} size=${26} stroke=${isActive ? 2 : 1.5} />
                    <span className=${`text-[11px] ${isActive ? "font-extrabold" : "font-medium"}`}>${item.label}</span>
                  </button>
                `;
              })}
              <button className="flex flex-col items-center gap-1.5 p-2 min-w-[64px] text-gray-400 hover:text-gray-600">
                <${Icon} name="user" size=${26} stroke=${1.5} />
                <span className="text-[11px] font-medium">내정보</span>
              </button>
            </div>
          `;
        };

        const App = () => {
          const [activeTab, setActiveTab] = useState("request");
          const [searchTerm, setSearchTerm] = useState("");
          const [expandedCards, setExpandedCards] = useState(new Set());
          const [toast, setToast] = useState({ show: false, message: "" });
          const [newlyAddedId, setNewlyAddedId] = useState(null);

          const [requests, setRequests] = useState(REQUEST_DATA);
          const [productions, setProductions] = useState(PRODUCTION_DATA);
          const [shippings, setShippings] = useState(SHIPPING_DATA);

          const INITIAL_VISIBLE_COUNT = 5;
          const [visibleCount, setVisibleCount] = useState(INITIAL_VISIBLE_COUNT);

          useEffect(() => {
            setVisibleCount(INITIAL_VISIBLE_COUNT);
            setExpandedCards(new Set());
            setSearchTerm("");
            window.scrollTo({ top: 0, behavior: "smooth" });
          }, [activeTab]);

          // lucide icons render (after each paint)
          useEffect(() => {
            try {
              if (window.lucide && typeof window.lucide.createIcons === "function") {
                window.lucide.createIcons();
              }
            } catch (e) {}
          });

          const handleSearchChange = (e) => setSearchTerm(e.target.value);
          const clearSearch = () => setSearchTerm("");

          const toggleCard = (id) => {
            setExpandedCards(prev => {
              const next = new Set(prev);
              if (next.has(id)) next.delete(id);
              else next.add(id);
              return next;
            });
          };

          const showToast = (message) => {
            setToast({ show: true, message });
            setTimeout(() => setToast(prev => ({ ...prev, show: false })), 2000);
          };

          const getTodayString = () => {
            const d = new Date();
            return `${d.getFullYear()}. ${String(d.getMonth() + 1).padStart(2, "0")}. ${String(d.getDate()).padStart(2, "0")}.`;
          };

          const handleAddItem = () => {
            const today = getTodayString();
            const newId = Math.random().toString(36).substr(2, 9);

            window.scrollTo({ top: 0, behavior: "smooth" });

            setNewlyAddedId(newId);
            setTimeout(() => setNewlyAddedId(null), 2000);

            if (activeTab === "request") {
              const sites = ["성수 지식산업센터", "용산 재개발 지구", "마곡 R&D 센터", "여의도 파크원"];
              const materials = ["NPC-1000", "NPC-3000Q", "NPC-500"];
              const randomSite = sites[Math.floor(Math.random() * sites.length)];
              const randomMaterial = materials[Math.floor(Math.random() * materials.length)];

              const newItem = {
                id: newId,
                type: "request",
                site: randomSite,
                date: today,
                material: randomMaterial,
                qty: Math.floor(Math.random() * 100) + 10,
                priority: "normal",
                partner: "미지정",
                memo: "신규 등록된 주문 건입니다."
              };
              setRequests(prev => [newItem, ...prev]);
              showToast("새 주문요청이 등록되었습니다.");
            } else if (activeTab === "production") {
              const partners = ["서울전기공사", "경기배관(주)", "인천자재", "세종물산"];
              const randomPartner = partners[Math.floor(Math.random() * partners.length)];

              const newItem = {
                id: newId,
                type: "production",
                date: today,
                site: "제1공장",
                partner: randomPartner,
                productionQty: Math.floor(Math.random() * 400) + 100,
                material: "NPC-3000Q",
                additionalMaterial: "일일 생산 보고"
              };
              setProductions(prev => [newItem, ...prev]);
              showToast("새 생산정보가 등록되었습니다.");
            } else if (activeTab === "shipping") {
              const sites = ["부산 LCT", "대전 신세계", "광주 터미널", "대구 동대구역"];
              const randomSite = sites[Math.floor(Math.random() * sites.length)];
              const randomQty = Math.floor(Math.random() * 150) + 30;

              const newItem = {
                id: newId,
                type: "shipping",
                date: today,
                site: randomSite,
                partner: "대한건설(주)",
                status: "waiting",
                material: "통합 자재 세트",
                totalQty: randomQty,
                amount: randomQty * 50000,
                tags: ["신규", "화물"]
              };
              setShippings(prev => [newItem, ...prev]);
              showToast("새 출고배송 건이 등록되었습니다.");
            }
          };

          const handleDeleteItem = (id, type) => {
            if (!window.confirm("선택한 항목을 삭제하시겠습니까?")) return;

            if (type === "request") setRequests(prev => prev.filter(item => item.id !== id));
            else if (type === "production") setProductions(prev => prev.filter(item => item.id !== id));
            else if (type === "shipping") setShippings(prev => prev.filter(item => item.id !== id));

            showToast("항목이 삭제되었습니다.");
          };

          const handleEditItem = (id, type) => {
            if (type === "request") {
              const target = requests.find(item => item.id === id);
              if (!target) return;
              const newQty = window.prompt("수정할 주문 수량을 입력하세요:", String(target.qty));
              if (newQty === null) return;
              const parsed = parseInt(newQty, 10);
              if (isNaN(parsed) || parsed < 0) return showToast("유효한 숫자를 입력해주세요.");
              setRequests(prev => prev.map(item => item.id === id ? { ...item, qty: parsed } : item));
              showToast("주문 수량이 수정되었습니다.");
            } else if (type === "production") {
              const target = productions.find(item => item.id === id);
              if (!target) return;
              const newQty = window.prompt("수정할 생산 수량을 입력하세요:", String(target.productionQty));
              if (newQty === null) return;
              const parsed = parseInt(newQty, 10);
              if (isNaN(parsed) || parsed < 0) return showToast("유효한 숫자를 입력해주세요.");
              setProductions(prev => prev.map(item => item.id === id ? { ...item, productionQty: parsed } : item));
              showToast("생산 수량이 수정되었습니다.");
            } else if (type === "shipping") {
              const target = shippings.find(item => item.id === id);
              if (!target) return;
              const newQty = window.prompt("수정할 총 수량을 입력하세요:", String(target.totalQty));
              if (newQty === null) return;
              const parsed = parseInt(newQty, 10);
              if (isNaN(parsed) || parsed < 0) return showToast("유효한 숫자를 입력해주세요.");
              setShippings(prev => prev.map(item => item.id === id ? { ...item, totalQty: parsed } : item));
              showToast("출고 수량이 수정되었습니다.");
            }
          };

          const { currentData, kpis } = useMemo(() => {
            const lowerQuery = searchTerm.toLowerCase();
            let data = [];
            let kpiList = [];

            if (activeTab === "request") {
              data = requests.filter(item =>
                item.site.toLowerCase().includes(lowerQuery) ||
                item.material.toLowerCase().includes(lowerQuery)
              );
              kpiList = [
                { label: "주문 건수", value: `${requests.length}건`, color: "navy" },
                { label: "주문 현장", value: "5곳", color: "sky" },
                { label: "총 수량", value: requests.reduce((acc, cur) => acc + cur.qty, 0).toLocaleString(), color: "red" }
              ];
            } else if (activeTab === "production") {
              data = productions.filter(item =>
                item.site.toLowerCase().includes(lowerQuery) ||
                item.material.toLowerCase().includes(lowerQuery)
              );
              kpiList = [
                { label: "생산량", value: productions.reduce((acc, cur) => acc + cur.productionQty, 0).toLocaleString(), color: "navy" },
                { label: "출고량", value: "600", color: "sky" },
                { label: "순증량", value: "+250", color: "red" }
              ];
            } else if (activeTab === "shipping") {
              data = shippings.filter(item =>
                item.site.toLowerCase().includes(lowerQuery) ||
                item.partner.toLowerCase().includes(lowerQuery)
              );
              kpiList = [
                { label: "출고 건수", value: `${shippings.filter(i => i.status === "done").length} / ${shippings.length}`, color: "navy" },
                { label: "출고 수량", value: shippings.reduce((acc, cur) => acc + cur.totalQty, 0).toLocaleString(), color: "sky" },
                { label: "출고 금액", value: "240만", color: "red" }
              ];
            }

            return { currentData: data, kpis: kpiList };
          }, [activeTab, searchTerm, requests, productions, shippings]);

          const displayedData = currentData.slice(0, visibleCount);

          return html`
            <div className="pb-24 bg-bg-body min-h-screen">
              <!-- 1. 헤더 -->
              <header className="fixed top-0 left-0 right-0 h-[60px] bg-header-navy text-white flex items-center justify-between px-5 z-50 shadow-md">
                <div className="text-[19px] font-bold tracking-tight">INOPNC 주문생산관리</div>
                <div className="flex gap-1">
                  <button className="p-2 hover:bg-white/10 rounded-full transition-colors"><${Icon} name="bell" size=${22} /></button>
                  <button className="p-2 hover:bg-white/10 rounded-full transition-colors"><${Icon} name="menu" size=${22} /></button>
                </div>
              </header>

              <!-- 2. 상단 탭 -->
              <div className="fixed top-[60px] left-0 right-0 bg-white border-b border-border flex h-[54px] z-40">
                <button onClick=${() => setActiveTab("request")}
                  className=${`flex-1 font-bold text-[15px] relative transition-colors ${activeTab === "request" ? "text-primary" : "text-text-sub hover:text-text-main"}`}>
                  주문요청
                  ${activeTab === "request" ? html`<div className="absolute bottom-0 left-[20%] right-[20%] h-[3px] bg-primary rounded-t-md" />` : null}
                </button>

                <button onClick=${() => setActiveTab("production")}
                  className=${`flex-1 font-bold text-[15px] relative transition-colors ${activeTab === "production" ? "text-primary" : "text-text-sub hover:text-text-main"}`}>
                  생산정보
                  ${activeTab === "production" ? html`<div className="absolute bottom-0 left-[20%] right-[20%] h-[3px] bg-primary rounded-t-md" />` : null}
                </button>

                <button onClick=${() => setActiveTab("shipping")}
                  className=${`flex-1 font-bold text-[15px] relative transition-colors ${activeTab === "shipping" ? "text-primary" : "text-text-sub hover:text-text-main"}`}>
                  출고배송
                  ${activeTab === "shipping" ? html`<div className="absolute bottom-0 left-[20%] right-[20%] h-[3px] bg-primary rounded-t-md" />` : null}
                </button>
              </div>

              <div className="w-full max-w-[600px] mx-auto px-4 box-border pt-[134px]">
                <!-- 3. KPI -->
                <div className="grid grid-cols-3 gap-2.5 mb-6 animate-[slideDown_0.3s_ease-out]">
                  ${kpis.map((kpi, idx) => html`<${SummaryCard} key=${idx} value=${kpi.value} label=${kpi.label} type=${kpi.color} />`)}
                </div>

                <!-- 4. 검색 -->
                <div className="relative mb-3 flex items-center">
                  <input
                    type="text"
                    className="w-full h-14 rounded-2xl bg-white border border-transparent pl-[22px] pr-12 text-[17px] font-semibold text-slate-900 shadow-soft focus:ring-2 focus:ring-primary focus:outline-none transition-all placeholder:text-gray-400"
                    placeholder=${activeTab === "request" ? "현장명, 자재명 검색" : activeTab === "production" ? "생산일자, 거래처 검색" : "거래처, 상태 검색"}
                    value=${searchTerm}
                    onInput=${handleSearchChange}
                  />
                  <div className=${`absolute right-[18px] top-1/2 -translate-y-1/2 text-gray-400 transition-opacity duration-200 pointer-events-none ${searchTerm ? "opacity-0" : "opacity-100"}`}>
                    <${Icon} name="search" size=${20} />
                  </div>
                  <button
                    className=${`absolute right-[14px] top-1/2 -translate-y-1/2 bg-[#cbd5e1] text-white rounded-full w-[22px] h-[22px] flex items-center justify-center border-none cursor-pointer transition-opacity duration-200 z-10 ${searchTerm ? "opacity-100 pointer-events-auto" : "opacity-0 pointer-events-none"}`}
                    onClick=${clearSearch}
                  >
                    <${Icon} name="x" size=${14} />
                  </button>
                </div>

                <!-- 5. 필터(표시용) -->
                <div className="flex gap-3 mb-6">
                  <div className="relative w-full">
                    <select className="w-full h-[54px] bg-white border border-border rounded-xl pl-[18px] pr-10 text-[16px] font-bold text-[#111] appearance-none shadow-soft focus:border-primary focus:ring-4 focus:ring-primary/15 focus:outline-none transition-all cursor-pointer">
                      <option>전체 현장</option>
                      <option>자이 아파트</option>
                      <option>삼성 반도체</option>
                    </select>
                    <div className="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none">
                      <${Icon} name="chevron-down" size=${20} className="text-text-sub" />
                    </div>
                  </div>

                  <div className="relative w-full">
                    <select className="w-full h-[54px] bg-white border border-border rounded-xl pl-[18px] pr-10 text-[16px] font-bold text-[#111] appearance-none shadow-soft focus:border-primary focus:ring-4 focus:ring-primary/15 focus:outline-none transition-all cursor-pointer">
                      <option>최신순</option>
                      <option>상태순</option>
                    </select>
                    <div className="absolute right-4 top-1/2 -translate-y-1/2 pointer-events-none">
                      <${Icon} name="chevron-down" size=${20} className="text-text-sub" />
                    </div>
                  </div>
                </div>

                <!-- 6. 리스트 -->
                <div className="space-y-4">
                  ${displayedData.map((item) => html`
                    <${InfoCard}
                      key=${item.id}
                      item=${item}
                      isExpanded=${expandedCards.has(item.id)}
                      onToggle=${() => toggleCard(item.id)}
                      isHighlighted=${item.id === newlyAddedId}
                      onEdit=${() => handleEditItem(item.id, item.type)}
                      onDelete=${() => handleDeleteItem(item.id, item.type)}
                    />
                  `)}

                  ${currentData.length === 0 ? html`
                    <div className="text-center py-16 flex flex-col items-center justify-center text-gray-400">
                      <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4 text-gray-300">
                        <${Icon} name="search" size=${32} />
                      </div>
                      <span className="font-bold text-lg">검색 결과가 없습니다.</span>
                      <span className="text-sm mt-1 opacity-70">다른 검색어를 입력해보세요.</span>
                    </div>
                  ` : null}
                </div>

                <!-- 7. 더보기 -->
                ${currentData.length > INITIAL_VISIBLE_COUNT ? html`
                  <button
                    onClick=${() => {
                      if (visibleCount < currentData.length) setVisibleCount(v => v + 5);
                      else setVisibleCount(INITIAL_VISIBLE_COUNT);
                    }}
                    className="w-full h-12 mt-6 bg-white border border-border rounded-full flex items-center justify-center text-[15px] font-bold text-text-sub shadow-soft active:scale-[0.98] transition-all gap-1.5 hover:bg-gray-50"
                  >
                    ${visibleCount < currentData.length
                      ? html`더보기 <span className="inline-flex"><${Icon} name="chevron-down" size=${18} /></span>`
                      : html`접기 <span className="inline-flex"><${Icon} name="chevron-up" size=${18} /></span>`
                    }
                  </button>
                ` : null}
              </div>

              <!-- 8. 하단 내비 -->
              <${BottomNav} activeTab=${activeTab} onTabChange=${setActiveTab} />

              <!-- 9. FAB -->
              <button
                className="fixed bottom-[100px] right-5 w-14 h-14 bg-primary text-white rounded-full shadow-[0_4px_12px_rgba(49,163,250,0.4)] flex items-center justify-center z-50 active:scale-90 transition-transform hover:brightness-110"
                onClick=${handleAddItem}
              >
                <span className="text-3xl font-light mb-1">+</span>
              </button>

              <!-- Toast -->
              <div className=${`fixed bottom-[100px] left-1/2 -translate-x-1/2 bg-header-navy/90 backdrop-blur-sm text-white px-6 py-3 rounded-full text-[15px] font-semibold transition-all duration-300 z-[100] pointer-events-none whitespace-nowrap shadow-lg ${toast.show ? "opacity-100 translate-y-0" : "opacity-0 translate-y-4"}`}>
                ${toast.message}
              </div>
            </div>
          `;
        };

        const mount = document.getElementById("root");
        if (!mount) throw new Error("#root 엘리먼트를 찾을 수 없습니다.");

        // React 18 UMD: ReactDOM.createRoot 지원
        const root = ReactDOM.createRoot(mount);
        root.render(html`<${App} />`);
      } catch (err) {
        bootError(err);
      }
    })();
  </script>
</body>
</html>
