# 파트너사 모바일 화면 재구축 계획안 (DY0929)

본 문서는 파트너사 관리자(= `customer_manager`/`partner`) 역할의 모바일 화면을, 최신 소스 구조와 "현장관리자" 메뉴 체계를 기준으로 전면 재구축하기 위한 계획안입니다. 참고 HTML은 레이아웃·톤앤매너·타이포그래피만 참조하고(기능/데이터 로직은 소스 기준), 구현은 현재 코드베이스의 인증/라우팅/스타일 체계를 따릅니다.

참고 파일(디자인 톤 참고용):

- p-main.html, p-site.html, p-task.html, p-worklog.html
  - 경로: `dy_memo/new_image_html_v3.0/inopnc-page/public/raw/`
  - 최신 기능 기준은 레포 소스를 우선 적용

## 1) 목표와 원칙

- 파트너사 모바일 전용 진입점(`/mobile/partner`) 확보 및 메뉴 구조를 "현장관리자"와 동일하게 정렬
- 기존 파트너 전용 UI 로직(선택 UI/복잡한 분기)을 제거하고, 사용자 소속(organization_id) 기반으로 자동 필터된 읽기 중심(또는 제한된 쓰기) UI 제공
- 레이아웃/네비/스타일은 모바일 셸 표준을 재사용하되, 파트너 전용 하단 탭과 홈 대시보드를 제공
- 인증·보안 정책(미들웨어, RLS, CSRF)과 일관성 유지

## 2) 범위(모바일 한정)

- 대상 역할: `customer_manager`, `partner`
- 대상 경로: `/mobile/partner` 및 하위 화면
- 메뉴 구성(현장관리자와 동일 트랙)
  - 홈: `/mobile/partner`
  - 출력정보: `/mobile/attendance`
  - 작업일지: `/mobile/worklog`
  - 현장정보: `/mobile/sites`
  - 문서함: `/mobile/documents` (별도 개편 진행 사항과 연동 예정)

## 3) 정보 구조 및 내비게이션

- 상단: 공통 AppBar(검색/드로어)
- 하단: 파트너 전용 BottomNav(`modules/mobile/components/layout/PartnerBottomNav.tsx`)
- Drawer: 공통(계정/설정/로그아웃 등), 역할 표기만 맞춤
- 페이지 전환: App Router 기본 라우팅, prefetch 최소화, no-store 캐싱 정책 유지

## 4) 인증·보안·접근 제어

- Ultra Simple Auth + 미들웨어 기반 보호(이미 적용):
  - 로그인 후 UI 트랙: `customer_manager`/`partner` → `/mobile/partner`
  - 미들웨어에서 무권한 접근 차단 및 캐시 무효화
- 데이터 접근 제한: 사용자 프로필의 `organization_id` 기준 제한
  - API 레벨: `/api/sites/by-partner`, `/api/partner/*` 등 기존 엔드포인트 활용(조직 필터)
  - UI 레벨: 파트너사/부서 드롭다운 제거(자동 소속 적용)

## 5) 페이지별 설계(초기 버전)

### A. 홈(`/mobile/partner`)

- 목적: 파트너 담당자 관점의 핀치 뷰(KPI/요약/바로가기)
- 구성:
  - KPI 카드: 금일/주간 작업일지 제출 수, 승인 대기, 담당 현장 수 등
  - 빠른 이동: 출력정보, 작업일지, 현장정보, 문서함 링크 카드
  - 공지/알림(선택): 최근 공지/이슈가 있으면 상단 배너
- 데이터 소스(예시):
  - `/api/partner/labor/summary`, `/api/partner/labor/by-site`, `/api/sites/by-partner`
  - 캐시: no-store, 초기엔 클라이언트 fetch, 추후 SSR 혼합 고려

### B. 출력정보(`/mobile/attendance`)

- 목적: 기간/현장 기준으로 근무/출력 현황 확인(읽기 중심)
- 구성:
  - 기간 선택(월/주)
  - 담당 현장 필터(자동 소속 현장만)
  - 총 근무/공수 요약 + 캘린더/리스트 뷰
- 데이터 소스: 기존 attendance 로직 재사용, 다만 조직/현장 필터만 강제

### C. 작업일지(`/mobile/worklog`)

- 목적: 제출/승인 현황 모니터링(읽기 중심, 필요 시 제한된 상세)
- 구성:
  - 상태 필터(제출/승인/반려)
  - 현장/기간 필터(자동 소속 현장만)
  - 항목 리스트 + 상세 보기
- 데이터 소스: 기존 worklog API/액션 재사용, 파트너는 생성/수정 능력을 제한(요건에 따라 결정)

### D. 현장정보(`/mobile/sites`)

- 목적: 담당 현장 목록/상세(기본 정보, 진행 상태, 문서 바로가기)
- 구성:
  - 소속 현장 목록
  - 상세: 기본정보/담당자/문서/도면
- 데이터 소스: `/api/sites/by-partner` 등

### E. 문서함(`/mobile/documents`)

- 별도 개편 진행 중. 파트너 화면은 해당 개편 가이드에 맞춰 리다이렉션 또는 진입점 제공만 우선 적용.

## 6) 컴포넌트 구조(신규)

- 디렉터리
  - `modules/mobile/components/partner/*` (파트너 전용 컴포넌트)
  - `modules/mobile/pages/partner/*` (파트너 전용 페이지 래퍼)
- 공통 재사용
  - 레이아웃 셸: AppBar/Drawer/SearchOverlay는 공통 재사용
  - BottomNav: 파트너 전용으로 분리(홈 링크만 `/mobile/partner`)

## 7) 스타일 가이드(톤앤매너)

- 참고 HTML의 타이포그래피/여백/컬러 톤을 반영
  - 폰트 스케일: 제목 18~20, 본문 14~16(모바일 기준)
  - 카드형 요약 레이아웃, 그림자 최소화, 대비 명확성 강화
- 기존 모바일 전역 스타일(`modules/mobile/styles/*`)과 충돌 없이 확장

## 8) 접근성·성능

- 접근성: 명확한 터치 타겟(44px+), ARIA 라벨, 키보드 포커스 관리(모바일 키보드 대응)
- 성능: 초기 렌더 경량화(필수 데이터 우선), no-store 헤더 유지, 이미지/아이콘 최소화
- 보안: 미들웨어 캐시 무효화, CSRF 체크 유지, RLS 전제

## 9) 구현/이행 단계(마일스톤)

1. 라우팅/셸 스캐폴딩 (완료)
   - `/mobile/partner` 엔트리 및 전용 레이아웃/BottomNav/Wrapper 추가
   - 역할→UI 트랙을 `/mobile/partner`로 정렬
2. 파트너 홈 v1(요약 카드+바로가기)
   - KPI 2~4개 및 주요 링크 카드 구현
3. 출력정보 뷰 최적화
   - 소속 현장 자동 필터, 읽기 중심 UI 고정
4. 작업일지 뷰 최적화
   - 상태/기간 필터, 상세 보기(읽기 중심)
5. 현장정보 뷰 최적화
   - 목록/상세, 문서/도면 바로가기 정리
6. 문서함 연동(개편 반영)
   - 리다이렉션/탭 진입점/권한 반영
7. 레거시 클린업(모바일 한정)
   - 파트너 선택/부서 선택 UI 제거
   - 구 도면/문서 파트너 흐름 제거 또는 격리
8. QA/피드백/성능 점검

## 10) 레거시 정리 후보(모바일)

- 파트너 선택/부서 선택:
  - `modules/mobile/components/home/PartnerCompanySelect.tsx`
  - `modules/mobile/components/home/DepartmentSelect.tsx`
- 구 파트너 도면/문서 흐름:
  - `modules/mobile/components/markup/DrawingBrowser.tsx`
  - `modules/mobile/components/home/DrawingCard*.tsx`, `DrawingQuickAction.tsx`
  - `modules/mobile/hooks/use-blueprints.ts`
- 구 조직 선택 기반 로딩:
  - `modules/mobile/components/home/HomePage.tsx` 중 by-partner 호출
  - `modules/mobile/pages/attendance-page.tsx` 중 조직 기준 로딩 부분
    ※ 실제 제거는 신규 화면 대체 후 참조 제거를 확인하고 단계적으로 진행

## 11) 수용 기준(예시)

- 파트너 역할 로그인 시 1초 내 `/mobile/partner` 진입
- 홈에서 KPI/바로가기 노출, 링크 정상 동작
- 각 메뉴에서 조직 제한이 일관되게 적용(타 조직 데이터 미노출)
- 문서함 개편 완료 시, 동일 내비에서 자연스럽게 전환
- Lighthouse(모바일) 성능 80+, 접근성 90+ 목표

## 12) 즉시 후속 작업 제안

- 홈 v1 컴포넌트에 KPI 수치 바인딩(API 연결)
- 출력정보/작업일지/현장정보 화면에서 파트너 역할 제약(생성/편집 제한) 명확화
- 문서함 개편 가이드 확보 시 라우팅/연동 방식 결정

---

부연: 이미 `/mobile/partner` 라우트, 전용 레이아웃/바텀내비, 홈 래퍼를 스캐폴딩했습니다(빈 요약 카드 + 링크). 본 계획안 승인 시, A→B→C 단계로 페이지별 기능을 빠르게 구체화하고, 레거시를 단계적으로 제거하겠습니다.
