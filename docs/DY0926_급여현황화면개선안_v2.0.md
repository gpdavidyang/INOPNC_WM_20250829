# DY0926\_급여현황화면 개선안 v2.0 (HTML-first + 스냅샷)

## 개요

- 모바일(현장관리자) 급여현황 탭을 단순·명확하게 개편하고, 급여명세서는 PDF 생성 대신 HTML-first로 제공.
- 시스템관리자 급여관리 도구와 계산/데이터가 일치되며, 발행본은 스냅샷(JSON)으로 보존.
- 참고 스크린샷:
  - dy_memo/screenshots_INOPNC_0829/스크린샷 2025-09-26 16.51.44.png
  - dy_memo/screenshots_INOPNC_0829/스크린샷 2025-09-26 17.04.32.png

## 핵심 원칙

- 계산식: 일급 × 총공수 − 세금(소득세+주민세+법정 공제) = 실수령액
- 월 단위 합산(동월 다현장 합산), 모바일/관리자 동일 로직.
- HTML-first 열람, 브라우저 인쇄로 PDF 저장 유도.
- 스냅샷 저장으로 재현성 보장, 권한/RLS 적용.

## 모바일 UI (현장관리자 > 출력정보 > 급여현황)

- 필터: 년월 선택만 유지. ‘현장’ 드롭다운 제거.
- 통계 카드 3개: 현장수 / 공수 / 근무일.
- 급여 요약 카드(간단): 고용형태, 일급, 기본급(월·총액), 세금(총 공제), 실수령액.
- 동작: “급여명세서 보기” → 새 탭에서 HTML 페이지(`/payslip/[userId]/[year]/[month]`) 열기.
- 이력(옵션): 발행본 리스트 → 클릭 시 HTML 열람.

## 시스템관리자 UI (급여관리 도구)

- 발행: 계산 결과 스냅샷(JSON) 저장 → HTML 링크 제공(열람/인쇄).
- 목록/상세: [HTML 보기] 링크, 상태 배지(calculated/approved/paid).
- 대량 발행(옵션): 비동기 스냅샷 생성.

## API/데이터 흐름

- source
  - work_records: 근무/공수/현장 집계.
  - salary_info + employment_tax_rates: 일급·세율 조회.
  - salary_records: 발행본(확정치) 사용.
- 모바일
  - GET /api/salary/monthly?year=YYYY&month=M: 월 급여 요약 반환(총공제 포함).
  - /payslip/[userId]/[year]/[month]: HTML 명세서 렌더.
- 관리자
  - 발행 시 snapshot 저장, 목록에서 HTML 링크 제공.

## 인쇄 CSS 가이드

- @page { size: A4; margin: 12mm; }
- @media print { .no-print { display:none } .page-break { break-before: page; } }
- print-color-adjust: exact 적용.

## 단계적 적용

1. v2.0: 모바일 UI 반영 + /api/salary/monthly + HTML 명세서 라우트 연동(완료).
2. v2.1: 발행 스냅샷 저장/조회, 관리자 목록에 HTML 보기 노출.
3. v2.2: 선택적 PDF 대량 발행(서명/직인) 비동기 지원.

## 구현 체크리스트

- [x] 모바일 급여 탭 ‘현장’ 드롭다운 제거
- [x] 통계 카드 레이블: 현장수/공수/근무일
- [x] 급여 요약 카드 + “급여명세서 보기” 버튼
- [x] /api/salary/monthly 구현(HTML-first 데이터 계약)
- [x] /payslip/... HTML 렌더 동작
- [ ] 스냅샷 저장/조회 연동(다음 단계)
