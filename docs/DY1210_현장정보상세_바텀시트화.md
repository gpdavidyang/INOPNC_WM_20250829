# DY1210: 현장 정보 상세 뷰 바텀시트 통합안

## 배경

- 현장관리자 모바일 화면에서 현장 상세 정보가 두 곳에서 노출되고 있음
  - **A. 현장 정보 카드 내부 확대 상세** (`SiteInfoPage` → `showDetail` true)
  - **B. 참여 현장/파트너 화면에서 사용하는 `SiteInfoBottomSheet`**
- 두 UI가 노출하는 항목이 서로 다르고, 액션(공도면/진행도면/PTW/기타서류/작업일지)도 일부만 제공되어 사용자 혼란이 발생.
- 동일한 데이터 구조를 두 번 렌더링하면서 코드 중복 및 유지보수 부담 증가.

## 목표

1. **진입점 통합**: 상세 정보는 언제나 바텀시트를 통해 노출.
2. **항목/기능 일치**: 게시되는 필드(요약, 담당자, 주소, 작업 정보, 업로드 현황, 문서 링크, CTA 버튼)를 일관되게 유지.
3. **연동 기능 유지**: 공도면/진행도면/PTW 열람, 기타서류 업로드, 작업일지 이동 버튼 포함.

## UI/UX 개선 방향

1. **현장 카드 버튼 변경**
   - `site-info-card`의 “상세” 버튼 클릭 시 `SiteInfoBottomSheet`를 열도록 변경.
   - 카드 내부 `showDetail` 렌더링 로직 제거 → 중복 제거.

2. **바텀시트 섹션 확장**
   - 기존 섹션(요약, 연락처, 주소, CTA)에 다음 항목을 추가:
     - **작업 정보**: 부재명/작업공정/작업유형/블럭 정보.
     - **업로드 현황**: 사진, 도면, PTW 업로드 건수.
     - **문서 리스트**: 공도면/진행도면/PTW 카드 + 파일 목록 + 기존 핸들러 연결.
     - 필요 시 **추가 통계**(사이트 공수/근무일 등)도 상단에 Badge 형태로 표시 가능.

3. **CTA 배치**
   - “기타서류업로드”, “작업일지목록” 버튼은 바텀시트 하단에 고정.
   - 필요하다면 “사진 업로드/도면 업로드” 등 추가 액션 버튼을 동일 영역에 배치.

## 구현 방안

### 1. `SiteInfoPage` (현장 정보 카드)

- `showDetail` 토글이 열리면 바텀시트를 띄우도록 수정.
  ```tsx
  const handleOpenSheet = () => {
    setSheetPayload(buildSheetPayload(currentSite, ...));
    setShowSiteBottomSheet(true);
  };
  ```
- 기존 상세 JSX 제거 및 BottomSheet 전용 데이터 빌더 함수 추가(contacts, address, work details, attachments 등).

### 2. `SiteInfoBottomSheet` 확장

- Props 추가:
  ```ts
  workDetails?: {
    memberName?: string;
    workProcess?: string;
    workType?: string;
    blockInfo?: string;
  };
  uploadSummary?: {
    photoCount: number;
    drawingCount: number;
    ptwCount: number;
  };
  documents?: Array<{
    key: 'construction' | 'progress' | 'ptw';
    title: string;
    files: Attachment[];
    emptyText: string;
    onClick: () => void;
  }>;
  onOpenUpload?: () => void;
  ```
- 섹션 렌더링 조건부 추가:
  - `workDetails` 존재 시 “작업 정보” 카드 렌더.
  - `uploadSummary` 존재 시 배지 표시.
  - `documents` 배열 순회하여 카드형 리스트 구성, 기존 스타일 재사용.
- CTA 그룹: `onOpenOtherDocuments`, `onOpenWorklogList`, `onOpenUpload` 버튼 배치.

### 3. 데이터 전달

- `SiteInfoPage` 및 참여 현장 리스트에서 BottomSheet 호출 시 공통 데이터 구조 생성:
  - `contactItems`: 기존 로직 재사용 (`buildSiteContactItems`).
  - `workDetails`: `currentSite.process` 및 위치 정보.
  - `uploadSummary`: `attachments` / `photoCounts` 등 집계.
  - `documents`: `attachments.construction / progress / ptw` 와 핸들러.
  - CTA 핸들러: 기존 함수 (`handleAttachmentOpen`, `handleOpenLatestProgressDrawing`, `handleOtherDocs`, `openWorklogList`, `openPhotoUpload` 등).

### 4. 연동 기능 재검증

- 바텀시트 내 각 버튼/파일 클릭 시 기존 핸들러를 호출하도록 연결.
  - 공도면/진행도면/PTW: 기존 onClick 함수를 `documents` 항목에 전달하여 호출.
  - 기타서류업로드: `onOpenOtherDocuments`.
  - 작업일지목록: `onOpenWorklogList`.
  - 사진/도면 업로드 등 추가 액션도 동일 방식으로 연결.

### 5. QA 포인트

1. 현장 정보 카드 → 상세 → 바텀시트 동일 구성/기능 확인.
2. 참여 현장 리스트/파트너 화면에서도 동일 레이아웃 노출.
3. 문서 항목 클릭, CTA 버튼(기타서류·작업일지), 맵/복사/전화 기능 정상 동작.
4. `documents`/`workDetails` 데이터가 없는 경우 섹션이 자연스럽게 숨겨지는지 확인.
