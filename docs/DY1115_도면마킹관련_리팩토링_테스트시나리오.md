# DY1115 도면마킹 워크플로우 리팩토링 테스트 시나리오

## 1. 마킹 저장 & PDF 생성

1. `/mobile/markup-tool`에서 기존 도면을 열어 마킹 후 저장.
2. Supabase `markup_documents`에서 신규 레코드 생성 확인 (`preview_image_url`, `markup_data`).
3. 관리자 현장공유함(`/documents/hub`)에서 해당 도면에 **보기**와 **PDF** 버튼이 표시되는지 확인.
4. “보기”는 웹 이미지(Preview), “PDF” 버튼은 snapshot PDF를 열어야 함.

## 2. 작업일지 연동 체크

1. 현장공유함에서 `?worklogId=...` 쿼리로 접속하여 대상 도면을 작업일지에 연결.
2. `markup_document_worklog_links` 테이블에 링크가 추가되었는지 확인.
3. 관리자 작업일지 상세(`/dashboard/admin/daily-reports/[id]`)에서 연결된 도면 목록에 PDF 버튼이 노출되는지 확인.
4. 모바일 작업일지 상세(`/mobile/worklog/[id]`)에서도 연결된 도면 섹션에 PDF 링크가 노출되는지 확인.

## 3. 현장공유함 저장/공유 버튼 확인

1. 현장공유함에서 도면을 선택한 뒤 “저장하기” 실행 시 snapshot PDF가 다운로드되는지 확인.
2. “공유하기” 버튼(`navigator.share`)이 허용된 환경에서 PDF 링크를 공유하는지 확인.
3. PDF 없는 일반 도면의 경우 기존(이미지) URL로 계속 동작하는지 확인.

## 4. 관리자 UI

1. `/dashboard/admin/sites/[siteId]/documents`에서 공유자료 리스트에 PDF 버튼이 표시되는지 확인.
2. `/dashboard/admin/tools/markup` Recent Docs에서 `PDF` 버튼을 클릭하면 snapshot PDF가 열리는지 확인.
3. Markup Tool 편집 화면에서 저장 후 남기는 안내(현장공유함에서 PDF 확인)를 확인.

## 5. 모바일 워크플로우 안내

1. 모바일 마킹 도구에서 저장 시 “PDF로 저장됨” 안내 Toast가 노출되는지 확인.
2. 모바일 WorkLogModal(작성/수정) 화면에서 연결된 도면 리스트가 PDF 여부와 함께 출력되는지 확인.
3. 모바일 DiaryDetailViewer가 `PDF` 버튼을 노출하고 올바른 링크를 여는지 확인.

## 6. 백필 검증

1. `tsx scripts/backfill-markup-snapshots.ts` 실행 후 로그 확인.
2. 이전에 PDF가 없던 문서가 새로운 PDF 버튼을 가지는지 sampling.
