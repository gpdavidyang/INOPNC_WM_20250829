# DY0920 Mobile Documents Test Plan

## 🎯 Overview

문서함 V2 화면의 UI/UX 구현과 Supabase 연동을 안정적으로 검증하기 위한 계획입니다. 현재 구현 상태는 다음과 같습니다.

- `/api/documents` GET으로 _내 문서_ / _공유 문서_ 목록을 Supabase에서 가져와 렌더링합니다.
- 검색, 탭 이동, 단일 선택, 미리보기, 공유 모달 등 UI 흐름이 요구사항에 맞게 연결되어 있습니다.
- 업로드/삭제는 아직 로컬 토스트만 띄우며, Supabase 저장소와 DB에 반영되지 않습니다. (후속 작업 예정)

## ✅ 핵심 시나리오

1. **목록 로딩**
   - 로그인 사용자 기준으로 개인/공유 문서가 API에서 정상적으로 내려오는지 확인
   - 빈 상태 UI, 에러 상태 UI, 검색 결과 UI

2. **선택 및 삭제 모드**
   - 검색어 입력 및 초기화 후 필터링 되돌리기
   - 탭별로 단일 문서만 선택 가능한지 확인
   - 롱프레스 → 삭제 모드 진입 → 다른 영역 탭 시 종료되는지 확인

3. **업로드** _(후속 연동 완료 후 검증)_
   - 10MB 이하의 허용 확장자(PDF/JPG/PNG/DOC/DOCX) 업로드 → 목록이 즉시 갱신되는지 확인
   - 업로드 실패/중단 시 토스트와 상태가 올바르게 표시되는지 확인

4. **삭제** _(후속 연동 완료 후 검증)_
   - 선택한 문서를 삭제하면 목록/로컬 스토리지/데이터베이스에서 제거되는지 확인
   - 삭제 실패 시 오류 토스트가 노출되는지 확인

5. **공유**
   - 업로드된 문서만 이메일/카카오 옵션이 활성화되는지 확인
   - 공유 옵션 선택 시 안내 메시지 또는 링크가 정상 동작하는지 확인

## 🔧 수동 검증 루틴

1. `npm run dev` 후 `/mobile/documents` 페이지 접속 (모바일 뷰)
2. 개인·공유 문서 카드 노출 여부 확인
3. 검색/선택/삭제 모드/미리보기/공유 토스트를 순차적으로 확인
4. (업로드/삭제 연동 후) Supabase 대시보드 또는 `curl`로 데이터 변경 여부 확인

## 🤖 자동화(E2E) 계획

1. **로그인 헬퍼 마련**: `e2e/auth` 유틸 또는 새로운 로그인 스텝을 작성해 재사용
2. **테스트 데이터 준비**: 테스트용 사용자와 문서를 초기화하는 seed 스크립트 또는 API 호출 마련
3. **Playwright 시나리오 구성**: `e2e/mobile/documents.spec.ts`에서 아래 케이스 작성
   - 목록 로딩 후 카드 노출 확인
   - 업로드 → 목록 반영 → 삭제 → 제거 확인
   - 공유 버튼 활성화 조건 확인
4. **환경 분리**: `.env`에 테스트용 Supabase 키, BASE_URL을 정의하고 `npm run test:e2e -- --grep @documents`처럼 문서함 시나리오만 실행
5. **CI 연계**: 배포 전(또는 nightly) 문서함 시나리오를 돌릴 수 있도록 파이프라인에 추가 (다른 화면 안정화 후 시행)

## 🛠️ 도구 및 스크립트

- `npm run lint`, `npm test`, `npm run test:e2e`
- `scripts/mobile-documents-snapshot.sh` (추가 예정): `/api/documents?type=personal/shared` 호출로 API 상태 점검
- Supabase 대시보드 또는 SQL 에디터

## 📌 후속 작업 메모

- `/api/documents` POST/DELETE를 모바일 업로드/삭제에서 실제 호출되도록 연동 예정
- 공유 기능(이메일/카카오)도 실제 API와 연결하는 경우, 성공·실패 케이스별 추가 검증 필요
- 미리보기 모달은 현재 시뮬레이션 상태이므로, 파일 타입별 렌더링 로직을 도입할 경우 대응 필요

---

위 계획을 기준으로 다른 화면 구현이 정리된 뒤 Playwright 테스트 및 후속 자동화를 한꺼번에 적용하는 것을 권장합니다.
