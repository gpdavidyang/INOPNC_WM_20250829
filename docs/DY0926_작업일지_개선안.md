# DY0926 작업일지 목록/상세 개선안 (범위 축소)

본 문서는 dy_memo/new_image_html_v3.0/inopnc-page/public/raw/task.html 의 ‘작업일지’ 화면 중 “목록(List)·상세(Detail)”에 한정해 현재 구현과 격차를 정리하고, 개선 방안을 제안합니다. 출력현황/급여현황은 범위에서 제외합니다.

--

## 1) 요구 레퍼런스(목록/상세) 핵심

- 목록 카드
  - 현장명, 작성자, 일자, 위치(블럭/동/호), 공정/유형, 공수, 상태 배지, 첨부(사진/도면/완료/기타) 개수 표시.
  - 카드 클릭 → 풀스크린 상세 열기, 더보기/무한 스크롤 UX.
- 상세(Fullscreen)
  - 기본정보(현장/주소/부재명/공정/유형/블럭·동·층) + 문서 탭(사진대지/진행도면/완료확인서/기타).
  - 줌(+/−/표시), 탭 닫기, PDF/공유, 드래그&드롭 업로드 상호작용.

--

## 2) 현재 구현(목록/상세) 요약

- 목록 UI 2계열
  - v2 카드: modules/mobile/components/work-log/WorkLogCard.tsx:1 (현 WorkLogHomePage에서 사용)
  - v3 레퍼런스형: modules/mobile/components/worklogs/TaskDiaryListItem.tsx:1, TaskDiaryList.tsx:1 (.worklog-card 스타일)
- 상세(풀스크린)
  - modules/mobile/components/worklogs/DiaryDetailViewer.tsx:1 (사진/도면/완료/기타, 마킹 문서 링크, 닫기/다운로드 버튼)
- 데이터 소스/매핑
  - /api/mobile/daily-reports → modules/mobile/data/worklog-api.ts:1 에서 WorklogSummary/Detail로 정규화(상태/첨부/위치 포함)

--

## 3) 격차(목록/상세 중심)

- 목록 톤&매너/정보 밀도
  - v2 WorkLogCard는 레퍼런스(.worklog-card) 시각 톤과 다르고, 첨부 개수/상태 칩 구성이 상이.
- 상세 연결성
  - WorkLogHomePage에는 풀스크린 상세 연결 부재(작성/수정 모달만 존재). v3 DiaryDetailViewer 미연결.
- 첨부 ‘기타(others)’ 흐름
  - 뷰어는 분류 지원, 생성/수정 플로우에서 others 그룹 선택/저장 매핑 일부 보강 필요.
- 더보기/무한 스크롤
  - TaskDiaryList는 더보기 UI만 보유, API 페이지 파라미터 연동 미완.
- 줌/PDF/공유 동작
  - 버튼 레이아웃은 있으나 실제 동작/프리셋/표시 상태는 보강 필요.

--

## 4) 개선 목표(목록/상세 한정)

- 목록을 레퍼런스 스타일로 일치: `.worklog-card` 기반 v3 리스트 사용, 메타/상태/첨부 수 표준화.
- 클릭 시 풀스크린 상세 연결: v3 DiaryDetailViewer로 전환, 문서/마킹/다운로드 액션 제공.
- 단일 데이터 소스: `/api/mobile/daily-reports` + `worklog-api.ts` 매퍼 활용.
- 더보기(페이지네이션)와 간단 검색/필터(선택)는 최소 범위에서 지원.

--

## 5) 구현 계획(실행 단계)

- 단계 A: 목록 교체·연결
  - `modules/worker-site-manager/pages/WorkLogHomePage.tsx:1` 목록 영역을 v3 `TaskDiaryList`로 교체 또는 추가.
  - 데이터: `fetchWorklogList`로 summaries/detailMap 동시 확보, `onSelect(id)` → 상세 오픈.
  - 스타일: `modules/mobile/styles/worklogs.css:1`, `app/globals.css:1897` 토큰 재사용(레퍼런스 일치 확인).

- 단계 B: 상세 뷰어 연동 강화
  - 상태 관리: 선택된 id → detailMap에서 `WorklogDetail` 조회 후 `DiaryDetailViewer` 오픈/닫기.
  - 액션:
    - 문서 열기: 새 탭(noopener,noreferrer) 또는 콜백으로 내부 뷰잉.
    - 마킹 열기: `/mobile/markup-tool?worklogId=...` (이미 지원 코드 존재)
    - 전체 다운로드: 첨부 URL 개별 오픈(1차) → zip 다운로드(2차 개선).
    - 줌: 50/75/100/125/150/200% 프리셋 + 현재 배율 표시 및 이미지 scale 반영.

- 단계 C: 첨부 ‘others’ 저장/표시 보강
  - `modules/mobile/services/work-log.service.ts:1` uploadAttachments에 `others → document_type='other'` 보강 확인.
  - 작성/수정 사용 시 `FileUploadSection.tsx:1`에 others 그룹 노출 옵션(필요 시 활성화) 적용.

- 단계 D: 더보기/간단 검색(선택)
  - `/api/mobile/daily-reports?page=N&limit=M` 연동한 단순 페이지네이션 또는 더보기 버튼 구현.
  - 검색/필터(필요 시): siteId/기간/텍스트 일부만 연결(상단 간단 컨트롤).

--

## 6) 변경 파일(목록/상세 범위)

- `modules/worker-site-manager/pages/WorkLogHomePage.tsx:1` (v3 리스트/상세 연결 및 데이터 전환)
- `modules/mobile/components/worklogs/TaskDiaryList.tsx:1`, `TaskDiaryListItem.tsx:1` (필요 시 프롭/접근성 보강)
- `modules/mobile/components/worklogs/DiaryDetailViewer.tsx:1` (줌/PDF/공유/다운로드 핸들러 채움)
- `modules/mobile/services/work-log.service.ts:1` (others 매핑 보강)
- `modules/mobile/components/work-log/FileUploadSection.tsx:1` (others 그룹 노출 시)

보호 파일은 편집하지 않음.

--

## 7) 수용 기준(acceptance)

- 목록 카드가 레퍼런스 스타일과 유사하고(현장/일자/공정/공수/상태/첨부 수), 다건 렌더링 성능 정상.
- 카드 클릭 시 풀스크린 상세가 열리고, 문서 그룹(사진/도면/완료/기타)이 올바르게 분류/표시.
- ‘마킹 열기’가 해당 작업일지 id로 정상 이동, ‘전체 다운로드’/개별 열기 동작 가능.
- 줌 프리셋/표시가 동작, 이미지 스케일 시 품질·레이아웃 깨짐 없음.

--

## 8) 일정(목록/상세 한정)

- A(목록 교체·연결): 0.5~1일
- B(상세 뷰어/액션): 0.5~1일
- C(others 매핑/작성 연동): 0.5일
- D(더보기/간단 검색): 0.5일

총 2~3일(리뷰 포함).

--

## 9) 참고 파일

- 요구 레퍼런스: `dy_memo/new_image_html_v3.0/inopnc-page/public/raw/task.html`
- 목록/상세 컴포넌트: `modules/mobile/components/worklogs/TaskDiaryList.tsx:1`, `modules/mobile/components/worklogs/TaskDiaryListItem.tsx:1`, `modules/mobile/components/worklogs/DiaryDetailViewer.tsx:1`
- 데이터 매핑: `modules/mobile/data/worklog-api.ts:1`
- 현재 페이지: `modules/worker-site-manager/pages/WorkLogHomePage.tsx:1`
